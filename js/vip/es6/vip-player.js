!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/assets/",__webpack_require__(__webpack_require__.s=29)}([function(module,exports){module.exports=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={error:console.error,warn:console.warn,log:console.log,debug:()=>{},v2:()=>{},deprecated:s=>{throw console.warn(s),new Error(s)}};exports.default=_default},function(module,exports,__webpack_require__){"use strict";var Stream=function(){this.init=function(){var listeners={};this.on=function(type,listener){listeners[type]||(listeners[type]=[]),listeners[type]=listeners[type].concat(listener)},this.off=function(type,listener){var index;return!!listeners[type]&&(index=listeners[type].indexOf(listener),listeners[type]=listeners[type].slice(),listeners[type].splice(index,1),index>-1)},this.trigger=function(type){var callbacks,i,length,args;if(callbacks=listeners[type])if(2===arguments.length)for(length=callbacks.length,i=0;i<length;++i)callbacks[i].call(this,arguments[1]);else{for(args=[],i=arguments.length,i=1;i<arguments.length;++i)args.push(arguments[i]);for(length=callbacks.length,i=0;i<length;++i)callbacks[i].apply(this,args)}},this.dispose=function(){listeners={}}}};Stream.prototype.pipe=function(destination){return this.on("data",(function(data){destination.push(data)})),this.on("done",(function(flushSource){destination.flush(flushSource)})),this.on("partialdone",(function(flushSource){destination.partialFlush(flushSource)})),this.on("endedtimeline",(function(flushSource){destination.endTimeline(flushSource)})),this.on("reset",(function(flushSource){destination.reset(flushSource)})),destination},Stream.prototype.push=function(data){this.trigger("data",data)},Stream.prototype.flush=function(flushSource){this.trigger("done",flushSource)},Stream.prototype.partialFlush=function(flushSource){this.trigger("partialdone",flushSource)},Stream.prototype.endTimeline=function(flushSource){this.trigger("endedtimeline",flushSource)},Stream.prototype.reset=function(flushSource){this.trigger("reset",flushSource)},module.exports=Stream},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default=class FakeEvent{constructor(type,optDict){const dict=optDict||{};Object.keys(dict).forEach(key=>{this[key]=dict[key]}),this.bubbles=!1,this.cancelable=!1,this.defaultPrevented=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=type,this.isTrusted=!1,this.currentTarget=null,this.target=null,this.stopped=!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopImmediatePropagation(){this.stopped=!0}stopPropagation(){}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _assert=_interopRequireDefault(__webpack_require__(49)),_logger=_interopRequireDefault(__webpack_require__(1)),_MultiMap=_interopRequireDefault(__webpack_require__(50)),_FakeEvent=_interopRequireDefault(__webpack_require__(3));exports.default=class FakeEventTarget{constructor(){this.listeners_=new _MultiMap.default,this.dispatchTarget=this}addEventListener(type,listener){this.listeners_.push(type,listener)}removeEventListener(type,listener){this.listeners_.remove(type,listener)}dispatchEvent(event){(0,_assert.default)(event instanceof _FakeEvent.default,"FakeEventTarget can only dispatch FakeEvents!");const listeners=this.listeners_.get(event.type)||[];for(let i=0;i<listeners.length;i+=1){event.target=this.dispatchTarget,event.currentTarget=this.dispatchTarget;const listener=listeners[i];try{listener.handleEvent?listener.handleEvent(event):listener.call(this,event)}catch(exception){_logger.default.error("Uncaught exception in event handler",exception,exception?exception.message:null,exception?exception.stack:null)}if(event.stopped)break}return event.defaultPrevented}}},function(module,exports,__webpack_require__){"use strict";var secondsToVideoTs,secondsToAudioTs,videoTsToSeconds,audioTsToSeconds,audioTsToVideoTs,videoTsToAudioTs,metadataTsToSeconds;secondsToVideoTs=function(seconds){return 9e4*seconds},secondsToAudioTs=function(seconds,sampleRate){return seconds*sampleRate},videoTsToSeconds=function(timestamp){return timestamp/9e4},audioTsToSeconds=function(timestamp,sampleRate){return timestamp/sampleRate},audioTsToVideoTs=function(timestamp,sampleRate){return secondsToVideoTs(audioTsToSeconds(timestamp,sampleRate))},videoTsToAudioTs=function(timestamp,sampleRate){return secondsToAudioTs(videoTsToSeconds(timestamp),sampleRate)},metadataTsToSeconds=function(timestamp,timelineStartPts,keepOriginalTimestamps){return videoTsToSeconds(keepOriginalTimestamps?timestamp:timestamp-timelineStartPts)},module.exports={ONE_SECOND_IN_TS:9e4,secondsToVideoTs,secondsToAudioTs,videoTsToSeconds,audioTsToSeconds,audioTsToVideoTs,videoTsToAudioTs,metadataTsToSeconds}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.veygaToVipError=veygaToVipError,exports.default=exports.VeygoPlayerError=exports.VeygoPlayerErrorCode=exports.VeygoPlayerErrorCategory=exports.VeygoPlayerErrorSeverity=void 0;const VeygoPlayerErrorSeverity={RECOVERABLE:1,CRITICAL:2};exports.VeygoPlayerErrorSeverity=VeygoPlayerErrorSeverity;const VeygoPlayerErrorCategory={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9};exports.VeygoPlayerErrorCategory=VeygoPlayerErrorCategory;const VeygoPlayerErrorCode={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,SOURCE_NOT_SET:1010,BAD_STATE:1011,BAD_ARGUMENT:1012,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,INTERNAL_ERROR_KEY_STATUS:4013,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,VIP_SDK_NOT_ACTIVE:7003,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013};function veygaToVipError(veygaError){let{category}=veygaError;const{message}=veygaError;let code,severity;if(category===VeygoPlayerErrorCategory.NETWORK)category="network",code===VeygoPlayerErrorCode.BAD_HTTP_STATUS&&(code="bad_http_status");else if(category===VeygoPlayerErrorCategory.MANIFEST)category="set_source",code===VeygoPlayerErrorCode.UNABLE_TO_GUESS_MANIFEST_TYPE?code="unsupported_manifest":code===VeygoPlayerErrorCode.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME&&(code="unsupported_hls_stream");else if(category===VeygoPlayerErrorCategory.DRM)category="drm",code===VeygoPlayerErrorCode.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE?code="unsupported":code===VeygoPlayerErrorCode.LICENSE_REQUEST_FAILED&&(code=void 0);else if(void 0!==category){const cats=VeygoPlayerErrorCategory,keys=Object.keys(cats);for(let i=0;i<keys.length;i+=1){const key=keys[i];if(cats[key]===category){category=key.toLowerCase();break}}}if(void 0===code){const codes=VeygoPlayerErrorCode,keys=Object.keys(codes);for(let i=0;i<keys.length;i+=1){const key=keys[i];if(codes[key]===veygaError.code){code=key.toLowerCase();break}}}{const severities=VeygoPlayerErrorSeverity,keys=Object.keys(severities);for(let i=0;i<keys.length;i+=1){const key=keys[i];if(severities[key]===veygaError.severity){severity=key.toLowerCase();break}}}return{severity,category,code,message}}exports.VeygoPlayerErrorCode=VeygoPlayerErrorCode;class VeygoPlayerError extends Error{constructor(severity,category,code,...varArgs){const error=veygaToVipError({severity,category,code});super(`${error.category}:${error.code}`),this.name="VeygoPlayerError",this.severity=error.severity,this.category=error.category,this.code=error.code,this.data=varArgs,this.handled=!1}toString(){return"VeygoPlayerError "+JSON.stringify({severity:this.severity,category:this.category,code:this.code,data:this.data},null,"")}}exports.VeygoPlayerError=VeygoPlayerError,VeygoPlayerError.Severity=VeygoPlayerErrorSeverity,VeygoPlayerError.Category=VeygoPlayerErrorCategory,VeygoPlayerError.Code=VeygoPlayerErrorCode;var _default=VeygoPlayerError;exports.default=_default},function(module,exports,__webpack_require__){"use strict";module.exports={toUnsigned:function(value){return value>>>0},toHexString:function(value){return("00"+value.toString(16)).slice(-2)}}},function(module,exports){function _extends(){return module.exports=_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}module.exports=_extends},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={HTML5:0,VEYGOD:1,HLSJS:2,VEYGA:3,YOUTUBE:4,UNKNOWN:10};exports.default=_default},function(module,exports,__webpack_require__){"use strict";var VideoSegmentStream,AudioSegmentStream,Transmuxer,CoalesceStream,Stream=__webpack_require__(2),mp4=__webpack_require__(14),frameUtils=__webpack_require__(35),audioFrameUtils=__webpack_require__(36),trackDecodeInfo=__webpack_require__(38),m2ts=__webpack_require__(39),clock=__webpack_require__(5),AdtsStream=__webpack_require__(42),H264Stream=__webpack_require__(43).H264Stream,AacStream=__webpack_require__(45),isLikelyAacData=__webpack_require__(23).isLikelyAacData,ONE_SECOND_IN_TS=__webpack_require__(5).ONE_SECOND_IN_TS,AUDIO_PROPERTIES=__webpack_require__(46),VIDEO_PROPERTIES=__webpack_require__(47),arrayEquals=function(a,b){var i;if(a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0},generateSegmentTimingInfo=function(baseMediaDecodeTime,startDts,startPts,endDts,endPts,prependedContentDuration){return{start:{dts:baseMediaDecodeTime,pts:baseMediaDecodeTime+(startPts-startDts)},end:{dts:baseMediaDecodeTime+(endDts-startDts),pts:baseMediaDecodeTime+(endPts-startPts)},prependedContentDuration,baseMediaDecodeTime}};(AudioSegmentStream=function(track,options){var adtsFrames=[],sequenceNumber=0,earliestAllowedDts=0,audioAppendStartTs=0,videoBaseMediaDecodeTime=1/0;options=options||{},AudioSegmentStream.prototype.init.call(this),this.push=function(data){trackDecodeInfo.collectDtsInfo(track,data),track&&AUDIO_PROPERTIES.forEach((function(prop){track[prop]=data[prop]})),adtsFrames.push(data)},this.setEarliestDts=function(earliestDts){earliestAllowedDts=earliestDts},this.setVideoBaseMediaDecodeTime=function(baseMediaDecodeTime){videoBaseMediaDecodeTime=baseMediaDecodeTime},this.setAudioAppendStart=function(timestamp){audioAppendStartTs=timestamp},this.flush=function(){var frames,moof,mdat,boxes,frameDuration,segmentDuration,videoClockCyclesOfSilencePrefixed;0!==adtsFrames.length?(frames=audioFrameUtils.trimAdtsFramesByEarliestDts(adtsFrames,track,earliestAllowedDts),track.baseMediaDecodeTime=trackDecodeInfo.calculateTrackBaseMediaDecodeTime(track,options.keepOriginalTimestamps),videoClockCyclesOfSilencePrefixed=audioFrameUtils.prefixWithSilence(track,frames,audioAppendStartTs,videoBaseMediaDecodeTime),track.samples=audioFrameUtils.generateSampleTable(frames),mdat=mp4.mdat(audioFrameUtils.concatenateFrameData(frames)),adtsFrames=[],moof=mp4.moof(sequenceNumber,[track]),boxes=new Uint8Array(moof.byteLength+mdat.byteLength),sequenceNumber++,boxes.set(moof),boxes.set(mdat,moof.byteLength),trackDecodeInfo.clearDtsInfo(track),frameDuration=Math.ceil(1024*ONE_SECOND_IN_TS/track.samplerate),frames.length&&(segmentDuration=frames.length*frameDuration,this.trigger("segmentTimingInfo",generateSegmentTimingInfo(clock.audioTsToVideoTs(track.baseMediaDecodeTime,track.samplerate),frames[0].dts,frames[0].pts,frames[0].dts+segmentDuration,frames[0].pts+segmentDuration,videoClockCyclesOfSilencePrefixed||0)),this.trigger("timingInfo",{start:frames[0].pts,end:frames[0].pts+segmentDuration})),this.trigger("data",{track,boxes}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){trackDecodeInfo.clearDtsInfo(track),adtsFrames=[],this.trigger("reset")}}).prototype=new Stream,(VideoSegmentStream=function(track,options){var config,pps,sequenceNumber=0,nalUnits=[],gopsToAlignWith=[];options=options||{},VideoSegmentStream.prototype.init.call(this),delete track.minPTS,this.gopCache_=[],this.push=function(nalUnit){trackDecodeInfo.collectDtsInfo(track,nalUnit),"seq_parameter_set_rbsp"!==nalUnit.nalUnitType||config||(config=nalUnit.config,track.sps=[nalUnit.data],VIDEO_PROPERTIES.forEach((function(prop){track[prop]=config[prop]}),this)),"pic_parameter_set_rbsp"!==nalUnit.nalUnitType||pps||(pps=nalUnit.data,track.pps=[nalUnit.data]),nalUnits.push(nalUnit)},this.flush=function(){for(var frames,gopForFusion,gops,moof,mdat,boxes,firstGop,lastGop,prependedContentDuration=0;nalUnits.length&&"access_unit_delimiter_rbsp"!==nalUnits[0].nalUnitType;)nalUnits.shift();if(0===nalUnits.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(frames=frameUtils.groupNalsIntoFrames(nalUnits),(gops=frameUtils.groupFramesIntoGops(frames))[0][0].keyFrame||((gopForFusion=this.getGopForFusion_(nalUnits[0],track))?(prependedContentDuration=gopForFusion.duration,gops.unshift(gopForFusion),gops.byteLength+=gopForFusion.byteLength,gops.nalCount+=gopForFusion.nalCount,gops.pts=gopForFusion.pts,gops.dts=gopForFusion.dts,gops.duration+=gopForFusion.duration):gops=frameUtils.extendFirstKeyFrame(gops)),gopsToAlignWith.length){var alignedGops;if(!(alignedGops=options.alignGopsAtEnd?this.alignGopsAtEnd_(gops):this.alignGopsAtStart_(gops)))return this.gopCache_.unshift({gop:gops.pop(),pps:track.pps,sps:track.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),nalUnits=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");trackDecodeInfo.clearDtsInfo(track),gops=alignedGops}trackDecodeInfo.collectDtsInfo(track,gops),track.samples=frameUtils.generateSampleTable(gops),mdat=mp4.mdat(frameUtils.concatenateNalData(gops)),track.baseMediaDecodeTime=trackDecodeInfo.calculateTrackBaseMediaDecodeTime(track,options.keepOriginalTimestamps),this.trigger("processedGopsInfo",gops.map((function(gop){return{pts:gop.pts,dts:gop.dts,byteLength:gop.byteLength}}))),firstGop=gops[0],lastGop=gops[gops.length-1],this.trigger("segmentTimingInfo",generateSegmentTimingInfo(track.baseMediaDecodeTime,firstGop.dts,firstGop.pts,lastGop.dts+lastGop.duration,lastGop.pts+lastGop.duration,prependedContentDuration)),this.trigger("timingInfo",{start:gops[0].pts,end:gops[gops.length-1].pts+gops[gops.length-1].duration}),this.gopCache_.unshift({gop:gops.pop(),pps:track.pps,sps:track.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),nalUnits=[],this.trigger("baseMediaDecodeTime",track.baseMediaDecodeTime),this.trigger("timelineStartInfo",track.timelineStartInfo),moof=mp4.moof(sequenceNumber,[track]),boxes=new Uint8Array(moof.byteLength+mdat.byteLength),sequenceNumber++,boxes.set(moof),boxes.set(mdat,moof.byteLength),this.trigger("data",{track,boxes}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),nalUnits=[],this.gopCache_.length=0,gopsToAlignWith.length=0,this.trigger("reset")},this.resetStream_=function(){trackDecodeInfo.clearDtsInfo(track),config=void 0,pps=void 0},this.getGopForFusion_=function(nalUnit){var dtsDistance,nearestGopObj,currentGop,currentGopObj,i,nearestDistance=1/0;for(i=0;i<this.gopCache_.length;i++)currentGop=(currentGopObj=this.gopCache_[i]).gop,track.pps&&arrayEquals(track.pps[0],currentGopObj.pps[0])&&track.sps&&arrayEquals(track.sps[0],currentGopObj.sps[0])&&(currentGop.dts<track.timelineStartInfo.dts||(dtsDistance=nalUnit.dts-currentGop.dts-currentGop.duration)>=-1e4&&dtsDistance<=45e3&&(!nearestGopObj||nearestDistance>dtsDistance)&&(nearestGopObj=currentGopObj,nearestDistance=dtsDistance));return nearestGopObj?nearestGopObj.gop:null},this.alignGopsAtStart_=function(gops){var alignIndex,gopIndex,align,gop,byteLength,nalCount,duration,alignedGops;for(byteLength=gops.byteLength,nalCount=gops.nalCount,duration=gops.duration,alignIndex=gopIndex=0;alignIndex<gopsToAlignWith.length&&gopIndex<gops.length&&(align=gopsToAlignWith[alignIndex],gop=gops[gopIndex],align.pts!==gop.pts);)gop.pts>align.pts?alignIndex++:(gopIndex++,byteLength-=gop.byteLength,nalCount-=gop.nalCount,duration-=gop.duration);return 0===gopIndex?gops:gopIndex===gops.length?null:((alignedGops=gops.slice(gopIndex)).byteLength=byteLength,alignedGops.duration=duration,alignedGops.nalCount=nalCount,alignedGops.pts=alignedGops[0].pts,alignedGops.dts=alignedGops[0].dts,alignedGops)},this.alignGopsAtEnd_=function(gops){var alignIndex,gopIndex,align,gop,alignEndIndex,matchFound,trimIndex;for(alignIndex=gopsToAlignWith.length-1,gopIndex=gops.length-1,alignEndIndex=null,matchFound=!1;alignIndex>=0&&gopIndex>=0;){if(align=gopsToAlignWith[alignIndex],gop=gops[gopIndex],align.pts===gop.pts){matchFound=!0;break}align.pts>gop.pts?alignIndex--:(alignIndex===gopsToAlignWith.length-1&&(alignEndIndex=gopIndex),gopIndex--)}if(!matchFound&&null===alignEndIndex)return null;if(0===(trimIndex=matchFound?gopIndex:alignEndIndex))return gops;var alignedGops=gops.slice(trimIndex),metadata=alignedGops.reduce((function(total,gop){return total.byteLength+=gop.byteLength,total.duration+=gop.duration,total.nalCount+=gop.nalCount,total}),{byteLength:0,duration:0,nalCount:0});return alignedGops.byteLength=metadata.byteLength,alignedGops.duration=metadata.duration,alignedGops.nalCount=metadata.nalCount,alignedGops.pts=alignedGops[0].pts,alignedGops.dts=alignedGops[0].dts,alignedGops},this.alignGopsWith=function(newGopsToAlignWith){gopsToAlignWith=newGopsToAlignWith}}).prototype=new Stream,(CoalesceStream=function(options,metadataStream){this.numberOfTracks=0,this.metadataStream=metadataStream,void 0!==(options=options||{}).remux?this.remuxTracks=!!options.remux:this.remuxTracks=!0,"boolean"==typeof options.keepOriginalTimestamps?this.keepOriginalTimestamps=options.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,CoalesceStream.prototype.init.call(this),this.push=function(output){return output.text?this.pendingCaptions.push(output):output.frames?this.pendingMetadata.push(output):(this.pendingTracks.push(output.track),this.pendingBytes+=output.boxes.byteLength,"video"===output.track.type&&(this.videoTrack=output.track,this.pendingBoxes.push(output.boxes)),void("audio"===output.track.type&&(this.audioTrack=output.track,this.pendingBoxes.unshift(output.boxes))))}}).prototype=new Stream,CoalesceStream.prototype.flush=function(flushSource){var caption,id3,initSegment,i,offset=0,event={captions:[],captionStreams:{},metadata:[],info:{}},timelineStartPts=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==flushSource&&"AudioSegmentStream"!==flushSource)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(timelineStartPts=this.videoTrack.timelineStartInfo.pts,VIDEO_PROPERTIES.forEach((function(prop){event.info[prop]=this.videoTrack[prop]}),this)):this.audioTrack&&(timelineStartPts=this.audioTrack.timelineStartInfo.pts,AUDIO_PROPERTIES.forEach((function(prop){event.info[prop]=this.audioTrack[prop]}),this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?event.type=this.pendingTracks[0].type:event.type="combined",this.emittedTracks+=this.pendingTracks.length,initSegment=mp4.initSegment(this.pendingTracks),event.initSegment=new Uint8Array(initSegment.byteLength),event.initSegment.set(initSegment),event.data=new Uint8Array(this.pendingBytes),i=0;i<this.pendingBoxes.length;i++)event.data.set(this.pendingBoxes[i],offset),offset+=this.pendingBoxes[i].byteLength;for(i=0;i<this.pendingCaptions.length;i++)(caption=this.pendingCaptions[i]).startTime=clock.metadataTsToSeconds(caption.startPts,timelineStartPts,this.keepOriginalTimestamps),caption.endTime=clock.metadataTsToSeconds(caption.endPts,timelineStartPts,this.keepOriginalTimestamps),event.captionStreams[caption.stream]=!0,event.captions.push(caption);for(i=0;i<this.pendingMetadata.length;i++)(id3=this.pendingMetadata[i]).cueTime=clock.metadataTsToSeconds(id3.pts,timelineStartPts,this.keepOriginalTimestamps),event.metadata.push(id3);for(event.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",event),i=0;i<event.captions.length;i++)caption=event.captions[i],this.trigger("caption",caption);for(i=0;i<event.metadata.length;i++)id3=event.metadata[i],this.trigger("id3Frame",id3)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},CoalesceStream.prototype.setRemux=function(val){this.remuxTracks=val},(Transmuxer=function(options){var videoTrack,audioTrack,self=this,hasFlushed=!0;Transmuxer.prototype.init.call(this),options=options||{},this.baseMediaDecodeTime=options.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline,pipeline.type="aac",pipeline.metadataStream=new m2ts.MetadataStream,pipeline.aacStream=new AacStream,pipeline.audioTimestampRolloverStream=new m2ts.TimestampRolloverStream("audio"),pipeline.timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream("timed-metadata"),pipeline.adtsStream=new AdtsStream,pipeline.coalesceStream=new CoalesceStream(options,pipeline.metadataStream),pipeline.headOfPipeline=pipeline.aacStream,pipeline.aacStream.pipe(pipeline.audioTimestampRolloverStream).pipe(pipeline.adtsStream),pipeline.aacStream.pipe(pipeline.timedMetadataTimestampRolloverStream).pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream),pipeline.metadataStream.on("timestamp",(function(frame){pipeline.aacStream.setTimestamp(frame.timeStamp)})),pipeline.aacStream.on("data",(function(data){"timed-metadata"!==data.type&&"audio"!==data.type||pipeline.audioSegmentStream||(audioTrack=audioTrack||{timelineStartInfo:{baseMediaDecodeTime:self.baseMediaDecodeTime},codec:"adts",type:"audio"},pipeline.coalesceStream.numberOfTracks++,pipeline.audioSegmentStream=new AudioSegmentStream(audioTrack,options),pipeline.audioSegmentStream.on("timingInfo",self.trigger.bind(self,"audioTimingInfo")),pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream),self.trigger("trackinfo",{hasAudio:!!audioTrack,hasVideo:!!videoTrack}))})),pipeline.coalesceStream.on("data",this.trigger.bind(this,"data")),pipeline.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline,pipeline.type="ts",pipeline.metadataStream=new m2ts.MetadataStream,pipeline.packetStream=new m2ts.TransportPacketStream,pipeline.parseStream=new m2ts.TransportParseStream,pipeline.elementaryStream=new m2ts.ElementaryStream,pipeline.timestampRolloverStream=new m2ts.TimestampRolloverStream,pipeline.adtsStream=new AdtsStream,pipeline.h264Stream=new H264Stream,pipeline.captionStream=new m2ts.CaptionStream(options),pipeline.coalesceStream=new CoalesceStream(options,pipeline.metadataStream),pipeline.headOfPipeline=pipeline.packetStream,pipeline.packetStream.pipe(pipeline.parseStream).pipe(pipeline.elementaryStream).pipe(pipeline.timestampRolloverStream),pipeline.timestampRolloverStream.pipe(pipeline.h264Stream),pipeline.timestampRolloverStream.pipe(pipeline.adtsStream),pipeline.timestampRolloverStream.pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream),pipeline.h264Stream.pipe(pipeline.captionStream).pipe(pipeline.coalesceStream),pipeline.elementaryStream.on("data",(function(data){var i;if("metadata"===data.type){for(i=data.tracks.length;i--;)videoTrack||"video"!==data.tracks[i].type?audioTrack||"audio"!==data.tracks[i].type||((audioTrack=data.tracks[i]).timelineStartInfo.baseMediaDecodeTime=self.baseMediaDecodeTime):(videoTrack=data.tracks[i]).timelineStartInfo.baseMediaDecodeTime=self.baseMediaDecodeTime;videoTrack&&!pipeline.videoSegmentStream&&(pipeline.coalesceStream.numberOfTracks++,pipeline.videoSegmentStream=new VideoSegmentStream(videoTrack,options),pipeline.videoSegmentStream.on("timelineStartInfo",(function(timelineStartInfo){audioTrack&&!options.keepOriginalTimestamps&&(audioTrack.timelineStartInfo=timelineStartInfo,pipeline.audioSegmentStream.setEarliestDts(timelineStartInfo.dts-self.baseMediaDecodeTime))})),pipeline.videoSegmentStream.on("processedGopsInfo",self.trigger.bind(self,"gopInfo")),pipeline.videoSegmentStream.on("segmentTimingInfo",self.trigger.bind(self,"videoSegmentTimingInfo")),pipeline.videoSegmentStream.on("baseMediaDecodeTime",(function(baseMediaDecodeTime){audioTrack&&pipeline.audioSegmentStream.setVideoBaseMediaDecodeTime(baseMediaDecodeTime)})),pipeline.videoSegmentStream.on("timingInfo",self.trigger.bind(self,"videoTimingInfo")),pipeline.h264Stream.pipe(pipeline.videoSegmentStream).pipe(pipeline.coalesceStream)),audioTrack&&!pipeline.audioSegmentStream&&(pipeline.coalesceStream.numberOfTracks++,pipeline.audioSegmentStream=new AudioSegmentStream(audioTrack,options),pipeline.audioSegmentStream.on("timingInfo",self.trigger.bind(self,"audioTimingInfo")),pipeline.audioSegmentStream.on("segmentTimingInfo",self.trigger.bind(self,"audioSegmentTimingInfo")),pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream)),self.trigger("trackinfo",{hasAudio:!!audioTrack,hasVideo:!!videoTrack})}})),pipeline.coalesceStream.on("data",this.trigger.bind(this,"data")),pipeline.coalesceStream.on("id3Frame",(function(id3Frame){id3Frame.dispatchType=pipeline.metadataStream.dispatchType,self.trigger("id3Frame",id3Frame)})),pipeline.coalesceStream.on("caption",this.trigger.bind(this,"caption")),pipeline.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(baseMediaDecodeTime){var pipeline=this.transmuxPipeline_;options.keepOriginalTimestamps||(this.baseMediaDecodeTime=baseMediaDecodeTime),audioTrack&&(audioTrack.timelineStartInfo.dts=void 0,audioTrack.timelineStartInfo.pts=void 0,trackDecodeInfo.clearDtsInfo(audioTrack),pipeline.audioTimestampRolloverStream&&pipeline.audioTimestampRolloverStream.discontinuity()),videoTrack&&(pipeline.videoSegmentStream&&(pipeline.videoSegmentStream.gopCache_=[]),videoTrack.timelineStartInfo.dts=void 0,videoTrack.timelineStartInfo.pts=void 0,trackDecodeInfo.clearDtsInfo(videoTrack),pipeline.captionStream.reset()),pipeline.timestampRolloverStream&&pipeline.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(timestamp){audioTrack&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(timestamp)},this.setRemux=function(val){var pipeline=this.transmuxPipeline_;options.remux=val,pipeline&&pipeline.coalesceStream&&pipeline.coalesceStream.setRemux(val)},this.alignGopsWith=function(gopsToAlignWith){videoTrack&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(gopsToAlignWith)},this.push=function(data){if(hasFlushed){var isAac=isLikelyAacData(data);isAac&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():isAac||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),hasFlushed=!1}this.transmuxPipeline_.headOfPipeline.push(data)},this.flush=function(){hasFlushed=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new Stream,module.exports={Transmuxer,VideoSegmentStream,AudioSegmentStream,AUDIO_PROPERTIES,VIDEO_PROPERTIES,generateSegmentTimingInfo}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _logger=_interopRequireDefault(__webpack_require__(1));class Utils{static _textEncode(str){if(window.TextEncoder)return new TextEncoder("utf-8").encode(str);const utf8=unescape(encodeURIComponent(str)),result=new Uint8Array(utf8.length);for(let i=0;i<utf8.length;i+=1)result[i]=utf8.charCodeAt(i);return result}static getHash(str,algo="SHA-256"){if(!crypto.subtle)return _logger.default.warn("unsecure context detected (non localhost clear HTTP ?)"),Promise.resolve(str);const strBuf=Utils._textEncode(str);return crypto.subtle.digest(algo,strBuf).then(hash=>{let result="";const view=new DataView(hash);for(let i=0;i<hash.byteLength;i+=4)result+=("00000000"+view.getUint32(i).toString(16)).slice(-8);return result})}static _apiToCamel(s){return s.replace(/(_\w)/g,m=>m[1].toUpperCase())}static objectApiToCamel(o){const{_apiToCamel}=Utils;return Object.keys(o).reduce((acc,k)=>(acc[_apiToCamel(k)]=o[k],acc),{})}static toUTF8Array(str){const utf8=[];for(let i=0;i<str.length;i+=1){let charcode=str.charCodeAt(i);charcode<128?utf8.push(charcode):charcode<2048?utf8.push(192|charcode>>6,128|63&charcode):charcode<55296||charcode>=57344?utf8.push(224|charcode>>12,128|charcode>>6&63,128|63&charcode):(i+=1,charcode=65536+((1023&charcode)<<10|1023&str.charCodeAt(i)),utf8.push(240|charcode>>18,128|charcode>>12&63,128|charcode>>6&63,128|63&charcode))}return utf8}static byteArray2ArrayBuffer(arr){const buf=new ArrayBuffer(arr.length),bufView=new Uint8Array(buf);for(let i=0,strLen=arr.length;i<strLen;i+=1)bufView[i]=arr[i];return buf}static uuid(){let d=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(d+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)})}}exports.default=Utils},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _VipPlayer=_interopRequireDefault(__webpack_require__(26)),_VipStream=_interopRequireDefault(__webpack_require__(25));class PlayerContent extends _VipPlayer.default{static _chooseSource(sources,drms){const sortDashLast=(a,b)=>a.type==="dash"-b.type==="dash";let source=sources.filter(s=>null==s.drm||0===Object.keys(s.drm).length).sort(sortDashLast).pop();return source||(drms.widevine&&(source=sources.filter(s=>s.drm&&void 0!==s.drm.widevine).sort(sortDashLast).pop()),source||(drms.playready&&(source=sources.filter(s=>s.drm&&void 0!==s.drm.playready).sort(sortDashLast).pop()),source||sources[0]))}setMedium(medium,fetcher,options){return _VipPlayer.default.probeDrmSupport().then(drms=>{const source=PlayerContent._chooseSource(medium.sources||[],drms),uriParameters=options["stream.url_parameters"]?"?"+options["stream.url_parameters"]:"",stream=new _VipStream.default(medium.reference,`${source.url}${uriParameters}`,null,null,null,source.type,medium.type);return source.drm&&source.drm.widevine&&(stream["widevine.license_server"]=source.drm.widevine.license_server,stream["widevine.license_url_parameter"]=options["license.url_parameters"]),source.drm&&source.drm.fairplay&&(stream["fairplay.license_server"]=source.drm.fairplay.license_server,stream["fairplay.license_url_parameter"]=options["license.url_parameters"],stream["fairplay.certificate_uri"]=source.drm.fairplay.certificate_url),["veygo.license_server","veygo.license_token","veygo.device","veygo.user_name","veygo.user_token"].forEach(id=>{fetcher[id]&&(stream[id]=fetcher[id])}),this.setSource(stream,options)})}}exports.default=PlayerContent},function(module,exports,__webpack_require__){"use strict";(function(global){!function(){var innerGlobal="undefined"!=typeof window?window:global,exportTo={};for(var k in function(window,global){var p,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)},ba=void 0!==window&&window===this?this:void 0!==global&&null!=global?global:this;function ca(){ca=function(){},ba.Symbol||(ba.Symbol=ea)}var b,ea=(b=0,function(c){return"jscomp_symbol_"+(c||"")+b++});function fa(){ca();var b=ba.Symbol.iterator;b||(b=ba.Symbol.iterator=ba.Symbol("iterator")),"function"!=typeof Array.prototype[b]&&aa(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return ia(this)}}),fa=function(){}}function ia(b){var c=0;return ja((function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}}))}function ja(b){return fa(),(b={next:b})[ba.Symbol.iterator]=function(){return this},b}function r(b){fa(),ca(),fa();var c=b[Symbol.iterator];return c?c.call(b):ia(b)}function ka(b,c){if(c){for(var d=ba,e=b.split("."),f=0;f<e.length-1;f++){var g=e[f];g in d||(d[g]={}),d=d[g]}(g=c(f=d[e=e[e.length-1]]))!=f&&null!=g&&aa(d,e,{configurable:!0,writable:!0,value:g})}}function t(b){return function la(b){function c(c){return b.next(c)}function d(c){return b.throw(c)}return new Promise((function(e,f){!function g(b){b.done?e(b.value):Promise.resolve(b.value).then(c,d).then(g,f)}(b.next())}))}(b())}function ma(){this.g=!1,this.c=null,this.u=void 0,this.j=1,this.b=this.f=0,this.i=this.a=null}function oa(b){if(b.g)throw new TypeError("Generator is already running");b.g=!0}function pa(b,c){b.a={Jc:c,Xc:!0},b.j=b.f||b.b}function u(b,c,d){return b.j=d,{value:c}}function qa(b,c,d){b.f=c,null!=d&&(b.b=d)}function ra(b,c){b.f=0,b.b=c||0}function sa(b,c){b.j=c,b.f=0}function ta(b){b.f=0;var c=b.a.Jc;return b.a=null,c}function ua(b){b.i=[b.a],b.f=0,b.b=0}function va(b,c){var d=b.i.splice(0)[0];(d=b.a=b.a||d)?d.Xc?b.j=b.f||b.b:null!=d.A&&b.b<d.A?(b.j=d.A,b.a=null):b.j=b.b:b.j=c}function wa(b){this.a=new ma,this.b=b}function ya(b,c,d,e){try{var f=c.call(b.a.c,d);if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");if(!f.done)return b.a.g=!1,f;var g=f.value}catch(h){return b.a.c=null,pa(b.a,h),za(b)}return b.a.c=null,e.call(b.a,g),za(b)}function za(b){for(;b.a.j;)try{var c=b.b(b.a);if(c)return b.a.g=!1,{value:c.value,done:!1}}catch(d){b.a.u=void 0,pa(b.a,d)}if(b.a.g=!1,b.a.a){if(c=b.a.a,b.a.a=null,c.Xc)throw c.Jc;return{value:c.return,done:!0}}return{value:void 0,done:!0}}function Aa(b){this.next=function(c){return oa(b.a),b.a.c?c=ya(b,b.a.c.next,c,b.a.h):(b.a.h(c),c=za(b)),c},this.throw=function(c){return oa(b.a),b.a.c?c=ya(b,b.a.c.throw,c,b.a.h):(pa(b.a,c),c=za(b)),c},this.return=function(c){return function xa(b,c){oa(b.a);var d=b.a.c;return d?ya(b,"return"in d?d.return:function(b){return{value:b,done:!0}},c,b.a.return):(b.a.return(c),za(b))}(b,c)},fa(),this[Symbol.iterator]=function(){return this}}function v(b,c){return Aa.prototype=b.prototype,new Aa(new wa(c))}function Ba(b,c){return Object.prototype.hasOwnProperty.call(b,c)}function Ca(b,c,d){b instanceof String&&(b=String(b));for(var e=b.length,f=0;f<e;f++){var g=b[f];if(c.call(d,g,f,b))return{Tc:f,ud:g}}return{Tc:-1,ud:void 0}}function Ea(b,c,d){if(null==b)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return b+""}ka("Promise",(function(b){function c(b){this.b=0,this.g=void 0,this.a=[];var c=this.c();try{b(c.resolve,c.reject)}catch(l){c.reject(l)}}function d(){this.a=null}function e(b){return b instanceof c?b:new c((function(c){c(b)}))}if(b)return b;d.prototype.b=function(b){null==this.a&&(this.a=[],this.f()),this.a.push(b)},d.prototype.f=function(){var b=this;this.c((function(){b.h()}))};var f=ba.setTimeout;d.prototype.c=function(b){f(b,0)},d.prototype.h=function(){for(;this.a&&this.a.length;){var b=this.a;this.a=[];for(var c=0;c<b.length;++c){var d=b[c];b[c]=null;try{d()}catch(m){this.g(m)}}}this.a=null},d.prototype.g=function(b){this.c((function(){throw b}))},c.prototype.c=function(){function b(b){return function(e){d||(d=!0,b.call(c,e))}}var c=this,d=!1;return{resolve:b(this.o),reject:b(this.f)}},c.prototype.o=function(b){if(b===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof c)this.s(b);else{a:switch(typeof b){case"object":var d=null!=b;break a;case"function":d=!0;break a;default:d=!1}d?this.m(b):this.h(b)}},c.prototype.m=function(b){var c=void 0;try{c=b.then}catch(l){return void this.f(l)}"function"==typeof c?this.w(c,b):this.h(b)},c.prototype.f=function(b){this.i(2,b)},c.prototype.h=function(b){this.i(1,b)},c.prototype.i=function(b,c){if(0!=this.b)throw Error("Cannot settle("+b+", "+c+"): Promise already settled in state"+this.b);this.b=b,this.g=c,this.l()},c.prototype.l=function(){if(null!=this.a){for(var b=0;b<this.a.length;++b)g.b(this.a[b]);this.a=null}};var g=new d;return c.prototype.s=function(b){var c=this.c();b.Ab(c.resolve,c.reject)},c.prototype.w=function(b,c){var d=this.c();try{b.call(c,d.resolve,d.reject)}catch(m){d.reject(m)}},c.prototype.then=function(b,d){function e(b,c){return"function"==typeof b?function(c){try{f(b(c))}catch(G){g(G)}}:c}var f,g,h=new c((function(b,c){f=b,g=c}));return this.Ab(e(b,f),e(d,g)),h},c.prototype.catch=function(b){return this.then(void 0,b)},c.prototype.Ab=function(b,c){function d(){switch(e.b){case 1:b(e.g);break;case 2:c(e.g);break;default:throw Error("Unexpected state: "+e.b)}}var e=this;null==this.a?g.b(d):this.a.push(d)},c.resolve=e,c.reject=function(b){return new c((function(c,d){d(b)}))},c.race=function(b){return new c((function(c,d){for(var f=r(b),g=f.next();!g.done;g=f.next())e(g.value).Ab(c,d)}))},c.all=function(b){var d=r(b),f=d.next();return f.done?e([]):new c((function(b,c){function g(c){return function(d){h[c]=d,0==--k&&b(h)}}var h=[],k=0;do{h.push(void 0),k++,e(f.value).Ab(g(h.length-1),c),f=d.next()}while(!f.done)}))},c})),ka("Promise.prototype.finally",(function(b){return b||function(b){return this.then((function(c){return Promise.resolve(b()).then((function(){return c}))}),(function(c){return Promise.resolve(b()).then((function(){throw c}))}))}})),ma.prototype.h=function(b){this.u=b},ma.prototype.return=function(b){this.a={return:b},this.j=this.b},ma.prototype.A=function(b){this.j=b},ka("WeakMap",(function(b){function c(b){if(this.a=(g+=Math.random()+1).toString(),b){ca(),fa(),b=r(b);for(var c;!(c=b.next()).done;)c=c.value,this.set(c[0],c[1])}}function d(b){Ba(b,f)||aa(b,f,{value:{}})}function e(b){var c=Object[b];c&&(Object[b]=function(b){return d(b),c(b)})}if(function(){if(!b||!Object.seal)return!1;try{var c=Object.seal({}),d=Object.seal({}),e=new b([[c,2],[d,3]]);return 2==e.get(c)&&3==e.get(d)&&(e.delete(c),e.set(d,4),!e.has(c)&&4==e.get(d))}catch(m){return!1}}())return b;var f="$jscomp_hidden_"+Math.random();e("freeze"),e("preventExtensions"),e("seal");var g=0;return c.prototype.set=function(b,c){if(d(b),!Ba(b,f))throw Error("WeakMap key fail: "+b);return b[f][this.a]=c,this},c.prototype.get=function(b){return Ba(b,f)?b[f][this.a]:void 0},c.prototype.has=function(b){return Ba(b,f)&&Ba(b[f],this.a)},c.prototype.delete=function(b){return!(!Ba(b,f)||!Ba(b[f],this.a))&&delete b[f][this.a]},c})),ka("Map",(function(b){function c(){var b={};return b.ta=b.next=b.head=b}function d(b,c){var d=b.a;return ja((function(){if(d){for(;d.head!=b.a;)d=d.ta;for(;d.next!=d.head;)return d=d.next,{done:!1,value:c(d)};d=null}return{done:!0,value:void 0}}))}function e(b,c){var d=c&&typeof c;"object"==d||"function"==d?g.has(c)?d=g.get(c):(d=""+ ++h,g.set(c,d)):d="p_"+c;var e=b.b[d];if(e&&Ba(b.b,d))for(var f=0;f<e.length;f++){var k=e[f];if(c!=c&&k.key!=k.key||c===k.key)return{id:d,list:e,index:f,S:k}}return{id:d,list:e,index:-1,S:void 0}}function f(b){if(this.b={},this.a=c(),this.size=0,b){b=r(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),d=new b(r([[c,"s"]]));if("s"!=d.get(c)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();return!f.done&&f.value[0]==c&&"s"==f.value[1]&&!((f=e.next()).done||4!=f.value[0].x||"t"!=f.value[1]||!e.next().done)}catch(q){return!1}}())return b;ca(),fa();var g=new WeakMap;f.prototype.set=function(b,c){var d=e(this,b);return d.list||(d.list=this.b[d.id]=[]),d.S?d.S.value=c:(d.S={next:this.a,ta:this.a.ta,head:this.a,key:b,value:c},d.list.push(d.S),this.a.ta.next=d.S,this.a.ta=d.S,this.size++),this},f.prototype.delete=function(b){return!(!(b=e(this,b)).S||!b.list)&&(b.list.splice(b.index,1),b.list.length||delete this.b[b.id],b.S.ta.next=b.S.next,b.S.next.ta=b.S.ta,b.S.head=null,this.size--,!0)},f.prototype.clear=function(){this.b={},this.a=this.a.ta=c(),this.size=0},f.prototype.has=function(b){return!!e(this,b).S},f.prototype.get=function(b){return(b=e(this,b).S)&&b.value},f.prototype.entries=function(){return d(this,(function(b){return[b.key,b.value]}))},f.prototype.keys=function(){return d(this,(function(b){return b.key}))},f.prototype.values=function(){return d(this,(function(b){return b.value}))},f.prototype.forEach=function(b,c){for(var e,d=this.entries();!(e=d.next()).done;)e=e.value,b.call(c,e[1],e[0],this)},f.prototype[Symbol.iterator]=f.prototype.entries;var h=0;return f})),ka("Set",(function(b){function c(b){if(this.a=new Map,b){b=r(b);for(var c;!(c=b.next()).done;)this.add(c.value)}this.size=this.a.size}return function(){if(!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),e=new b(r([c]));if(!e.has(c)||1!=e.size||e.add(c)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();return!g.done&&g.value[0]==c&&g.value[1]==c&&(!(g=f.next()).done&&g.value[0]!=c&&4==g.value[0].x&&g.value[1]==g.value[0]&&f.next().done)}catch(h){return!1}}()?b:(ca(),fa(),c.prototype.add=function(b){return this.a.set(b,b),this.size=this.a.size,this},c.prototype.delete=function(b){return b=this.a.delete(b),this.size=this.a.size,b},c.prototype.clear=function(){this.a.clear(),this.size=0},c.prototype.has=function(b){return this.a.has(b)},c.prototype.entries=function(){return this.a.entries()},c.prototype.values=function(){return this.a.values()},c.prototype.keys=c.prototype.values,c.prototype[Symbol.iterator]=c.prototype.values,c.prototype.forEach=function(b,c){var d=this;this.a.forEach((function(e){return b.call(c,e,e,d)}))},c)})),ka("Array.prototype.findIndex",(function(b){return b||function(b,d){return Ca(this,b,d).Tc}})),ka("Array.prototype.keys",(function(b){return b||function(){return function Da(b,c){fa(),b instanceof String&&(b+="");var d=0,e={next:function(){if(d<b.length){var f=d++;return{value:c(f,b[f]),done:!1}}return e.next=function(){return{done:!0,value:void 0}},e.next()}};return e[Symbol.iterator]=function(){return e},e}(this,(function(b){return b}))}})),ka("Object.is",(function(b){return b||function(b,d){return b===d?0!==b||1/b==1/d:b!=b&&d!=d}})),ka("Array.prototype.includes",(function(b){return b||function(b,d){var c=this;c instanceof String&&(c=String(c));var f=c.length,g=d||0;for(0>g&&(g=Math.max(g+f,0));g<f;g++){var h=c[g];if(h===b||Object.is(h,b))return!0}return!1}})),ka("String.prototype.includes",(function(b){return b||function(b,d){return-1!==Ea(this,b,"includes").indexOf(b,d||0)}})),ka("Array.from",(function(b){return b||function(b,d,e){fa(),d=null!=d?d:function(b){return b};var c=[],g=b[Symbol.iterator];if("function"==typeof g)for(b=g.call(b);!(g=b.next()).done;)c.push(d.call(e,g.value));else{g=b.length;for(var h=0;h<g;h++)c.push(d.call(e,b[h]))}return c}})),ka("Array.prototype.find",(function(b){return b||function(b,d){return Ca(this,b,d).ud}})),ka("String.prototype.startsWith",(function(b){return b||function(b,d){for(var c=Ea(this,b,"startsWith"),f=c.length,g=b.length,h=Math.max(0,Math.min(0|d,c.length)),k=0;k<g&&h<f;)if(c[h++]!=b[k++])return!1;return k>=g}}));var Fa=this;function y(b,c){var f,d=b.split("."),e=Fa;d[0]in e||!e.execScript||e.execScript("var "+d[0]);for(;d.length&&(f=d.shift());)d.length||void 0===c?e=e[f]?e[f]:e[f]={}:e[f]=c}function Ga(b,c){function d(){}d.prototype=c.prototype,b.pf=c.prototype,b.prototype=new d,b.prototype.constructor=b,b.kf=function(b,d,g){return c.prototype[d].apply(b,Array.prototype.slice.call(arguments,2))}}function Ha(b){this.c=Math.exp(Math.log(.5)/b),this.b=this.a=0}function Ia(b,c,d){var e=Math.pow(b.c,c);d=d*(1-e)+e*b.a,isNaN(d)||(b.a=d,b.b+=c)}function Ja(b){return b.a/(1-Math.pow(b.c,b.b))}function Ka(){this.b=new Ha(2),this.c=new Ha(5),this.a=0}function La(){}function Ma(){}Fa.a=!0,Ka.prototype.getBandwidthEstimate=function(b){return 128e3>this.a?b:Math.min(Ja(this.b),Ja(this.c))},window.console&&window.console.log.bind&&(Ma=console.warn.bind(console),La=console.error.bind(console));var Na=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function Oa(b){var c;b instanceof Oa?(Sa(this,b.ka),this.Na=b.Na,this.pa=b.pa,Ta(this,b.ab),this.da=b.da,Ua(this,b.a.clone()),this.Ga=b.Ga):b&&(c=String(b).match(Na))?(Sa(this,c[1]||"",!0),this.Na=Va(c[2]||""),this.pa=Va(c[3]||"",!0),Ta(this,c[4]),this.da=Va(c[5]||"",!0),Ua(this,c[6]||"",!0),this.Ga=Va(c[7]||"")):this.a=new Wa(null)}function Sa(b,c,d){b.ka=d?Va(c,!0):c,b.ka&&(b.ka=b.ka.replace(/:$/,""))}function Ta(b,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);b.ab=c}else b.ab=null}function Ua(b,c,d){c instanceof Wa?b.a=c:(d||(c=Xa(c,cb)),b.a=new Wa(c))}function Va(b,c){return b?c?decodeURI(b):decodeURIComponent(b):""}function Xa(b,c,d){return"string"==typeof b?(b=encodeURI(b).replace(c,db),d&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function db(b){return"%"+((b=b.charCodeAt(0))>>4&15).toString(16)+(15&b).toString(16)}(p=Oa.prototype).ka="",p.Na="",p.pa="",p.ab=null,p.da="",p.Ga="",p.toString=function(){var b=[],c=this.ka;if(c&&b.push(Xa(c,Ya,!0),":"),c=this.pa){b.push("//");var d=this.Na;d&&b.push(Xa(d,Ya,!0),"@"),b.push(encodeURIComponent(c).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(c=this.ab)&&b.push(":",String(c))}return(c=this.da)&&(this.pa&&"/"!=c.charAt(0)&&b.push("/"),b.push(Xa(c,"/"==c.charAt(0)?Za:$a,!0))),(c=this.a.toString())&&b.push("?",c),(c=this.Ga)&&b.push("#",Xa(c,bb)),b.join("")},p.resolve=function(b){var c=this.clone();"data"===c.ka&&(c=new Oa);var d=!!b.ka;d?Sa(c,b.ka):d=!!b.Na,d?c.Na=b.Na:d=!!b.pa,d?c.pa=b.pa:d=null!=b.ab;var e=b.da;if(d)Ta(c,b.ab);else if(d=!!b.da){if("/"!=e.charAt(0))if(this.pa&&!this.da)e="/"+e;else{var f=c.da.lastIndexOf("/");-1!=f&&(e=c.da.substr(0,f+1)+e)}if(".."==e||"."==e)e="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){f=0==e.lastIndexOf("/",0),e=e.split("/");for(var g=[],h=0;h<e.length;){var k=e[h++];"."==k?f&&h==e.length&&g.push(""):".."==k?((1<g.length||1==g.length&&""!=g[0])&&g.pop(),f&&h==e.length&&g.push("")):(g.push(k),f=!0)}e=g.join("/")}}return d?c.da=e:d=""!==b.a.toString(),d?Ua(c,b.a.clone()):d=!!b.Ga,d&&(c.Ga=b.Ga),c},p.clone=function(){return new Oa(this)};var Ya=/[#\/\?@]/g,$a=/[#\?:]/g,Za=/[#\?]/g,cb=/[#\?@]/g,bb=/#/g;function Wa(b){this.a=b||null}function z(){var b,c,d=new Promise((function(d,f){b=d,c=f}));return d.resolve=b,d.reject=c,d}function eb(b,c){var d={maxAttempts:3,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:1e4};this.i=null==b.maxAttempts?d.maxAttempts:b.maxAttempts,this.f=null==b.baseDelay?d.baseDelay:b.baseDelay,this.h=null==b.fuzzFactor?d.fuzzFactor:b.fuzzFactor,this.g=null==b.backoffFactor?d.backoffFactor:b.backoffFactor,this.a=0,this.b=this.f,(this.c=void 0!==c&&c)&&(this.a=1)}function gb(b){if(b.a>=b.i){if(!b.c)return Promise.reject();b.a=1,b.b=b.f}var c=new z;return b.a?(window.setTimeout(c.resolve,b.b*(1+(2*Math.random()-1)*b.h)),b.b*=b.g):c.resolve(),b.a++,c}function A(b,c,d,e){for(var f=[],g=3;g<arguments.length;++g)f[g-3]=arguments[g];this.severity=b,this.category=c,this.code=d,this.data=f,this.handled=!1}function B(b,c){this.promise=b,this.b=c,this.a=!1}function hb(b){return new B(Promise.reject(b),(function(){return Promise.resolve()}))}function ib(){var b=Promise.reject(new A(2,7,7001));return b.catch((function(){})),new B(b,(function(){return Promise.resolve()}))}function jb(b){return new B(Promise.resolve(b),(function(){return Promise.resolve()}))}function kb(b){return new B(b,(function(){return b.catch((function(){}))}))}function lb(b){return new B(Promise.all(b.map((function(b){return b.promise}))),(function(){return Promise.all(b.map((function(b){return b.abort()})))}))}function mb(b,c,d){try{var e=b(c);return e&&e.promise&&e.abort?(d.resolve(e.promise),function(){return e.abort()}):(d.resolve(e),function(){return Promise.resolve(e).then((function(){})).catch((function(){}))})}catch(f){return d.reject(f),function(){return Promise.resolve()}}}function C(b,c){for(var d in c=void 0===c?{}:c)this[d]=c[d];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=b,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function pb(){this.a={}}function qb(){this.Rb=new pb,this.Bc=this}function rb(b){var d=new Set;return function c(b){switch(typeof b){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return b;default:if(!b||b.buffer&&b.buffer.constructor==ArrayBuffer)return b;if(d.has(b))return null;var e=b.constructor==Array;if(b.constructor!=Object&&!e)return null;d.add(b);var h,g=e?[]:{};for(h in b)g[h]=c(b[h]);return e&&(g.length=b.length),g}}(b)}function sb(b,c){return!("number"!=typeof b||"number"!=typeof c||!isNaN(b)||!isNaN(c))||b===c}function tb(b,c){var d=b.indexOf(c);-1<d&&b.splice(d,1)}function vb(b,c,d){if(d||(d=sb),b.length!=c.length)return!1;c=c.slice();for(var e={},f=(b=r(b)).next();!f.done;e={item:e.item},f=b.next()){if(e.item=f.value,-1==(f=c.findIndex(function(b){return function(c){return d(b.item,c)}}(e))))return!1;c[f]=c[c.length-1],c.pop()}return 0==c.length}function wb(){this.a=[]}function xb(b,c){b.a.push(c.finally((function(){tb(b.a,c)})))}function E(b){qb.call(this),this.f=!1,this.g=new wb,this.a=new Set,this.b=new Set,this.c=b||null}(p=Wa.prototype).ca=null,p.Cb=null,p.add=function(b,c){if(!this.ca&&(this.ca={},this.Cb=0,this.a))for(var d=this.a.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null;if(0<=f){var h=d[e].substring(0,f);g=d[e].substring(f+1)}else h=d[e];h=decodeURIComponent(h.replace(/\+/g," ")),g=g||"",this.add(h,decodeURIComponent(g.replace(/\+/g," ")))}return this.a=null,(d=this.ca.hasOwnProperty(b)&&this.ca[b])||(this.ca[b]=d=[]),d.push(c),this.Cb++,this},p.toString=function(){if(this.a)return this.a;if(!this.ca)return"";var c,b=[];for(c in this.ca)for(var d=encodeURIComponent(c),e=this.ca[c],f=0;f<e.length;f++){var g=d;""!==e[f]&&(g+="="+encodeURIComponent(e[f])),b.push(g)}return this.a=b.join("&")},p.clone=function(){var b=new Wa;if(b.a=this.a,this.ca){var d,c={};for(d in this.ca)c[d]=this.ca[d].concat();b.ca=c,b.Cb=this.Cb}return b},z.prototype.resolve=function(){},z.prototype.reject=function(){},y("veygo.util.Error",A),A.prototype.toString=function(){return"veygo.util.Error "+JSON.stringify(this,null,"  ")},A.Severity={RECOVERABLE:1,CRITICAL:2},A.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},A.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013},y("veygo.util.AbortableOperation",B),B.failed=hb,B.aborted=ib,B.completed=jb,B.notAbortable=kb,B.prototype.abort=function(){return this.a=!0,this.b()},B.prototype.abort=B.prototype.abort,B.all=lb,B.prototype.finally=function(b){return this.promise.then((function(){return b(!0)}),(function(){return b(!1)})),this},B.prototype.finally=B.prototype.finally,B.prototype.Z=function(b,c){function d(){return f.reject(new A(2,7,7001)),e.abort()}var e=this,f=new z;return this.promise.then((function(c){e.a?f.reject(new A(2,7,7001)):b?d=mb(b,c,f):f.resolve(c)}),(function(b){c?d=mb(c,b,f):f.reject(b)})),new B(f,(function(){return d()}))},B.prototype.chain=B.prototype.Z,C.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},C.prototype.stopImmediatePropagation=function(){this.a=!0},C.prototype.stopPropagation=function(){},(p=pb.prototype).push=function(b,c){this.a.hasOwnProperty(b)?this.a[b].push(c):this.a[b]=[c]},p.get=function(b){return(b=this.a[b])?b.slice():null},p.getAll=function(){var c,b=[];for(c in this.a)b.push.apply(b,this.a[c]);return b},p.remove=function(b,c){var d=this.a[b];if(d)for(var e=0;e<d.length;++e)d[e]==c&&(d.splice(e,1),--e)},p.forEach=function(b){for(var c in this.a)b(c,this.a[c])},qb.prototype.addEventListener=function(b,c){this.Rb.push(b,c)},qb.prototype.removeEventListener=function(b,c){this.Rb.remove(b,c)},qb.prototype.dispatchEvent=function(b){for(var c=this.Rb.get(b.type)||[],d=0;d<c.length;++d){b.target=this.Bc,b.currentTarget=this.Bc;var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(this,b)}catch(f){}if(b.a)break}return b.defaultPrevented},wb.prototype.destroy=function(){var b=[];return this.a.forEach((function(c){c.promise.catch((function(){})),b.push(c.abort())})),this.a=[],Promise.all(b)},Ga(E,qb),y("veygo.net.NetworkingEngine",E),E.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},E.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var yb={};function zb(b,c,d){d=d||3;var e=yb[b];(!e||d>=e.priority)&&(yb[b]={priority:d,Fe:c})}function Ab(b,c){return{uris:b,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:c,licenseRequestType:null}}function Eb(){this.a=new pb}function F(b,c,d,e){b.a&&(c=new Gb(c,d,e),b.a.push(d,c))}function Hb(b,c,d,e){F(b,c,d,function(b){this.ua(c,d),e(b)}.bind(b))}function Fb(b){if(b.a){for(var c=b.a.getAll(),d=0;d<c.length;++d)c[d].ua();b.a.a={}}}function Gb(b,c,d){this.target=b,this.type=c,this.a=d,this.target.addEventListener(c,d,!1)}function Kb(b){var c=new Map;return Object.keys(b).forEach((function(d){c.set(d,b[d])})),c}function Mb(b){var c={};return b.forEach((function(b,e){c[e]=b})),c}function Nb(b,c){var d=b;return c&&(d+='; codecs="'+c+'"'),d}function Qb(b){var c=(b=b.split("."))[0];return b.pop(),[c,b.join(".")]}E.registerScheme=zb,E.unregisterScheme=function(b){delete yb[b]},E.prototype.Ge=function(b){this.a.add(b)},E.prototype.registerRequestFilter=E.prototype.Ge,E.prototype.bf=function(b){this.a.delete(b)},E.prototype.unregisterRequestFilter=E.prototype.bf,E.prototype.Dd=function(){this.a.clear()},E.prototype.clearAllRequestFilters=E.prototype.Dd,E.prototype.He=function(b){this.b.add(b)},E.prototype.registerResponseFilter=E.prototype.He,E.prototype.cf=function(b){this.b.delete(b)},E.prototype.unregisterResponseFilter=E.prototype.cf,E.prototype.Ed=function(){this.b.clear()},E.prototype.clearAllResponseFilters=E.prototype.Ed,E.prototype.destroy=function(){return this.f=!0,this.a.clear(),this.b.clear(),this.g.destroy()},E.prototype.destroy=E.prototype.destroy,E.prototype.request=function(b,c){var d=this;if(this.f)return ib();c.method=c.method||"GET",c.headers=c.headers||{},c.retryParameters=c.retryParameters?rb(c.retryParameters):{maxAttempts:3,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:1e4},c.uris=rb(c.uris);var e=function Bb(b,c,d){for(var e=jb(void 0),f={},g=(b=r(b.a)).next();!g.done;f={mc:f.mc},g=b.next())f.mc=g.value,e=e.Z(function(b){return function(){return b.mc(c,d)}}(f));return e.Z(void 0,(function(b){if(b&&7001==b.code)throw b;throw new A(2,1,1006,b)}))}(this,b,c),f=e.Z((function(){return function Cb(b,c,d,e,f,g){var h=new Oa(d.uris[f]),k=h.ka,l=!1;k||(k=(k=location.protocol).slice(0,-1),Sa(h,k),d.uris[f]=h.toString());var n,m=(k=yb[k])?k.Fe:null;return m?kb(gb(e)).Z((function(){return b.f?ib():(n=Date.now(),m(d.uris[f],d,c,(function(d,e){b.c&&1==c&&(b.c(d,e),l=!0)})))})).Z((function(b){return null==b.timeMs&&(b.timeMs=Date.now()-n),{response:b,be:l}}),(function(h){if(h&&7001==h.code)throw h;if(b.f)return ib();if(h&&1==h.severity)return b.dispatchEvent(new C("retry",{error:h instanceof A?h:null})),f=(f+1)%d.uris.length,Cb(b,c,d,e,f,h);throw h||g})):hb(new A(2,1,1e3,h))}(d,b,c,new eb(c.retryParameters,!1),0,null)})),g=f.Z((function(c){return function Db(b,c,d){for(var e=jb(void 0),f=(b=r(b.b)).next();!f.done;f=b.next())e=e.Z(f.value.bind(null,c,d.response));return e.Z((function(){return d}),(function(b){if(b&&7001==b.code)throw b;var c=2;throw b instanceof A&&(c=b.severity),new A(c,1,1007,b)}))}(d,b,c)})),h=Date.now(),k=0;e.promise.then((function(){k=Date.now()-h}),(function(){}));var l=0;return f.promise.then((function(){l=Date.now()}),(function(){})),e=g.Z((function(c){var e=Date.now()-l,f=c.response;return f.timeMs+=k,f.timeMs+=e,c.be||!d.c||f.fromCache||1!=b||d.c(f.timeMs,f.data.byteLength),f}),(function(b){throw b&&(b.severity=2),b})),xb(this.g,e),e},E.prototype.request=E.prototype.request,Eb.prototype.O=function(){Fb(this),this.a=null},Eb.prototype.ua=function(b,c){if(this.a)for(var d=this.a.get(c)||[],e=0;e<d.length;++e){var f=d[e];f.target==b&&(f.ua(),this.a.remove(c,f))}},Gb.prototype.ua=function(){this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null};var Pb=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function Rb(b){return(navigator.userAgent||"").includes(b)}function Sb(b){if(!b)return"";239==(b=new Uint8Array(b))[0]&&187==b[1]&&191==b[2]&&(b=b.subarray(3)),b=escape(Tb(b));try{return decodeURIComponent(b)}catch(c){throw new A(2,2,2004)}}function Ub(b,c,d){if(!b)return"";if(!d&&0!=b.byteLength%2)throw new A(2,2,2004);if(b instanceof ArrayBuffer)var e=b;else(d=new Uint8Array(b.byteLength)).set(new Uint8Array(b)),e=d.buffer;b=Math.floor(b.byteLength/2),d=new Uint16Array(b),e=new DataView(e);for(var f=0;f<b;f++)d[f]=e.getUint16(2*f,c);return Tb(d)}function Vb(b){var c=new Uint8Array(b);if(239==c[0]&&187==c[1]&&191==c[2])return Sb(c);if(254==c[0]&&255==c[1])return Ub(c.subarray(2),!1);if(255==c[0]&&254==c[1])return Ub(c.subarray(2),!0);var d=function(b,c){return b.byteLength<=c||32<=b[c]&&126>=b[c]}.bind(null,c);if(0==c[0]&&0==c[2])return Ub(b,!1);if(0==c[1]&&0==c[3])return Ub(b,!0);if(d(0)&&d(1)&&d(2)&&d(3))return Sb(b);throw new A(2,2,2003)}function Wb(b){b=encodeURIComponent(b),b=unescape(b);for(var c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c.buffer}function Tb(b){for(var c="",d=0;d<b.length;d+=16e3)c+=String.fromCharCode.apply(null,b.subarray(d,d+16e3));return c}function H(b){this.b=b,this.a=null}function Xb(b,c){var d=Tb(b);return c=null==c||c,d=window.btoa(d).replace(/\+/g,"-").replace(/\//g,"_"),c?d:d.replace(/=*$/,"")}function Yb(b){b=window.atob(b.replace(/-/g,"+").replace(/_/g,"/"));for(var c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c}function Zb(b){for(var c=new Uint8Array(b.length/2),d=0;d<b.length;d+=2)c[d/2]=window.parseInt(b.substr(d,2),16);return c}function $b(b){for(var c="",d=0;d<b.length;++d){var e=b[d].toString(16);1==e.length&&(e="0"+e),c+=e}return c}function ac(b,c){if(!b&&!c)return!0;if(!b||!c||b.length!=c.length)return!1;for(var d=0;d<b.length;++d)if(b[d]!=c[d])return!1;return!0}function bc(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];for(var e=d=0;e<c.length;++e)d+=c[e].length;d=new Uint8Array(d);for(var f=e=0;f<c.length;++f)d.set(c[f],e),e+=c[f].length;return d}function cc(b){var c=this;this.w=b,this.s=new Set,this.m=this.h=null,this.L=!1,this.a=null,this.i=new Eb,this.b=new Map,this.o=[],this.l=new z,this.f=null,this.g=function(d){c.l.reject(d),b.onError(d)},this.oa=new Map,this.V=new Map,this.R=new H((function(){return function dc(b){var c=b.oa,d=b.V;d.clear(),c.forEach((function(b,c){return d.set(c,b)})),(c=Array.from(d.values())).length&&c.every((function(b){return"expired"==b}))&&b.g(new A(2,6,6014)),b.w.ic(Mb(d))}(c)})),this.c=!1,this.$=new z,this.C=!1,this.F=[],this.na=!1,this.P=new H((function(){return function ec(b){b.b.forEach((function(c,d){var e=c.hc,f=d.expiration;isNaN(f)&&(f=1/0),f!=e&&(b.w.onExpirationUpdated(d.sessionId,f),c.hc=f)}))}(c)})),this.P.start(1,!0),this.l.catch((function(){}))}function ic(b,c){var d=c.some((function(b){return 0<b.drmInfos.length}));if(!d){var e=Kb(b.f.servers);!function mc(b,c){var d=[];c.forEach((function(b,c){d.push({keySystem:c,licenseServerUri:b,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})}));for(var e=r(b),f=e.next();!f.done;f=e.next())f.value.drmInfos=d}(c,e)}if(e=function nc(b){if(0==(b=Kb(b.f.clearKeys)).size)return null;var c=[],d=[];b.forEach((function(b,e){var f=Zb(e),g=Zb(b);f={kty:"oct",kid:Xb(f,!1),k:Xb(g,!1)},c.push(f),d.push(f.kid)})),b=JSON.stringify({keys:c});var e=JSON.stringify({kids:d});return e=[{initData:new Uint8Array(Wb(e)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+window.btoa(b),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,authMethod:"",audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:e,keyIds:[]}}(b))for(var f=r(c),g=f.next();!g.done;g=f.next())g.value.drmInfos=[e];for(g=(e=r(c)).next();!g.done;g=e.next())for(f=(g=r(g.value.drmInfos)).next();!f.done;f=g.next())oc(f=f.value,Kb(b.f.servers),Kb(b.f.advanced||{})),"hbola"===f.authMethod&&(f.hbola=b.f.hbola),f.licenseRequestExtraHeaders=b.f.licenseRequestExtraHeaders;return(e=function pc(b,c){for(var d=new Set,e=r(c),f=e.next();!f.done;f=e.next()){var g=r(f.value.drmInfos);for(f=g.next();!f.done;f=g.next())d.add(f.value)}for(e=r(d),f=e.next();!f.done;f=e.next())oc(f.value,Kb(b.f.servers),Kb(b.f.advanced||{}));g=b.C?"required":"optional";var h=b.C?["persistent-license"]:["temporary"];for(e=new Map,d=r(d),f=d.next();!f.done;f=d.next())f=f.value,e.set(f.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:g,sessionTypes:h,label:f.keySystem,drmInfos:[]});for(d=r(c),f=d.next();!f.done;f=d.next()){g=(f=f.value).audio,h=f.video;var k=g?Nb(g.mimeType,g.codecs):"",l=h?Nb(h.mimeType,h.codecs):"",m=r(f.drmInfos);for(f=m.next();!f.done;f=m.next()){f=f.value;var n=e.get(f.keySystem);n.drmInfos.push(f),f.distinctiveIdentifierRequired&&(n.distinctiveIdentifier="required"),f.persistentStateRequired&&(n.persistentState="required"),g&&n.audioCapabilities.push({robustness:f.audioRobustness||"",contentType:k}),h&&n.videoCapabilities.push({robustness:f.videoRobustness||"",contentType:l})}}return e}(b,c)).size?1==e.size&&e.has("com.apple.hls-aes-128")?(b.L=!0,b.a=e.get("com.apple.hls-aes-128").drmInfos[0],Promise.resolve()):(e=lc(b,e),d?e:e.catch((function(){}))):(b.L=!0,Promise.resolve())}function rc(b){return t((function d(){var e;return v(d,(function(d){switch(d.j){case 1:if(!(b.h&&b.a&&b.a.serverCertificate&&b.a.serverCertificate.length)){d.A(0);break}return qa(d,3),u(d,b.h.setServerCertificate(b.a.serverCertificate),5);case 5:sa(d,0);break;case 3:return e=ta(d),d.return(Promise.reject(new A(2,6,6004,e.message)))}}))}))}function sc(b){var c=b.a?b.a.initData:[];return c.forEach((function(c){return wc(b,c.initDataType,c.initData)})),b.o.forEach((function(c){return vc(b,c)})),c.length||b.o.length||b.l.resolve(),b.l}function tc(b,c,d){for(var e=b.b.values(),f=(e=r(e)).next();!f.done;f=e.next())if(ac(d,f.value.initData))return;wc(b,c,d)}function xc(b,c){return!!Rb("Edge/")||b.s.has(c)}function yc(b){return b=function Ib(b,c){for(var d=[],e=r(b),f=e.next();!f.done;f=e.next())d.push(c(f.value));return d}(b=b.b.keys(),(function(b){return b.sessionId})),Array.from(b)}function lc(b,c){if(1==c.size&&c.has(""))return Promise.reject(new A(2,6,6e3));for(var d=r(c.values()),e=d.next();!e.done;e=d.next())0==(e=e.value).audioCapabilities.length&&delete e.audioCapabilities,0==e.videoCapabilities.length&&delete e.videoCapabilities;var f=d=new z;return[!0,!1].forEach(function(b){var d=this;c.forEach((function(c,e){c.drmInfos.some((function(b){return!!b.licenseServerUri}))==b&&(f=f.then(function(b){return b||(this.c?void 0:navigator.requestMediaKeySystemAccess(e,[c]).catch((function(){})))}.bind(d)))}))}.bind(b)),f=(f=f.catch((function(){return Promise.reject(new A(2,6,6001))}))).then(function(b){if(this.c)return Promise.reject();this.s.clear();var d=b.getConfiguration(),e=d.videoCapabilities||[],f=r(d.audioCapabilities||[]);for(d=f.next();!d.done;d=f.next())this.s.add(d.value.contentType);for(d=(e=r(e)).next();!d.done;d=e.next())this.s.add(d.value.contentType);e=b.keySystem,f=[];var g=[],n=[],q=[],x=(d=c.get(b.keySystem)).drmInfos[0].authMethod,w=d.drmInfos[0].hbola,D=d.drmInfos[0].licenseRequestExtraHeaders;return function zc(b,c,d,e,f){b.forEach((function(b){if(c.includes(b.licenseServerUri)||c.push(b.licenseServerUri),b.serverCertificate&&(d.some((function(c){return ac(c,b.serverCertificate)}))||d.push(b.serverCertificate)),b.initData&&b.initData.forEach((function(b){e.some((function(c){return!(!c.keyId||c.keyId!=b.keyId)||c.initDataType==b.initDataType&&ac(c.initData,b.initData)}))||e.push(b)})),b.keyIds)for(var g=0;g<b.keyIds.length;++g)f.includes(b.keyIds[g])||f.push(b.keyIds[g])}))}(d.drmInfos,f,g,n,q),this.a={keySystem:e,authMethod:x,licenseServerUri:f[0],hbola:w,licenseRequestExtraHeaders:D,distinctiveIdentifierRequired:"required"==d.distinctiveIdentifier,persistentStateRequired:"required"==d.persistentState,audioRobustness:d.audioCapabilities?d.audioCapabilities[0].robustness:"",videoRobustness:d.videoCapabilities?d.videoCapabilities[0].robustness:"",serverCertificate:g[0],initData:n,keyIds:q},this.a.licenseServerUri?b.createMediaKeys():Promise.reject(new A(2,6,6012))}.bind(b)).then(function(b){if(this.c)return Promise.reject();this.h=b,this.L=!0}.bind(b)).catch(function(b){if(!this.c)return this.a=null,this.s.clear(),b instanceof A?Promise.reject(b):Promise.reject(new A(2,6,6002,b.message))}.bind(b)),d.resolve(),f}function vc(b,c){try{var d=b.h.createSession("persistent-license")}catch(g){var e=new A(2,6,6005,g.message);return b.g(e),Promise.reject(e)}F(b.i,d,"message",b.cd.bind(b)),F(b.i,d,"keystatuseschange",b.$c.bind(b));var f={initData:null,loaded:!1,hc:1/0,ma:null};return b.b.set(d,f),d.load(c).then(function(b){return this.c?Promise.reject():b?(f.loaded=!0,Ac(this)&&this.l.resolve(),d):(this.b.delete(d),void this.g(new A(2,6,6013)))}.bind(b),function(b){this.c||(this.b.delete(d),this.g(new A(2,6,6005,b.message)))}.bind(b))}function wc(b,c,d){try{var e=b.C?b.h.createSession("persistent-license"):b.h.createSession()}catch(f){return void b.g(new A(2,6,6005,f.message))}F(b.i,e,"message",b.cd.bind(b)),F(b.i,e,"keystatuseschange",b.$c.bind(b)),b.b.set(e,{initData:d,loaded:!1,hc:1/0,ma:null}),e.generateRequest(c,d.buffer).catch((function(c){if(!b.c){if(b.b.delete(e),c.errorCode&&c.errorCode.systemCode){var d=c.errorCode.systemCode;0>d&&(d+=Math.pow(2,32)),d="0x"+d.toString(16)}b.g(new A(2,6,6006,c.message,c,d))}}))}function qc(b,c){var d=c.target,e=b.b.get(d),f=b.a.licenseServerUri,g=b.f.advanced[b.a.keySystem];if("individualization-request"==c.messageType&&g&&g.individualizationServer&&(f=g.individualizationServer),(f=Ab([f],b.f.retryParameters)).body=c.message,f.method="POST",f.licenseRequestType=c.messageType,"hbola"===b.a.authMethod&&(f.headers["dt-custom-data"]=window.btoa("tokenID="+b.a.hbola.tokenID+"|keyid="+b.a.keyIds[0].toUpperCase()+"|operatorID="+b.a.hbola.operatorID+"|countryID="+b.a.hbola.countryID)),b.a.licenseRequestExtraHeaders){g=Object.keys(b.a.licenseRequestExtraHeaders);for(var h=0;h<g.length;h++){var k=g[h];f.headers[k]=b.a.licenseRequestExtraHeaders[k]}}"com.microsoft.playready"!=b.a.keySystem&&"com.chromecast.playready"!=b.a.keySystem||function Cc(b){var c=Ub(b.body,!0,!0);if(c.includes("PlayReadyKeyMessage")){for(var d=(c=(new DOMParser).parseFromString(c,"application/xml")).getElementsByTagName("HttpHeader"),e=0;e<d.length;++e)b.headers[d[e].querySelector("name").textContent]=d[e].querySelector("value").textContent;b.body=Yb(c.querySelector("Challenge").textContent).buffer}else b.headers["Content-Type"]="text/xml; charset=utf-8"}(f),b.w.Xa.request(2,f).promise.then(function(b){if(this.c)return Promise.reject();if("drmtoday"===this.a.authMethod&&b.headers["content-type"]&&0===b.headers["content-type"].indexOf("application/json")){var c=String.fromCharCode.apply(null,new Uint8Array(b.data));c=function Bc(b){for(var c=(b=window.atob(b)).length,d=new Uint8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer}((c=JSON.parse(c)).license)}return void 0===c&&(c=b.data),d.update(c).then(function(){var b=this;this.w.onEvent(new C("drmsessionupdate")),e&&(e.ma&&e.ma.resolve(),Dc(Ec).then((function(){e.loaded=!0,Ac(b)&&b.l.resolve()})))}.bind(this))}.bind(b),function(b){this.c||(b=new A(2,6,6007,b),this.g(b),e&&e.ma&&e.ma.reject(b))}.bind(b)).catch(function(b){this.c||(b=new A(2,6,6008,b.message),this.g(b),e&&e.ma&&e.ma.reject(b))}.bind(b))}function Kc(){var c=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],d=[{videoCapabilities:c,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:c}],e=new Map;return c="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map((function(c){return function b(b){return t((function h(){var c,f,m;return v(h,(function(h){switch(h.j){case 1:return qa(h,2),u(h,navigator.requestMediaKeySystemAccess(b,d),4);case 4:return c=h.u,m=!!(f=c.getConfiguration().sessionTypes)&&f.includes("persistent-license"),Rb("Tizen 3")&&(m=!1),e.set(b,{persistentState:m}),u(h,c.createMediaKeys(),5);case 5:sa(h,0);break;case 2:ta(h),e.set(b,null),h.j=0}}))}))}(c)})),Promise.all(c).then((function(){return Mb(e)}))}function Lc(b,c){var d=c.audio,e=c.video;if(d&&d.encrypted&&!xc(b,Nb(d.mimeType,d.codecs))||e&&e.encrypted&&!xc(b,Nb(e.mimeType,e.codecs)))return!1;var f=b.keySystem();return 0==c.drmInfos.length||c.drmInfos.some((function(b){return b.keySystem==f}))}function Mc(b,c){if(!b.length)return c;if(!c.length)return b;for(var d=[],e=0;e<b.length;e++)for(var f=0;f<c.length;f++)if(b[e].keySystem==c[f].keySystem){var g=b[e];f=c[f];var h=[];h=(h=h.concat(g.initData||[])).concat(f.initData||[]);var k=[];k=(k=k.concat(g.keyIds)).concat(f.keyIds),d.push({keySystem:g.keySystem,licenseServerUri:g.licenseServerUri||f.licenseServerUri,distinctiveIdentifierRequired:g.distinctiveIdentifierRequired||f.distinctiveIdentifierRequired,persistentStateRequired:g.persistentStateRequired||f.persistentStateRequired,videoRobustness:g.videoRobustness||f.videoRobustness,audioRobustness:g.audioRobustness||f.audioRobustness,serverCertificate:g.serverCertificate||f.serverCertificate,initData:h,keyIds:k});break}return d}function Ac(b){return function Jb(b,c){for(var d=r(b),e=d.next();!e.done;e=d.next())if(!c(e.value))return!1;return!0}(b=b.b.values(),(function(b){return b.loaded}))}function Dc(b){return new Promise((function(c){return setTimeout(c,1e3*b)}))}function oc(b,c,d){var e=b.keySystem;e&&((c=c.get(e))&&(b.licenseServerUri=c),b.licenseRequestExtraHeaders||(b.licenseRequestExtraHeaders={}),b.keyIds||(b.keyIds=[]),(d=d.get(e))&&(b.distinctiveIdentifierRequired||(b.distinctiveIdentifierRequired=d.distinctiveIdentifierRequired),b.persistentStateRequired||(b.persistentStateRequired=d.persistentStateRequired),b.videoRobustness||(b.videoRobustness=d.videoRobustness),b.audioRobustness||(b.audioRobustness=d.audioRobustness),b.serverCertificate||(b.serverCertificate=d.serverCertificate),b.authMethod=d.authMethod),window.cast&&window.cast.__platform__&&"com.microsoft.playready"==b.keySystem&&(b.keySystem="com.chromecast.playready"))}y("veygo.util.StringUtils.fromUTF8",Sb),y("veygo.util.StringUtils.fromUTF16",Ub),y("veygo.util.StringUtils.fromBytesAutoDetect",Vb),y("veygo.util.StringUtils.toUTF8",Wb),y("veygo.util.Timer",H),H.prototype.$e=function(){null!=this.a&&(clearTimeout(this.a),this.a=null),this.b()},H.prototype.tick=H.prototype.$e,H.prototype.start=function(b,c){var d=this,e=1e3*b;null!=this.a&&(this.c?clearInterval:clearTimeout)(this.a),this.a=(c?setInterval:setTimeout)((function(){d.b()}),e),this.c=c},H.prototype.start=H.prototype.start,H.prototype.stop=function(){null!=this.a&&(this.c?clearInterval:clearTimeout)(this.a),this.a=null},H.prototype.stop=H.prototype.stop,y("veygo.util.Uint8ArrayUtils.toBase64",Xb),y("veygo.util.Uint8ArrayUtils.fromBase64",Yb),y("veygo.util.Uint8ArrayUtils.fromHex",Zb),y("veygo.util.Uint8ArrayUtils.toHex",$b),y("veygo.util.Uint8ArrayUtils.equal",ac),y("veygo.util.Uint8ArrayUtils.concat",bc),(p=cc.prototype).destroy=function(){var b=this;return t((function d(){return v(d,(function(d){switch(d.j){case 1:return b.c?u(d,b.$,0):(b.c=!0,u(d,function fc(b){return t((function d(){var e;return v(d,(function(d){switch(d.j){case 1:return b.i.O(),b.i=null,b.l.reject(),b.P.stop(),b.P=null,b.R.stop(),b.R=null,e=Array.from(b.b.keys()),b.b.clear(),u(d,Promise.all(e.map((function(b){return Promise.resolve().then((function(){return t((function k(){return v(k,(function(d){switch(d.j){case 1:return qa(d,2),u(d,function gc(b){return t((function d(){var e,f;return v(d,(function(d){switch(d.j){case 1:return e=b.close().then((function(){return!0})),f=Dc(Nc).then((function(){return!1})),u(d,Promise.race([e,f]),2);case 2:d.j=0}}))}))}(b),4);case 4:sa(d,0);break;case 2:ta(d),d.j=0}}))}))}))}))),2);case 2:if(!b.m){d.A(3);break}return qa(d,4),u(d,b.m.setMediaKeys(null),6);case 6:sa(d,5);break;case 4:ta(d);case 5:b.m=null;case 3:b.a=null,b.s.clear(),b.h=null,b.o=[],b.f=null,b.g=null,b.w=null,d.j=0}}))}))}(b),4));case 4:b.$.resolve(),d.A(0)}}))}))},p.configure=function(b){this.f=b},p.zb=function(b){var c=this;if(!this.h)return Hb(this.i,b,"encrypted",(function(){c.g(new A(2,6,6010))})),Promise.resolve();this.m=b,Hb(this.i,this.m,"play",(function(){for(var b=0;b<c.F.length;b++)qc(c,c.F[b]);c.na=!0,c.F=[]})),b=(b=this.m.setMediaKeys(this.h)).catch((function(b){return Promise.reject(new A(2,6,6003,b.message))}));var d=rc(this);return Promise.all([b,d]).then((function(){if(c.c)return Promise.reject();sc(c),c.a.initData.length||c.o.length||F(c.i,c.m,"encrypted",(function(b){return tc(c,b.initDataType,new Uint8Array(b.initData))}))})).catch((function(b){if(!c.c)return Promise.reject(b)}))},p.keySystem=function(){return this.a?this.a.keySystem:""},p.Hb=function(){for(var b=1/0,c=this.b.keys(),d=(c=r(c)).next();!d.done;d=c.next())d=d.value,isNaN(d.expiration)||(b=Math.min(b,d.expiration));return b},p.cd=function(b){this.f.delayLicenseRequestUntilPlayed&&this.m.paused&&!this.na?this.F.push(b):qc(this,b)},p.$c=function(b){b=b.target;var c=this.b.get(b),d=!1;b.keyStatuses.forEach(function(b,e){if("string"==typeof e){var f=e;e=b,b=f}if("com.microsoft.playready"==this.a.keySystem&&16==e.byteLength&&!Rb("Tizen")){var g=(f=new DataView(e)).getUint32(0,!0),l=f.getUint16(4,!0),m=f.getUint16(6,!0);f.setUint32(0,g,!1),f.setUint16(4,l,!1),f.setUint16(6,m,!1)}"com.microsoft.playready"==this.a.keySystem&&"status-pending"==b&&(b="usable"),"status-pending"!=b&&(c.loaded=!0),"expired"==b&&(d=!0),f=$b(new Uint8Array(e)),this.oa.set(f,b)}.bind(this));var e=b.expiration-Date.now();(0>e||d&&1e3>e)&&c&&!c.ma&&(this.b.delete(b),b.close().catch((function(){}))),Ac(this)&&(this.l.resolve(),this.R.start(Fc,!1))};var Nc=1,Ec=5,Fc=.5;function Oc(b){this.a=new muxjs.mp4.CaptionParser(b),this.g=[],this.f={}}function Pc(){}function Qc(b){return!b||1==b.length&&1e-6>b.end(0)-b.start(0)?null:b.length?b.end(b.length-1):null}function Rc(b,c,d){return d=void 0===d?0:d,!(!b||!b.length||1==b.length&&1e-6>b.end(0)-b.start(0)||c>b.end(b.length-1))&&c+d>=b.start(0)}function Sc(b,c){if(!b||!b.length||1==b.length&&1e-6>b.end(0)-b.start(0))return 0;for(var d=0,e=b.length-1;0<=e&&b.end(e)>c;--e)d+=b.end(e)-Math.max(b.start(e),c);return d}function Tc(b){if(!b)return[];for(var c=[],d=0;d<b.length;d++)c.push({start:b.start(d),end:b.end(d)});return c}Oc.prototype.init=function(b){var c=muxjs.mp4.probe;b=new Uint8Array(b),this.g=c.videoTrackIds(b),this.f=c.timescale(b),this.a.init()},Oc.prototype.b=function(b,c){var d=new Uint8Array(b);(d=this.a.parse(d,this.g,this.f))&&d.captions&&c(d.captions),this.a.clearParsedCaptions()},Oc.prototype.c=function(){this.a.resetCaptionStream()},Pc.prototype.init=function(){},Pc.prototype.b=function(){},Pc.prototype.c=function(){};var I={Fd:function(b,c){return b.reduce(function(b,c,f){return c.catch(b.bind(null,f))}.bind(null,c),Promise.reject())},Sb:function(b,c){return b.concat(c)},nb:function(){},wa:function(b){return null!=b}};function Uc(b,c){if(0==c.length)return b;var d=c.map((function(b){return new Oa(b)}));return b.map((function(b){return new Oa(b)})).map((function(b){return d.map(b.resolve.bind(b))})).reduce(I.Sb,[]).map((function(b){return b.toString()}))}function Vc(b,c){return{keySystem:b,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",authMethod:"",serverCertificate:null,initData:c||[],keyIds:[]}}var Wc={Ac:"video",wc:"audio",Da:"text",gf:"application"};function Yc(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.b=null,this.g=[],this.c=[],this.f=!1,this.a.on("data",this.i.bind(this)),this.a.on("done",this.h.bind(this))}function Zc(b,c){if(!window.muxjs)return!1;var d=b.split(";")[0].split("/")[1];return void 0!==(d=$c[d])&&(c?MediaSource.isTypeSupported(d(c,b)):MediaSource.isTypeSupported(d("audio",b))||MediaSource.isTypeSupported(d("video",b)))}Yc.prototype.destroy=function(){return this.a.dispose(),this.a=null,Promise.resolve()},Yc.prototype.i=function(b){this.c=b.captions;var c=new Uint8Array(b.data.byteLength+b.initSegment.byteLength);c.set(b.initSegment,0),c.set(b.data,b.initSegment.byteLength),this.g.push(c)};var $c={mp2t:function(b,c){var d=c.replace("mp2t","mp4");"audio"==b&&(d=d.replace("video","audio"));var e=/avc1\.(66|77|100)\.(\d+)/.exec(d);if(e){var f="avc1.",g=e[1],h=Number(e[2]);f=("66"==g?f+"4200":"77"==g?f+"4d00":f+"6400")+(h>>4).toString(16),f+=(15&h).toString(16),d=d.replace(e[0],f)}return d},aac:function(b,c){var d=c.replace("aac","mp4");return"audio"==b&&(d=d.replace("video","audio")),d}};function bd(b){this.g=null,this.c=b,this.f=this.m=0,this.h=1/0,this.b=this.a=null,this.l="",this.i=new Map}Yc.prototype.h=function(){var b={data:bc.apply(null,this.g),captions:this.c};this.b.resolve(b),this.f=!1};var cd={};function dd(b,c){cd[b.toLowerCase()]=c}function ed(b){return b=b.toLowerCase(),!!(cd[b]||window.muxjs&&"application/cea-608"==b)}function fd(b,c){"application/cea-608"!=c&&(b.g=new(cd[c.toLowerCase()]))}function hd(b,c,d,e,f){for(var g=d+" "+e,h=new Map,k=[],l=(c=r(c)).next();!l.done;l=c.next()){var m=l.value;l=m.stream,h.has(l)||h.set(l,new Map),h.get(l).has(g)||h.get(l).set(g,[]),m.startTime+=f,m.endTime+=f,m.startTime>=b.f&&m.startTime<b.h&&(m=new id(m.startTime,m.endTime,m.text),h.get(l).get(g).push(m),l==b.l&&k.push(m))}for(k.length&&b.c.append(k),g=(f=r(h.keys())).next();!g.done;g=f.next())for(g=g.value,b.i.has(g)||b.i.set(g,new Map),c=(k=r(h.get(g).keys())).next();!c.done;c=k.next())c=c.value,l=h.get(g).get(c),b.i.get(g).set(c,l);b.a=null==b.a?Math.max(d,b.f):Math.min(b.a,Math.max(d,b.f)),b.b=Math.max(b.b,Math.min(e,b.h))}function jd(b,c,d){this.f=b,this.l=d,this.b={},this.a=null,this.c={},this.h=new Eb,this.s=!1,this.i={},this.m=c,b=this.o=new z,c=new MediaSource,Hb(this.h,c,"sourceopen",b.resolve),this.f.src=window.URL.createObjectURL(c),this.w={},this.g=c}function kd(b){var c=Nb(b.mimeType,b.codecs),d=function Ob(b){var c=[b.mimeType];return Pb.forEach((function(d,e){var f=b[e];f&&c.push(d+'="'+f+'"')})),c.join(";")}(b);return ed(c)||MediaSource.isTypeSupported(d)||Zc(c,b.type)}function md(b,c){b.a||(b.a=new bd(b.l)),fd(b.a,c)}function nd(b,c){if("text"==c)var d=b.a.a;else d=!(d=od(b,c))||1==d.length&&1e-6>d.end(0)-d.start(0)?null:1==d.length&&0>d.start(0)?0:d.length?d.start(0):null;return d}function pd(b,c){return"text"==c?b.a.b:Qc(od(b,c))}function od(b,c){if(!(c in b.b))return null;try{return b.b[c].buffered}catch(d){return null}}function rd(b,c,d,e,f,g){return"text"==c?function gd(b,c,d,e){return Promise.resolve().then(function(){if(this.g&&this.c)if(null==d||null==e)this.g.parseInit(new Uint8Array(c));else{var b={periodStart:this.m,segmentStart:d,segmentEnd:e};b=this.g.parseMedia(new Uint8Array(c),b).filter(function(b){return b.startTime>=this.f&&b.startTime<this.h}.bind(this)),this.c.append(b),null==this.a&&(this.a=Math.max(d,this.f)),this.b=Math.min(e,this.h)}}.bind(b))}(b.a,d,e,f):b.i[c]?function ad(b,c){b.f=!0,b.b=new z,b.g=[],b.c=[];var d=new Uint8Array(c);return b.a.push(d),b.a.flush(),b.f&&b.b.reject(new A(2,3,3018)),b.b}(b.i[c],d).then(function(b){return this.a||md(this,"text/vtt"),b.captions&&hd(this.a,b.captions,e,f,(this.b.video||this.b.audio).timestampOffset),sd(this,c,this.pd.bind(this,c,b.data.buffer))}.bind(b)):(g&&window.muxjs?(b.a||md(b,"application/cea-608"),null==e&&null==f?b.m.init(d):b.m.b(d,(function(c){c.length&&hd(b.a,c,e,f,b.b.video.timestampOffset)}))):"audio/aac"===b.w[c]&&sd(b,c,b.nd.bind(b,c,e||0)),sd(b,c,b.pd.bind(b,c,d)))}function td(b,c){return"text"==c?b.a?(b.m.c(),b.a.remove(0,1/0)):Promise.resolve():sd(b,c,b.qd.bind(b,c,0,b.g.duration))}function sd(b,c,d){if(b.s)return Promise.reject();if(d={start:d,p:new z},b.c[c].push(d),1==b.c[c].length)try{d.start()}catch(e){"QuotaExceededError"==e.name?d.p.reject(new A(2,3,3017,c)):d.p.reject(new A(2,3,3015,e)),wd(b,c)}return d.p}function vd(b,c){if(b.s)return Promise.reject();var e,d=[];for(e in b.b){var f=new z,g={start:function(b){b.resolve()}.bind(null,f),p:f};b.c[e].push(g),d.push(f),1==b.c[e].length&&g.start()}return Promise.all(d).then(function(){try{c()}catch(l){var b=Promise.reject(new A(2,3,3015,l))}for(var d in this.b)wd(this,d);return b}.bind(b),function(){return Promise.reject()}.bind(b))}function wd(b,c){b.c[c].shift();var d=b.c[c][0];if(d)try{d.start()}catch(e){d.p.reject(new A(2,3,3015,e)),wd(b,c)}}function xd(b,c){b=J(b),c=J(c);var d=b.split("-"),e=c.split("-");return d[0]==e[0]&&1==d.length&&2==e.length}function J(b){var c=b.split("-");return b=c[0]||"",c=c[1]||"",b=b.toLowerCase(),b=yd.get(b)||b,(c=c.toUpperCase())?b+"-"+c:b}function zd(b){return b.language?J(b.language):b.audio&&b.audio.language?J(b.audio.language):b.video&&b.video.language?J(b.video.language):"und"}function Ad(b,c){for(var d=J(b),e=new Set,f=r(c),g=f.next();!g.done;g=f.next())e.add(J(g.value));for(g=(f=r(e)).next();!g.done;g=f.next())if((g=g.value)==d)return g;for(g=(f=r(e)).next();!g.done;g=f.next())if(xd(g=g.value,d))return g;for(g=(f=r(e)).next();!g.done;g=f.next()){var h=g=g.value,k=d;if(h=J(h),k=J(k),h=h.split("-"),k=k.split("-"),2==h.length&&2==k.length&&h[0]==k[0])return g}for(g=(e=r(e)).next();!g.done;g=e.next())if(xd(d,f=g.value))return f;return null}y("veygo.text.TextEngine.registerParser",dd),y("veygo.text.TextEngine.unregisterParser",(function(b){delete cd[b.toLowerCase()]})),bd.prototype.destroy=function(){return this.c=this.g=null,this.i.clear(),Promise.resolve()},bd.prototype.Zb=function(b){try{return this.g.parseMedia(new Uint8Array(b),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(d){throw new A(2,2,2009,d)}},bd.prototype.remove=function(b,c){return Promise.resolve().then(function(){!this.c||!this.c.remove(b,c)||null==this.a||c<=this.a||b>=this.b||(b<=this.a&&c>=this.b?this.a=this.b=null:b<=this.a&&c<this.b?this.a=c:b>this.a&&c>=this.b&&(this.b=b))}.bind(this))},bd.prototype.zd=function(b){this.c.append(b)},bd.prototype.appendCues=bd.prototype.zd,bd.prototype.Nb=function(b,c){this.l=b;var d=this.i.get(b);if(d)for(var e=r(d.keys()),f=e.next();!f.done;f=e.next())(f=d.get(f.value))&&(f=f.filter((function(b){return b.endTime<=c})),this.c.append(f))},bd.prototype.setSelectedClosedCaptionId=bd.prototype.Nb,(p=jd.prototype).destroy=function(){var b=this;this.s=!0;var d,c=[];for(d in this.c){var e=this.c[d],f=e[0];for(this.c[d]=e.slice(0,1),f&&c.push(f.p.catch(I.nb)),f=1;f<e.length;++f)e[f].p.catch(I.nb),e[f].p.reject()}for(var g in this.a&&c.push(this.a.destroy()),this.l&&c.push(this.l.destroy()),this.i)c.push(this.i[g].destroy());return Promise.all(c).then((function(){b.h&&(b.h.O(),b.h=null),b.f&&(b.f.removeAttribute("src"),b.f.load(),b.f=null),b.g=null,b.a=null,b.l=null,b.b={},b.i={},b.m=null,b.c={}}))},p.init=function(b,c){var d=this;return t((function f(){var g;return v(f,(function(f){switch(f.j){case 1:return g=Wc,u(f,d.o,2);case 2:b.forEach((function(b,f){var h=Nb(b.mimeType,b.codecs);if(f==g.Da)md(d,h);else{if((c||!MediaSource.isTypeSupported(h))&&Zc(h,f)){d.i[f]=new Yc;var k=h.split(";")[0].split("/")[1];h=void 0===(k=$c[k])?null:k(f,h)}d.w[f]=h||"",h=d.g.addSourceBuffer(h||""),F(d.h,h,"error",d.Ye.bind(d,f)),F(d.h,h,"updateend",d.Za.bind(d,f)),d.b[f]=h,d.c[f]=[]}})),f.j=0}}))}))},p.Wb=function(){var b=this.a&&null!=this.a.a?[{start:this.a.a,end:this.a.b}]:[];return{total:Tc(this.f.buffered),audio:Tc(od(this,"audio")),video:Tc(od(this,"video")),text:b}},p.Nb=function(b){var c=pd(this,"video")||0;this.a.Nb(b,c)},p.remove=function(b,c,d){return"text"==b?this.a.remove(c,d):sd(this,b,this.qd.bind(this,b,c,d))},p.flush=function(b){return"text"==b?Promise.resolve():sd(this,b,this.Kd.bind(this,b))},p.endOfStream=function(b){return vd(this,function(){b?this.g.endOfStream(b):this.g.endOfStream()}.bind(this))},p.la=function(b){return vd(this,function(){this.g.duration=b}.bind(this))},p.T=function(){return this.g.duration},p.pd=function(b,c){this.b[b].appendBuffer(c)},p.qd=function(b,c,d){d<=c?this.Za(b):this.b[b].remove(c,d)},p.xd=function(b){var c=this.b[b].appendWindowStart,d=this.b[b].appendWindowEnd;this.b[b].abort(),this.b[b].appendWindowStart=c,this.b[b].appendWindowEnd=d,this.Za(b)},p.Kd=function(b){this.f.currentTime-=.001,this.Za(b)},p.nd=function(b,c){0>c&&(c+=.001),this.b[b].timestampOffset=c,this.Za(b)},p.Te=function(b,c,d){this.b[b].appendWindowStart=0,this.b[b].appendWindowEnd=d,this.b[b].appendWindowStart=c,this.Za(b)},p.Ye=function(b){this.c[b][0].p.reject(new A(2,3,3014,this.f.error?this.f.error.code+":"+this.f.error.message:"?"))},p.Za=function(b){var c=this.c[b][0];c&&(c.p.resolve(),wd(this,b))};var yd=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),K={Kb:function(b,c,d){function e(b,c,d){return b>=c&&b<=d}var f=b.video;return!(f&&f.width&&f.height&&!(e(f.width,c.minWidth,Math.min(c.maxWidth,d.width))&&e(f.height,c.minHeight,Math.min(c.maxHeight,d.height))&&e(f.width*f.height,c.minPixels,c.maxPixels))||!e(b.bandwidth,c.minBandwidth,c.maxBandwidth))}};function L(){this.h=null,this.f=!1,this.b=new Ka,this.c=[],this.i=!1,this.a=this.g=null}function Bd(b,c){return b&&(c=c.filter((function(c){return K.Kb(c,b,{width:1/0,height:1/0})}))),c.sort((function(b,c){return b.bandwidth-c.bandwidth}))}y("veygo.util.StreamUtils.meetsRestrictions",K.Kb),K.Dc=function(b,c,d){var e=!1;return b.forEach((function(b){var f=b.allowedByApplication;b.allowedByApplication=K.Kb(b,c,d),f!=b.allowedByApplication&&(e=!0)})),e},K.filterNewPeriod=function(b,c,d,e){e.variants=e.variants.filter((function(e){if(b&&b.L&&e.drmInfos.length&&"com.apple.hls-aes-128"!==e.drmInfos[0].keySystem&&!Lc(b,e))return!1;var f=e.audio;return e=e.video,!(f&&!kd(f)||e&&!kd(e)||f&&c&&!K.Ec(f,c)||e&&d&&!K.Ec(e,d))})),e.textStreams=e.textStreams.filter((function(b){return ed(Nb(b.mimeType,b.codecs))}))},K.Ec=function(b,c){return b.mimeType==c.mimeType&&b.codecs.split(".")[0]==c.codecs.split(".")[0]},K.vc=function(b){var c=b.audio,d=b.video,e=c?c.codecs:null,f=d?d.codecs:null,g=[];f&&g.push(f),e&&g.push(e);var h=[];d&&h.push(d.mimeType),c&&h.push(c.mimeType),h=h[0]||null;var k=[];c&&k.push(c.kind),d&&k.push(d.kind),k=k[0]||null;var l=new Set;return c&&c.roles.forEach((function(b){return l.add(b)})),d&&d.roles.forEach((function(b){return l.add(b)})),b={id:b.id,active:!1,type:"variant",bandwidth:b.bandwidth,language:b.language,label:null,kind:k,width:null,height:null,frameRate:null,mimeType:h,codecs:g.join(", "),audioCodec:e,videoCodec:f,primary:b.primary,roles:Array.from(l),videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},d&&(b.videoId=d.id,b.originalVideoId=d.originalId,b.width=d.width||null,b.height=d.height||null,b.frameRate=d.frameRate||null,b.videoBandwidth=d.bandwidth||null),c&&(b.audioId=c.id,b.originalAudioId=c.originalId,b.channelsCount=c.channelsCount,b.audioBandwidth=c.bandwidth||null,b.label=c.label),b},K.qc=function(b){return{id:b.id,active:!1,type:"text",bandwidth:0,language:b.language,label:b.label,kind:b.kind||null,width:null,height:null,frameRate:null,mimeType:b.mimeType,codecs:b.codecs||null,audioCodec:null,videoCodec:null,primary:b.primary,roles:b.roles,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:b.originalId}},K.Jd=function(b,c){for(var d=0;d<b.variants.length;d++)if(b.variants[d].id==c.id)return b.variants[d];return null},K.Id=function(b,c){for(var d=0;d<b.textStreams.length;d++)if(b.textStreams[d].id==c.id)return b.textStreams[d];return null},K.Ua=function(b){return b.allowedByApplication&&b.allowedByKeySystem},K.Ud=function(b){return b.filter((function(b){return K.Ua(b)}))},K.Mc=function(b,c){var d=b.filter((function(b){return b.audio&&b.audio.channelsCount})).reduce((function(b,c){var d=c.audio.channelsCount;return b[d]?b[d].push(c):b[d]=[c],b}),{}),e=Object.keys(d);if(0==e.length)return b;var f=e.filter((function(b){return b<=c}));return f.length?d[Math.max.apply(null,f)]:d[Math.min.apply(null,e)]},K.Db=function(b,c,d){var e=[],f=b.filter((function(b){return b.primary}));if(f.length&&(e=f),c){var g=Ad(J(c),b.map((function(b){return b.language})));g&&(e=b.filter((function(b){return J(b.language)==g})))}else d&&0===e.length&&(e=b);if(d){if((b=K.Lc(e,d)).length)return b}else if((b=e.filter((function(b){return 0==b.roles.length}))).length)return b;return(b=e.map((function(b){return b.roles})).reduce(I.Sb,[])).length?K.Lc(e,b[0]):e},K.Lc=function(b,c){return b.filter((function(b){return b.roles.includes(c)}))},K.Sc=function(b,c,d){for(var e=0;e<d.length;e++)if(d[e].audio==b&&d[e].video==c)return d[e];return null},K.Fb=function(b,c){for(var d=b.periods.length-1;0<d;--d)if(c+.06666666666666667>=b.periods[d].startTime)return d;return 0},K.Hd=function(b,c){for(var d=0;d<b.periods.length;++d)for(var e=b.periods[d],f=0;f<e.variants.length;++f)if(e.variants[f]==c)return d;return-1},K.de=function(b){return"audio"==b.type},K.he=function(b){return"video"==b.type},K.Qc=function(b){var c=[];return b.periods.forEach((function(b){b.variants.forEach((function(b){c.push(b)}))})),c},K.$d=function(b){var c=[];return b.audio&&c.push(b.audio),b.video&&c.push(b.video),c},K.mf=function(b){return K.de(b)?"type=audio codecs="+b.codecs+" bandwidth="+b.bandwidth+" channelsCount="+b.channelsCount:K.he(b)?"type=video codecs="+b.codecs+" bandwidth="+b.bandwidth+" frameRate="+b.frameRate+" width="+b.width+" height="+b.height:"unexpected stream type"},y("veygo.abr.SimpleAbrManager",L),L.prototype.stop=function(){this.h=null,this.f=!1,this.c=[],this.g=null},L.prototype.stop=L.prototype.stop,L.prototype.init=function(b){this.h=b},L.prototype.init=L.prototype.init,L.prototype.chooseVariant=function(){var b=Bd(this.a.restrictions,this.c),c=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.c.length&&!b.length&&(b=[(b=Bd(null,this.c))[0]]);for(var d=b[0]||null,e=0;e<b.length;++e){var f=b[e],g=(b[e+1]||{bandwidth:1/0}).bandwidth/this.a.bandwidthUpgradeTarget;c>=f.bandwidth/this.a.bandwidthDowngradeTarget&&c<=g&&(d=f)}return this.g=Date.now(),d},L.prototype.chooseVariant=L.prototype.chooseVariant,L.prototype.enable=function(){this.f=!0},L.prototype.enable=L.prototype.enable,L.prototype.disable=function(){this.f=!1},L.prototype.disable=L.prototype.disable,L.prototype.segmentDownloaded=function(b,c){var d=this.b;if(!(16e3>c)){var e=8e3*c/b,f=b/1e3;d.a+=c,Ia(d.b,f,e),Ia(d.c,f,e)}if(null!=this.g&&this.f)a:{if(this.i){if(Date.now()-this.g<1e3*this.a.switchInterval)break a}else{if(!(128e3<=this.b.a))break a;this.i=!0}d=this.chooseVariant(),this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate),this.h(d)}},L.prototype.segmentDownloaded=L.prototype.segmentDownloaded,L.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)},L.prototype.getBandwidthEstimate=L.prototype.getBandwidthEstimate,L.prototype.setVariants=function(b){this.c=b},L.prototype.setVariants=L.prototype.setVariants,L.prototype.configure=function(b){this.a=b},L.prototype.configure=L.prototype.configure;var M={Eb:function(b,c){var d=M.M(b,c);return 1!=d.length?null:d[0]},Nc:function(b,c,d){return 1!=(b=M.Oc(b,c,d)).length?null:b[0]},M:function(b,c){return Array.prototype.filter.call(b.childNodes,(function(b){return b instanceof Element&&b.tagName==c}))},Oc:function(b,c,d){return Array.prototype.filter.call(b.childNodes,(function(b){return b instanceof Element&&b.localName==d&&b.namespaceURI==c}))},getAttributeNS:function(b,c,d){return b.hasAttributeNS(c,d)?b.getAttributeNS(c,d):null},Gb:function(b){return Array.prototype.every.call(b.childNodes,(function(b){return b.nodeType==Node.TEXT_NODE||b.nodeType==Node.CDATA_SECTION_NODE}))?b.textContent.trim():null},G:function(b,c,d,e){e=void 0===e?null:e;var f=null;return null!=(b=b.getAttribute(c))&&(f=d(b)),null==f?e:f},Be:function(b){return b?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(b)&&(b+="Z"),b=Date.parse(b),isNaN(b)?null:Math.floor(b/1e3)):null},sa:function(b){return b&&(b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(b))?(b=31536e3*Number(b[1]||null)+2592e3*Number(b[2]||null)+86400*Number(b[3]||null)+3600*Number(b[4]||null)+60*Number(b[5]||null)+Number(b[6]||null),isFinite(b)?b:null):null},Mb:function(b){var c=/([0-9]+)-([0-9]+)/.exec(b);return c?(b=Number(c[1]),isFinite(b)?(c=Number(c[2]),isFinite(c)?{start:b,end:c}:null):null):null},parseInt:function(b){return 0==(b=Number(b))%1?b:null},jc:function(b){return 0==(b=Number(b))%1&&0<b?b:null},$a:function(b){return 0==(b=Number(b))%1&&0<=b?b:null},parseFloat:function(b){return b=Number(b),isNaN(b)?null:b},Gd:function(b){var c;return b=(c=b.match(/^(\d+)\/(\d+)$/))?Number(c[1]/c[2]):Number(b),isNaN(b)?null:b},ed:function(b,c){var d=new DOMParser;try{var e=d.parseFromString(b,"text/xml")}catch(g){}if(e&&e.documentElement.tagName==c)var f=e.documentElement;return f&&0<f.getElementsByTagName("parsererror").length?null:f},dd:function(b,c){try{var d=Sb(b);return M.ed(d,c)}catch(e){}}},Cd=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime");function Dd(b,c,d){var e=function Ed(b){for(var c=[],d=(b=r(b)).next();!d.done;d=b.next())(d=Kd(d.value))&&c.push(d);return c}(b),f=null;b=[];var g=[],h=new Set(e.map((function(b){return b.keyId})));if(h.delete(null),1<h.size)throw new A(2,4,4010);if(d||(g=e.filter((function(b){return"urn:mpeg:dash:mp4protection:2011"!=b.jd||(f=b.init||f,!1)}))).length&&(0==(b=function Fd(b,c,d){for(var e=[],f=(d=r(d)).next();!f.done;f=d.next()){f=f.value;var g=Cd.get(f.jd);if(g){var h=Vc(g,f.init||b);(g=Jd.get(g))&&(h.licenseServerUri=g(f)),e.push(h)}else for(h=(f=r(f=c(f.node)||[])).next();!h.done;h=f.next())e.push(h.value)}return e}(f,c,g)).length&&(b=[Vc("",f)])),e.length&&(d||!g.length))for(b=[],d=(c=r(Cd.values())).next();!d.done;d=c.next())"org.w3.clearkey"!=(d=d.value)&&b.push(Vc(d,f));if(h=Array.from(h)[0]||null)for(d=(c=r(b)).next();!d.done;d=c.next())for(e=(d=r(d.value.initData)).next();!e.done;e=d.next())e.value.keyId=h;return{Gc:h,lf:f,drmInfos:b,Pc:!0}}var Jd=(new Map).set("com.widevine.alpha",(function(b){return(b=M.Nc(b.node,"urn:microsoft","laurl"))&&b.getAttribute("licenseUrl")||""})).set("com.microsoft.playready",(function(b){return(b=M.Nc(b.node,"urn:microsoft:playready","pro"))&&(b=function Hd(b){var c=0,d=new DataView(b).getUint32(c,!0);if(d!==b.byteLength)return[];c+=6,d=[];for(var e=new DataView(b);c<b.byteLength-1;){var f=e.getUint16(c,!0);c+=2;var g=e.getUint16(c,!0);c+=2;var h=new Uint8Array(b,c,g);d.push({type:f,value:h}),c+=g}return d}((b=Yb(b.textContent)).buffer).filter((function(b){return 1===b.type}))[0])?(b=Ub(b.value,!0),(b=M.ed(b,"WRMHEADER"))?function Id(b){return(b=b.querySelector("DATA > LA_URL"))?b.textContent:""}(b):""):""}));function Kd(b){var c=b.getAttribute("schemeIdUri"),d=M.getAttributeNS(b,"urn:mpeg:cenc:2013","default_KID"),e=M.Oc(b,"urn:mpeg:cenc:2013","pssh").map(M.Gb);if(!c)return null;if(c=c.toLowerCase(),d&&(d=d.replace(/-/g,"").toLowerCase()).includes(" "))throw new A(2,4,4009);var f=[];try{f=e.map((function(b){return{initDataType:"cenc",initData:Yb(b),keyId:null}}))}catch(g){throw new A(2,4,4007)}return{node:b,jd:c,keyId:d,init:0<f.length?f:null}}function Ld(b,c,d,e,f){var g={RepresentationID:c,Number:d,Bandwidth:e,Time:f};return b.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(b,c,d,e){if("$$"==b)return"$";var f=g[c];if(null==f)return b;switch("RepresentationID"==c&&d&&(d=void 0),"Time"==c&&(f=Math.round(f)),e){case void 0:case"d":case"i":case"u":b=f.toString();break;case"o":b=f.toString(8);break;case"x":b=f.toString(16);break;case"X":b=f.toString(16).toUpperCase();break;default:b=f.toString()}return d=window.parseInt(d,10)||1,Array(Math.max(0,d-b.length)+1).join("0")+b}))}function Md(b,c){var d=Nd(b,c,"timescale"),e=1;d&&(e=M.jc(d)||1),d=Nd(b,c,"duration"),(d=Number(d||""))&&(d/=e);var f=Nd(b,c,"startNumber"),g=Number(Nd(b,c,"presentationTimeOffset"))||0,h=M.$a(f||"");null!=f&&null!=h||(h=1);var k=Od(b,c,"SegmentTimeline");if(f=null,k){f=e;var l=b.N.duration||1/0;k=M.M(k,"S");for(var m=[],n=0,q=0;q<k.length;++q){var x=k[q],w=M.G(x,"t",M.$a),D=M.G(x,"d",M.$a);if(x=M.G(x,"r",M.parseInt),null!=w&&(w-=g),!D)break;if(w=null!=w?w:n,0>(x=x||0))if(q+1<k.length){if(null==(x=M.G(k[q+1],"t",M.$a)))break;if(w>=x)break;x=Math.ceil((x-w)/D)-1}else{if(1/0==l)break;if(w/f>=l)break;x=Math.ceil((l*f-w)/D)-1}0<m.length&&w!=n&&(m[m.length-1].end=w/f);for(var G=0;G<=x;++G)n=w+D,m.push({start:w/f,end:n/f,df:w}),w=n}f=m}return{timescale:e,U:d,Ma:h,ga:g/e||0,uc:g,K:f}}function Nd(b,c,d){return[c(b.v),c(b.Y),c(b.ea)].filter(I.wa).map((function(b){return b.getAttribute(d)})).reduce((function(b,c){return b||c}))}function Od(b,c,d){return[c(b.v),c(b.Y),c(b.ea)].filter(I.wa).map((function(b){return M.Eb(b,d)})).reduce((function(b,c){return b||c}))}function Qd(b,c,d,e,f,g){if(g=void 0===g?0:g,M.getAttributeNS(b,"http://www.w3.org/1999/xlink","href")){var h=function Pd(b,c,d,e,f,g){for(var h=M.getAttributeNS(b,"http://www.w3.org/1999/xlink","href"),k=M.getAttributeNS(b,"http://www.w3.org/1999/xlink","actuate")||"onRequest",l=0;l<b.attributes.length;l++){var m=b.attributes[l];"http://www.w3.org/1999/xlink"==m.namespaceURI&&(b.removeAttributeNS(m.namespaceURI,m.localName),--l)}if(5<=g)return hb(new A(2,4,4028));if("onLoad"!=k)return hb(new A(2,4,4027));var n=Uc([e],[h]);return f.request(0,Ab(n,c)).Z((function(e){if(!(e=M.dd(e.data,b.tagName)))return hb(new A(2,4,4001,h));for(;b.childNodes.length;)b.removeChild(b.childNodes[0]);for(;e.childNodes.length;){var k=e.childNodes[0];e.removeChild(k),b.appendChild(k)}for(k=0;k<e.attributes.length;k++){var l=e.attributes[k].nodeName,m=e.getAttribute(l);b.setAttribute(l,m)}return Qd(b,c,d,n[0],f,g+1)}))}(b,c,d,e,f,g);return d&&(h=h.Z(void 0,(function(){return Qd(b,c,d,e,f,g)}))),h}h=[];for(var k=0;k<b.childNodes.length;k++){var l=b.childNodes[k];l instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==M.getAttributeNS(l,"http://www.w3.org/1999/xlink","href")?(b.removeChild(l),--k):"SegmentTimeline"!=l.tagName&&h.push(Qd(l,c,d,e,f,g)))}return lb(h).Z((function(){return b}))}function Rd(b,c,d){this.c=b,this.b=c,this.a=d}function N(b,c,d,e,f,g,h,k,l){this.position=b,this.startTime=c,this.endTime=d,this.c=e,this.b=f,this.a=g,this.encrypted=h||!1,this.f=k||null,this.g=l||null}function O(b,c){this.H=b,this.b=c==Sd,this.a=0}y("veygo.media.InitSegmentReference",Rd),Rd.prototype.Tb=function(){return this.c()},Rd.prototype.createUris=Rd.prototype.Tb,Rd.prototype.Yb=function(){return this.b},Rd.prototype.getStartByte=Rd.prototype.Yb,Rd.prototype.Xb=function(){return this.a},Rd.prototype.getEndByte=Rd.prototype.Xb,y("veygo.media.SegmentReference",N),N.prototype.X=function(){return this.position},N.prototype.getPosition=N.prototype.X,N.prototype.Zb=function(){return this.startTime},N.prototype.getStartTime=N.prototype.Zb,N.prototype.Pd=function(){return this.endTime},N.prototype.getEndTime=N.prototype.Pd,N.prototype.Tb=function(){return this.c()},N.prototype.createUris=N.prototype.Tb,N.prototype.Yb=function(){return this.b},N.prototype.getStartByte=N.prototype.Yb,N.prototype.Xb=function(){return this.a},N.prototype.getEndByte=N.prototype.Xb,y("veygo.util.DataViewReader",O);var be,Sd=1;function Td(){throw new A(2,3,3e3)}function P(){this.c=[],this.b=[],this.a=!1}function Q(b){for(;b.reader.ia()&&!b.parser.a;)b.parser.Lb(b.start,b.reader,b.partialOkay)}function Vd(b){for(var c=b.reader.B();0<c&&!b.parser.a;--c)b.parser.Lb(b.start,b.reader,b.partialOkay)}function Wd(b){return function(c){b(c.reader.Ka(c.reader.H.byteLength-c.reader.X()))}}function Ud(b){for(var c=0,d=0;d<b.length;d++)c=c<<8|b.charCodeAt(d);return c}function Xd(b){return String.fromCharCode(b>>24&255,b>>16&255,b>>8&255,255&b)}function Yd(b,c,d,e){var f,g=(new P).aa("sidx",(function(b){f=function Zd(b,c,d,e){var f=[];e.reader.I(4);var g=e.reader.B();if(0==g)throw new A(2,3,3005);if(0==e.version)var h=e.reader.B(),k=e.reader.B();else h=e.reader.bb(),k=e.reader.bb();e.reader.I(2);var l=e.reader.pb();for(b=b+e.size+k,k=0;k<l;k++){var m=e.reader.B(),n=(2147483648&m)>>>31;m&=2147483647;var q=e.reader.B();if(e.reader.I(4),1==n)throw new A(2,3,3006);f.push(new N(f.length,h/g-c,(h+q)/g-c,(function(){return d}),b,b+m-1)),h+=q,b+=m}return e.parser.stop(),f}(c,e,d,b)}));if(b&&g.parse(b),f)return f;throw new A(2,3,3004)}function R(b){this.a=b}function $d(b,c){for(;b.a.length&&b.a[b.a.length-1].startTime>=c;)b.a.pop();for(;b.a.length&&0>=b.a[0].endTime;)b.a.shift();if(0!=b.a.length){var d=b.a[b.a.length-1];b.a[b.a.length-1]=new N(d.position,d.startTime,c,d.c,d.b,d.a,d.encrypted,d.f,d.g)}}function ae(b){this.b=b,this.a=new O(b,0),be||(be=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function ce(b){var c=de(b);if(7<c.length)throw new A(2,3,3002);for(var d=0,e=0;e<c.length;e++)d=256*d+c[e];c=d,d=de(b);a:{for(e=0;e<be.length;e++)if(ac(d,be[e])){e=!0;break a}e=!1}if(e)d=b.b.byteLength-b.a.X();else{if(8==d.length&&224&d[1])throw new A(2,3,3001);e=d[0]&(1<<8-d.length)-1;for(var f=1;f<d.length;f++)e=256*e+d[f];d=e}return d=b.a.X()+d<=b.b.byteLength?d:b.b.byteLength-b.a.X(),e=new DataView(b.b.buffer,b.b.byteOffset+b.a.X(),d),b.a.I(d),new ee(c,e)}function de(b){var d,c=b.a.fa();for(d=1;8>=d&&!(c&1<<8-d);d++);if(8<d)throw new A(2,3,3002);var e=new Uint8Array(d);for(e[0]=c,c=1;c<d;c++)e[c]=b.a.fa();return e}function ee(b,c){this.id=b,this.a=c}function fe(b){if(8<b.a.byteLength)throw new A(2,3,3002);if(8==b.a.byteLength&&224&b.a.getUint8(0))throw new A(2,3,3001);for(var c=0,d=0;d<b.a.byteLength;d++){c=256*c+b.a.getUint8(d)}return c}function ge(){}function ie(b){var c=new ae(b.a);if(179!=(b=ce(c)).id)throw new A(2,3,3013);if(b=fe(b),183!=(c=ce(c)).id)throw new A(2,3,3012);c=new ae(c.a);for(var d=0;c.ia();){var e=ce(c);if(241==e.id){d=fe(e);break}}return{ef:b,Ie:d}}function je(b,c){var d=Od(b,c,"Initialization");if(!d)return null;var e=b.v.ha,f=d.getAttribute("sourceURL");f&&(e=Uc(b.v.ha,[f])),f=0;var g=null;return(d=M.G(d,"range",M.Mb))&&(f=d.start,g=d.end),new Rd((function(){return e}),f,g)}function me(b,c,d,e,f,g,h,k){var l=b.presentationTimeline,m=!b.Ra||!b.N.$b,n=b.N.start,q=b.N.duration,x=c,w=null;return{createSegmentIndex:function(){var b=[x(e,f,g),"webm"==h?x(d.c(),d.b,d.a):null];return x=null,Promise.all(b).then((function(b){var c=b[0];b=b[1]||null,c="mp4"==h?Yd(c,f,e,k):(new ge).parse(c,b,e,k),l.Ya(c,n),w=new R(c),m&&$d(w,q)}))},findSegmentPosition:function(b){return w.find(b)},getSegmentReference:function(b){return w.get(b)}}}function le(b){return b.qb}function ne(b,c){var d=je(b,oe),e=function pe(b){return[b.v.Aa,b.Y.Aa,b.ea.Aa].filter(I.wa).map((function(b){return M.M(b,"SegmentURL")})).reduce((function(b,d){return 0<b.length?b:d})).map((function(c){return c.getAttribute("indexRange")&&!b.Wc&&(b.Wc=!0),{ie:c.getAttribute("media"),start:(c=M.G(c,"mediaRange",M.Mb,{start:0,end:null})).start,end:c.end}}))}(b),f=Md(b,oe),g=f.Ma;0==g&&(g=1);var h=0;if(f.U?h=f.U*(g-1):f.K&&0<f.K.length&&(h=f.K[0].start),!(e={U:f.U,startTime:h,Ma:g,ga:f.ga,K:f.K,Wa:e}).U&&!e.K&&1<e.Wa.length)throw new A(2,4,4002);if(!e.U&&!b.N.duration&&!e.K&&1==e.Wa.length)throw new A(2,4,4002);if(e.K&&0==e.K.length)throw new A(2,4,4002);return g=f=null,b.ea.id&&b.v.id&&(f=c[g=b.ea.id+","+b.v.id]),h=function qe(b,c,d,e){var f=e.Wa.length;e.K&&e.K.length!=e.Wa.length&&(f=Math.min(e.K.length,e.Wa.length));for(var g=[],h=e.startTime,k=0;k<f;k++){var l=e.Wa[k],m=Uc(d,[l.ie]),n=void 0;n=null!=e.U?h+e.U:e.K?e.K[k].end:h+b,g.push(new N(k+c,h,n,function(b){return b}.bind(null,m),l.start,l.end)),h=n}return g}(b.N.duration,e.Ma,b.v.ha,e),f?(f.cc(h),f.Ub(b.presentationTimeline.jb()-b.N.start)):(b.presentationTimeline.Ya(h,b.N.start),f=new R(h),g&&b.Ra&&(c[g]=f)),b.Ra&&b.N.$b||$d(f,b.N.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:f.find.bind(f),getSegmentReference:f.get.bind(f),initSegmentReference:d,ga:e.ga}}function oe(b){return b.Aa}function re(b,c,d,e){var f=function se(b){var c=Nd(b,te,"initialization");if(!c)return null;var d=b.v.id,e=b.bandwidth||null,f=b.v.ha;return new Rd((function(){var b=Ld(c,d,null,e,null);return Uc(f,[b])}),0,null)}(b),g=Md(b,te),h=Nd(b,te,"media"),k=Nd(b,te,"index");if(h=(g={U:g.U,timescale:g.timescale,Ma:g.Ma,ga:g.ga,uc:g.uc,K:g.K,bc:h,lb:k}).lb?1:0,h+=g.K?1:0,0==(h+=g.U?1:0))throw new A(2,4,4002);if(1!=h&&(g.lb&&(g.K=null),g.U=null),!g.lb&&!g.bc)throw new A(2,4,4002);if(g.lb){if("mp4"!=(d=b.v.mimeType.split("/")[1])&&"webm"!=d)throw new A(2,4,4006);if("webm"==d&&!f)throw new A(2,4,4005);e=Ld(g.lb,b.v.id,null,b.bandwidth||null,null),b=me(b,c,f,e=Uc(b.v.ha,[e]),0,null,d,g.ga)}else g.U?(e||(b.presentationTimeline.ec(g.U),b.presentationTimeline.fc(b.N.start)),b=function ue(b,c){var d=b.N.duration,e=c.U,f=c.Ma,g=c.timescale,h=c.bc,k=b.bandwidth||null,l=b.v.id,m=b.v.ha;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(b){return 0>b||d&&b>=d?null:Math.floor(b/e)},getSegmentReference:function(b){var c=b*e,n=c+e;return d&&(n=Math.min(n,d)),0>n||d&&c>=d?null:new N(b,c,n,(function(){var d=Ld(h,l,b+f,k,c*g);return Uc(m,[d])}),0,null)}}}(b,g)):(e=c=null,b.ea.id&&b.v.id&&(c=d[e=b.ea.id+","+b.v.id]),h=function ve(b,c){for(var d=[],e=0;e<c.K.length;e++){var f=e+c.Ma;d.push(new N(f,c.K[e].start,c.K[e].end,function(b,c,d,e,f,n){return Uc(e,[b=Ld(b,c,f,d,n)]).map((function(b){return b.toString()}))}.bind(null,c.bc,b.v.id,b.bandwidth||null,b.v.ha,f,c.K[e].df+c.uc),0,null))}return d}(b,g),k=!b.Ra||!b.N.$b,c?(k&&$d(new R(h),b.N.duration),c.cc(h),c.Ub(b.presentationTimeline.jb()-b.N.start)):(b.presentationTimeline.Ya(h,b.N.start),c=new R(h),e&&b.Ra&&(d[e]=c)),k&&$d(c,b.N.duration),b={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:c.find.bind(c),getSegmentReference:c.get.bind(c)});return{createSegmentIndex:b.createSegmentIndex,findSegmentPosition:b.findSegmentPosition,getSegmentReference:b.getSegmentReference,initSegmentReference:f,ga:g.ga}}function te(b){return b.sb}O.Endianness={hf:0,jf:Sd},O.prototype.ia=function(){return this.a<this.H.byteLength},O.prototype.hasMoreData=O.prototype.ia,O.prototype.X=function(){return this.a},O.prototype.getPosition=O.prototype.X,O.prototype.Qd=function(){return this.H.byteLength},O.prototype.getLength=O.prototype.Qd,O.prototype.fa=function(){try{var b=this.H.getUint8(this.a);return this.a+=1,b}catch(c){Td()}},O.prototype.readUint8=O.prototype.fa,O.prototype.pb=function(){try{var b=this.H.getUint16(this.a,this.b);return this.a+=2,b}catch(c){Td()}},O.prototype.readUint16=O.prototype.pb,O.prototype.B=function(){try{var b=this.H.getUint32(this.a,this.b);return this.a+=4,b}catch(c){Td()}},O.prototype.readUint32=O.prototype.B,O.prototype.fd=function(){try{var b=this.H.getInt32(this.a,this.b);return this.a+=4,b}catch(c){Td()}},O.prototype.readInt32=O.prototype.fd,O.prototype.bb=function(){try{if(this.b)var b=this.H.getUint32(this.a,!0),c=this.H.getUint32(this.a+4,!0);else c=this.H.getUint32(this.a,!1),b=this.H.getUint32(this.a+4,!1)}catch(d){Td()}if(2097151<c)throw new A(2,3,3001);return this.a+=8,c*Math.pow(2,32)+b},O.prototype.readUint64=O.prototype.bb,O.prototype.Ka=function(b){this.a+b>this.H.byteLength&&Td();var c=new Uint8Array(this.H.buffer,this.H.byteOffset+this.a,b);return this.a+=b,new Uint8Array(c)},O.prototype.readBytes=O.prototype.Ka,O.prototype.I=function(b){this.a+b>this.H.byteLength&&Td(),this.a+=b},O.prototype.skip=O.prototype.I,O.prototype.hd=function(b){this.a<b&&Td(),this.a-=b},O.prototype.rewind=O.prototype.hd,O.prototype.seek=function(b){(0>b||b>this.H.byteLength)&&Td(),this.a=b},O.prototype.seek=O.prototype.seek,O.prototype.kc=function(){for(var b=this.a;this.ia()&&0!=this.H.getUint8(this.a);)this.a+=1;return b=new Uint8Array(this.H.buffer,this.H.byteOffset+b,this.a-b),this.a+=1,Sb(b)},O.prototype.readTerminatedString=O.prototype.kc,y("veygo.util.Mp4Parser",P),P.prototype.D=function(b,c){var d=Ud(b);return this.c[d]=0,this.b[d]=c,this},P.prototype.box=P.prototype.D,P.prototype.aa=function(b,c){var d=Ud(b);return this.c[d]=1,this.b[d]=c,this},P.prototype.fullBox=P.prototype.aa,P.prototype.stop=function(){this.a=!0},P.prototype.stop=P.prototype.stop,P.prototype.parse=function(b,c){var d=new Uint8Array(b);for(d=new O(new DataView(d.buffer,d.byteOffset,d.byteLength),0),this.a=!1;d.ia()&&!this.a;)this.Lb(0,d,c)},P.prototype.parse=P.prototype.parse,P.prototype.Lb=function(b,c,d){var e=c.X(),f=c.B(),g=c.B();switch(f){case 0:f=c.H.byteLength-e;break;case 1:f=c.bb()}var h=this.b[g];if(h){var k=null,l=null;1==this.c[g]&&(k=(l=c.B())>>>24,l&=16777215),g=e+f,d&&g>c.H.byteLength&&(g=c.H.byteLength),g-=c.X(),c=0<g?c.Ka(g):new Uint8Array(0),h({parser:this,partialOkay:d||!1,version:k,flags:l,reader:c=new O(new DataView(c.buffer,c.byteOffset,c.byteLength),0),size:f,start:e+b})}else c.I(Math.min(e+f-c.X(),c.H.byteLength-c.X()))},P.prototype.parseNext=P.prototype.Lb,P.children=Q,P.sampleDescription=Vd,P.allData=Wd,P.typeToString=Xd,y("veygo.media.SegmentIndex",R),R.prototype.destroy=function(){return this.a=null,Promise.resolve()},R.prototype.destroy=R.prototype.destroy,R.prototype.find=function(b){for(var c=this.a.length-1;0<=c;--c){var d=this.a[c];if(b>=d.startTime&&b<d.endTime)return d.position}return this.a.length&&b<this.a[0].startTime?this.a[0].position:null},R.prototype.find=R.prototype.find,R.prototype.get=function(b){return 0==this.a.length||0>(b-=this.a[0].position)||b>=this.a.length?null:this.a[b]},R.prototype.get=R.prototype.get,R.prototype.offset=function(b){for(var c=0;c<this.a.length;++c)this.a[c].startTime+=b,this.a[c].endTime+=b},R.prototype.offset=R.prototype.offset,R.prototype.cc=function(b){for(var c=[],d=0,e=0;d<this.a.length&&e<b.length;){var f=this.a[d],g=b[e];f.startTime<g.startTime?(c.push(f),d++):(f.startTime>g.startTime?0==d&&c.push(g):(.1<Math.abs(f.endTime-g.endTime)?c.push(new N(f.position,g.startTime,g.endTime,g.c,g.b,g.a)):c.push(f),d++),e++)}for(;d<this.a.length;)c.push(this.a[d++]);if(c.length)for(d=c[c.length-1].position+1;e<b.length;)f=new N(d++,(f=b[e++]).startTime,f.endTime,f.c,f.b,f.a),c.push(f);else c=b;this.a=c},R.prototype.merge=R.prototype.cc,R.prototype.Ub=function(b){for(var c=0;c<this.a.length;++c)if(this.a[c].endTime>b)return void this.a.splice(0,c);this.a=[]},R.prototype.evict=R.prototype.Ub,ae.prototype.ia=function(){return this.a.ia()},ge.prototype.parse=function(b,c,d,e){var f;if(440786851!=ce(c=new ae(new DataView(c))).id)throw new A(2,3,3008);var g=ce(c);if(408125543!=g.id)throw new A(2,3,3009);for(c=g.a.byteOffset,g=new ae(g.a),f=null;g.ia();){var h=ce(g);if(357149030==h.id){f=h;break}}if(!f)throw new A(2,3,3010);for(g=new ae(f.a),f=1e6,h=null;g.ia();){var k=ce(g);if(2807729==k.id)f=fe(k);else if(17545==k.id)if(4==(h=k).a.byteLength)h=h.a.getFloat32(0);else{if(8!=h.a.byteLength)throw new A(2,3,3003);h=h.a.getFloat64(0)}}if(null==h)throw new A(2,3,3011);if(f=h*(g=f/1e9),475249515!=(b=ce(new ae(new DataView(b)))).id)throw new A(2,3,3007);return function he(b,c,d,e,f,g){function h(){return f}var k=[];b=new ae(b.a);for(var l=null,m=null;b.ia();){var n=ce(b);if(187==n.id){var q=ie(n);q&&(n=d*q.ef,q=c+q.Ie,null!=l&&k.push(new N(k.length,l-g,n-g,h,m,q-1)),l=n,m=q)}}return null!=l&&k.push(new N(k.length,l-g,e-g,h,m,null)),k}(b,c,g,f,d,e)};var we={},xe={};function ze(b,c,d,e){return t((function g(){var h,k;return v(g,(function(g){switch(g.j){case 1:return qa(g,2),u(g,function Ae(b,c,d,e){return t((function g(){var h,k,l,m,n,q,x,w,D,G;return v(g,(function(g){switch(g.j){case 1:return e&&(h=e.toLowerCase(),k=we[h])?g.return(k):(l=new Oa(b),m=l.da.split("/"),n=m.pop(),1<(q=n.split(".")).length&&(x=q.pop().toLowerCase(),w=xe[x])?g.return(w):u(g,function Be(b,c,d){return t((function f(){var g,h,k;return v(f,(function(f){switch(f.j){case 1:return(g=Ab([b],d)).method="HEAD",u(f,c.request(0,g).promise,2);case 2:return h=f.u,k=h.headers["content-type"],f.return(k?k.toLowerCase():"")}}))}))}(b,c,d),2));case 2:if(D=g.u,G=we[D])return g.return(G);throw new A(2,4,4e3,b)}}))}))}(b,c,d,e),4);case 4:return h=g.u,g.return(new h);case 2:throw(k=ta(g)).severity=2,k}}))}))}function S(b,c,d){this.f=b,this.m=c,this.h=this.g=1/0,this.a=1,this.b=this.c=null,this.l=0,this.o=!0,this.i=0,this.s=void 0===d||d}function Ce(){this.a=this.b=null,this.h=[],this.c=null,this.l=[],this.i=1,this.m={},this.o=0,this.s=new Ha(5),this.g=null,this.f=new wb}function De(b){var c=Date.now(),d=b.a.networkingEngine.request(0,Ab(b.h,b.b.retryParameters));return xb(b.f,d),d.promise.then((function(c){if(b.a)return function Fe(b,c,d){if(!(c=M.dd(c,"MPD")))throw new A(2,4,4001,d);return c=Qd(c,b.b.retryParameters,b.b.dash.xlinkFailGracefully,d,b.a.networkingEngine),xb(b.f,c),c.promise.then((function(c){return function Ge(b,c,d){return t((function f(){var g,h,k,l,m,n,q,x,w,D,V,Z,da,na,nb,Pa,ha,Tf,Vf,Wf,Xf,Yf;return v(f,(function(f){switch(f.j){case 1:l=I,n=[d],0<(q=(m=M).M(c,"Location").map(m.Gb).filter(l.wa)).length&&(x=Uc(n,q),n=b.h=x),w=m.M(c,"BaseURL").map(m.Gb),D=Uc(n,w),b.b.dash.ignoreMinBufferTime||(V=m.G(c,"minBufferTime",m.sa)),b.o=m.G(c,"minimumUpdatePeriod",m.sa,-1),Z=m.G(c,"availabilityStartTime",m.Be),da=m.G(c,"timeShiftBufferDepth",m.sa),na=m.G(c,"suggestedPresentationDelay",m.sa),nb=m.G(c,"maxSegmentDuration",m.sa),Pa=c.getAttribute("type")||"static",b.c?ha=b.c.presentationTimeline:(Tf=Math.max(b.b.dash.defaultPresentationDelay,1.5*V),ha=new S(Z,null!=na?na+2:Tf,b.b.dash.autoCorrectDrift));for(var Zf={Ra:"static"!=Pa,presentationTimeline:ha,ea:null,N:null,Y:null,v:null,bandwidth:0,Wc:!1},zj=D,Hc=M.G(c,"mediaPresentationDuration",M.sa),Ic=[],Qa=0,Lb=M.M(c,"Period"),ob=0;ob<Lb.length;ob++){var ab=Lb[ob];Qa=M.G(ab,"start",M.sa,Qa);var Jc=M.G(ab,"duration",M.sa),Ra=null;if(ob!=Lb.length-1){var $f=M.G(Lb[ob+1],"start",M.sa);null!=$f&&(Ra=$f-Qa)}else null!=Hc&&(Ra=Hc-Qa);if(null==Ra&&(Ra=Jc),ab=He(b,Zf,zj,{start:Qa,duration:Ra,node:ab,$b:null==Ra||ob==Lb.length-1}),Ic.push(ab),Jc=Zf.ea.id,b.l.includes(Jc)||(b.l.push(Jc),b.c&&(b.a.filterNewPeriod(ab),b.c.periods.push(ab))),null==Ra){Qa=null;break}Qa+=Ra}if(null==b.c&&b.a.filterAllPeriods(Ic),null!=Hc?(g=Ic,h=Hc,k=!1):(g=Ic,h=Qa,k=!0),Vf=h,Wf=g,ha.tb("static"==Pa),"static"!=Pa&&k||ha.la(Vf||1/0),ha.ba()&&!isNaN(b.b.availabilityWindowOverride)&&(da=b.b.availabilityWindowOverride),null==da&&(da=1/0),ha.oc(da),ha.ec(nb||1),b.c){f.A(2);break}if(b.c={presentationTimeline:ha,periods:Wf,offlineSessionIds:[],minBufferTime:V||0},!ha.td()){f.A(2);break}return Xf=m.M(c,"UTCTiming"),u(f,function Ie(b,c,d){d=d.map((function(b){return{scheme:b.getAttribute("schemeIdUri"),value:b.getAttribute("value")}}));var e=b.b.dash.clockSyncUri;return!d.length&&e&&d.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:e}),I.Fd(d,function(b){var d=b.scheme;switch(b=b.value,d){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Pe(this,c,b,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Pe(this,c,b,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return d=Date.parse(b),isNaN(d)?0:d-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return Ma("NTP UTCTiming scheme is not supported"),Promise.reject();default:return Ma("Unrecognized scheme in UTCTiming element",d),Promise.reject()}}.bind(b)).catch((function(){return Ma("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0}))}(b,D,Xf),4);case 4:if(Yf=f.u,!b.a)return f.return();ha.ld(Yf);case 2:if(b.c)return u(f,b.a.filter(b.c),0);f.A(0)}}))}))}(b,c,d)}))}(b,c.data,c.uri)})).then((function(){var d=(Date.now()-c)/1e3;return Ia(b.s,1,d),d}))}function He(b,c,d,e){if(c.ea=Je(e.node,null,d),c.N=e,c.ea.id||(c.ea.id="__veygo_period_"+e.start),M.M(e.node,"EventStream").forEach(b.De.bind(b,e.start,e.duration)),d=M.M(e.node,"AdaptationSet").map(b.Ae.bind(b,c)).filter(I.wa),c.Ra){c=[];for(var f=r(d),g=f.next();!g.done;g=f.next())for(var h=(g=r(g.value.Ke)).next();!h.done;h=g.next())c.push(h.value);if(c.length!=new Set(c).size)throw new A(2,4,4018)}var k=d.filter((function(b){return!b.sc}));if(d.filter((function(b){return b.sc})).forEach((function(b){var c=b.streams[0],d=b.sc;k.forEach((function(b){b.id==d&&b.streams.forEach((function(b){b.trickModeVideo=c}))}))})),c=Ke(k,"video"),f=Ke(k,"audio"),!c.length&&!f.length)throw new A(2,4,4004);for(f.length||(f=[null]),c.length||(c=[null]),d=[],g=0;g<f.length;g++)for(h=0;h<c.length;h++)Le(b,f[g],c[h],d);for(b=Ke(k,"text"),c=[],f=0;f<b.length;f++)c.push.apply(c,b[f].streams);return{startTime:e.start,textStreams:c,variants:d}}function Ke(b,c){return b.filter((function(b){return b.contentType==c}))}function Le(b,c,d,e){if(c||d)if(c&&d){var f=c.drmInfos,g=d.drmInfos;if(!f.length||!g.length||0<Mc(f,g).length){g=Mc(c.drmInfos,d.drmInfos);for(var h=0;h<c.streams.length;h++)for(var k=0;k<d.streams.length;k++)f=(d.streams[k].bandwidth||0)+(c.streams[h].bandwidth||0),f={id:b.i++,language:c.language,primary:c.ac||d.ac,audio:c.streams[h],video:d.streams[k],bandwidth:f,drmInfos:g,allowedByApplication:!0,allowedByKeySystem:!0},e.push(f)}}else for(g=c||d,h=0;h<g.streams.length;h++)f=g.streams[h].bandwidth||0,f={id:b.i++,language:g.language||"und",primary:g.ac,audio:c?g.streams[h]:null,video:d?g.streams[h]:null,bandwidth:f,drmInfos:g.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},e.push(f)}function Ee(b,c){0>b.o||(b.g=window.setTimeout(b.Xe.bind(b),1e3*Math.max(3,b.o-c,Ja(b.s))))}function Je(b,c,d){c=c||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,gc:null},d=d||c.ha;var e=M.$a,f=M.Gd,g=M.M(b,"BaseURL").map(M.Gb),h=b.getAttribute("contentType")||c.contentType,k=b.getAttribute("mimeType")||c.mimeType,l=b.getAttribute("codecs")||c.codecs;f=M.G(b,"frameRate",f)||c.frameRate;for(var m=M.M(b,"InbandEventStream"),n=c.emsgSchemeIdUris.slice(),q=(m=r(m)).next();!q.done;q=m.next())q=q.value.getAttribute("schemeIdUri"),n.includes(q)||n.push(q);return m=function Oe(b){for(var c=0;c<b.length;++c){var d=b[c],e=d.getAttribute("schemeIdUri");if(e&&(d=d.getAttribute("value")))switch(e){case"urn:mpeg:dash:outputChannelPositionList:2012":return d.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(!(e=parseInt(d,10)))continue;return e;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(e=parseInt(d,16)){for(b=0;e;)1&e&&++b,e>>=1;return b}}}return null}(m=M.M(b,"AudioChannelConfiguration"))||c.gc,h||(h=Me(k,l)),{ha:Uc(d,g),qb:M.Eb(b,"SegmentBase")||c.qb,Aa:M.Eb(b,"SegmentList")||c.Aa,sb:M.Eb(b,"SegmentTemplate")||c.sb,width:M.G(b,"width",e)||c.width,height:M.G(b,"height",e)||c.height,contentType:h,mimeType:k,codecs:l,frameRate:f,emsgSchemeIdUris:n,id:b.getAttribute("id"),gc:m}}function Pe(b,c,d,e){return(c=Ab(c=Uc(c,[d]),b.b.retryParameters)).method=e,c=b.a.networkingEngine.request(4,c),xb(b.f,c),c.promise.then((function(b){if("HEAD"==e){if(!b.headers||!b.headers.date)return 0;b=b.headers.date}else b=Sb(b.data);return b=Date.parse(b),isNaN(b)?0:b-Date.now()}))}function Me(b,c){return ed(Nb(b,c))?"text":b.split("/")[0]}function Qe(b,c){this.a=b,this.b=c}function Re(b,c){var d=new Qe(2,6),e=Se,f=e.a,g=d.b-f.b;(0<(d.a-f.a||g)?e.c:e.b)(e.a,d,b,c)}function Te(b,c,d,e){Ma([d,"has been deprecated and will be removed in",c,". We are currently at version",b,". Additional information:",e].join(" "))}function Ue(b,c,d,e){La([d,"has been deprecated and has been removed in",c,". We are now at version",b,". Additional information:",e].join(""))}y("veygo.media.ManifestParser.registerParserByExtension",(function(b,c){xe[b]=c})),y("veygo.media.ManifestParser.registerParserByMime",(function(b,c){we[b]=c})),y("veygo.media.PresentationTimeline",S),S.prototype.T=function(){return this.g},S.prototype.getDuration=S.prototype.T,S.prototype.la=function(b){this.g=b},S.prototype.setDuration=S.prototype.la,S.prototype.Wd=function(){return this.f},S.prototype.getPresentationStartTime=S.prototype.Wd,S.prototype.ld=function(b){this.l=b},S.prototype.setClockOffset=S.prototype.ld,S.prototype.tb=function(b){this.o=b},S.prototype.setStatic=S.prototype.tb,S.prototype.oc=function(b){this.h=b},S.prototype.setSegmentAvailabilityDuration=S.prototype.oc,S.prototype.Ue=function(b){this.m=b},S.prototype.setDelay=S.prototype.Ue,S.prototype.Od=function(){return this.m},S.prototype.getDelay=S.prototype.Od,S.prototype.Ya=function(b,c){if(0!=b.length){var d=b[b.length-1].endTime+c;this.fc(b[0].startTime+c),this.a=b.reduce((function(b,c){return Math.max(b,c.endTime-c.startTime)}),this.a),this.b=Math.max(this.b,d),null!=this.f&&this.s&&(this.f=(Date.now()+this.l)/1e3-this.b-this.a)}},S.prototype.notifySegments=S.prototype.Ya,S.prototype.fc=function(b){this.c=null==this.c?b:Math.min(this.c,b)},S.prototype.notifyMinSegmentStartTime=S.prototype.fc,S.prototype.ec=function(b){this.a=Math.max(this.a,b)},S.prototype.notifyMaxSegmentDuration=S.prototype.ec,S.prototype.offset=function(b){null!=this.c&&(this.c+=b),null!=this.b&&(this.b+=b)},S.prototype.offset=S.prototype.offset,S.prototype.ba=function(){return 1/0==this.g&&!this.o},S.prototype.isLive=S.prototype.ba,S.prototype.Ia=function(){return 1/0!=this.g&&!this.o},S.prototype.isInProgress=S.prototype.Ia,S.prototype.jb=function(){return 1/0==this.h?this.i:Math.max(this.i,this.Ta()-this.h)},S.prototype.getSegmentAvailabilityStart=S.prototype.jb,S.prototype.od=function(b){this.i=b},S.prototype.setUserSeekStart=S.prototype.od,S.prototype.Ta=function(){return this.ba()||this.Ia()?Math.min(Math.max(0,(Date.now()+this.l)/1e3-this.a-this.f),this.g):this.g},S.prototype.getSegmentAvailabilityEnd=S.prototype.Ta,S.prototype.ib=function(b){var c=Math.max(this.c,this.i);return 1/0==this.h?c:Math.max(c,Math.min(this.Ta()-this.h+b,this.qa()))},S.prototype.getSafeSeekRangeStart=S.prototype.ib,S.prototype.Sa=function(){return this.ib(0)},S.prototype.getSeekRangeStart=S.prototype.Sa,S.prototype.qa=function(){return Math.max(0,this.Ta()-(this.ba()||this.Ia()?this.m:0))},S.prototype.getSeekRangeEnd=S.prototype.qa,S.prototype.td=function(){return null!=this.f&&null==this.b},S.prototype.usingPresentationStartTime=S.prototype.td,y("veygo.dash.DashParser",Ce),(p=Ce.prototype).configure=function(b){this.b=b},p.start=function(b,c){return this.h=[b],this.a=c,De(this).then(function(b){return this.a&&Ee(this,b),this.c}.bind(this))},p.stop=function(){return this.b=this.a=null,this.h=[],this.c=null,this.l=[],this.m={},null!=this.g&&(window.clearTimeout(this.g),this.g=null),this.f.destroy()},p.update=function(){De(this).catch(function(b){this.a&&this.a.onError(b)}.bind(this))},p.onExpirationUpdated=function(){},p.Ae=function(b,c){b.Y=Je(c,b.ea,null);var d=!1,e=M.M(c,"Role"),f=e.map((function(b){return b.getAttribute("value")})).filter(I.wa),g=void 0,h="text"==b.Y.contentType;h&&(g="subtitle");for(var k=0;k<e.length;k++){var l=e[k].getAttribute("schemeIdUri");if(null==l||"urn:mpeg:dash:role:2011"==l)switch(l=e[k].getAttribute("value"),l){case"main":d=!0;break;case"caption":case"subtitle":g=l}}var m=null,n=!1;M.M(c,"EssentialProperty").forEach((function(b){"http://dashif.org/guidelines/trickmode"==b.getAttribute("schemeIdUri")?m=b.getAttribute("value"):n=!0})),k=M.M(c,"Accessibility");var q=new Map;for(e={},l=(k=r(k)).next();!l.done;e={gb:e.gb},l=k.next()){var x=(l=l.value).getAttribute("schemeIdUri");"urn:scte:dash:cc:cea-608:2015"!=x&&"urn:scte:dash:cc:cea-708:2015"!=x||(e.gb=1,null!=(l=l.getAttribute("value"))?l.split(";").forEach(function(b){return function(c){if(c.includes("=")){var d=(c=c.split("="))[0].startsWith("CC")?c[0]:"CC"+c[0];c=c[1].split(",")[0].split(":").pop()}else d="CC"+b.gb,b.gb+=2,c=c.length?c:"und";q.set(d,J(c))}}(e)):q.set("CC1","und"))}if(n)return null;var w=Dd(e=M.M(c,"ContentProtection"),this.b.dash.customScheme,this.b.dash.ignoreDrmInfo);if(e=J(c.getAttribute("lang")||"und"),l=c.getAttribute("label"),0==(f=(k=M.M(c,"Representation")).map(this.Ee.bind(this,b,w,g,e,l,d,f,q)).filter((function(b){return!!b}))).length){if(h)return null;throw new A(2,4,4003)}return b.Y.contentType&&"application"!=b.Y.contentType||(b.Y.contentType=Me(f[0].mimeType,f[0].codecs),f.forEach((function(c){c.type=b.Y.contentType}))),f.forEach((function(b){w.drmInfos.forEach((function(c){b.keyId&&c.keyIds.push(b.keyId)}))})),h=k.map((function(b){return b.getAttribute("id")})).filter(I.wa),{id:b.Y.id||"__fake__"+this.i++,contentType:b.Y.contentType,language:e,ac:d,streams:f,drmInfos:w.drmInfos,sc:m,Ke:h}},p.Ee=function(b,c,d,e,f,g,h,k,l){if(b.v=Je(l,b.Y,null),!function Ne(b){var c=b.qb?1:0;return c+=b.Aa?1:0,0==(c+=b.sb?1:0)?"text"==b.contentType||"application"==b.contentType:(1!=c&&(b.qb&&(b.Aa=null),b.sb=null),!0)}(b.v))return null;b.bandwidth=M.G(l,"bandwidth",M.jc)||0;var m=b.v.contentType;m="text"==m||"application"==m;try{var n=this.Le.bind(this);if(b.v.qb)var q=function ke(b,c){var d=Number(Nd(b,le,"presentationTimeOffset"))||0,e=Nd(b,le,"timescale"),f=1;e&&(f=M.jc(e)||1),d=d/f||0,e=je(b,le);var g=b.v.contentType;if(f=b.v.mimeType.split("/")[1],"text"!=g&&"mp4"!=f&&"webm"!=f)throw new A(2,4,4006);if("webm"==f&&!e)throw new A(2,4,4005);g=Od(b,le,"RepresentationIndex");var h=Nd(b,le,"indexRange"),k=b.v.ha;if(h=M.Mb(h||""),g){var l=g.getAttribute("sourceURL");l&&(k=Uc(b.v.ha,[l])),h=M.G(g,"range",M.Mb,h)}if(!h)throw new A(2,4,4002);return{createSegmentIndex:(f=me(b,c,e,k,h.start,h.end,f,d)).createSegmentIndex,findSegmentPosition:f.findSegmentPosition,getSegmentReference:f.getSegmentReference,initSegmentReference:e,ga:d}}(b,n);else if(b.v.Aa)q=ne(b,this.m);else if(b.v.sb)q=re(b,n,this.m,!!this.c);else{var x=b.v.ha,w=b.N.duration||0;q={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(b){return 0<=b&&b<w?1:null},getSegmentReference:function(b){return 1!=b?null:new N(1,0,w,(function(){return x}),0,null)},initSegmentReference:null,ga:0}}}catch(D){if(m&&4002==D.code)return null;throw D}return l=function Gd(b,c,d,e){var f=Dd(b,c,e);if(d.Pc)b=1==d.drmInfos.length&&!d.drmInfos[0].keySystem,c=0==f.drmInfos.length,(0==d.drmInfos.length||b&&!c)&&(d.drmInfos=f.drmInfos),d.Pc=!1;else if(0<f.drmInfos.length&&(d.drmInfos=d.drmInfos.filter((function(b){return f.drmInfos.some((function(c){return c.keySystem==b.keySystem}))})),0==d.drmInfos.length))throw new A(2,4,4008);return f.Gc||d.Gc}(l=M.M(l,"ContentProtection"),this.b.dash.customScheme,c,this.b.dash.ignoreDrmInfo),{id:this.i++,originalId:b.v.id,createSegmentIndex:q.createSegmentIndex,findSegmentPosition:q.findSegmentPosition,getSegmentReference:q.getSegmentReference,initSegmentReference:q.initSegmentReference,presentationTimeOffset:q.ga,mimeType:b.v.mimeType,codecs:b.v.codecs,frameRate:b.v.frameRate,bandwidth:b.bandwidth,width:b.v.width,height:b.v.height,kind:d,encrypted:0<c.drmInfos.length,keyId:l,language:e,label:f,type:b.Y.contentType,primary:g,trickModeVideo:null,emsgSchemeIdUris:b.v.emsgSchemeIdUris,roles:h,channelsCount:b.v.gc,closedCaptions:k}},p.Xe=function(){this.g=null,De(this).then(function(b){this.a&&Ee(this,b)}.bind(this)).catch(function(b){this.a&&(b.severity=1,this.a.onError(b),Ee(this,0))}.bind(this))},p.De=function(b,c,d){var e=M.$a,f=d.getAttribute("schemeIdUri")||"",g=d.getAttribute("value")||"",h=M.G(d,"timescale",e)||1;M.M(d,"Event").forEach(function(d){var k=M.G(d,"presentationTime",e)||0,m=M.G(d,"duration",e)||0;m=(k=k/h+b)+m/h,null!=c&&(k=Math.min(k,b+c),m=Math.min(m,b+c)),d={schemeIdUri:f,value:g,startTime:k,endTime:m,id:d.getAttribute("id")||"",eventElement:d},this.a.onTimelineRegionAdded(d)}.bind(this))},p.Le=function(b,c,d){return b=Ab(b,this.b.retryParameters),null!=c&&(b.headers.Range="bytes="+c+"-"+(null!=d?d:"")),c=this.a.networkingEngine.request(1,b),xb(this.f,c),c.promise.then((function(b){return b.data}))},xe.mpd=Ce,we["application/dash+xml"]=Ce,Qe.prototype.toString=function(){return"v"+this.a+"."+this.b};var Se=null;function Ve(b,c,d,e){this.b=b,this.type=c,this.a=d,this.segments=e||null}function We(b,c,d,e){this.id=b,this.name=c,this.a=d,this.value=void 0===e?null:e}function Xe(b,c){this.name=b,this.value=c}function T(b,c,d){return(b=b.getAttribute(c))?b.value:d||null}function Ye(b,c){this.b=c,this.a=b}function Ze(b,c){return b.filter((function(b){return b.name==c}))}function $e(b,c){var d=Ze(b,c);return d.length?d[0]:null}function af(b,c,d){return b.filter((function(b){var e=b.getAttribute("TYPE");return b=b.getAttribute("GROUP-ID"),e.value==c&&b.value==d}))}function bf(b,c,d){var e=window.crypto.subtle;return e.importKey("raw",d.data,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then((function(d){return e.decrypt({name:"AES-CBC",iv:b.g},d,c.data).then((function(b){return c.data=b,c})).catch((function(){}))}))}function cf(b){this.b=b,this.a=0}function df(b){ef(b,/[ \t]+/gm)}function ef(b,c){c.lastIndex=b.a;var d=c.exec(b.b);return d=null==d?null:{position:d.index,length:d[0].length,Ne:d},b.a==b.b.length||null==d||d.position!=b.a?null:(b.a+=d.length,d.Ne)}function ff(b){return b.a==b.b.length?null:(b=ef(b,/[^ \t\n]*/gm))?b[0]:null}function gf(){this.a=0}function hf(b,c,d){var e=(c=(c=Sb(c)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(e[0]))throw new A(2,4,4015);c=0;for(var f=1;f<e.length;f++)if(!/^#(?!EXT)/m.test(e[f])){var g=jf(b,e[f]);if(--b.a,kf.includes(g.name)){c=1;break}"EXT-X-STREAM-INF"==g.name&&(f+=1)}for(f=[],g=1;g<e.length;)if(/^#(?!EXT)/m.test(e[g]))g+=1;else{var h=jf(b,e[g]);if(lf.includes(h.name)){if(1!=c)throw new A(2,4,4017);return new Ve(d,c,f,b=mf(b,d,e=e.splice(g,e.length-g),f))}f.push(h),g+=1,"EXT-X-STREAM-INF"==h.name&&(h.a.push(new Xe("URI",e[g])),g+=1)}return new Ve(d,c,f)}function mf(b,c,d,e){var f=[],g=[];return d.forEach((function(d){if(/^(#EXT)/.test(d))d=jf(b,d),kf.includes(d.name)?e.push(d):g.push(d);else{if(/^#(?!EXT)/m.test(d))return[];d=Uc([c],[d.trim()])[0],f.push(new Ye(d,g)),g=[]}})),f}function jf(b,c){var d=b.a++,e=c.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!e)throw new A(2,4,4016,c);var h,f=e[1],g=e[2];if(e=[],g){var k;(k=ef(g=new cf(g),/^([^,=]+)(?:,|$)/g))&&(h=k[1]);for(var l=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:, *|$)/g;k=ef(g,l);)e.push(new Xe(k[1],k[2]||k[3]))}return new We(d,f,e,h)}We.prototype.toString=function(){var c="#"+this.name,d=this.a?this.a.map((function b(b){return b.name+"="+(isNaN(Number(b.value))?'"'+b.value+'"':b.value)})):[];return this.value&&d.unshift(this.value),0<d.length&&(c+=":"+d.join(",")),c},We.prototype.getAttribute=function(b){var c=this.a.filter((function(c){return c.name==b}));return c.length?c[0]:null};var kf="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),lf="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" ");function nf(b){try{var c=nf.parse(b);return jb({uri:b,data:c.data,headers:{"content-type":c.contentType}})}catch(d){return hb(d)}}function of(){var b=this;this.c=this.f=null,this.$=1,this.F=new Map,this.V=new Set,this.a=new Map,this.b=null,this.w="",this.s=new gf,this.o=0,this.i=new H((function(){!function pf(b){t((function d(){var e;return v(d,(function(d){switch(d.j){case 1:return b.f?(qa(d,2),u(d,b.update(),4)):d.return();case 4:b.i.start(b.o,!1),sa(d,0);break;case 2:(e=ta(d)).severity=1,b.f.onError(e),b.i.start(.1,!1),d.j=0}}))}))}(b)})),this.g=qf,this.m=null,this.C=0,this.L=1/0,this.h=new wb,this.P=[],this.l=new Map,this.R=new Map}function uf(b,c){rf(b,c.yd).then(function(b){var d=tf,f=hf(this.s,b.data,b.uri);if(1!=f.type)throw new A(2,4,4017);b=(b=$e(f.a,"EXT-X-MEDIA-SEQUENCE"))?Number(b.value):0;var g=c.stream,h=vf(f);wf(this,c.Ob,f,b,g.mimeType,g.codecs,h).then(function(b){c.rb.a=b,b=b[b.length-1],$e(f.a,"EXT-X-ENDLIST")&&(xf(this,d.Ea),this.b.la(b.endTime))}.bind(this))}.bind(b))}function Gf(b){b.forEach((function(b){var c=b.stream.codecs.split(",");c=c.filter((function(b){return"mp4a.40.34"!=b})),b.stream.codecs=c.join(",")}))}function If(b,c,d,e,f){return{id:b.$++,language:c?c.language:"und",primary:!!c&&c.primary||!!d&&d.primary,audio:c,video:d,bandwidth:e,drmInfos:f,allowedByApplication:!0,allowedByKeySystem:!0}}function Ef(b,c,d){var e=U(c,"URI");if(b.a.has(e))return Promise.resolve(b.a.get(e));var f=U(c,"TYPE").toLowerCase();"subtitles"==f&&(f="text");var g=J(T(c,"LANGUAGE","und")),h=T(c,"NAME"),k=c.getAttribute("DEFAULT"),l=c.getAttribute("AUTOSELECT"),m=T(c,"CHANNELS");return Jf(b,e,d,f,g,!!k||!!l,h,"audio"==f?function Kf(b){return b?(b=b.split("/")[0],parseInt(b,10)):null}(m):null,null).then(function(b){return"text"===f&&("public.accessibility.describes-music-and-sound"===T(c,"CHARACTERISTICS")?(b.stream.kind="caption",b.stream.roles=["caption"]):b.stream.roles=["subtitle"]),this.a.has(e)?this.a.get(e):(this.F.set(c.id,b),this.a.set(e,b),b)}.bind(b))}function vf(b){var f,c=[],d=[],e=!1;if(b.segments.forEach((function(b){b=Ze(b.b,"EXT-X-KEY"),d.push.apply(d,0==b.length&&f?f:b),b.length&&(f=b)})),d.forEach((function(b){if("NONE"!=U(b,"METHOD")){e=!0;var d=T(b,"KEYFORMAT")||"identity";(b=(d=Lf[d])?d(b):null)&&c.push(b)}})),e&&!c.length)throw new A(2,4,4026);return c}function Jf(b,c,d,e,f,g,h,k,l){var n,x,m=Uc([b.w],[c])[0],q="";return rf(b,m).then((function(c){if(m=c.uri,1!=(n=hf(b.s,c.data,m)).type)throw new A(2,4,4017);var f=tf,g=$e((c=n).a,"EXT-X-PLAYLIST-TYPE"),h=$e(c.a,"EXT-X-ENDLIST");if(h=g&&"VOD"==g.value||h,g=g&&"EVENT"==g.value&&!h,g=!h&&!g,h?xf(b,f.Ea):(xf(b,g?f.xc:f.wd),c=Mf(c.a,"EXT-X-TARGETDURATION"),c=Number(c.value),b.C=Math.max(c,b.C),b.L=Math.min(c,b.L)),1==d.length)q=d[0];else{if(null==(c=Df(e,d)))throw new A(2,4,4025,d);q=c}return function Nf(b,c,d,e){var f=new Oa(e=e.segments[0].a).da.split(".").pop(),g=dg[c][f];return g?Promise.resolve(g):"text"==c?d&&"vtt"!=d?Promise.resolve("application/mp4"):Promise.resolve("text/vtt"):((c=Ab([e],b.c.retryParameters)).method="HEAD",c=b.f.networkingEngine.request(1,c),xb(b.h,c),c.promise.then((function(b){if(!(b=b.headers["content-type"]))throw new A(2,4,4021,f);return b.split(";")[0]})))}(b,e,q,n)})).then((function(d){x=d,d=(d=$e(n.a,"EXT-X-MEDIA-SEQUENCE"))?Number(d.value):0;var e=vf(n);return wf(b,c,n,d,x,q,e)})).then((function(d){var w=d[0].startTime,G=d[d.length-1].endTime,V=G-w;d=new R(d);var Z=Of(n),da=void 0;"text"==e&&(da="subtitle");var na=[];n.segments.forEach((function(b){b=Ze(b.b,"EXT-X-KEY"),na.push.apply(na,b)}));var nb=!1,Pa=[],ha=null;if(na.forEach((function(b){if("NONE"!=U(b,"METHOD")){nb=!0;var c=T(b,"KEYFORMAT")||"identity";(b=(c=Lf[c])?c(b):null)&&(b.keyIds.length&&(ha=b.keyIds[0]),Pa.push(b))}})),nb&&!Pa.length)throw new A(2,4,4026);return{stream:{id:b.$++,originalId:h,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:d.find.bind(d),getSegmentReference:d.get.bind(d),initSegmentReference:Z,presentationTimeOffset:0,mimeType:x,codecs:q,kind:da,encrypted:nb,keyId:ha,language:f,label:h,type:e,primary:g,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:[],channelsCount:k,closedCaptions:l},rb:d,drmInfos:Pa,Ob:c,yd:m,dc:w,nf:G,duration:V}}))}function Of(b){var c=Ze(b.a,"EXT-X-MAP");if(!c.length)return null;if(1<c.length)throw new A(2,4,4020);var d=U(c=c[0],"URI"),e=Uc([b.b],[d])[0];return b=0,d=null,(c=T(c,"BYTERANGE"))&&(b=c.split("@"),c=Number(b[0]),d=(b=Number(b[1]))+c-1),new Rd((function(){return[e]}),b,d)}function Pf(b,c,d,e,f){var g=c.b,h=c.a;c=Mf(g,"EXTINF").value.split(","),c=e+Number(c[0]);var k=0,l=null;if((g=$e(g,"EXT-X-BYTERANGE"))&&(k=g.value.split("@"),l=Number(k[0]),l=(k=k[1]?Number(k[1]):b.a+1)+l-1),b=!1,g=null,f&&"com.apple.hls-aes-128"==f.keySystem){b=!0;var m=f.licenseServerUri;g=new ArrayBuffer(16),new DataView(g).setUint32(12,d,!1),g=f.initData[0].initData||g}return new N(d,e,c,(function(){return[h]}),k,l,b,m,g)}function zf(b){b.b&&(b.P.forEach((function(c){b.b.Ya(c,0)})),b.P=[])}function wf(b,c,d,e,f,g,h){var k=d.segments,l=[],m=k[0].a,n=Pf(null,k[0],e,0,h[0]);return function Qf(b,c,d,e,f,g){if(b.m&&(c=b.a.get(c).rb.get(e.position)))return Promise.resolve(c.startTime);e=[Rf(b,e)],("video/mp4"==f||"audio/mp4"==f)&&(d?e.push(Rf(b,d)):e.push(e[0]));return Promise.all(e).then(function(b){if("video/mp4"==f||"audio/mp4"==f)return function ag(b,c){var d=0;if((new P).D("moov",Q).D("trak",Q).D("mdia",Q).aa("mdhd",(function(b){b.reader.I(0==b.version?8:16),d=b.reader.B(),b.parser.stop()})).parse(c,!0),!d)throw new A(2,4,4030);var e=0,f=!1;if((new P).D("moof",Q).D("traf",Q).aa("tfdt",(function(b){e=(0==b.version?b.reader.B():b.reader.bb())/d,f=!0,b.parser.stop()})).parse(b,!0),!f)throw new A(2,4,4030);return e}(b[0].data,b[1].data);if("audio/mpeg"==f)return 0;if("video/mp2t"==f)return function bg(b){function c(){throw new A(2,4,4030)}b=new O(new DataView(b),0);for(var d=0,e=0;;){if(d=b.X(),71!=(e=b.fa())&&c(),b.pb(),0==(e=(48&b.fa())>>4)&&c(),3==e&&(e=b.fa(),b.I(e)),1==b.B()>>8)return b.I(3),0!=(d=b.fa()>>6)&&1!=d||c(),0==b.fa()&&c(),(1073741824*((14&(d=b.fa()))>>1)+((65534&(e=b.pb()))<<14|(65534&(b=b.pb()))>>1))/9e4;b.seek(d+188),71!=(e=b.fa())&&(b.seek(d+192),e=b.fa()),71!=e&&(b.seek(d+204),e=b.fa()),71!=e&&c(),b.hd(1)}}(b[0].data);if("audio/aac"==f)return function Sf(b){function c(b,c,d){for(var e=[],f=c,g=0;;f++,g++){var h=b[f];if(void 0===d&&0===h)break;if(d&&f>=c+d)break;e[g]=String.fromCharCode(h)}return e.join("")}function d(b,c,d){for(var e=0,f=0;f<d;++f)e=e<<8|b[c+f];return e}b=new Uint8Array(b,0,128);var e=0;if("ID3"!==c(b,e,3)||4!==b[e+3])return 0;var f=0!=(64&b[e+5]);return e+=10,f&&(e+=d(b,e,4)+4),"PRIV"!==c(b,e,4)||"com.apple.streaming.transportStreamTimestamp"!==(f=c(b,e+10))?0:d(b,e+10+f.length+1,8)/9e4}(b[0].data);if("application/mp4"==f||f.startsWith("text/")){b=b[0].data;var c=Nb(f,g);if(ed(c)){var d=new bd(null);fd(d,c),b=d.Zb(b)}else b=0;return b}throw new A(2,4,4030)}.bind(b))}(b,c,d=Of(d),n,f,g).then(function(b){m.split("/").pop();for(var c=0;c<k.length;++c){var d=l[l.length-1];d=Pf(d,k[c],e+c,0==c?b:d.endTime,h[c]),l.push(d)}return this.P.push(l),zf(this),l}.bind(b))}function Rf(b,c){var d=b.f.networkingEngine,e=Ab(c.c(),b.c.retryParameters),f={},g=c.encrypted?0:c.b;f.Range="bytes="+g+"-"+(g+2048-1);var h={};return 0==g&&null==c.a||(g="bytes="+g+"-",null!=c.a&&(g+=c.a),h.Range=g),c.encrypted||(e.headers=f),f=d.request(1,e),xb(b.h,f),f=f.promise.catch((function(){Ma("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",e.uris[0]),e.headers=h;var c=d.request(1,e);return xb(b.h,c),c.promise})),c.encrypted?(g=b.R.get(c.f)?Promise.resolve(b.R.get(c.f)):d.request(2,Ab([c.f],b.c.retryParameters)).promise.then(function(b){return this.R.set(c.f,b),b}.bind(b)),Promise.all([f,g]).then((function(b){return bf(c,b[0],b[1])}))):f}function Df(b,c){for(var d=cg[b],e=0;e<d.length;e++)for(var f=0;f<c.length;f++)if(d[e].test(c[f].trim()))return c[f].trim();return"text"==b?"":null}function U(b,c){var d=b.getAttribute(c);if(!d)throw new A(2,4,4023,c);return d.value}function Mf(b,c){var d=$e(b,c);if(!d)throw new A(2,4,4024,c);return d}function rf(b,c){var d=b.f.networkingEngine.request(0,Ab([c],b.c.retryParameters));return xb(b.h,d),d.promise}y("veygo.net.DataUriPlugin",nf),nf.parse=function(b){var c=b.split(":");if(2>c.length||"data"!=c[0])throw new A(2,1,1004,b);if(2>(c=c.slice(1).join(":").split(",")).length)throw new A(2,1,1004,b);var d=c[0];c=window.decodeURIComponent(c.slice(1).join(","));var e=null;if(1<(d=d.split(";")).length&&(e=d[1]),"base64"==e)b=Yb(c).buffer;else{if(e)throw new A(2,1,1005,b);b=Wb(c)}return{data:b,contentType:d[0]}},zb("data",nf),y("veygo.hls.HlsParser",of),(p=of.prototype).configure=function(b){this.c=b},p.start=function(b,c){var d=this;return t((function f(){var g;return v(f,(function(f){switch(f.j){case 1:return d.f=c,u(f,rf(d,b),2);case 2:return g=f.u,d.w=g.uri,u(f,function sf(b,c){var d=hf(b.s,c,b.w);if(0!=d.type)throw new A(2,4,4022);return function yf(b,c){var d=c.a,e=Ze(c.a,"EXT-X-MEDIA"),f=e.filter(function(b){return"SUBTITLES"==U(b,"TYPE")}.bind(b)).map(function(b){return function Af(b,c){return U(c,"TYPE"),Ef(b,c,[]).then((function(b){return b.stream}))}(this,b)}.bind(b));return e=e.filter((function(b){return"CLOSED-CAPTIONS"==U(b,"TYPE")})),function Bf(b,c){for(var d=r(c),e=d.next();!e.done;e=d.next()){U(e=e.value,"TYPE");var f=T(e,"LANGUAGE")||"und";f=J(f);var g=U(e,"GROUP-ID");e=U(e,"INSTREAM-ID"),b.l.get(g)||b.l.set(g,new Map),b.l.get(g).set(e,f)}}(b,e),Promise.all(f).then(function(b){var e=Ze(d,"EXT-X-STREAM-INF").map(function(b){return function Cf(b,c,d){var e=T(c,"CODECS","avc1.42E01E,mp4a.40.2").split(/\s*,\s*/),f=c.getAttribute("RESOLUTION"),g=null,h=null,k=T(c,"FRAME-RATE"),l=Number(U(c,"BANDWIDTH"));if(f){var m=f.value.split("x");g=m[0],h=m[1]}d=(d=(d=Ze(d.a,"EXT-X-MEDIA")).filter((function(b){return"CLOSED-CAPTIONS"!=U(b,"TYPE")}))).filter((function(b){var c=T(b,"URI")||"";return"SUBTITLES"==(T(b,"TYPE")||"")||""!=c}));var n=T(c,"AUDIO"),q=T(c,"VIDEO");if(n?d=af(d,"AUDIO",n):q&&(d=af(d,"VIDEO",q)),m=Df("text",e)){var x=T(c,"SUBTITLES");x&&((x=af(d,"SUBTITLES",x)).length&&(b.F.get(x[0].id).stream.codecs=m)),tb(e,m)}d=d.map(function(b){return Ef(this,b,e)}.bind(b));var w=[],D=[];return Promise.all(d).then(function(b){if(n?w=b:q&&(D=b),b=!1,w.length||D.length)if(w.length)if(U(c,"URI")==w[0].Ob){var d="audio";b=!0}else d="video";else d="audio";else 1==e.length?(d=Df("video",e),d=f||k||d?"video":"audio"):(d="video",e=[e.join(",")]);return b?Promise.resolve():function Ff(b,c,d,e){var f=U(c,"URI");if(b.a.has(f))return Promise.resolve(b.a.get(f));c=T(c,"CLOSED-CAPTIONS");var g=null;return"video"==e&&c&&"NONE"!=c&&(g=b.l.get(c)),Jf(b,f,d,e,"und",!1,null,null,g).then(function(b){return this.a.has(f)?this.a.get(f):(this.a.set(f,b),b)}.bind(b))}(this,c,e,d)}.bind(b)).then(function(b){return b&&("audio"==b.stream.type?w=[b]:D=[b]),D&&Gf(D),w&&Gf(w),function Hf(b,c,d,e,f,g,h){d.forEach(function(b){(b=b.stream)&&(b.width=Number(f)||void 0,b.height=Number(g)||void 0,b.frameRate=Number(h)||void 0)}.bind(b)),c.length||(c=[null]),d.length||(d=[null]);for(var k=[],l=0;l<c.length;l++)for(var m=0;m<d.length;m++){var n=c[l]?c[l].stream:null,q=d[m]?d[m].stream:null,x=c[l]?c[l].drmInfos:null,w=d[m]?d[m].drmInfos:null,D=void 0;if(n&&q){if(x.length&&w.length&&!(0<Mc(x,w).length))continue;D=Mc(x,w)}else n?D=x:q&&(D=w);x=(d[l]?d[l].Ob:"")+" - "+(c[l]?c[l].Ob:""),b.V.has(x)||(n=If(b,n,q,e,D),k.push(n),b.V.add(x))}return k}(this,w,D,l,g,h,k)}.bind(b))}(this,b,c)}.bind(this));return Promise.all(e).then(function(c){return{startTime:0,variants:c.reduce(I.Sb,[]),textStreams:b}}.bind(this))}.bind(b))}(b,d).then(function(b){this.f.filterAllPeriods([b]);for(var c=1/0,d=0,e=1/0,k=r(this.a.values()),l=k.next();!l.done;l=k.next())l=l.value,c=Math.min(c,l.dc),d=Math.max(d,l.dc),"text"!=l.stream.type&&(e=Math.min(e,l.duration));if(this.g!=tf.Ea?(this.b=new S(0,3*this.C),this.b.tb(!1)):(this.b=new S(null,0),this.b.tb(!0)),zf(this),this.g!=tf.Ea){for(this.o=this.L,this.g==tf.xc&&(c=e,isNaN(this.c.availabilityWindowOverride)||(c=this.c.availabilityWindowOverride),this.b.oc(c)),c=0;95443.7176888889<=d;)c+=95443.7176888889,d-=95443.7176888889;if(c)for(l=(d=r(this.a.values())).next();!l.done;l=d.next())95443.7176888889>(e=l.value).dc&&(e.stream.presentationTimeOffset=-c,e.rb.offset(c))}else for(this.b.la(e),this.b.offset(-c),l=(d=r(this.a.values())).next();!l.done;l=d.next())(l=l.value).stream.presentationTimeOffset=c,l.rb.offset(-c),$d(l.rb,e);this.m={presentationTimeline:this.b,periods:[b],offlineSessionIds:[],minBufferTime:0}}.bind(b))}(d,g.data),3);case 3:return 0<d.o&&d.i.start(d.o,!1),f.return(d.m)}}))}))},p.stop=function(){return this.i.stop(),this.c=this.f=null,this.F.clear(),this.V.clear(),this.a.clear(),this.m=null,this.h.destroy()},p.update=function(){if(this.g!=tf.Ea){for(var b=[],c=r(this.a.values()),d=c.next();!d.done;d=c.next())b.push(uf(this,d.value));return Promise.all(b)}},p.onExpirationUpdated=function(){};var cg={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]},dg={audio:{aac:"audio/aac",mp4:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",ts:"video/mp2t"},video:{mp4:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"}};function xf(b,c){b.g=c,b.b&&b.b.tb(b.g==tf.Ea),b.g!=tf.Ea||b.i.stop()}var Lf={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(b){var c=U(b,"METHOD");return Re("HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227"),["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].includes(c)?(c=U(b,"URI"),c=nf.parse(c),c=Vc("com.widevine.alpha",[{initDataType:"cenc",initData:c=new Uint8Array(c.data)}]),(b=T(b,"KEYID"))&&(c.keyIds=[b.substr(2).toLowerCase()]),c):null},identity:function(b){if("AES-128"!=U(b,"METHOD"))return null;var c=U(b,"URI"),d=null;return(b=T(b,"IV"))&&(d=Zb(b.substr(2).toLowerCase())),(b=Vc("com.apple.hls-aes-128",[{initDataType:"hls-aes-128",initData:d}])).licenseServerUri=c,b}},qf="VOD",tf={Ea:qf,wd:"EVENT",xc:"LIVE"};function eg(){this.a=new Map}function fg(b,c){return b.a.has(c)||b.a.set(c,new gg),b.a.get(c)}function gg(){this.text=this.variant=null}function hg(b,c){this.a=b,this.b=new Set([b]);for(var d=r(c=c||[]),e=d.next();!e.done;e=d.next())this.add(e.value)}function ig(b,c){var d;if(!(d=!!b.audio!=!!c.audio||!!b.video!=!!c.video||b.language!=c.language)&&(d=b.audio&&c.audio)){d=b.audio;var e=c.audio;d=!(d.channelsCount==e.channelsCount&&jg(d,e)&&kg(d.roles,e.roles))}return!d&&(d=b.video&&c.video)&&(d=!(jg(d=b.video,e=c.video)&&kg(d.roles,e.roles))),!d}function jg(b,c){if(b.mimeType!=c.mimeType)return!1;var d=b.codecs.split(",").map((function(b){return Qb(b)[0]})),e=c.codecs.split(",").map((function(b){return Qb(b)[0]}));if(d.length!=e.length)return!1;d.sort(),e.sort();for(var f=0;f<d.length;f++)if(d[f]!=e[f])return!1;return!0}function kg(b,c){var d=new Set(b),e=new Set(c);if(d.delete("main"),e.delete("main"),d.size!=e.size)return!1;for(var f=(d=r(d)).next();!f.done;f=d.next())if(!e.has(f.value))return!1;return!0}function lg(b){this.a=b,this.b=new mg(b.language,"",b.audio&&b.audio.channelsCount?b.audio.channelsCount:0)}function mg(b,c,d){this.c=b,this.b=c,this.a=d}function pg(b){var c=this;this.c=b,this.a=new Set,this.b=new H((function(){qg(c,!1)})),this.b.start(.25,!0)}function qg(b,c){for(var d=r(b.a),e=d.next();!e.done;e=d.next())e.value.g(b.c.currentTime,c)}function rg(b,c,d){var e=this;this.c=sg,this.f=.5,this.h=b,this.l=d,this.i=c,this.b=function(){},this.a=function(){},this.m=[{vd:sg,is:tg,Hc:function(){return e.a()}},{vd:tg,is:sg,Hc:function(){return e.b()}}],this.f>=this.h&&(Ma("Rebuffering threshold is set too low!  This could cause poor buffering behavior during playback!"),this.f=this.h/2)}xe.m3u8=of,we["application/x-mpegurl"]=of,we["application/vnd.apple.mpegurl"]=of,hg.prototype.add=function(b){return!!ig(this.a,b)&&(this.b.add(b),!0)},hg.prototype.values=function(){return this.b.values()},lg.prototype.create=function(b){var c=this,d=b.filter((function(b){return ig(c.a,b)}));return d.length?new hg(d[0],d):this.b.create(b)},mg.prototype.create=function(b){var c=[];c=function ng(b,c){var e=Ad(J(c),b.map((function(b){return zd(b)})));return e?b.filter((function(b){return e==zd(b)})):[]}(b,this.c);var d=b.filter((function(b){return b.primary}));for(c=c.length?c:d.length?d:b,this.b&&((b=function og(b,c){return b.filter((function(b){var d=b.audio;return b=b.video,d&&0<=d.roles.indexOf(c)||b&&0<=b.roles.indexOf(c)}))}(c,this.b)).length&&(c=b)),this.a&&((b=K.Mc(c,this.a)).length&&(c=b)),b=new hg(c[0]),d=(c=r(c)).next();!d.done;d=c.next())d=d.value,ig(b.a,d)&&b.add(d);return b},pg.prototype.O=function(){this.b.stop();for(var b=r(this.a),c=b.next();!c.done;c=b.next())c.value.O();this.a.clear()},rg.prototype.O=function(){this.b=function(){},this.a=function(){}},rg.prototype.g=function(b){var c=this.c==tg?this.f:this.h;b=this.i(b),c=this.l()||b>=c?tg:sg;for(var d=(b=r(this.m)).next();!d.done;d=b.next())d=d.value,this.c==d.vd&&c==d.is&&d.Hc();this.c=c};var sg=0,tg=1;function vg(b){this.g=b,this.f=wg(b),this.a=b.a.currentTime,this.b=Date.now()/1e3,this.c=function(){}}function yg(b){this.a=b}function wg(b){if(b.a.paused||0==b.a.playbackRate||null==b.a.buffered)var c=!1;else a:{c=b.a.buffered,b=b.a.currentTime;for(var d=0;d<c.length;d++){var e=c.start(d),f=c.end(d);if(!(b<e||b>f-.5)){c=!0;break a}}c=!1}return c}function zg(b,c,d,e){this.a=b,this.s=c,this.m=d,this.o=e,this.f=new Eb,this.b=null,this.h=!1,this.l=b.readyState,this.c=!1,this.w=new vg(new yg(b)),function xg(b,c){b.c=c}(this.w,(function(){b.currentTime+=.1})),this.g=!1,c=this.i.bind(this),F(this.f,b,"waiting",c),this.b=new H(c),this.b.start(.25,!0)}function Ag(b){this.c=b,this.a=null,this.b=function(){}}function Cg(b,c,d){this.a=b,this.i=c,this.h=d,this.c=new Eb,this.f=1,this.g=!1,this.b=null,0<b.readyState?this.ad():Hb(this.c,b,"loadedmetadata",this.ad.bind(this)),F(this.c,b,"ratechange",this.re.bind(this))}function Dg(b){return 0<b.a.readyState?b.a.currentTime:b.h}function Eg(b,c){0<b.a.readyState?function Fg(b,c,d){function e(){!b.a||10<=f++||b.a.currentTime!=c||(b.a.currentTime=d,setTimeout(e,100))}b.a.currentTime=d;var f=0;setTimeout(e,100)}(b,b.a.currentTime,c):(b.h=c,setTimeout(b.i,0))}function Gg(b,c){null!=b.b&&(b.b.stop(),b.b=null),b.f=c,b.a.playbackRate=b.g||0>c?0:c,!b.g&&0>c&&(b.b=new H((function(){b.a.currentTime+=c/4})),b.b.start(.25,!0))}function Hg(b,c,d,e,f,g,h){this.c=b,this.a=c,this.m=d,this.h=e,this.l=g,this.f=null,this.g=new zg(b,c,e,h),null==(c=f)?c=1/0>this.a.T()?this.a.Sa():this.a.qa():0>c&&(c=this.a.qa()+c),this.b=new Cg(b,this.se.bind(this),Ig(this,Jg(this,c))),this.f=new H(this.qe.bind(this)),this.f.start(.25,!0)}function Kg(b){var c=Dg(b.b);return 0<b.c.readyState&&(b.c.paused||(c=Jg(b,c))),c}function Ig(b,c){var d=b.a.T();return c>=d?d-b.h.durationBackoff:c}function Lg(b,c){var d=Rc.bind(null,b.c.buffered),e=Math.max(b.m,b.h.rebufferingGoal),f=b.h.safeSeekOffset,g=b.a.Sa(),h=b.a.qa(),k=b.a.T();3>h-g&&(g=h-3);var l=b.a.ib(e),m=b.a.ib(f);return e=b.a.ib(e+f),c>=k?Ig(b,c):c>h?h:c<g?d(m)?m:e:c>=l||d(c)?c:e}function Jg(b,c){var d=b.a.Sa();return c<d||c>(d=b.a.qa())?d:c}function Mg(){this.b=function(){},this.a=new Set}function Og(b){var c=this;this.h=b,this.f=new Map,this.a=function(){},this.b=function(){},this.c=function(){},this.i=[{Pa:null,Oa:Pg,Ha:function(b,e){return c.a(b,e)}},{Pa:Qg,Oa:Pg,Ha:function(b,e){return c.a(b,e)}},{Pa:Rg,Oa:Pg,Ha:function(b,e){return c.a(b,e)}},{Pa:Pg,Oa:Qg,Ha:function(b,e){return c.b(b,e)}},{Pa:Pg,Oa:Rg,Ha:function(b,e){return c.b(b,e)}},{Pa:Qg,Oa:Rg,Ha:function(b,e){return c.c(b,e)}},{Pa:Rg,Oa:Qg,Ha:function(b,e){return c.c(b,e)}}]}zg.prototype.O=function(){this.f&&(this.f.O(),this.f=null),null!=this.b&&(this.b.stop(),this.b=null),this.a=this.s=this.o=null},zg.prototype.ob=function(){this.g=!0,this.i()},zg.prototype.i=function(){if(0!=this.a.readyState){if(this.a.seeking){if(!this.h)return}else this.h=!1;if(!this.a.paused||4!==this.a.readyState){this.a.readyState!=this.l&&(this.c=!1,this.l=this.a.readyState);var b=this.m.smallGapLimit,c=this.a.currentTime,d=this.a.buffered;a:{if(d&&d.length&&!(1==d.length&&1e-6>d.end(0)-d.start(0)))for(var e=Rb("Edge/")||Rb("Trident/")||Rb("Tizen")||Rb("CrKey")?.5:.1,f=0;f<d.length;f++)if(d.start(f)>c&&(0==f||d.end(f-1)-c<=e)){e=f;break a}e=null}if(null==e)c=wg(e=(d=this.w).g),e=e.a.currentTime,f=Date.now()/1e3,d.a==e&&d.f==c||(d.b=f,d.a=e,d.f=c),1<=(e=f-d.b)&&c&&d.c(d.a,e);else if((0!=e||this.g)&&!((f=d.start(e))>=this.s.qa())){var g=f-c;b=g<=b;var h=!1;.001>g||(b||this.c||(this.c=!0,(c=new C("largegap",{currentTime:c,gapSize:g})).cancelable=!0,this.o(c),this.m.jumpLargeGaps&&!c.defaultPrevented&&(h=!0)),!b&&!h)||(0!=e&&d.end(e-1),this.a.currentTime=f)}}}},Ag.prototype.O=function(){this.a=this.c=null,this.b=function(){}},Ag.prototype.g=function(b){for(var c=this.a,d=this.c.periods[0],e=r(this.c.periods),f=e.next();!f.done;f=e.next())b>=(f=f.value).startTime&&(d=f);c!=(b=d)&&this.b(b),this.a=b},(p=Cg.prototype).O=function(){this.c&&(this.c.O(),this.c=null),null!=this.b&&(this.b.stop(),this.b=null),this.a=this.i=null},p.hb=function(){return this.f},p.re=function(){var b=this.g||0>this.f?0:this.f;this.a.playbackRate&&this.a.playbackRate!=b&&Gg(this,this.a.playbackRate)},p.ad=function(){.001>Math.abs(this.a.currentTime-this.h)?this.bd():(Hb(this.c,this.a,"seeking",this.bd.bind(this)),this.a.currentTime=0==this.a.currentTime?this.h:this.a.currentTime)},p.bd=function(){var b=this;F(this.c,this.a,"seeking",(function(){return b.i()}))},(p=Hg.prototype).O=function(){this.b&&(this.b.O(),this.b=null),this.g&&(this.g.O(),this.g=null),this.f&&(this.f.stop(),this.f=null),this.c=this.b=this.a=this.l=this.h=null},p.hb=function(){return this.b.hb()},p.ob=function(){this.g.ob()},p.qe=function(){if(0!=this.c.readyState&&!this.c.paused){var b=this.c.currentTime,c=this.a.Sa(),d=this.a.qa();3>d-c&&(c=d-3),b+1e-6<c&&(b=Lg(this,b),this.c.currentTime=b)}},p.se=function(){var b=this.g;b.h=!0,b.g=!1,b.c=!1;var c=Dg(this.b);if(b=Lg(this,c),.001<Math.abs(b-c)&&(c=(new Date).getTime()/1e3,!this.i||this.i<c-1))return this.i=c,void Eg(this.b,b);this.l()},Mg.prototype.O=function(){this.b=function(){},this.a.clear()},Og.prototype.O=function(){this.h=null,this.f.clear(),this.a=function(){},this.b=function(){},this.c=function(){}},Og.prototype.g=function(b,c){for(var d=r(this.h.a),e=d.next();!e.done;e=d.next()){e=e.value;var f=this.f.get(e),g=b<e.startTime?Qg:b>e.endTime?Rg:Pg;this.f.set(e,g);for(var h=r(this.i),k=h.next();!k.done;k=h.next())(k=k.value).Pa==f&&k.Oa==g&&k.Ha(e,c)}};var Qg=1,Pg=2,Rg=3;function Tg(b,c){this.a=c,this.c=b,this.g=null,this.l=1,this.s=Promise.resolve(),this.h=[],this.i=new Map,this.b=new Map,this.o=!1,this.L=null,this.F=this.f=this.m=!1,this.C=0,this.w=new Map}function Xg(b){return Yg(b,"audio")}function Zg(b){return Yg(b,"video")}function Yg(b,c){var d=b.b.get(c);return d?d.za||d.stream:null}function $g(b,c){return t((function e(){var f,g,h,k,l,m,n,q;return v(e,(function(e){switch(e.j){case 1:return f=Wc,td(b.a.J,f.Da),b.C++,b.F=!1,g=b.C,h=b.a.J,k=new Map,l=new Set,k.set(f.Da,c),l.add(c),u(e,h.init(k,!1),2);case 2:return b.f?e.return():u(e,ah(b,l),3);case 3:if(b.f)return e.return();b.C!=g||b.b.has(f.Da)||b.F||(m=b.a.va(),n=K.Fb(b.c,m),q=Vg(c,n,0),b.b.set(f.Da,q),b.o&&bh(b,q,0)),e.j=0}}))}))}function ch(b,c){var d=b.b.get("video");if(d){var e=d.stream;if(e)if(c){var f=e.trickModeVideo;f&&!d.za&&(dh(b,f,!1,0),d.za=e)}else(e=d.za)&&(d.za=null,dh(b,e,!0,0))}}function eh(b,c,d,e){c.video&&dh(b,c.video,d,e),c.audio&&dh(b,c.audio,d,e)}function dh(b,c,d,e){var f=b.b.get(c.type);if(f||"text"!=c.type){if(f){var g=fh(b,c);d&&g!=f.xa?gh(b):(f.za&&(c.trickModeVideo?(f.za=c,c=c.trickModeVideo):f.za=null),(g=b.h[g])&&g.ya&&(g=b.i.get(c.id))&&g.ya&&f.stream!=c&&("text"==c.type&&md(b.a.J,Nb(c.mimeType,c.codecs)),f.stream=c,f.mb=!0,d&&(f.Fa?f.Pb=!0:f.Ja?(f.Ca=!0,f.Bb=e,f.Pb=!0):(Ug(f),hh(b,f,!0,e)))))}}else $g(b,c)}function gh(b){b.b.forEach((function(c,d){c.Fa||c.Ca||(c.Ja?(c.Ca=!0,c.Bb=0):null==nd(b.a.J,d)?null==c.Ba&&bh(b,c,0):(Ug(c),hh(b,c,!1,0)))}))}function Wg(b,c,d,e,f){return t((function h(){var k,l,m,n,q,x,w;return v(h,(function(h){switch(h.j){case 1:return k=b.a.va(),l=K.Fb(b.c,k),m=Wc,n=new Map,q=new Set,c&&(n.set(m.wc,c),q.add(c)),d&&(n.set(m.Ac,d),q.add(d)),e&&(n.set(m.Da,e),q.add(e)),x=b.a.J,w=b.g.forceTransmuxTS,u(h,x.init(n,w),2);case 2:return b.f?h.return():(function jh(b){var c=b.c.presentationTimeline.T();1/0>c?b.a.J.la(c):b.a.J.la(Math.pow(2,32))}(b),u(h,ah(b,q),3));case 3:if(b.f)return h.return();n.forEach((function(c,d){if(b.b.has(d))d===m.Da&&(e=b.b.get(d),bh(b,e,0));else{var e=Vg(c,l,f);b.b.set(d,e),bh(b,e,0)}})),h.j=0}}))}))}function Vg(b,c,d){return{stream:b,type:b.type,Va:null,ra:null,za:null,mb:!0,xa:c,endOfStream:!1,Ja:!1,Ba:null,Ca:!1,Bb:0,Pb:!1,Fa:!1,lc:!1,kb:!1,gd:d}}function kh(b,c){var d=b.h[c];if(d)return d.promise;d={promise:new z,ya:!1},b.h[c]=d;for(var e=new Set,f=r(b.c.periods[c].variants),g=f.next();!g.done;g=f.next())(g=g.value).video&&e.add(g.video),g.video&&g.video.trickModeVideo&&e.add(g.video.trickModeVideo),g.audio&&e.add(g.audio);for(g=(f=r(b.c.periods[c].textStreams)).next();!g.done;g=f.next())e.add(g.value);return b.s=b.s.then(function(){if(!this.f)return ah(this,e)}.bind(b)).then(function(){this.f||(this.h[c].promise.resolve(),this.h[c].ya=!0)}.bind(b)).catch(function(b){this.f||(this.h[c].promise.catch((function(){})),this.h[c].promise.reject(),delete this.h[c],this.a.onError(b))}.bind(b)),d.promise}function ah(b,c){return t((function e(){var f,g,h,k,l,m,n;return v(e,(function(e){switch(e.j){case 1:f=[];for(var q=r(c),w=q.next();!w.done;w=q.next())g=w.value,(h=b.i.get(g.id))?f.push(h.promise):(b.i.set(g.id,{promise:new z,ya:!1}),f.push(g.createSegmentIndex()));return qa(e,2),u(e,Promise.all(f),4);case 4:if(b.f)return e.return();sa(e,3);break;case 2:if(k=ta(e),b.f)return e.return();for(w=(e=r(c)).next();!w.done;w=e.next())l=w.value,b.i.get(l.id).promise.catch((function(){})),b.i.get(l.id).promise.reject(),b.i.delete(l.id);throw k;case 3:for(w=(q=r(c)).next();!w.done;w=q.next())m=w.value,(n=b.i.get(m.id)).ya||(n.promise.resolve(),n.ya=!0);e.j=0}}))}))}function oh(b,c,d){return c.Va&&c.ra?(d=fh(b,c.Va),b.c.periods[d].startTime+c.ra.endTime):Math.max(d,c.gd)}function rh(b,c,d,e){return d=b.c.periods[d],(c=c.stream.getSegmentReference(e))?(e=(b=b.c.presentationTimeline).Ta(),d.startTime+c.endTime<b.jb()||d.startTime+c.startTime>e?null:c):null}function yh(b){return!b.Ja&&null==b.Ba&&!b.Ca&&!b.Fa}function fh(b,c){for(var d=b.c.periods,e=0;e<d.length;e++){for(var f=d[e],g=new Set,h=r(f.variants),k=h.next();!k.done;k=h.next())(k=k.value).audio&&g.add(k.audio),k.video&&g.add(k.video),k.video&&k.video.trickModeVideo&&g.add(k.video.trickModeVideo);for(h=(f=r(f.textStreams)).next();!h.done;h=f.next())g.add(h.value);if(g.has(c))return e}return-1}function th(b,c){var d=Ab(c.c(),b.g.retryParameters);if(!c.encrypted&&(0!=c.b||null!=c.a)){var e="bytes="+c.b+"-";null!=c.a&&(e+=c.a),d.headers.Range=e}return e=b.a.Xa.request(1,d).promise,c.encrypted&&(d=b.a.Xa,d=b.w.get(c.f)?Promise.resolve(b.w.get(c.f)):d.request(2,Ab([c.f],b.g.retryParameters)).promise.then(function(b){return this.w.set(c.f,b),b}.bind(b)),e=Promise.all([e,d]).then((function(b){return bf(c,b[0],b[1])}))),e.then((function(b){return b.data}))}function hh(b,c,d,e){t((function g(){var h,k,l;return v(g,(function(g){switch(g.j){case 1:return c.Ca=!1,c.Pb=!1,c.Bb=0,c.Fa=!0,e?(k=b.a.va(),l=b.a.J.T(),h=b.a.J.remove(c.type,k+e,l)):h=td(b.a.J,c.type).then(function(){if(!this.f&&d)return this.a.J.flush(c.type)}.bind(b)),u(g,h,2);case 2:if(b.f)return g.return();c.Va=null,c.ra=null,c.Fa=!1,c.endOfStream=!1,bh(b,c,0),g.j=0}}))}))}function bh(b,c,d){c.Ba=window.setTimeout(b.Ze.bind(b,c),1e3*d)}function Ug(b){null!=b.Ba&&(window.clearTimeout(b.Ba),b.Ba=null)}function mh(b,c){gb(b.L).then(function(){this.f||(this.a.onError(c),c.handled||this.g.failureCallback(c))}.bind(b))}function zh(b,c,d,e,f,g){if(200<=d&&299>=d&&202!=d)return f&&(e=f),{uri:e,data:c,headers:b,fromCache:!!b["x-veygo-from-cache"]};f=null;try{f=Vb(c)}catch(h){}throw new A(401==d||403==d?2:1,1,1001,e,d,f,b,g)}function Ah(b,c,d,e){var f=new Ah.b;Kb(c.headers).forEach((function(b,c){f.append(c,b)}));var l,g=new Ah.a,h={body:c.body||void 0,headers:f,method:c.method,signal:g.signal,credentials:c.allowCrossSiteCredentials?"include":void 0},k={Fc:!1,rd:!1};return c.retryParameters.timeout&&(l=setTimeout((function(){k.rd=!0,g.abort()}),c.retryParameters.timeout)),new B(b=Ah.h(b,d,h,k,l,e),(function(){return k.Fc=!0,g.abort(),Promise.resolve()}))}function Bh(b,c,d,e){var f=new Bh.f,g=Date.now(),h=0;return new B(new Promise((function(k,m){for(var l in f.open(c.method,b,!0),f.responseType="arraybuffer",f.timeout=c.retryParameters.timeout,f.withCredentials=c.allowCrossSiteCredentials,f.onabort=function(){m(new A(1,1,7001,b,d))},f.onload=function(c){for(var e=(c=c.target).getAllResponseHeaders().trim().split("\r\n"),f={},g=(e=r(e)).next();!g.done;g=e.next())f[(g=g.value.split(": "))[0].toLowerCase()]=g.slice(1).join(": ");try{var h=zh(f,c.response,c.status,b,c.responseURL,d);k(h)}catch(V){m(V)}},f.onerror=function(c){m(new A(1,1,1002,b,c,d))},f.ontimeout=function(){m(new A(1,1,1003,b,d))},f.onprogress=function(b){var c=Date.now();(100<c-g||b.lengthComputable&&b.loaded==b.total)&&(e(c-g,b.loaded-h),h=b.loaded,g=c)},c.headers)f.setRequestHeader(l.toLowerCase(),c.headers[l]);f.send(c.body)})),(function(){return f.abort(),Promise.resolve()}))}function Ch(b,c){this.l=b,this.c=new Map,this.g=!1,this.h=c,this.a=this.b=this.f=0}function Dh(b,c,d,e,f){b.b+=e;var g=b.c.get(c)||Promise.resolve();b.c.set(c,g.then((function(){return t((function k(){var c,g;return v(k,(function(k){switch(k.j){case 1:return u(k,function Eh(b,c){return t((function e(){var g;return v(e,(function(e){switch(e.j){case 1:return u(e,b.l.request(1,c).promise,2);case 2:return g=e.u,e.return(g.data)}}))}))}(b,d),2);case 2:if(c=k.u,b.g)throw new A(2,9,7001);return b.f+=e,b.a+=c.byteLength,g=b.b?b.f/b.b:0,b.h(g,b.a),k.return(f(c,g))}}))}))})))}function Gh(b,c){var d=this;this.c=b,this.b=b.objectStore(c),this.a=new z,b.onabort=function(b){b.preventDefault(),d.a.reject()},b.onerror=function(b){b.preventDefault(),d.a.reject()},b.oncomplete=function(){d.a.resolve()}}function Hh(b,c){return new Promise((function(d,e){var f=b.b.openCursor();f.onerror=e,f.onsuccess=function(b){if(!(b=b.target.result))return d();c(b.key,b.value,b),b.continue()}}))}function Ih(b){this.b=b,this.a=[]}function Jh(b,c){return Kh(b,c,"readonly")}function Lh(b,c){return Kh(b,c,"readwrite")}function Kh(b,c,d){var e=new Gh(d=b.b.transaction([c],d),c);return b.a.push(e),e.promise().then((function(){tb(b.a,e)}),(function(){tb(b.a,e)})),e}function Mh(b){this.a=new Ih(b)}function Nh(){this.a=new Map}function Rh(b,c,d){if(!(b=b.a.get(c)))throw new A(2,9,9013,"Could not find mechanism with name "+c);if(!(c=b.getCells().get(d)))throw new A(2,9,9013,"Could not find cell with name "+d);return c}function Uh(b,c){Oh.set(b,c)}function Vh(){for(var b=r(Oh.values()),c=b.next();!c.done;c=b.next())if(c=(c=c.value)())return c.destroy(),!0;return!1}(p=Tg.prototype).destroy=function(){for(var b=r(this.b.values()),c=b.next();!c.done;c=b.next())Ug(c.value);return this.b.clear(),this.i.clear(),this.g=this.h=this.s=this.c=this.a=null,this.f=!0,Promise.resolve()},p.configure=function(b){this.g=b,this.L=new eb({maxAttempts:Math.max(b.retryParameters.maxAttempts,2),baseDelay:b.retryParameters.baseDelay,backoffFactor:b.retryParameters.backoffFactor,fuzzFactor:b.retryParameters.fuzzFactor,timeout:0},!0)},p.init=function(b){var c=this;return t((function e(){var f,g,h,k,l,m;return v(e,(function(e){switch(e.j){case 1:return f=Wc,g=c.a.va(),h=K.Fb(c.c,g),(k=c.a.Zc(c.c.periods[h])).variant||k.text?(l=[],k.variant&&k.variant.audio&&(l.push(k.variant.audio.createSegmentIndex()),c.b.set(f.wc,Vg(k.variant.audio,0,0))),k.variant&&k.variant.video&&(l.push(k.variant.video.createSegmentIndex()),c.b.set(f.Ac,Vg(k.variant.video,0,0))),u(e,Promise.all(l),2)):e.return(Promise.reject(new A(2,5,5005)));case 2:return c.i.set(k.variant.audio.id,{promise:null,ya:!0}),c.i.set(k.variant.video.id,{promise:null,ya:!0}),m=b(),u(e,Wg(c,k.variant?k.variant.audio:null,k.variant?k.variant.video:null,k.text,m||g),3);case 3:if(c.f)return e.return();c.a&&c.a.ke&&c.a.ke(),e.j=0}}))}))},p.Ze=function(b){if(!this.f&&!b.Ja&&null!=b.Ba&&!b.Fa)if(b.Ba=null,b.Ca)hh(this,b,b.Pb,b.Bb);else{try{var c=function lh(b,c){function d(b){return"text"==b.type&&"application/cea-608"==b.stream.mimeType}if(d(c))return b.a.J.Nb(c.stream.originalId||""),null;var e=b.a.va(),f=oh(b,c,e),g=fh(b,c.stream),h=K.Fb(b.c,f),k=function qd(b,c,d){return"text"==c?null==(b=b.a).b||b.b<d?0:b.b-Math.max(d,b.a):Sc(b=od(b,c),d)}(b.a.J,c.type,e),l=Math.max(b.c.minBufferTime||0,b.g.rebufferingGoal,b.g.bufferingGoal)*b.l;if(f>=b.c.presentationTimeline.T())return c.endOfStream=!0,"video"==c.type&&(f=b.b.get("text"))&&"application/cea-608"==f.stream.mimeType&&(f.endOfStream=!0),null;if(c.endOfStream=!1,c.xa=h,h!=g)return null;if(k>=l)return.5;if(h=pd(b.a.J,c.type),!(h=function ph(b,c,d,e,f){return c.ra&&c.stream==c.Va?rh(b,c,f,c.ra.position+1):(c.ra?(d=fh(b,c.Va),d=c.stream.findSegmentPosition(Math.max(0,b.c.periods[d].startTime+c.ra.endTime-b.c.periods[f].startTime))):d=c.stream.findSegmentPosition(Math.max(0,(e||d)-b.c.periods[f].startTime)),null==d?null:rh(b,c,f,d))}(b,c,e,h,g)))return 1;var m=1/0;return Array.from(b.b.values()).forEach((function(c){d(c)||(c=oh(b,c,e),m=Math.min(m,c))})),f>=m+b.c.presentationTimeline.a?1:(c.gd=0,function qh(b,c,d,e,f){var g=b.c.periods[e],h=c.stream,k=b.c.presentationTimeline.T(),l=b.c.periods[e+1];e=function sh(b,c,d,e,f){return c.mb?(d=function ud(b,c,d,e,f){return"text"==c?(b.a.m=d,(b=b.a).f=e,b.h=f,Promise.resolve()):Promise.all([sd(b,c,b.xd.bind(b,c)),sd(b,c,b.nd.bind(b,c,d)),sd(b,c,b.Te.bind(b,c,e,f))])}(b.a.J,c.type,b.c.periods[d].startTime-c.stream.presentationTimeOffset,e,f),c.stream.initSegmentReference?(b=th(b,c.stream.initSegmentReference).then(function(b){if(!this.f)return rd(this.a.J,c.type,b,null,null,c.stream.closedCaptions&&0<c.stream.closedCaptions.size)}.bind(b)).catch((function(b){return c.mb=!0,Promise.reject(b)})),Promise.all([d,b])):d):Promise.resolve()}(b,c,e,Math.max(0,g.startTime-.1),l?l.startTime+.01:k),c.Ja=!0,c.mb=!1,k=th(b,f),Promise.all([e,k]).then(function(b){if(!this.f&&!this.m)return function uh(b,c,d,e,f,g,h){var k=f.closedCaptions&&0<f.closedCaptions.size;return null!=f.emsgSchemeIdUris&&0<f.emsgSchemeIdUris.length&&(new P).aa("emsg",b.Ce.bind(b,e,g,f.emsgSchemeIdUris)).parse(h),function xh(b,c,d){var e=Math.max(b.g.bufferBehind,b.c.presentationTimeline.a),f=nd(b.a.J,c.type);return null==f||0>=(d=d-f-e)?Promise.resolve():b.a.J.remove(c.type,f,f+d).then(function(){}.bind(b))}(b,c,d).then(function(){if(!this.f)return rd(this.a.J,c.type,h,g.startTime+e.startTime,g.endTime+e.startTime,k)}.bind(b)).then(function(){if(!this.f)return c.Va=f,c.ra=g,Promise.resolve()}.bind(b))}(this,c,d,g,h,f,b[1])}.bind(b)).then(function(){this.f||this.m||(c.Ja=!1,c.lc=!1,c.Ca||this.a.ob(),bh(this,c,0),function vh(b,c){if(!b.o&&(b.o=Array.from(b.b.values()).every((function(b){return"text"==b.type||!b.Ca&&!b.Fa&&b.ra})),b.o)){var d=fh(b,c);for(b.h[d]||kh(b,d).then(function(){this.f||this.a.Yc()}.bind(b)).catch(I.nb),d=0;d<b.c.periods.length;++d)kh(b,d).catch(I.nb);b.a.ue&&b.a.ue()}}(this,h))}.bind(b)).catch(function(b){this.f||this.m||(c.Ja=!1,"text"==c.type&&this.g.ignoreTextStreamFailures?this.b.delete("text"):3017==b.code?function wh(b,c,d){if(!Array.from(b.b.values()).some((function(b){return b!=c&&b.lc}))){var e=Math.round(100*b.l);if(20<e)b.l-=.2;else{if(!(4<e))return c.kb=!0,b.m=!0,void b.a.onError(d);b.l-=.04}c.lc=!0}bh(b,c,4)}(this,c,b):(c.kb=!0,b.severity=2,mh(this,b)))}.bind(b))}(b,c,e,g,h),null)}(this,b);null!=c&&(bh(this,b,c),b.kb=!1)}catch(d){return void mh(this,d)}c=Array.from(this.b.values()),function nh(b,c){var d=fh(b,c.stream);if(c.xa!=d){var e=c.xa,f=Array.from(b.b.values());f.every((function(b){return b.xa==e}))&&f.every(yh)&&kh(b,e).then(function(){if(!this.f&&f.every(function(b){var c=yh(b),d=fh(this,b.stream);return c&&b.xa==e&&d!=e}.bind(this))){var b=this.c.periods[e],c=this.a.Zc(b),d=new Map;c.variant&&c.variant.video&&d.set("video",c.variant.video),c.variant&&c.variant.audio&&d.set("audio",c.variant.audio),c.text&&d.set("text",c.text);var l=r(this.b.keys());for(c=l.next();!c.done;c=l.next())if(c=c.value,!d.has(c)&&"text"!=c)return void this.a.onError(new A(2,5,5005));for(c=(l=r(Array.from(d.keys()))).next();!c.done;c=l.next())if(c=c.value,!this.b.has(c)){if("text"!=c)return void this.a.onError(new A(2,5,5005));Wg(this,null,null,d.get("text"),b.startTime),d.delete(c)}for(c=(b=r(Array.from(this.b.keys()))).next();!c.done;c=b.next())c=c.value,(l=d.get(c))?(dh(this,l,!1,0),bh(this,this.b.get(c),0)):this.b.delete(c);this.a.Yc()}}.bind(b)).catch(I.nb)}}(this,b),c.every((function(b){return b.endOfStream}))&&this.a.J.endOfStream().then(function(){if(!this.f){var b=this.a.J.T();b<this.c.presentationTimeline.T()&&this.c.presentationTimeline.la(b)}}.bind(this))}},p.Ce=function(b,c,d,e){var f=e.reader.kc(),g=e.reader.kc(),h=e.reader.B(),k=e.reader.B(),l=e.reader.B(),m=e.reader.B();e=e.reader.Ka(e.reader.H.byteLength-e.reader.X()),b=b.startTime+c.startTime+k/h,d.includes(f)&&("urn:mpeg:dash:event:2012"==f?this.a.le():this.a.onEvent(new C("emsg",{detail:{startTime:b,endTime:b+l/h,schemeIdUri:f,value:g,timescale:h,presentationTimeDelta:k,eventDuration:l,id:m,messageData:e}})))},y("veygo.net.HttpFetchPlugin",Ah),Ah.h=function(b,c,d,e,f,g){return t((function k(){var l,m,n,q,x,w,D,G,Z,da;return v(k,(function(k){switch(k.j){case 1:return l=Ah.g,m=Ah.c,w=x=0,D=Date.now(),qa(k,2,3),u(k,l(b,d),5);case 5:return n=k.u,G=n.clone().body.getReader(),new m({start:function(b){!function c(){return t((function Gc(){var d,e;return v(Gc,(function(f){switch(f.j){case 1:return u(f,G.read(),2);case 2:(d=f.u).done||(x+=d.value.byteLength),(100<(e=Date.now())-D||d.done)&&(g(e-D,x-w),w=x,D=e),d.done?b.close():(b.enqueue(d.value),c()),f.j=0}}))}))}()}}),u(k,n.arrayBuffer(),6);case 6:q=k.u;case 3:ua(k),clearTimeout(f),va(k,4);break;case 2:if(Z=ta(k),e.Fc)throw new A(1,1,7001,b,c);if(e.rd)throw new A(1,1,1003,b,c);throw new A(1,1,1002,b,Z,c);case 4:return da={},n.headers.forEach((function(b,c){da[c.trim()]=b})),k.return(zh(da,q,n.status,b,n.url,c))}}))}))},Ah.isSupported=function(){if(!window.ReadableStream)return!1;try{new ReadableStream({})}catch(b){return!1}return!(!window.fetch||!window.AbortController)},Ah.isSupported=Ah.isSupported,Ah.g=window.fetch,Ah.a=window.AbortController,Ah.c=window.ReadableStream,Ah.b=window.Headers,Ah.isSupported()&&(zb("http",Ah,2),zb("https",Ah,2)),y("veygo.net.HttpXHRPlugin",Bh),Bh.f=window.XMLHttpRequest,zb("http",Bh,1),zb("https",Bh,1),Ch.prototype.destroy=function(){return this.g=!0,Promise.all(this.c.values()).then((function(){}),(function(){}))},Gh.prototype.abort=function(){try{this.c.abort()}catch(b){}return this.a.catch((function(){}))},Gh.prototype.store=function(){return this.b},Gh.prototype.promise=function(){return this.a},Ih.prototype.destroy=function(){return Promise.all(this.a.map((function(b){return b.abort()})))},Mh.prototype.destroy=function(){return this.a.destroy()},Mh.prototype.getAll=function(){var b=this;return t((function d(){var e,f;return v(d,(function(d){switch(d.j){case 1:return e=Jh(b.a,"session-ids"),f=[],u(d,Hh(e,(function(b,d){f.push(d)})),2);case 2:return u(d,e.promise(),3);case 3:return d.return(f)}}))}))},Mh.prototype.add=function(b){for(var c=Lh(this.a,"session-ids"),d=c.store(),e=(b=r(b)).next();!e.done;e=b.next())d.add(e.value);return c.promise()},Mh.prototype.remove=function(b){var c=this;return t((function e(){var f;return v(e,(function(e){switch(e.j){case 1:return u(e,Hh(f=Lh(c.a,"session-ids"),(function(c,e,f){0<=b.indexOf(e.sessionId)&&f.delete()})),2);case 2:return u(e,f.promise(),0)}}))}))},Nh.prototype.destroy=function(){for(var b=[],c=r(this.a.values()),d=c.next();!d.done;d=c.next())b.push(d.value.destroy());return this.a.clear(),Promise.all(b)},Nh.prototype.init=function(){var b=this;Oh.forEach((function(c,d){var e=c();e&&b.a.set(d,e)}));for(var c=[],d=r(this.a.values()),e=d.next();!e.done;e=d.next())c.push(e.value.init());return Promise.all(c)},Nh.prototype.erase=function(){var b=this;return t((function d(){var e,f;return v(d,(function(d){switch(d.j){case 1:return e=Array.from(b.a.values()),(f=0<e.length)||Oh.forEach((function(b){(b=b())&&e.push(b)})),u(d,Promise.all(e.map((function(b){return b.erase()}))),2);case 2:if(!f)return u(d,Promise.all(e.map((function(b){return b.destroy()}))),0);d.A(0)}}))}))},y("veygo.offline.StorageMuxer.register",Uh),y("veygo.offline.StorageMuxer.unregister",(function(b){Oh.delete(b)}));var Oh=new Map;function Wh(b){this.a=new Ih(b)}function Xh(b){return Promise.reject(new A(2,9,9011,"Cannot add new value to "+b))}function Yh(b,c,d,e){var f=(b=Lh(b.a,c)).store();return d.forEach((function(b){f.delete(b).onsuccess=function(){return e(b)}})),b.promise()}function Zh(b,c,d){var e=(b=Jh(b.a,c)).store(),f={},g=[];return d.forEach((function(b){e.get(b).onsuccess=function(c){null==(c=c.target.result)&&g.push(b),f[b]=c}})),b.promise().then((function(){return g.length?Promise.reject(new A(2,9,9012,"Could not find values for "+g)):d.map((function(b){return f[b]}))}))}function ai(b){return{originalManifestUri:b.originalManifestUri,duration:b.duration,size:b.size,expiration:null==b.expiration?1/0:b.expiration,periods:b.periods.map(bi),sessionIds:b.sessionIds,drmInfo:b.drmInfo,appMetadata:b.appMetadata}}function bi(b){return function ci(b){var c=b.streams.filter((function(b){return"audio"==b.contentType})),d=b.streams.filter((function(b){return"video"==b.contentType}));if(!c.every((function(b){return b.variantIds}))||!d.every((function(b){return b.variantIds}))){c.forEach((function(b){b.variantIds=[]})),d.forEach((function(b){b.variantIds=[]}));var e=0;if(d.length&&!c.length){var f=e++;d.forEach((function(b){b.variantIds.push(f)}))}if(!d.length&&c.length){var g=e++;c.forEach((function(b){b.variantIds.push(g)}))}d.length&&c.length&&c.forEach((function(b){d.forEach((function(c){var d=e++;b.variantIds.push(d),c.variantIds.push(d)}))}))}}(b),b.streams.forEach((function(){})),{startTime:b.startTime,streams:b.streams.map(di)}}function di(b){var c=b.ce?ei(b.ce):null;return{id:b.id,originalId:null,primary:b.primary,presentationTimeOffset:b.presentationTimeOffset,contentType:b.contentType,mimeType:b.mimeType,codecs:b.codecs,frameRate:b.frameRate,kind:b.kind,language:b.language,label:b.label,width:b.width,height:b.height,initSegmentKey:c,encrypted:b.encrypted,keyId:b.keyId,segments:b.segments.map(fi),variantIds:b.variantIds}}function fi(b){var c=ei(b.uri);return{startTime:b.startTime,endTime:b.endTime,dataKey:c}}function $h(b){return{data:b.data}}function ei(b){var c;if((c=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(b))||(c=/^offline:segment\/([0-9]+)$/.exec(b)))return Number(c[1]);throw new A(2,9,9004,"Could not parse uri "+b)}function gi(b,c,d,e){this.a=new Ih(b),this.c=c,this.b=d,this.f=e}function hi(b,c,d){if(b.f)return Promise.reject(new A(1,9,9011,"Cannot add new value to "+c));var e=(b=Lh(b.a,c)).store(),f=[];return d.forEach((function(b){e.add(b).onsuccess=function(b){f.push(b.target.result)}})),b.promise().then((function(){return f}))}function ii(b,c,d,e){var f=(b=Lh(b.a,c)).store();return d.forEach((function(b){f.delete(b).onsuccess=function(){return e(b)}})),b.promise()}function ji(b,c,d){var e=(b=Jh(b.a,c)).store(),f={},g=[];return d.forEach((function(b){var c=e.get(b);c.onsuccess=function(){null==c.result&&g.push(b),f[b]=c.result}})),b.promise().then((function(){return g.length?Promise.reject(new A(1,9,9012,"Could not find values for "+g)):d.map((function(b){return f[b]}))}))}function ki(){this.g=this.c=this.b=this.a=this.f=null}(p=Wh.prototype).destroy=function(){return this.a.destroy()},p.hasFixedKeySpace=function(){return!0},p.addSegments=function(){return Xh("segment")},p.removeSegments=function(b,c){return Yh(this,"segment",b,c)},p.getSegments=function(b){return Zh(this,"segment",b).then((function(b){return b.map($h)}))},p.addManifests=function(){return Xh("manifest")},p.updateManifestExpiration=function(b,c){var d=Lh(this.a,"manifest"),e=d.store(),f=new z;return e.get(b).onsuccess=function(d){(d=d.target.result)?(d.expiration=c,e.put(d),f.resolve()):f.reject(new A(2,9,9012,"Could not find values for "+b))},d.promise().then((function(){return f}))},p.removeManifests=function(b,c){return Yh(this,"manifest",b,c)},p.getManifests=function(b){return Zh(this,"manifest",b).then((function(b){return b.map(ai)}))},p.getAllManifests=function(){var b=this;return t((function d(){var e,f,g;return v(d,(function(d){switch(d.j){case 1:return e=ai,f=Jh(b.a,"manifest"),g=new Map,u(d,Hh(f,(function(b,d){g.set(b,e(d))})),2);case 2:return u(d,f.promise(),3);case 3:return d.return(g)}}))}))},(p=gi.prototype).destroy=function(){return this.a.destroy()},p.hasFixedKeySpace=function(){return this.f},p.addSegments=function(b){return hi(this,this.c,b)},p.removeSegments=function(b,c){return ii(this,this.c,b,c)},p.getSegments=function(b){return ji(this,this.c,b)},p.addManifests=function(b){return hi(this,this.b,b)},p.updateManifestExpiration=function(b,c){var d=Lh(this.a,this.b),e=d.store();return e.get(b).onsuccess=function(d){(d=d.target.result)&&(d.expiration=c,e.put(d,b))},d.promise()},p.removeManifests=function(b,c){return ii(this,this.b,b,c)},p.getManifests=function(b){return ji(this,this.b,b)},p.getAllManifests=function(){var b=this;return t((function d(){var e,f;return v(d,(function(d){switch(d.j){case 1:return e=Jh(b.a,b.b),f=new Map,u(d,Hh(e,(function(b,d){f.set(b,d)})),2);case 2:return u(d,e.promise(),3);case 3:return d.return(f)}}))}))},(p=ki.prototype).init=function(){var b=this,c=li,d=new z,e=window.indexedDB.open(c,4);return e.onsuccess=function(c){c=c.target.result,b.f=c;var e=c.objectStoreNames;e=e.contains("manifest")&&e.contains("segment")?new Wh(c):null,b.a=e,e=(e=c.objectStoreNames).contains("manifest-v2")&&e.contains("segment-v2")?new gi(c,"segment-v2","manifest-v2",!0):null,b.b=e,e=(e=c.objectStoreNames).contains("manifest-v3")&&e.contains("segment-v3")?new gi(c,"segment-v3","manifest-v3",!1):null,b.c=e,c=c.objectStoreNames.contains("session-ids")?new Mh(c):null,b.g=c,d.resolve()},e.onupgradeneeded=function(b){b=b.target.result;for(var c=r(["segment-v3","manifest-v3","session-ids"]),d=c.next();!d.done;d=c.next())d=d.value,b.objectStoreNames.contains(d)||b.createObjectStore(d,{autoIncrement:!0})},e.onerror=function(b){d.reject(new A(2,9,9001,e.error)),b.preventDefault()},d},p.destroy=function(){var b=this;return t((function d(){return v(d,(function(d){switch(d.j){case 1:if(!b.a){d.A(2);break}return u(d,b.a.destroy(),2);case 2:if(!b.b){d.A(4);break}return u(d,b.b.destroy(),4);case 4:if(!b.c){d.A(6);break}return u(d,b.c.destroy(),6);case 6:if(!b.g){d.A(8);break}return u(d,b.g.destroy(),8);case 8:b.f&&b.f.close(),d.j=0}}))}))},p.getCells=function(){var b=new Map;return this.a&&b.set("v1",this.a),this.b&&b.set("v2",this.b),this.c&&b.set("v3",this.c),b},p.getEmeSessionCell=function(){return this.g},p.erase=function(){var b=this;return t((function d(){return v(d,(function(d){switch(d.j){case 1:if(!b.a){d.A(2);break}return u(d,b.a.destroy(),2);case 2:if(!b.b){d.A(4);break}return u(d,b.b.destroy(),4);case 4:if(!b.c){d.A(6);break}return u(d,b.c.destroy(),6);case 6:return b.f&&b.f.close(),u(d,function mi(){var b=li,c=new z,d=window.indexedDB.deleteDatabase(b);return d.onblocked=function(){},d.onsuccess=function(){c.resolve()},d.onerror=function(b){c.reject(new A(2,9,9001,d.error)),b.preventDefault()},c}(),8);case 8:return b.f=null,b.a=null,b.b=null,b.c=null,u(d,b.init(),0)}}))}))};var li="veygo_offline_db";function ni(b,c,d,e){this.a=b,this.g=c,this.f=d,this.c=e,this.b=["offline:",b,"/",c,"/",d,"/",e].join("")}function oi(b){if(null==(b=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(b)))return null;var c=b[1];if("manifest"!=c&&"segment"!=c)return null;var d=b[2];if(!d)return null;var e=b[3];return e&&null!=c?new ni(c,d,e,Number(b[4])):null}function pi(b,c){this.b=b,this.a=c}function ri(b,c,d){var e=c.streams.filter((function(b){return"audio"==b.contentType})),f=c.streams.filter((function(b){return"video"==b.contentType}));return e=function si(b,c,d){for(var e=new Set,f=r(c),g=f.next();!g.done;g=f.next()){var h=r(g.value.variantIds);for(g=h.next();!g.done;g=h.next())e.add(g.value)}for(f=r(d),g=f.next();!g.done;g=f.next())for(h=r(g.value.variantIds),g=h.next();!g.done;g=h.next())e.add(g.value);for(f=new Map,e=r(e),g=e.next();!g.done;g=e.next())g=g.value,f.set(g,{id:g,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0});for(c=r(c),e=c.next();!e.done;e=c.next())for(e=e.value,g=ti(b,e),h=r(e.variantIds),e=h.next();!e.done;e=h.next())(e=f.get(e.value)).language=g.language,e.primary=e.primary||g.primary,e.audio=g;for(d=r(d),c=d.next();!c.done;c=d.next())for(e=c.value,c=ti(b,e),g=r(e.variantIds),e=g.next();!e.done;e=g.next())(e=f.get(e.value)).primary=e.primary||c.primary,e.video=c;return f}(b,e,f),f=c.streams.filter((function(b){return"text"==b.contentType})).map((function(c){return ti(b,c)})),c.streams.forEach((function(e){e=e.segments.map((function(c,d){return ui(b,d,c)})),d.Ya(e,c.startTime)})),{startTime:c.startTime,variants:Array.from(e.values()),textStreams:f}}function ti(b,c){var d=c.segments.map((function(c,d){return ui(b,d,c)})),e=new R(d);return d={id:c.id,originalId:c.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(b){return e.find(b)},getSegmentReference:function(b){return e.get(b)},initSegmentReference:null,presentationTimeOffset:c.presentationTimeOffset,mimeType:c.mimeType,codecs:c.codecs,width:c.width||void 0,height:c.height||void 0,frameRate:c.frameRate||void 0,kind:c.kind,encrypted:c.encrypted,keyId:c.keyId,language:c.language,label:c.label||null,type:c.contentType,primary:c.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},null!=c.initSegmentKey&&(d.initSegmentReference=function vi(b,c){var d=new ni("segment",b.b,b.a,c);return new Rd((function(){return[d.toString()]}),0,null)}(b,c.initSegmentKey)),d}function ui(b,c,d){var e=new ni("segment",b.b,b.a,d.dataKey);return new N(c,d.startTime,d.endTime,(function(){return[e.toString()]}),0,null)}function wi(b){this.a=!1,this.b=new z,this.c=b}function xi(b,c){return t((function e(){return v(e,(function(e){switch(e.j){case 1:return ra(e,2),u(e,Promise.resolve(c()),4);case 4:return e.return(e.u);case 2:return ua(e),u(e,Promise.all(b.map((function(b){return b.destroy()}))),5);case 5:va(e,0)}}))}))}function yi(){this.a=null}function zi(b){var c=oi(b);return c&&"manifest"==c.a?zi.a(b):c&&"segment"==c.a?zi.b(c.key(),c):hb(new A(2,1,9004,b))}function Ai(b,c,d){return t((function f(){var g,h,k,l,m,n;return v(f,(function(f){switch(f.j){case 1:g=[];for(var q=[],w=r(d),D=w.next();!D.done;D=w.next()){D=D.value;for(var G=!1,V=r(q),Z=V.next();!Z.done;Z=V.next())if(Bi((Z=Z.value).info,D)){Z.sessionIds.push(D.sessionId),G=!0;break}G||q.push({info:D,sessionIds:[D.sessionId]})}h=r(q),k=h.next();case 2:if(k.done){f.A(4);break}return l=k.value,m=function Ci(b,c,d){return t((function f(){var g,h;return v(f,(function(f){switch(f.j){case 1:return g=new cc({Xa:c,onError:function(){},ic:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),qa(f,2),g.configure(b),u(f,function kc(b,c,d,e,f,g){var h=new Map;return h.set(c,{audioCapabilities:f,videoCapabilities:g,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:c,drmInfos:[{keySystem:c,licenseServerUri:d,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:e,initData:null,keyIds:null}]}),lc(b,h)}(g,d.info.keySystem,d.info.licenseUri,d.info.serverCertificate,d.info.audioCapabilities,d.info.videoCapabilities),4);case 4:sa(f,3);break;case 2:return ta(f),u(f,g.destroy(),5);case 5:return f.return([]);case 3:return qa(f,6),u(f,rc(g),8);case 8:sa(f,7);break;case 6:return ta(f),u(f,g.destroy(),9);case 9:return f.return([]);case 7:return h=[],u(f,Promise.all(d.sessionIds.map((function(b){return t((function n(){return v(n,(function(c){switch(c.j){case 1:return qa(c,2),u(c,function uc(b,c){return t((function e(){var f,g,h;return v(e,(function(e){switch(e.j){case 1:return u(e,vc(b,c),2);case 2:return(f=e.u)?(g=[],(h=b.b.get(f))&&(h.ma=new z,g.push(h.ma)),g.push(f.remove()),u(e,Promise.all(g),0)):e.return()}}))}))}(g,b),4);case 4:h.push(b),sa(c,0);break;case 2:ta(c),c.j=0}}))}))}))),10);case 10:return u(f,g.destroy(),11);case 11:return f.return(h)}}))}))}(b,c,l),u(f,m,5);case 5:n=f.u,g=g.concat(n),k=h.next(),f.A(2);break;case 4:return f.return(g)}}))}))}function Bi(b,c){function d(b,c){return b.robustness==c.robustness&&b.contentType==c.contentType}return b.keySystem==c.keySystem&&b.licenseUri==c.licenseUri&&vb(b.audioCapabilities,c.audioCapabilities,d)&&vb(b.videoCapabilities,c.videoCapabilities,d)}function Di(b,c,d,e,f){var k,g=f in e,h=!0;for(k in c){var l=f+"."+k,m=g?e[f]:d[k];g||k in d?void 0===c[k]?void 0===m||g?delete b[k]:b[k]=rb(m):m.constructor==Object&&c[k]&&c[k].constructor==Object?(b[k]||(b[k]=rb(m)),l=Di(b[k],c[k],m,e,l),h=h&&l):typeof c[k]!=typeof m||null==c[k]||c[k].constructor!=m.constructor?h=!1:b[k]=c[k]:h=!1}return h}function Ei(){var b={trackSelectionCallback:function(b){return b},progressCallback:function(){},usePersistentLicense:!0},c={drm:{retryParameters:{maxAttempts:3,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:1e4},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,licenseRequestExtraHeaders:{},hbola:{operatorID:"",countryID:"",tokenID:""}},manifest:{retryParameters:{maxAttempts:3,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:1e4},availabilityWindowOverride:NaN,dash:{customScheme:function(b){if(b)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0}},streaming:{retryParameters:{maxAttempts:3,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:1e4},failureCallback:function(){},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5},offline:b,abrFactory:L,abr:{enabled:!0,defaultBandwidthEstimate:5e5,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,keepAudioQualityConstant:!1,keepAudioQualityConstantBitrate:0,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null},closedCaptionParserFactory:function(){return null}};return b.trackSelectionCallback=function(b){return function Fi(b,c){var d=b.filter((function(b){return"variant"==b.type})),e=[],f=Ad(c,d.map((function(b){return b.language})));f&&(e=d.filter((function(b){return J(b.language)==f}))),0==e.length&&(e=d.filter((function(b){return b.primary}))),0==e.length&&(d.map((function(b){return b.language})),e=d);var g=e.filter((function(b){return b.height&&480>=b.height}));if(g.length&&(g.sort((function(b,c){return c.height-b.height})),e=g.filter((function(b){return b.height==g[0].height}))),d=[],e.length){var h=Math.floor(e.length/2);e.sort((function(b,c){return b.bandwidth-c.bandwidth})),d.push(e[h])}for(e=r(b),h=e.next();!h.done;h=e.next())"text"==(h=h.value).type&&d.push(h);return d}(b,c.preferredAudioLanguage)},c}function Gi(b,c,d){return Di(b,c,d||Ei(),{".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,authMethod:"",videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""},".drm.licenseRequestExtraHeaders":""},"")}function Hi(b){this.c=b,this.a=null,this.b=[]}function Ii(b){function c(b){return{timestamp:b.timestamp,state:b.state,duration:b.duration}}for(var d=[],e=r(b.b),f=e.next();!f.done;f=e.next())d.push(c(f.value));return b.a&&d.push(c(b.a)),d}function Ji(b,c){return c?"buffering":b.c.ended?"ended":b.c.paused?"paused":"playing"}function Ki(){this.b=this.c=null,this.a=[]}function Li(b,c,d){b.b!=c&&(b.b=c,b.a.push({timestamp:Date.now()/1e3,id:c.id,type:"text",fromAdaptation:d,bandwidth:null}))}function Mi(b){this.l=this.F=this.C=NaN,this.b=this.h=0,this.i=this.w=this.f=this.g=this.o=this.s=NaN,this.c=null,this.m=new Hi(b),this.a=new Ki}function Ni(b,c){var d=Date.now()/1e3,e=null==b.c?0:d-b.c;c?b.b+=e:b.h+=e,b.c=d}function W(b,c){var d=this;qb.call(this),this.f=null,this.V=!1,this.o=new Eb,this.Qb=this.i=this.cb=this.c=this.m=this.a=this.R=this.oa=this.h=this.s=this.g=this.C=null,this.Cc=1e9,this.wb=new Set,this.eb=!1,this.Qa=!0,this.L=this.yb=this.na=null,this.zc=!1,this.yc=0,this.F=null,this.w=new eg,this.b=Oi(this),this.xb={width:1/0,height:1/0},this.l=null,this.vb=new mg(this.b.preferredAudioLanguage,this.b.preferredVariantRole,this.b.preferredAudioChannelCount),this.P=this.b.preferredTextLanguage,this.$=this.b.preferredTextRole,c&&c(this),this.C=function Pi(b){return new E((function(c,d){b.i&&b.i.segmentDownloaded(c,d)}))}(this),b&&this.zb(b,!0),this.fb=new wi((function(){d.o&&(d.o.O(),d.o=null);var b=[];return d.C&&(b.push(d.C.destroy()),d.C=null),d.V=!1,d.o=null,d.i=null,d.Qb=null,d.b=null,Promise.all(b)})),F(this.o,window,"online",(function(){d.nc()}))}Uh("idb",(function(){return window.indexedDB?new ki:null})),ni.prototype.ja=function(){return this.g},ni.prototype.W=function(){return this.f},ni.prototype.key=function(){return this.c},ni.prototype.toString=function(){return this.b},wi.prototype.destroy=function(){var b=this;return this.a?this.b:(this.a=!0,this.c().then((function(){b.b.resolve()}),(function(){b.b.resolve()})))},(p=yi.prototype).configure=function(){},p.start=function(b){var c=oi(b);if(this.a=c,null==c||"manifest"!=c.a)return Promise.reject(new A(2,1,9004,c));var d=new Nh;return xi([d],(function(){return t((function f(){var h,k,l;return v(f,(function(f){switch(f.j){case 1:return u(f,d.init(),2);case 2:return u(f,Rh(d,c.ja(),c.W()),3);case 3:return u(f,f.u.getManifests([c.key()]),4);case 4:return h=f.u,k=h[0],l=new pi(c.ja(),c.W()),f.return(function qi(b,c){var d=new S(null,0);d.la(c.duration);var e=c.periods.map((function(c){return ri(b,c,d)})),f=c.drmInfo?[c.drmInfo]:[];return c.drmInfo&&e.forEach((function(b){b.variants.forEach((function(b){b.drmInfos=f}))})),{presentationTimeline:d,minBufferTime:2,offlineSessionIds:c.sessionIds,periods:e}}(l,k))}}))}))}))},p.stop=function(){return Promise.resolve()},p.update=function(){},p.onExpirationUpdated=function(b,c){var d=this.a,e=new Nh;return xi([e],(function(){return t((function g(){var h,k,l,m,n;return v(g,(function(g){switch(g.j){case 1:return u(g,e.init(),2);case 2:return u(g,Rh(e,d.ja(),d.W()),3);case 3:return u(g,(h=g.u).getManifests([d.key()]),4);case 4:if(k=g.u,l=k[0],m=l.sessionIds.includes(b),n=null==l.expiration||l.expiration>c,m&&n)return u(g,h.updateManifestExpiration(d.key(),c),0);g.A(0)}}))}))})).catch((function(){}))},we["application/x-offline-manifest"]=yi,y("veygo.offline.OfflineScheme",zi),zi.a=function(b){return jb(b={uri:b,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}})},zi.b=function(b,c){var d=new Nh;return kb(xi([d],(function(){return t((function g(){var e,l;return v(g,(function(g){switch(g.j){case 1:return u(g,d.init(),2);case 2:return u(g,Rh(d,c.ja(),c.W()),3);case 3:return u(g,g.u.getSegments([c.key()]),4);case 4:return e=g.u,l=e[0],g.return({uri:c,data:l.data,headers:{}})}}))}))})))},zb("offline",zi),y("veygo.util.ConfigUtils.mergeConfigObjects",Di),Ga(W,qb),y("veygo.Player",W),W.prototype.destroy=function(){var b=this;return t((function d(){return v(d,(function(d){switch(d.j){case 1:return u(d,b.detach(),2);case 2:return u(d,b.fb.destroy(),0)}}))}))},W.prototype.destroy=W.prototype.destroy,W.version="development";var Ri=["evelopment"];Se=new function(b){this.a=b,this.c=Te,this.b=Ue}(new Qe(Number(Ri[0]),Number(Ri[1])));var Si=["output-restricted","internal-error"],Ti={};function Ui(b){var c=b.b.closedCaptionParserFactory;c=window.muxjs?new Oc(c):new Pc;var d=new b.b.textDisplayFactory;return d.setTextVisibility(b.V),new jd(b.f,c,d)}function nj(b){if(b.m&&b.m.configure(b.b.manifest),b.g&&b.g.configure(b.b.drm),b.a){b.a.configure(b.b.streaming);try{b.c.periods.forEach(b.Vb.bind(b))}catch(f){b.La(f)}var c=Xg(b.a),d=Zg(b.a),e=ij(b);c=K.Sc(c,d,e.variants),b.i&&c&&c.allowedByApplication&&c.allowedByKeySystem?jj(b,e.variants):oj(b,e)}b.i&&(b.i.configure(b.b.abr),b.b.abr.enabled&&!b.Qa?b.i.enable():b.i.disable())}function cj(b,c,d,e){fg(b.w,c).variant=d,(b=b.l.a).c!=d&&(b.c=d,b.a.push({timestamp:Date.now()/1e3,id:d.id,type:"variant",fromAdaptation:e,bandwidth:d.bandwidth}))}function Oi(b){var c=Ei();return c.streaming.failureCallback=function(c){b.ba()&&[1001,1002,1003].includes(c.code)&&(c.severity=1,b.nc())},c.textDisplayFactory=function(){return new X(b.f)},c}function uj(b,c,d,e){d=void 0!==d&&d,e=void 0===e?0:e,b.Qa?(b.L=c,b.zc=d,b.yc=e):(eh(b.a,c,d,e),Bj(b,new C("variantchanged")))}function tj(b,c){b.Qa?b.F=c:(dh(b.a,c,!0,0),Bj(b,new C("textchanged")))}function kj(b,c){if(b.l&&Ni(b.l,b.eb),b.eb=c,Zi(b),b.h){var d=b.h.b;c!=d.g&&(d.g=c,Gg(d,d.f))}Bj(b,new C("buffering",{buffering:c}))}function Zi(b){if(b.l){var c=b.l.m,d=b.eb;null==c.a?c.a={timestamp:Date.now()/1e3,state:Ji(c,d),duration:0}:(b=Date.now()/1e3,d=Ji(c,d),c.a.duration=b-c.a.timestamp,c.a.state!=d&&(c.b.push(c.a),c.a={timestamp:b,state:d,duration:0}))}}function jj(b,c){try{Aj(b,c)}catch(e){return b.La(e),null}var d=c.filter((function(b){return K.Ua(b)}));return d=b.vb.create(d),b.i.setVariants(Array.from(d.values())),b.i.chooseVariant()}function oj(b,c){var d=jj(b,c.variants);d&&(cj(b,c,d,!0),uj(b,d,!0)),(d=K.Db(c.textStreams,b.P,b.$)[0]||null)&&(fg(b.w,c).text=d,Li(b.l.a,d,!0),(b.b.streaming.alwaysStreamText||b.V)&&tj(b,d)),dj(b)}function dj(b){Bj(b,new C("adaptation"))}function mj(b){Bj(b,new C("trackschanged"))}function xj(b){b.dispatchEvent(new C("texttrackvisibility"))}function Xi(b,c,d){b.ub(new C(c,{detail:{schemeIdUri:d.schemeIdUri,value:d.value,startTime:d.startTime,endTime:d.endTime,id:d.id,eventElement:d.eventElement}}))}function Aj(b,c){var d=b.g?Mb(b.g.V):{},e=Object.keys(d);e=e.length&&"00"==e[0];for(var f=!1,g=!1,h=[],k=[],l=r(c),m=l.next();!m.done;m=l.next()){var n=[];(m=m.value).audio&&n.push(m.audio),m.video&&n.push(m.video);for(var q=(n=r(n)).next();!q.done;q=n.next())if((q=q.value).keyId){var x=d[e?"00":q.keyId];x?Si.includes(x)&&(k.includes(x)||k.push(x)):h.includes(q.keyId)||h.push(q.keyId)}m.allowedByApplication?m.allowedByKeySystem&&(f=!0):g=!0}if(!f)throw new A(2,4,4012,{hasAppRestrictions:g,missingKeys:h,restrictedKeyStatuses:k})}function Bj(b,c){t((function e(){return v(e,(function(e){switch(e.j){case 1:return u(e,Promise.resolve(),2);case 2:b.fb.a||b.dispatchEvent(c),e.j=0}}))}))}function wj(b){for(var c=new Set,d=(b=r(b)).next();!d.done;d=b.next())(d=d.value)&&d.language?c.add(J(d.language)):c.add("und");return c}function vj(b){for(var c=new Map,d=[""],e=(b=r(b)).next();!e.done;e=b.next()){var f=e.value;e="und";var g=d;for(f&&f.language&&(e=J(f.language)),f&&f.roles.length&&(g=f.roles),c.has(e)||c.set(e,new Set),g=(f=r(g)).next();!g.done;g=f.next())g=g.value,c.get(e).add(g)}var h=[];return c.forEach((function(b,c){for(var d=r(b),e=d.next();!e.done;e=d.next())h.push({language:c,role:e.value})})),h}function rj(b){return null==(b=ij(b))?[]:b.variants.filter((function(b){return K.Ua(b)}))}function sj(b){var c=ij(b);return null==c?[]:c.textStreams.filter((function(c){return!b.wb.has(c)}))}function ij(b){if(null==b.c||null==b.h)return null;for(var c=Kg(b.h),d=null,e=(b=r(b.c.periods)).next();!e.done;e=b.next())(e=e.value).startTime<=c&&(d=e);return d}function qj(b){var c=ij(b);return c?fg(b.w,c).variant:null}function Ej(b,c){var d=ri(new pi(b.ja(),b.W()),c.periods[0],new S(null,0)),e=c.appMetadata||{};return d=Dj(d),{offlineUri:b.toString(),originalManifestUri:c.originalManifestUri,duration:c.duration,size:c.size,expiration:c.expiration,tracks:d,appMetadata:e}}function Dj(b){for(var c=[],d=K.Ud(b.variants),e=(d=r(d)).next();!e.done;e=d.next())c.push(K.vc(e.value));for(d=(b=r(b.textStreams)).next();!d.done;d=b.next())c.push(K.qc(d.value));return c}function Fj(){this.a={}}function Hj(b,c){var d=b.a[c];return null==d&&(d=0),d}function Lj(b){var c=new Mj;b.periods.forEach((function(b,d){var e=Nj(b.variants);if(0==d)for(var f=(e=r(e.a)).next();!f.done;f=e.next())c.add(f.value);else!function Oj(b,c){b.a=b.a.filter((function(b){return Pj(c,b)}))}(c,e)}));for(var d=(b=r(b.periods)).next();!d.done;d=b.next())(d=d.value).variants=d.variants.filter((function(b){return Pj(c,new Qj(b))}))}function Qj(b){var c=b.audio;b=b.video,this.b=c?c.mimeType:null,this.a=c?c.codecs.split(".")[0]:null,this.f=b?b.mimeType:null,this.c=b?b.codecs.split(".")[0]:null}function Mj(){this.a=[]}function Pj(b,c){return b.a.some((function(b){return c.b==b.b&&c.a==b.a&&c.f==b.f&&c.c==b.c}))}function Nj(b){for(var c=new Mj,d=(b=r(b)).next();!d.done;d=b.next())c.add(new Qj(d.value));return c}function Y(b){var c=this;if(b&&b.constructor!=W)throw new A(2,9,9008);this.b=this.a=null,b?(this.a=b.b,this.b=b.Ib()):(this.a=Ei(),this.b=new E),this.g=!1,this.c=[],this.f=[];var d=!b;this.h=new wi((function(){return t((function f(){var b;return v(f,(function(f){switch(f.j){case 1:return b=function(){},u(f,Promise.all(c.f.map((function(c){return c.then(b,b)}))),2);case 2:if(!d){f.A(3);break}return u(f,c.b.destroy(),3);case 3:c.a=null,c.b=null,f.j=0}}))}))}))}function Sj(){return Vh()}function gk(b,c){for(var d=[],e=r(b.periods),f=e.next();!f.done;f=e.next())for(var g=(f=r(f.value.streams)).next();!g.done;g=f.next())g=g.value,c&&"video"==g.contentType?d.push({contentType:Nb(g.mimeType,g.codecs),robustness:b.drmInfo.videoRobustness}):c||"audio"!=g.contentType||d.push({contentType:Nb(g.mimeType,g.codecs),robustness:b.drmInfo.audioRobustness});return d}function ek(b,c,d){return t((function f(){return v(f,(function(f){switch(f.j){case 1:return u(f,function hk(b,c,d,e){return t((function g(){var h,k,l;return v(g,(function(g){switch(g.j){case 1:return e.drmInfo?(h=function Th(b){var c=Array.from(b.a.keys());if(!c.length)throw new A(2,9,9e3,"No supported storage mechanisms found");return b.a.get(c[0]).getEmeSessionCell()}(d),k=e.sessionIds.map((function(b){return{sessionId:b,keySystem:e.drmInfo.keySystem,licenseUri:e.drmInfo.licenseServerUri,serverCertificate:e.drmInfo.serverCertificate,audioCapabilities:gk(e,!1),videoCapabilities:gk(e,!0)}})),u(g,Ai(c,b,k),2)):g.return();case 2:return l=g.u,u(g,h.remove(l),3);case 3:return u(g,h.add(k.filter((function(b){return-1==l.indexOf(b.sessionId)}))),0)}}))}))}(b.b,b.a.drm,d,c),0)}}))}))}function fk(b,c,d,e){function f(){k+=1,b.a.offline.progressCallback(l,k/h,0,0)}var g=function ik(b){var c=[];return b.periods.forEach((function(b){b.streams.forEach((function(b){null!=b.initSegmentKey&&c.push(b.initSegmentKey),b.segments.forEach((function(b){c.push(b.dataKey)}))}))})),c}(e),h=g.length+1,k=0,l=Ej(d,e);return Promise.all([c.removeSegments(g,f),c.removeManifests([d.key()],f)])}function nk(b,c,d,e,f,g){var h={id:g.id,originalId:g.originalId,primary:g.primary,presentationTimeOffset:g.presentationTimeOffset||0,contentType:g.type,mimeType:g.mimeType,codecs:g.codecs,frameRate:g.frameRate,kind:g.kind,language:g.language,label:g.label,width:g.width||null,height:g.height||null,initSegmentKey:null,encrypted:g.encrypted,keyId:g.keyId,segments:[],variantIds:[]},k=g.id;return function ok(b,c,d){for(var e=null==(c=b.findSegmentPosition(c))?null:b.getSegmentReference(c);e;)d(e),e=b.getSegmentReference(++c)}(g,f.presentationTimeline.jb(),(function(f){Dh(c,k,pk(b,f),function Gj(b,c,d){return d=d.endTime-d.startTime,Hj(b,c)*d}(e,g.id,f),(function(e,k){return"video"===g.type&&b.a.offline.progressCallback(c.i,k,f.startTime,f.endTime),d.addSegments([{data:e}]).then((function(c){b.c.push(c[0]),h.segments.push({startTime:f.startTime,endTime:f.endTime,dataKey:c[0]})}))}))})),(f=g.initSegmentReference)&&Dh(c,k,pk(b,f),.5*Hj(e,g.id),(function(c){return d.addSegments([{data:c}]).then((function(c){b.c.push(c[0]),h.initSegmentKey=c[0]}))})),h}function Xj(b){if(b.h.a)throw new A(2,9,7001)}function Vj(){if(!Vh())throw new A(2,9,9e3)}function pk(b,c){var d=b.a.streaming.retryParameters;return d=Ab(c.c(),d),0==c.b&&null==c.a||(d.headers.Range="bytes="+c.b+"-"+(null==c.a?"":c.a)),d}function Tj(b,c){return t((function e(){return v(e,(function(e){switch(e.j){case 1:return b.f.push(c),ra(e,2),u(e,c,4);case 4:return e.return(e.u);case 2:ua(e),tb(b.f,c),va(e,0)}}))}))}function lk(b){for(var c=new Set,d=(b=r(b.periods)).next();!d.done;d=b.next()){for(var e=r((d=d.value).textStreams),f=e.next();!f.done;f=e.next())c.add(f.value);for(e=(d=r(d.variants)).next();!e.done;e=d.next())(e=e.value).audio&&c.add(e.audio),e.video&&c.add(e.video)}return c}function qk(b){b.variants.map((function(b){return b.video}));var c=new Set(b.variants.map((function(b){return b.audio})));b=b.textStreams;for(var d=r(c),e=d.next();!e.done;e=d.next())for(var f=(e=r(c)).next();!f.done;f=e.next());for(d=(c=r(b)).next();!d.done;d=c.next())for(e=(d=r(b)).next();!e.done;e=d.next());}W.registerSupportPlugin=function(b,c){Ti[b]=c},W.isBrowserSupported=function(){return!!(window.Promise&&window.Uint8Array&&Array.prototype.forEach&&window.MediaSource&&MediaSource.isTypeSupported&&window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)},W.probeSupport=function(){return Kc().then((function(b){var c=function ye(){var c,b={};for(c in we)b[c]=!0;for(var d in xe)b[d]=!0;return["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"].forEach((function(c){b[c]=!!we[c]})),["mpd","m3u8","ism"].forEach((function(c){b[c]=!!xe[c]})),b}(),d=function ld(){var b={};return'video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").forEach((function(c){b[c]=ed(c)||MediaSource.isTypeSupported(c)||Zc(c);var d=c.split(";")[0];b[d]=b[d]||b[c]})),b}();for(var e in b={manifest:c,media:d,drm:b},Ti)b[e]=Ti[e]();return b}))},W.prototype.zb=function(b,c){var d=this;return t((function f(){return v(f,(function(f){switch(f.j){case 1:if(void 0===c&&(c=!0),!d.f){f.A(2);break}return u(f,d.detach(),2);case 2:if(d.f=b,F(d.o,d.f,"error",d.ve.bind(d)),c)return d.s=Ui(d),u(f,d.s.o,0);f.A(0)}}))}))},W.prototype.attach=W.prototype.zb,W.prototype.detach=function(){var b=this;return t((function d(){return v(d,(function(d){switch(d.j){case 1:return b.f?u(d,b.tc(!1),2):d.return();case 2:b.o.ua(b.f,"error"),b.f=null,d.j=0}}))}))},W.prototype.detach=W.prototype.detach,W.prototype.load=function(b,c,d){c=void 0===c?null:c;var e=this;return t((function g(){var h,k,l,m,n,q,x,w,D,G,V,Z,da,na;return v(g,(function(g){switch(g.j){case 1:if(!e.f)throw new A(2,7,7002);return k=new z,l=function(){return h=new A(2,7,7e3),k},e.dispatchEvent(new C("loading")),qa(g,2),m=e.f,n=e.tc(),e.na=l,u(g,n,4);case 4:if(e.l=new Mi(m),e.l.g=Date.now()/1e3,F(e.o,m,"playing",(function(){Zi(e)})),F(e.o,m,"pause",(function(){Zi(e)})),F(e.o,m,"ended",(function(){Zi(e)})),q=e.b.abrFactory,e.i&&e.Qb==q||(e.Qb=q,e.i=new q,e.i.configure(e.b.abr)),h)throw h;if(w=x=null,d&&("string"==typeof d?w=d:(Re("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),x=d)),D=e,x){G=new x,g.A(5);break}return u(g,function Vi(b,c,d){return t((function f(){var g;return v(f,(function(f){switch(f.j){case 1:return u(f,ze(c,b.C,b.b.manifest.retryParameters,d),2);case 2:return g=f.u,f.return(g)}}))}))}(e,b,w),6);case 6:G=g.u;case 5:return D.m=G,e.m.configure(e.b.manifest),e.cb=b,u(g,function Wi(b){return b.R=new Mg,function Ng(b,c){b.b=c}(b.R,(function(c){Xi(b,"timelineregionadded",c)})),b.m.start(b.cb,{networkingEngine:b.C,filter:function(c){var d=b.g?b.g.a:null;if(d)for(var e=(c=r(c.periods)).next();!e.done;e=c.next())for(var f=(e=r(e.value.variants)).next();!f.done;f=e.next())for(var g=(f=r(f.value.drmInfos)).next();!g.done;g=f.next())if((g=g.value).keySystem==d.keySystem)for(var h=(g=r(g.initData||[])).next();!h.done;h=g.next())h=h.value,tc(b.g,h.initDataType,h.initData)},filterNewPeriod:b.Vb.bind(b),filterAllPeriods:b.Kc.bind(b),onTimelineRegionAdded:function(c){var d=b.R;a:{for(var e=r(d.a),f=e.next();!f.done;f=e.next())if((f=f.value).schemeIdUri==c.schemeIdUri&&f.startTime==c.startTime&&f.endTime==c.endTime){e=f;break a}e=null}null==e&&(d.a.add(c),d.b(c))},onEvent:b.ub.bind(b),onError:b.La.bind(b)})}(e),7);case 7:if(V=g.u,e.c=V,h)throw h;return function Yi(b){function c(b){return b.video&&b.audio||b.video&&b.video.codecs.includes(",")}if(b.c.periods.some((function(b){return b.variants.some(c)}))&&b.c.periods.forEach((function(b){b.variants=b.variants.filter(c)})),0==b.c.periods.length)throw new A(2,4,4014)}(e),Z=e,u(g,function $i(b,c){return t((function e(){var f,g,h;return v(e,(function(e){switch(e.j){case 1:return f={Xa:b.C,onError:function(c){b.La(c)},ic:function(c){!function lj(b,c){var d=ij(b),e=!1,f=Object.keys(c),g=1==f.length&&"00"==f[0];f.length&&d.variants.forEach((function(b){K.$d(b).forEach((function(d){var f=b.allowedByKeySystem;d.keyId&&(d=c[g?"00":d.keyId],b.allowedByKeySystem=!!d&&!Si.includes(d)),f!=b.allowedByKeySystem&&(e=!0)}))})),f=Xg(b.a);var h=Zg(b.a);(f=K.Sc(f,h,d.variants))&&!f.allowedByKeySystem&&oj(b,d),e&&(mj(b),jj(b,d.variants))}(b,c)},onExpirationUpdated:function(c,e){b.m&&b.m.onExpirationUpdated&&b.m.onExpirationUpdated(c,e),b.dispatchEvent(new C("expirationupdated"))},onEvent:function(c){b.ub(c)}},(g=new cc(f)).configure(b.b.drm),h=K.Qc(c),u(e,function jc(b,c,d){return b.o=d,b.C=0<d.length,ic(b,c)}(g,h,c.offlineSessionIds),2);case 2:return e.return(g)}}))}))}(e,V),8);case 8:if(Z.g=g.u,h)throw h;return e.Kc(e.c.periods),function aj(b,c){for(var d=0;d<c.length;d++){for(var e=c[d],f=new Map,g=r(e.variants),h=g.next();!h.done;h=g.next())if((h=h.value).video&&h.video.closedCaptions)for(var k=r((h=h.video).closedCaptions.keys()),l=k.next();!l.done;l=k.next())if(l=l.value,!f.has(l)){var m={id:b.Cc++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",codecs:"",kind:"caption",encrypted:!1,keyId:null,language:h.closedCaptions.get(l),label:null,type:"text",primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:h.roles,channelsCount:null,closedCaptions:null};f.set(l,m)}for(g=(f=r(f.values())).next();!g.done;g=f.next())e.textStreams.push(g.value)}}(e,e.c.periods),e.vb=new mg(e.b.preferredAudioLanguage,e.b.preferredVariantRole,e.b.preferredAudioChannelCount),e.P=e.b.preferredTextLanguage,e.$=e.b.preferredTextRole,function bj(b,c,d){0<c&&(b.ba()||b.od(c)),d<b.T()&&(b.ba()||b.la(d))}(e.c.presentationTimeline,e.b.playRangeStart,e.b.playRangeEnd),u(g,e.g.zb(m),9);case 9:if(h)throw h;return e.i.init((function(b,c,d){c=void 0!==c&&c,d=void 0===d?0:d,cj(e,e.c.periods[K.Hd(e.c,b)],b,!0),e.a&&(eh(e.a,b,c,d),dj(e))})),e.s||(e.s=Ui(e)),e.h=new Hg(e.f,e.c.presentationTimeline,e.c.minBufferTime||0,e.b.streaming,c,e.We.bind(e),e.ub.bind(e)),e.oa=function ej(b){var c=new Ag(b.c);!function Bg(b,c){b.b=c}(c,(function(){mj(b)}));var d=new Og(b.R);!function Sg(b,c,d,e){b.a=c,b.b=d,b.c=e}(d,(function(c){Xi(b,"timelineregionenter",c)}),(function(c){Xi(b,"timelineregionexit",c)}),(function(c,d){d||(Xi(b,"timelineregionenter",c),Xi(b,"timelineregionexit",c))}));var e=new rg(Math.max(b.c.minBufferTime,b.b.streaming.rebufferingGoal),(function(c){return Sc(b.f.buffered,c)}),(function(){var c;a:if((c=b.f.ended)||(c=b.s,c=!c.g||"ended"==c.g.readyState),c)c=!0;else{if(b.c.presentationTimeline.ba()&&(c=b.c.presentationTimeline.Ta(),Qc(b.f.buffered)>=c)){c=!0;break a}c=!1}return c}));!function ug(b,c,d){b.b=c,b.a=d}(e,(function(){return kj(b,!0)}),(function(){return kj(b,!1)}));var f=new pg(b.f);return f.a.add(c),f.a.add(d),f.a.add(e),f}(e),e.a=function fj(b){return new Tg(b.c,{va:function(){return Kg(b.h)},J:b.s,Xa:b.C,Zc:b.je.bind(b),Yc:b.Bd.bind(b),onError:b.La.bind(b),onEvent:b.ub.bind(b),le:b.me.bind(b),ob:b.te.bind(b)})}(e),e.a.configure(e.b.streaming),function gj(b){function c(b){var c="";b.video&&(c=Qb(b.video.codecs)[0]);var d="";return b.audio&&(d=Qb(b.audio.codecs)[0]),c+"-"+d}var d=b.c.periods.reduce((function(b,c){return b.concat(c.variants)}),[]);d=K.Mc(d,b.b.preferredAudioChannelCount);var e=new pb;d.forEach((function(b){var d=c(b);e.push(d,b)}));var f=null,g=1/0;e.forEach((function(b,c){var d=0,e=0;c.forEach((function(b){d+=b.bandwidth||0,++e}));var h=d/e;h<g&&(f=b,g=h)})),b.c.periods.forEach((function(b){b.variants=b.variants.filter((function(b){return c(b)==f}))}))}(e),e.dispatchEvent(new C("streaming")),u(g,e.a.init((function(){if(e.b.streaming.startAtSegmentBoundary){var b=function hj(b,c){function d(b,c){if(!b)return null;var d=b.findSegmentPosition(c-g.startTime);return null==d?null:(d=b.getSegmentReference(d))?d.startTime+g.startTime:null}var e=Xg(b.a),f=Zg(b.a),g=ij(b);return e=d(e,c),null!=(f=d(f,c))&&null!=e||null!=f?f:null!=e?e:c}(e,Kg(e.h));return Eg(e.h.b,b),b}})),10);case 10:if(h)throw h;if(e.c.periods.forEach(e.Vb.bind(e)),dj(e),(da=ij(e)).variants.some((function(b){return b.primary})),jj(e,da.variants),kj(e,!0),Hb(e.o,m,"loadeddata",(function(){e.l.f=Date.now()/1e3})),h)throw h;e.na=null,sa(g,0);break;case 2:return na=ta(g),k.resolve(),e.na==l&&(e.na=null,e.dispatchEvent(new C("unloading"))),g.return(Promise.reject(h||na))}}))}))},W.prototype.load=W.prototype.load,W.prototype.configure=function(b,c){if(2==arguments.length&&"string"==typeof b){for(var d=b,e={},f=e,g=0,h=0;!(0>(g=d.indexOf(".",g)));)0!=g&&"\\"==d[g-1]||(f[h=d.substring(h,g).replace(/\\\./g,".")]={},f=f[h],h=g+1),g+=1;f[d.substring(h).replace(/\\\./g,".")]=c,b=e}return d=Gi(this.b,b,Oi(this)),nj(this),d},W.prototype.configure=W.prototype.configure,W.prototype.getConfiguration=function(){var b=Oi(this);return Gi(b,this.b,Oi(this)),b},W.prototype.getConfiguration=W.prototype.getConfiguration,W.prototype.Me=function(){for(var b in this.b)delete this.b[b];Gi(this.b,Oi(this),Oi(this)),nj(this)},W.prototype.resetConfiguration=W.prototype.Me,W.prototype.Td=function(){return this.f},W.prototype.getMediaElement=W.prototype.Td,W.prototype.Ib=function(){return this.C},W.prototype.getNetworkingEngine=W.prototype.Ib,W.prototype.Ld=function(){return this.cb},W.prototype.getAssetUri=W.prototype.Ld,W.prototype.Sd=function(){return Re("getManifestUri",'Please use "getAssetUri" instead.'),this.cb},W.prototype.getManifestUri=W.prototype.Sd,W.prototype.ba=function(){return this.c?this.c.presentationTimeline.ba():null},W.prototype.isLive=W.prototype.ba,W.prototype.Ia=function(){return!!this.c&&this.c.presentationTimeline.Ia()},W.prototype.isInProgress=W.prototype.Ia,W.prototype.ee=function(){if(!this.c||!this.c.periods.length)return!1;var b=this.c.periods[0].variants;return!!b.length&&!b[0].video},W.prototype.isAudioOnly=W.prototype.ee,W.prototype.Oe=function(){var b=0,c=0;return this.c&&(b=(c=this.c.presentationTimeline).Sa(),c=c.qa()),{start:b,end:c}},W.prototype.seekRange=W.prototype.Oe,W.prototype.keySystem=function(){return this.g?this.g.keySystem():""},W.prototype.keySystem=W.prototype.keySystem,W.prototype.drmInfo=function(){return this.g?this.g.a:null},W.prototype.drmInfo=W.prototype.drmInfo,W.prototype.Hb=function(){return this.g?this.g.Hb():1/0},W.prototype.getExpiration=W.prototype.Hb,W.prototype.fe=function(){return this.eb},W.prototype.isBuffering=W.prototype.fe,W.prototype.tc=function(b){var c=this;return t((function e(){return v(e,(function(e){switch(e.j){case 1:return c.fb.a?e.return():(void 0===b&&(b=!0),c.dispatchEvent(new C("unloading")),u(e,function Qi(b){if(!b.na)return Promise.resolve();var c=Promise.resolve();return b.m&&(c=b.m.stop(),b.m=null),Promise.all([c,b.na()])}(c),2));case 2:return c.yb||(c.yb=function pj(b){b.o&&(b.o.ua(b.f,"loadeddata"),b.o.ua(b.f,"playing"),b.o.ua(b.f,"pause"),b.o.ua(b.f,"ended")),b.oa&&(b.oa.O(),b.oa=null),b.h&&(b.h.O(),b.h=null);var c=b.g,d=Promise.all([b.i?b.i.stop():null,b.s?b.s.destroy():null,b.a?b.a.destroy():null,b.m?b.m.stop():null]).then((function(){return c?c.destroy():null}));return b.R&&(b.R.O(),b.R=null),b.Qa=!0,b.g=null,b.s=null,b.a=null,b.m=null,b.c=null,b.cb=null,b.w.a.clear(),b.wb.clear(),b.l=null,d}(c).then((function(){c.yb=null}))),u(e,c.yb,3);case 3:if(b)return c.s=Ui(c),u(e,c.s.o,0);e.A(0)}}))}))},W.prototype.unload=W.prototype.tc,W.prototype.hb=function(){return this.h?this.h.hb():0},W.prototype.getPlaybackRate=W.prototype.hb,W.prototype.af=function(b){this.h&&Gg(this.h.b,b),this.a&&ch(this.a,1!=b)},W.prototype.trickPlay=W.prototype.af,W.prototype.Cd=function(){this.h&&Gg(this.h.b,1),this.a&&ch(this.a,!1)},W.prototype.cancelTrickPlay=W.prototype.Cd,W.prototype.ae=function(){for(var b=qj(this),c=[],d=r(rj(this)),e=d.next();!e.done;e=d.next()){e=e.value;var f=K.vc(e);f.active=e==b,c.push(f)}return c},W.prototype.getVariantTracks=W.prototype.ae,W.prototype.getVideoTracks=function(){return this.a&&this.c?[{id:"main",active:!0,type:"video",representations:ij(this).variants.reduce((function(b,c){var d=c.bandwidth,e=c.video,f=e.bandwidth,g=e.codecs,h=e.frameRate,k=e.height,l=e.id,m=e.mimeType;return e=e.width,b.Uc[l]||(b.sd.push({bandwidth:f||d,muxedWithOtherContent:!f&&!!d,codecs:g,frameRate:h,height:k,id:l,mimeType:m,scanType:"progressive",width:e}),b.Uc[l]=!0),b}),{Uc:{},sd:[]}).sd}]:[]},W.prototype.getVideoTracks=W.prototype.getVideoTracks,W.prototype.Rc=function(){var b=ij(this);if(null==b)b=null;else{if(!fg(this.w,b).text){var c=K.Db(b.textStreams,this.P,this.$);c.length&&(c=c[0],fg(this.w,b).text=c)}b=fg(this.w,b).text}c=[];for(var d=r(sj(this)),e=d.next();!e.done;e=d.next()){e=e.value;var f=K.qc(e);f.active=e==b,c.push(f)}return c},W.prototype.getTextTracks=W.prototype.Rc,W.prototype.kd=function(b){var c=ij(this);null!=c&&(b=K.Id(c,b))&&(fg(this.w,c).text=b,Li(this.l.a,b,!1),tj(this,b),this.P=b.language)},W.prototype.selectTextTrack=W.prototype.kd,W.prototype.Qe=function(){Re("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var b=this.Rc().filter((function(b){return"application/cea-608"==b.mimeType}));0<b.length&&this.kd(b[0])},W.prototype.selectEmbeddedTextTrack=W.prototype.Qe,W.prototype.ff=function(){Re("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var b=this.a?Yg(this.a,"text"):null;return null!=b&&"application/cea-608"==b.mimeType},W.prototype.usingEmbeddedTextTrack=W.prototype.ff,W.prototype.Se=function(b,c,d){d=void 0===d?0:d;var e=ij(this);null!=e&&(this.b.abr.enabled&&Ma("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack()."),(b=K.Jd(e,b))&&K.Ua(b)&&(cj(this,e,b,!1),uj(this,b,c,d),this.vb=new lg(b),jj(this,e.variants)))},W.prototype.selectVariantTrack=W.prototype.Se,W.prototype.Nd=function(){for(var b=[],c=r(rj(this)),d=c.next();!d.done;d=c.next())b.push(d.value.audio);return vj(b)},W.prototype.getAudioLanguagesAndRoles=W.prototype.Nd,W.prototype.Zd=function(){return vj(sj(this))},W.prototype.getTextLanguagesAndRoles=W.prototype.Zd,W.prototype.Md=function(){for(var b=[],c=r(rj(this)),d=c.next();!d.done;d=c.next())b.push(d.value.audio);return Array.from(wj(b))},W.prototype.getAudioLanguages=W.prototype.Md,W.prototype.Yd=function(){return Array.from(wj(sj(this)))},W.prototype.getTextLanguages=W.prototype.Yd,W.prototype.Pe=function(b,c){var d=ij(this);null!=d&&(this.vb=new mg(b,c||"",0),oj(this,d))},W.prototype.selectAudioLanguage=W.prototype.Pe,W.prototype.Re=function(b,c){var d=ij(this);null!=d&&(this.P=b,this.$=c||"",oj(this,d))},W.prototype.selectTextLanguage=W.prototype.Re,W.prototype.ge=function(){return this.V},W.prototype.isTextTrackVisible=W.prototype.ge,W.prototype.md=function(b){var c=this;return t((function e(){var f,g,h,k;return v(e,(function(e){switch(e.j){case 1:if(b==c.V)return e.return();if(c.s&&c.s.l.setTextVisibility(b),c.V=b,xj(c),c.b.streaming.alwaysStreamText||!c.a)return e.return();if(f=K,b){if(g=ij(c),h=f.Db(g.textStreams,c.P,c.$),k=h[0])return u(e,$g(c.a,k),0)}else{var l=c.a;l.F=!0;var n=l.b.get("text");n&&(Ug(n),l.b.delete("text"))}e.A(0)}}))}))},W.prototype.setTextTrackVisibility=W.prototype.md,W.prototype.Vd=function(){return this.c?new Date(1e3*this.c.presentationTimeline.f+1e3*this.f.currentTime):null},W.prototype.getPlayheadTimeAsDate=W.prototype.Vd,W.prototype.Xd=function(){return this.c?new Date(1e3*this.c.presentationTimeline.f):null},W.prototype.getPresentationStartTimeAsDate=W.prototype.Xd,W.prototype.Wb=function(){return this.s?this.s.Wb():{total:[],audio:[],video:[],text:[]}},W.prototype.getBufferedInfo=W.prototype.Wb,W.prototype.getStats=function(){if(null==this.l)return{variantVideoId:NaN,width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,bufferingTime:NaN,switchHistory:[],stateHistory:[]};Ni(this.l,this.eb),Zi(this);var b=this.f;if(b.getVideoPlaybackQuality){b=b.getVideoPlaybackQuality();var c=this.l,d=Number(b.totalVideoFrames);c.s=Number(b.droppedVideoFrames),c.o=d}if((b=qj(this))&&(this.l.w=b.bandwidth),b&&b.video){c=this.l,d=b.video.height||NaN;var e=b.video.id;c.F=b.video.width||NaN,c.l=d,c.C=e}this.i&&(b=this.i.getBandwidthEstimate(),this.l.i=b),c=(b=this.l).C,d=b.F,e=b.l;for(var f=b.w,g=b.o,h=b.s,k=b.i,l=b.f>b.g?b.f-b.g:NaN,m=b.h,n=b.b,q=[],x=r(b.a.a),w=x.next();!w.done;w=x.next())w=w.value,q.push({timestamp:w.timestamp,id:w.id,type:w.type,fromAdaptation:w.fromAdaptation,bandwidth:w.bandwidth});return{variantVideoId:c,width:d,height:e,streamBandwidth:f,decodedFrames:g,droppedFrames:h,estimatedBandwidth:k,loadLatency:l,playTime:m,bufferingTime:n,switchHistory:q,stateHistory:Ii(b.m)}},W.prototype.getStats=W.prototype.getStats,W.prototype.addTextTrack=function(b,c,d,e,f,g){var h=ij(this);if(null==h)return Promise.reject();var k=this.c.periods.indexOf(h)+1,l=(k>=this.c.periods.length?this.c.presentationTimeline.T():this.c.periods[k].startTime)-h.startTime;if(1/0==l)return Promise.reject(new A(1,4,4033));var m={id:this.Cc++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(c){return 1!=c?null:new N(1,0,l,(function(){return[b]}),0,null)},initSegmentReference:null,presentationTimeOffset:0,mimeType:e,codecs:f||"",kind:d,encrypted:!1,keyId:null,language:c,label:g||null,type:"text",primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null};return this.wb.add(m),h.textStreams.push(m),$g(this.a,m).then(function(){if(!this.fb.a){var b=Yg(this.a,"text");return b&&(fg(this.w,h).text=b),this.wb.delete(m),oj(this,h),mj(this),{id:m.id,active:!1,type:"text",bandwidth:0,language:c,label:g||null,kind:d,width:null,height:null}}}.bind(this))},W.prototype.addTextTrack=W.prototype.addTextTrack,W.prototype.Ve=function(b,c){this.xb.width=b,this.xb.height=c},W.prototype.setMaxHardwareResolution=W.prototype.Ve,W.prototype.nc=function(){if(this.a){var b=this.a;if(b.f)b=!1;else if(b.m)b=!1;else{for(var c=r(b.b.values()),d=c.next();!d.done;d=c.next())(d=d.value).kb&&(d.kb=!1,bh(b,d,.1));b=!0}}else b=!1;return b},W.prototype.retryStreaming=W.prototype.nc,W.prototype.Rd=function(){return this.c},W.prototype.getManifest=W.prototype.Rd,(p=W.prototype).Kc=function(b){var c=this.a?Xg(this.a):null,d=this.a?Zg(this.a):null;if(b.forEach(K.filterNewPeriod.bind(null,this.g,c,d)),0==(c=function ub(b,c){var d=0;return b.forEach((function(b){d+=c(b)?1:0})),d}(b,(function(b){return b.variants.some(K.Ua)}))))throw new A(2,4,4032);if(c<b.length)throw new A(2,4,4011);b.forEach(function(b){K.Dc(b.variants,this.b.restrictions,this.xb)&&this.a&&ij(this)==b&&mj(this),Aj(this,b.variants)}.bind(this))},p.Vb=function(b){var c=this.a?Xg(this.a):null,d=this.a?Zg(this.a):null;if(K.filterNewPeriod(this.g,c,d,b),!(c=b.variants).some(K.Ua))throw new A(2,4,4011);if(Aj(this,b.variants),K.Dc(c,this.b.restrictions,this.xb)&&this.a&&ij(this)==b&&mj(this),b=this.g?this.g.a:null)for(d=(c=r(c)).next();!d.done;d=c.next())for(var e=(d=r(d.value.drmInfos)).next();!e.done;e=d.next())if((e=e.value).keySystem==b.keySystem)for(var f=(e=r(e.initData||[])).next();!f.done;f=e.next())(f=f.value).initData&&tc(this.g,f.initDataType,f.initData)},p.We=function(){this.oa&&qg(this.oa,!0),this.a&&function ih(b){var c=b.a.va(),d=b.g.smallGapLimit;Array.from(b.b.keys()).every((function(e){var f=b.a.J;return"text"==e?(e=f.a,e=c>=e.a&&c<e.b):e=Rc(e=od(f,e),c,d),e}))||(b.b.forEach((function(b){b.mb=!0})),gh(b))}(this.a)},p.je=function(b){try{this.Qa=!0,this.i.disable();var c=jj(this,b.variants),d=K.Db(b.textStreams,this.P,this.$)[0]||null;if(this.L&&(b.variants.includes(this.L)&&(c=this.L),this.L=null),this.F&&(b.textStreams.includes(this.F)&&(d=this.F),this.F=null),c&&cj(this,b,c,!0),d){var e=d;fg(this.w,b).text=e,Li(this.l.a,e,!0)}var f=this.a,g=f.b.get("video");if(g)var h=f.c.periods[g.xa];else{var k=f.b.get("audio");h=k?f.c.periods[k.xa]:null}var m,l=c?c.audio:null;if(m=!h&&l&&d){b=d;var n=J(this.b.preferredTextLanguage);J(l.language);var q=J(b.language);l=n,q=J(q),l=J(l),m=q.split("-")[0]==l.split("-")[0]}return m&&(this.md(!0),xj(this)),this.b.streaming.alwaysStreamText||this.V?{variant:c,text:d}:{variant:c,text:null}}catch(x){return this.La(x),{variant:null,text:null}}},p.Bd=function(){this.Qa=!1,this.b.abr.enabled&&this.i.enable(),this.L&&(eh(this.a,this.L,this.zc,this.yc),this.L=null),this.F&&(dh(this.a,this.F,!0,0),this.F=null)},p.me=function(){this.m&&this.m.update&&this.m.update()},p.te=function(){this.h&&this.h.ob()},p.La=function(b){if(!this.fb.a){var c=new C("error",{detail:b});this.dispatchEvent(c),c.defaultPrevented&&(b.handled=!0)}},p.ub=function(b){this.dispatchEvent(b)},p.ve=function(){if(this.f.error){var b=this.f.error.code;if(1!=b){var c=this.f.error.msExtendedCode;c&&(0>c&&(c+=Math.pow(2,32)),c=c.toString(16)),this.La(new A(2,3,3016,b,c,this.f.error.message))}}},p.va=function(){return null==this.h?null:Kg(this.h)},W.prototype.getPresentationTime=W.prototype.va,Mj.prototype.add=function(b){Pj(this,b)||this.a.push(b)},y("veygo.offline.Storage",Y),Y.support=Sj,Y.setDbName=function(b){li=b},Y.prototype.destroy=function(){return this.h.destroy()},Y.prototype.destroy=Y.prototype.destroy,Y.prototype.configure=function(b){var c=!1;return null!=b.trackSelectionCallback&&(c=!0,b.offline=b.offline||{},b.offline.trackSelectionCallback=b.trackSelectionCallback),null!=b.progressCallback&&(c=!0,b.offline=b.offline||{},b.offline.progressCallback=b.progressCallback),null!=b.usePersistentLicense&&(c=!0,b.offline=b.offline||{},b.offline.usePersistentLicense=b.usePersistentLicense),c&&Re("Storage.configure with OfflineConfig","Please configure storage with a player configuration."),Gi(this.a,b)},Y.prototype.configure=Y.prototype.configure,Y.prototype.Ib=function(){return this.b},Y.prototype.getNetworkingEngine=Y.prototype.Ib,Y.prototype.store=function(b,c,d){var e=this;return Tj(this,function Uj(b,c,d,e){return t((function g(){var h,l,m,n,q,x,w,D,G;return v(g,(function(g){switch(g.j){case 1:return Vj(),b.g?g.return(Promise.reject(new A(2,9,9006))):(b.g=!0,u(g,function Wj(b,c,d){return t((function f(){var g,h,k,l,m,n;return v(f,(function(f){switch(f.j){case 1:return g=null,h=b.b,k={networkingEngine:h,filter:function(){},filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(b){g=b}},u(f,d(),2);case 2:return(l=f.u).configure(b.a.manifest),Xj(b),ra(f,3),u(f,l.start(c,k),5);case 5:return m=f.u,Xj(b),n=lk(m),u(f,Promise.all(Array.from(n).map((function(b){return b.createSegmentIndex()}))),6);case 6:if(Xj(b),g)throw g;return f.return(m);case 3:return ua(f),u(f,l.stop(),7);case 7:va(f,0)}}))}))}(b,c,e),2));case 2:if(h=g.u,Xj(b),!(!h.presentationTimeline.ba()&&!h.presentationTimeline.Ia()))throw new A(2,9,9005,c);return l=null,m=new Nh,q=n=null,qa(g,3,4),u(g,function Yj(b,c,d){return t((function f(){var g,h,k;return v(f,(function(f){switch(f.j){case 1:return g=new cc({Xa:b.b,onError:d,ic:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),h=K.Qc(c),k=b.a,g.configure(k.drm),u(f,function hc(b,c,d){return b.o=[],b.C=d,ic(b,c)}(g,h,k.offline.usePersistentLicense),2);case 2:return u(f,rc(g),3);case 3:return u(f,sc(g),4);case 4:return f.return(g)}}))}))}(b,h,(function(b){q=q||b})),6);case 6:if(l=g.u,Xj(b),q)throw q;return function Zj(b,c,d){(function Ij(b,c){for(var d={width:1/0,height:1/0},e=r(b.periods),f=e.next();!f.done;f=e.next())(f=f.value).variants=f.variants.filter((function(b){return K.Kb(b,c,d)}))})(c,b.a.restrictions),function Jj(b){for(var c=(b=r(b.periods)).next();!c.done;c=b.next())(c=c.value).variants=c.variants.filter((function(b){var c=!0;return b.audio&&(c=c&&kd(b.audio)),b.video&&(c=c&&kd(b.video)),c}))}(c),function Kj(b,c){for(var d=r(b.periods),e=d.next();!e.done;e=d.next())(e=e.value).variants=e.variants.filter((function(b){return Lc(c,b)}))}(c,d),Lj(c),function Rj(b,c){var d=new Mj;b.periods.forEach((function(b,f){0<f&&(b.variants=b.variants.filter((function(b){return Pj(d,new Qj(b))}))),c(b),d=Nj(b.variants)}))}(c,(function(c){for(var d=[],e=r(c.variants),h=e.next();!h.done;h=e.next())d.push(K.vc(h.value));for(h=(e=r(c.textStreams)).next();!h.done;h=e.next())d.push(K.qc(h.value));d=b.a.offline.trackSelectionCallback(d);var k=new Set,l=new Set;for(e=(d=r(d)).next();!e.done;e=d.next())"variant"==(e=e.value).type&&k.add(e.id),"text"==e.type&&l.add(e.id);c.variants=c.variants.filter((function(b){return k.has(b.id)})),c.textStreams=c.textStreams.filter((function(b){return l.has(b.id)}))})),function bk(b){if(0==b.periods.length)throw new A(2,4,4014);for(var c=(b=r(b.periods)).next();!c.done;c=b.next())qk(c.value)}(c)}(b,h,l),u(g,m.init(),7);case 7:return Xj(b),u(g,function Ph(b){var c=null;if(b.a.forEach((function(b,e){b.getCells().forEach((function(b,d){b.hasFixedKeySpace()||c||(c={path:{ja:e,W:d},W:b})}))})),c)return c;throw new A(2,9,9013,"Could not find a cell that supports add-operations")}(m),8);case 8:return n=g.u,Xj(b),u(g,function ak(b,c,d,e,f,g){return t((function k(){var l,m,n,q;return v(k,(function(k){switch(k.j){case 1:return l=function Cj(b,c,d){var e=null==c.expiration?1/0:c.expiration;return{offlineUri:null,originalManifestUri:b,duration:c.presentationTimeline.T(),size:0,expiration:e,tracks:c=Dj(c.periods[0]),appMetadata:d}}(f,e,g),(m=new Ch(b.b,(function(b,c){l.size=c}))).i=l,ra(k,2),q=n=function ck(b,c,d,e,f,g,h){var k=new Fj,l=f.periods.map((function(e){return function mk(b,c,d,e,f,g){f.periods.forEach((function(b){b.variants.forEach((function(b){var c=b.audio,d=b.video;if(c&&!d&&(e.a[c.id]=c.bandwidth||b.bandwidth),!c&&d&&(e.a[d.id]=d.bandwidth||b.bandwidth),c&&d){var f=c.bandwidth||393216,g=d.bandwidth||b.bandwidth-f;0>=g&&(g=b.bandwidth),e.a[c.id]=f,e.a[d.id]=g}})),b.textStreams.forEach((function(b){e.a[b.id]=52}))}));for(var h=lk(f),k=new Map,l=(h=r(h)).next();!l.done;l=h.next()){l=l.value;var m=nk(b,c,d,e,f,l);k.set(l.id,m)}return g.variants.forEach((function(b){b.audio&&k.get(b.audio.id).variantIds.push(b.id),b.video&&k.get(b.video.id).variantIds.push(b.id)})),{startTime:g.startTime,streams:Array.from(k.values())}}(b,c,d,k,f,e)})),m=e.a,n=yc(e);if(m&&b.a.offline.usePersistentLicense){if(!n.length)throw new A(2,9,9007,g);m.initData=[]}return{originalManifestUri:g,duration:f.presentationTimeline.T(),size:0,expiration:e.Hb(),periods:l,sessionIds:b.a.offline.usePersistentLicense?n:[],drmInfo:m,appMetadata:h}}(b,m,c,d,e,f,g),u(k,function Fh(b){return t((function d(){return v(d,(function(d){switch(d.j){case 1:return u(d,Promise.all(b.c.values()),2);case 2:return d.return(b.a)}}))}))}(m),4);case 4:return q.size=k.u,k.return(n);case 2:return ua(k),u(k,m.destroy(),5);case 5:va(k,0)}}))}))}(b,n.W,l,h,c,d),9);case 9:if(x=g.u,Xj(b),q)throw q;return u(g,n.W.addManifests([x]),10);case 10:return w=g.u,Xj(b),D=new ni("manifest",n.path.ja,n.path.W,w[0]),g.return(Ej(D,x));case 4:return ua(g),b.g=!1,b.c=[],u(g,m.destroy(),11);case 11:if(!l){g.A(12);break}return u(g,l.destroy(),12);case 12:va(g,0);break;case 3:if(G=ta(g),!n){g.A(14);break}return u(g,n.W.removeSegments(b.c,(function(){})),14);case 14:throw q||G}}))}))}(this,b,c||{},(function(){return t((function g(){var c,k;return v(g,(function(g){switch(g.j){case 1:return d&&"string"!=typeof d?(Re("Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),c=d,g.return(new c)):u(g,ze(b,e.b,e.a.manifest.retryParameters,d),2);case 2:return k=g.u,g.return(k)}}))}))})))},Y.prototype.store=Y.prototype.store,Y.prototype.remove=function(b){return Tj(this,function dk(b,c){Vj();var d=oi(c);if(null==d||"manifest"!=d.a)return Promise.reject(new A(2,9,9004,c));var e=new Nh;return xi([e],(function(){return t((function g(){var c,k,l;return v(g,(function(g){switch(g.j){case 1:return u(g,e.init(),2);case 2:return u(g,Rh(e,d.ja(),d.W()),3);case 3:return u(g,(c=g.u).getManifests([d.key()]),4);case 4:return k=g.u,l=k[0],u(g,Promise.all([ek(b,l,e),fk(b,c,d,l)]),0)}}))}))}))}(this,b))},Y.prototype.remove=Y.prototype.remove,Y.prototype.Je=function(){return Tj(this,function jk(b){Vj();var c=b.b,d=b.a.drm,e=new Nh;return xi([e],(function(){return t((function g(){var b,k,l,m,n,q,x;return v(g,(function(g){switch(g.j){case 1:return u(g,e.init(),2);case 2:b=!1,k=[],function Sh(b,c){b.a.forEach((function(b){c(b.getEmeSessionCell())}))}(e,(function(b){return k.push(b)})),l=r(k),m=l.next();case 3:if(m.done){g.A(5);break}return u(g,(n=m.value).getAll(),6);case 6:return q=g.u,u(g,Ai(d,c,q),7);case 7:return x=g.u,u(g,n.remove(x),8);case 8:x.length!=q.length&&(b=!0),m=l.next(),g.A(3);break;case 5:return g.return(!b)}}))}))}))}(this))},Y.prototype.removeEmeSessions=Y.prototype.Je,Y.prototype.list=function(){return Tj(this,function kk(){function b(b,d){return t((function h(){return v(h,(function(f){switch(f.j){case 1:return u(f,d.getAllManifests(),2);case 2:f.u.forEach((function(d,e){var f=Ej(new ni("manifest",b.ja,b.W,e),d);c.push(f)})),f.j=0}}))}))}Vj();var c=[],d=new Nh;return xi([d],(function(){return t((function f(){var c;return v(f,(function(f){switch(f.j){case 1:return u(f,d.init(),2);case 2:return c=Promise.resolve(),function Qh(b,c){b.a.forEach((function(b,e){b.getCells().forEach((function(b,d){c({ja:e,W:d},b)}))}))}(d,(function(d,f){c=c.then((function(){return b(d,f)}))})),u(f,c,0)}}))}))})).then((function(){return c}))}())},Y.prototype.list=Y.prototype.list,Y.deleteAll=function(){return t((function c(){var d;return v(c,(function(c){switch(c.j){case 1:return d=new Nh,ra(c,2),u(c,d.erase(),2);case 2:return ua(c),u(c,d.destroy(),5);case 5:va(c,0)}}))}))},Ti.offline=Sj,y("veygo.polyfill.installAll",(function(){for(var b=0;b<rk.length;++b)rk[b].Ad()}));var uk,Pk,rk=[];function sk(b,c){for(var d={priority:c=c||0,Ad:b},e=0;e<rk.length;e++)if(rk[e].priority<c)return void rk.splice(e,0,d);rk.push(d)}function tk(b){var c=b.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var d=new Event(c,b);else(d=document.createEvent("Event")).initEvent(c,b.bubbles,b.cancelable);b.target.dispatchEvent(d)}function vk(b,c,d){if("input"==b)switch(this.type){case"range":b="change"}uk.call(this,b,c,d)}function wk(){var b=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e]=arguments[e];return(d=b.apply(this,d)).abort=function(){},d}}function zk(b){var c=b.target,d=c.mediaSource_;if(d.Vc){for(b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),c.Ic=!0,b=0;b<d.sourceBuffers.length;++b)if(0==d.sourceBuffers[b].Ic)return;d.Vc=!1}}function Ak(b){b=b.target;for(var c=0;c<b.sourceBuffers.length;++c)b.sourceBuffers[c].removeEventListener("updateend",zk,!1);b.removeEventListener("sourceclose",Ak,!1)}function Ek(b){this.f=[],this.b=[],this.a=[],(new P).aa("pssh",this.c.bind(this)).parse(b.buffer)}function Fk(b,c){try{var d=new Gk(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}function Gk(b,c){this.keySystem=b;for(var d=!1,e=0;e<c.length;++e){var f=c[e],g={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:f.initDataTypes,sessionTypes:["temporary"],label:f.label},h=!1;if(f.audioCapabilities)for(var k=0;k<f.audioCapabilities.length;++k){var l=f.audioCapabilities[k];if(l.contentType){h=!0;var m=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,m)&&(g.audioCapabilities.push(l),d=!0)}}if(f.videoCapabilities)for(k=0;k<f.videoCapabilities.length;++k)(l=f.videoCapabilities[k]).contentType&&(h=!0,m=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(g.videoCapabilities.push(l),d=!0));if(h||(d=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==f.persistentState&&(d=!1),d)return void(this.a=g)}throw(d=Error("Unsupported keySystem")).name="NotSupportedError",d.code=DOMException.NOT_SUPPORTED_ERR,d}function Ik(b){var c=this.mediaKeys;return c&&c!=b&&Jk(c,null),delete this.mediaKeys,(this.mediaKeys=b)?Jk(b,this):Promise.resolve()}function Hk(b){this.a=new MSMediaKeys(b),this.b=new Eb}function Jk(b,c){if(Fb(b.b),!c)return Promise.resolve();F(b.b,c,"msneedkey",Lk);var e=b;try{return 1<=c.readyState?c.msSetMediaKeys(b.a):c.addEventListener("loadedmetadata",(function d(){c.msSetMediaKeys(e.a),c.removeEventListener("loadedmetadata",d)})),Promise.resolve()}catch(f){return Promise.reject(f)}}function Kk(b){qb.call(this),this.c=null,this.g=b,this.b=this.a=null,this.f=new Eb,this.sessionId="",this.expiration=NaN,this.closed=new z,this.keyStatuses=new Mk}function Lk(b){if(b.initData){var c=document.createEvent("CustomEvent");c.initCustomEvent("encrypted",!1,!1,null),c.initDataType="cenc",c.initData=function Ok(b){if(!b)return b;var c=new Ek(b);if(1>=c.a.length)return b;for(var d=[],e=0;e<c.a.length;e++)d.push(b.subarray(c.a[e].start,c.a[e].end+1));for(b=[],c={},e=r(d),d=e.next();!d.done;c={Jb:c.Jb},d=e.next())c.Jb=d.value,b.some(function(b){return function(c){return ac(c,b.Jb)}}(c))||b.push(c.Jb);for(c=0,e=r(b),d=e.next();!d.done;d=e.next())c+=d.value.length;for(c=new Uint8Array(c),e=0,b=r(b),d=b.next();!d.done;d=b.next())d=d.value,c.set(d,e),e+=d.length;return c}(b.initData),this.dispatchEvent(c)}}function Nk(b,c){var d=b.keyStatuses;d.size=null==c?0:1,d.a=c,b.dispatchEvent(new C("keystatuseschange"))}function Mk(){this.size=0,this.a=void 0}function Qk(){return Promise.reject(Error("The key system specified is not supported."))}function Rk(b){return null==b?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Sk(){throw new TypeError("Illegal constructor.")}function Tk(){throw new TypeError("Illegal constructor.")}y("veygo.polyfill.register",sk),sk((function(){if(window.Document){var b=Element.prototype;b.requestFullscreen=b.requestFullscreen||b.mozRequestFullScreen||b.msRequestFullscreen||b.webkitRequestFullscreen,(b=Document.prototype).exitFullscreen=b.exitFullscreen||b.mozCancelFullScreen||b.msExitFullscreen||b.webkitExitFullscreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",tk),document.addEventListener("webkitfullscreenerror",tk),document.addEventListener("mozfullscreenchange",tk),document.addEventListener("mozfullscreenerror",tk),document.addEventListener("MSFullscreenChange",tk),document.addEventListener("MSFullscreenError",tk)}})),sk((function(){Rb("CrKey")&&delete window.indexedDB})),sk((function(){Rb("Trident/")&&HTMLInputElement.prototype.addEventListener!=vk&&(uk=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=vk)})),sk((function(){})),sk((function(){if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)!function Dk(){var b=MediaSource.isTypeSupported,c=/^dv(?:he|av)\./;MediaSource.isTypeSupported=function(d){for(var e=d.split(/ *; */),f=e[0],g={},h=1;h<e.length;++h){var k=e[h].split("="),l=k[0];k=k[1].replace(/"(.*)"/,"$1"),g[l]=k}if(!(e=g.codecs))return b(d);var m=!1,n=!1;for(var q in d=e.split(",").filter((function(b){return c.test(b)?(n=!0,!1):(/^(hev|hvc)1\.2/.test(b)&&(m=!0),!0)})),n&&(m=!1),g.codecs=d.join(","),m&&(g.eotf="smpte2084"),g)f+="; "+q+'="'+g[q]+'"';return cast.__platform__.canDisplayType(f)}}();else if(navigator.vendor&&navigator.vendor.includes("Apple")){var b=navigator.appVersion;!function Bk(){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return"mp2t"!=c.split(/ *; */)[0].split("/")[1]&&b(c)}}(),b.includes("Version/8")?window.MediaSource=null:b.includes("Version/9")?wk():b.includes("Version/10")?(wk(),function yk(){var b=MediaSource.prototype.endOfStream;MediaSource.prototype.endOfStream=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e]=arguments[e];for(var h=e=0;h<this.sourceBuffers.length;++h){var k=this.sourceBuffers[h];k=k.buffered.end(k.buffered.length-1),e=Math.max(e,k)}if(!isNaN(this.duration)&&e<this.duration)for(this.Vc=!0,e=0;e<this.sourceBuffers.length;++e)this.sourceBuffers[e].Ic=!1;return b.apply(this,d)};var c=!1,d=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(b){for(var e=[],g=0;g<arguments.length;++g)e[g]=arguments[g];return(e=d.apply(this,e)).mediaSource_=this,e.addEventListener("updateend",zk,!1),c||(this.addEventListener("sourceclose",Ak,!1),c=!0),e}}()):(b.includes("Version/11")||b.includes("Version/12"))&&(wk(),function xk(){var b=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(c,d){return b.call(this,c,d-.001)}}())}else Rb("Tizen")&&function Ck(){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return"opus"!=Qb(c)[0]&&b(c)}}()})),Ek.prototype.c=function(b){if(!(1<b.version)){var c=$b(b.reader.Ka(16)),d=[];if(0<b.version)for(var e=b.reader.B(),f=0;f<e;++f){var g=$b(b.reader.Ka(16));d.push(g)}e=b.reader.B(),b.reader.I(e),this.b.push.apply(this.b,d),this.f.push(c),this.a.push({start:b.start,end:b.start+b.size-1})}},Gk.prototype.createMediaKeys=function(){var b=new Hk(this.keySystem);return Promise.resolve(b)},Gk.prototype.getConfiguration=function(){return this.a},Hk.prototype.createSession=function(b){if("temporary"!=(b=b||"temporary"))throw new TypeError("Session type "+b+" is unsupported on this platform.");return new Kk(this.a,b)},Hk.prototype.setServerCertificate=function(){return Promise.resolve(!1)},Ga(Kk,qb),(p=Kk.prototype).generateRequest=function(b,c){this.a=new z;try{this.c=this.g.createSession("video/mp4",new Uint8Array(c),null),F(this.f,this.c,"mskeymessage",this.pe.bind(this)),F(this.f,this.c,"mskeyadded",this.ne.bind(this)),F(this.f,this.c,"mskeyerror",this.oe.bind(this)),Nk(this,"status-pending")}catch(d){this.a.reject(d)}return this.a},p.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},p.update=function(b){this.b=new z;try{this.c.update(new Uint8Array(b))}catch(c){this.b.reject(c)}return this.b},p.close=function(){try{this.c.close(),this.closed.resolve(),Fb(this.f)}catch(b){this.closed.reject(b)}return this.closed},p.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},p.pe=function(b){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new C("message",{messageType:null==this.keyStatuses.a?"license-request":"license-renewal",message:b.message.buffer}))},p.ne=function(){this.a?(Nk(this,"usable"),this.a.resolve(),this.a=null):this.b&&(Nk(this,"usable"),this.b.resolve(),this.b=null)},p.oe=function(){var b=Error("EME PatchedMediaKeysMs key error");if(b.errorCode=this.c.error,null!=this.a)this.a.reject(b),this.a=null;else if(null!=this.b)this.b.reject(b),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Nk(this,"output-not-allowed");break;default:Nk(this,"internal-error")}},(p=Mk.prototype).forEach=function(b){this.a&&b(this.a,Pk)},p.get=function(b){if(this.has(b))return this.a},p.has=function(b){var c=Pk;return!(!this.a||!ac(new Uint8Array(b),new Uint8Array(c)))},p.entries=function(){},p.keys=function(){},p.values=function(){},sk((function(){!window.HTMLVideoElement||!window.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Pk=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ik,window.MediaKeys=Hk,window.MediaKeySystemAccess=Gk,navigator.requestMediaKeySystemAccess=Fk)})),Sk.prototype.createSession=function(){},Sk.prototype.setServerCertificate=function(){},Tk.prototype.getConfiguration=function(){},Tk.prototype.createMediaKeys=function(){},sk((function(){!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=Qk,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Rk,window.MediaKeys=Sk,window.MediaKeySystemAccess=Tk)}),-10);var fl,Uk="";function Vk(b){return Uk?Uk+b.charAt(0).toUpperCase()+b.slice(1):b}function Wk(b,c){try{var d=new Xk(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}function Yk(b){var c=this.mediaKeys;return c&&c!=b&&Zk(c,null),delete this.mediaKeys,(this.mediaKeys=b)&&Zk(b,this),Promise.resolve()}function Xk(b,c){this.a=this.keySystem=b;var d=!1;"org.w3.clearkey"==b&&(this.a="webkit-org.w3.clearkey",d=!1);var e=!1,f=document.getElementsByTagName("video");f=f.length?f[0]:document.createElement("video");for(var g=0;g<c.length;++g){var h=c[g],k={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:h.initDataTypes,sessionTypes:["temporary"],label:h.label},l=!1;if(h.audioCapabilities)for(var m=0;m<h.audioCapabilities.length;++m){var n=h.audioCapabilities[m];if(n.contentType){l=!0;var q=n.contentType.split(";")[0];f.canPlayType(q,this.a)&&(k.audioCapabilities.push(n),e=!0)}}if(h.videoCapabilities)for(m=0;m<h.videoCapabilities.length;++m)(n=h.videoCapabilities[m]).contentType&&(l=!0,f.canPlayType(n.contentType,this.a)&&(k.videoCapabilities.push(n),e=!0));if(l||(e=f.canPlayType("video/mp4",this.a)||f.canPlayType("video/webm",this.a)),"required"==h.persistentState&&(d?(k.persistentState="required",k.sessionTypes=["persistent-license"]):e=!1),e)return void(this.b=k)}throw d="Unsupported keySystem","org.w3.clearkey"!=b&&"com.widevine.alpha"!=b||(d="None of the requested configurations were supported."),(d=Error(d)).name="NotSupportedError",d.code=DOMException.NOT_SUPPORTED_ERR,d}function $k(b){this.g=b,this.b=null,this.a=new Eb,this.c=[],this.f={}}function Zk(b,c){b.b=c,Fb(b.a);var d=Uk;c&&(F(b.a,c,d+"needkey",b.ze.bind(b)),F(b.a,c,d+"keymessage",b.ye.bind(b)),F(b.a,c,d+"keyadded",b.we.bind(b)),F(b.a,c,d+"keyerror",b.xe.bind(b)))}function bl(b,c){var d=b.f[c];return d||((d=b.c.shift())?(d.sessionId=c,b.f[c]=d):null)}function al(b,c,d){qb.call(this),this.f=b,this.h=!1,this.a=this.b=null,this.c=c,this.g=d,this.sessionId="",this.expiration=NaN,this.closed=new z,this.keyStatuses=new dl}function el(b,c,d){if(b.h)return Promise.reject(Error("The session is already initialized."));b.h=!0;try{if("persistent-license"==b.g)if(d)var e=new Uint8Array(Wb("LOAD_SESSION|"+d));else{var f=Wb("PERSISTENT|"),g=new Uint8Array(f.byteLength+c.byteLength);g.set(new Uint8Array(f),0),g.set(new Uint8Array(c),f.byteLength),e=g}else e=new Uint8Array(c)}catch(k){return Promise.reject(k)}b.b=new z;var h=Vk("generateKeyRequest");try{b.f[h](b.c,e)}catch(k){if("InvalidStateError"!=k.name)return b.b=null,Promise.reject(k);setTimeout(function(){try{this.f[h](this.c,e)}catch(l){this.b.reject(l),this.b=null}}.bind(b),10)}return b.b}function cl(b,c){var d=b.keyStatuses;d.size=null==c?0:1,d.a=c,b.dispatchEvent(new C("keystatuseschange"))}function dl(){this.size=0,this.a=void 0}function gl(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function hl(b,c,d){return new window.TextTrackCue(b,c,d)}function il(b,c,d){return new window.TextTrackCue(b+"-"+c+"-"+d,b,c,d)}function id(b,c,d){this.startTime=b,this.direction=jl,this.endTime=c,this.payload=d,this.region=new kl,this.position=null,this.positionAlign=ll,this.size=100,this.textAlign=ml,this.writingMode=nl,this.lineInterpretation=ol,this.line=null,this.lineHeight="",this.lineAlign=pl,this.displayAlign=ql,this.fontSize=this.backgroundColor=this.color="",this.fontWeight=rl,this.fontStyle=sl,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.a=null,this.b=[]}Xk.prototype.createMediaKeys=function(){var b=new $k(this.a);return Promise.resolve(b)},Xk.prototype.getConfiguration=function(){return this.b},(p=$k.prototype).createSession=function(b){if("temporary"!=(b=b||"temporary")&&"persistent-license"!=b)throw new TypeError("Session type "+b+" is unsupported on this platform.");var c=this.b||document.createElement("video");return c.src||(c.src="about:blank"),b=new al(c,this.g,b),this.c.push(b),b},p.setServerCertificate=function(){return Promise.resolve(!1)},p.ze=function(b){var c=document.createEvent("CustomEvent");c.initCustomEvent("encrypted",!1,!1,null),c.initDataType="webm",c.initData=b.initData,this.b.dispatchEvent(c)},p.ye=function(b){var c=bl(this,b.sessionId);c&&(b=new C("message",{messageType:null==c.keyStatuses.a?"licenserequest":"licenserenewal",message:b.message}),c.b&&(c.b.resolve(),c.b=null),c.dispatchEvent(b))},p.we=function(b){(b=bl(this,b.sessionId))&&(cl(b,"usable"),b.a&&b.a.resolve(),b.a=null)},p.xe=function(b){var c=bl(this,b.sessionId);if(c){var d=Error("EME v0.1b key error");d.errorCode=b.errorCode,d.errorCode.systemCode=b.systemCode,!b.sessionId&&c.b?(d.method="generateRequest",45==b.systemCode&&(d.message="Unsupported session type."),c.b.reject(d),c.b=null):b.sessionId&&c.a?(d.method="update",c.a.reject(d),c.a=null):(d=b.systemCode,b.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?cl(c,"output-restricted"):cl(c,1==d?"expired":"internal-error"))}},Ga(al,qb),(p=al.prototype).pc=function(b,c){if(this.a)this.a.then(this.pc.bind(this,b,c)).catch(this.pc.bind(this,b,c));else{if(this.a=b,"webkit-org.w3.clearkey"==this.c){var d=Sb(c),e=JSON.parse(d);"oct"!=e.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),d=Yb(e.keys[0].k),e=Yb(e.keys[0].kid)}else d=new Uint8Array(c),e=null;var f=Vk("addKey");try{this.f[f](this.c,d,e,this.sessionId)}catch(g){this.a.reject(g),this.a=null}}},p.generateRequest=function(b,c){return el(this,c,null)},p.load=function(b){return"persistent-license"==this.g?el(this,null,b):Promise.reject(Error("Not a persistent session."))},p.update=function(b){var c=new z;return this.pc(c,b),c},p.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var b=Vk("cancelKeyRequest");try{this.f[b](this.c,this.sessionId)}catch(c){}}return this.closed.resolve(),this.closed},p.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()},(p=dl.prototype).forEach=function(b){this.a&&b(this.a,fl)},p.get=function(b){if(this.has(b))return this.a},p.has=function(b){var c=fl;return!(!this.a||!ac(new Uint8Array(b),new Uint8Array(c)))},p.entries=function(){},p.keys=function(){},p.values=function(){},sk((function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)Uk="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;fl=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=Wk,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Yk,window.MediaKeys=$k,window.MediaKeySystemAccess=Xk}})),sk((function(){if(window.HTMLVideoElement){var b=HTMLVideoElement.prototype;!b.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in b&&(b.getVideoPlaybackQuality=gl)}})),sk((function(){if(!window.VTTCue&&window.TextTrackCue){var b=TextTrackCue.length;if(3==b)window.VTTCue=hl;else if(6==b)window.VTTCue=il;else{try{var c=!!hl(1,2,"")}catch(d){c=!1}c&&(window.VTTCue=hl)}}})),y("veygo.text.Cue",id);var ll="auto";id.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:ll};var ml="center",tl={LEFT:"left",RIGHT:"right",CENTER:ml,START:"start",END:"end"};id.textAlign=tl;var ql="after",ul={BEFORE:"before",CENTER:"center",AFTER:ql};id.displayAlign=ul;var jl="ltr";id.direction={HORIZONTAL_LEFT_TO_RIGHT:jl,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var nl="horizontal-tb";id.writingMode={HORIZONTAL_TOP_TO_BOTTOM:nl,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var ol=0;id.lineInterpretation={LINE_NUMBER:ol,PERCENTAGE:1};var pl="start",vl={CENTER:"center",START:pl,END:"end"};id.lineAlign=vl;var rl=400;id.fontWeight={NORMAL:rl,BOLD:700};var sl="normal",wl={NORMAL:sl,ITALIC:"italic",OBLIQUE:"oblique"};function kl(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=xl,this.scroll=yl}id.fontStyle=wl,id.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},y("veygo.text.CueRegion",kl);var xl=1;kl.units={PX:0,PERCENTAGE:xl,LINES:2};var yl="";function zl(){}kl.scrollMode={NONE:yl,UP:"up"},zl.prototype.parseInit=function(){},zl.prototype.parseMedia=function(b,c){var d=Sb(b),e=[],f=new DOMParser,g=null;try{g=f.parseFromString(d,"text/xml")}catch(V){throw new A(2,2,2005)}if(g){if(!(f=g.getElementsByTagName("tt")[0]))throw new A(2,2,2005);var h=M.getAttributeNS(f,"http://www.w3.org/ns/ttml#parameter","frameRate"),k=M.getAttributeNS(f,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),l=M.getAttributeNS(f,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),m=M.getAttributeNS(f,"http://www.w3.org/ns/ttml#parameter","tickRate");if("default"!=(d=f.getAttribute("xml:space")||"default")&&"preserve"!=d)throw new A(2,2,2005);for(d="default"==d,h=new Al(h,k,l,m),k={},g=g.getElementsByTagName("smpte:image"),l=0;l<g.length;l++){var n=(m=g.item(l)).getAttribute("xml:id");k[n]=m.childNodes[0].data}for(g=Bl(f.getElementsByTagName("styling")[0]),l=Bl(f.getElementsByTagName("layout")[0]),m=[],n=0;n<l.length;n++){var G,q=l[n],x=g,w=new kl,D=q.getAttribute("xml:id");if(D)w.id=D,(G=Cl(q,x,"extent"))&&(null!=(G=(D=Dl.exec(G))||El.exec(G))&&(w.width=Number(G[1]),w.height=Number(G[2]),w.widthUnits=D?xl:0,w.heightUnits=D?xl:0)),(q=Cl(q,x,"origin"))&&(null!=(G=(D=Dl.exec(q))||El.exec(q))&&(w.viewportAnchorX=Number(G[1]),w.viewportAnchorY=Number(G[2]),w.viewportAnchorUnits=D?xl:0));else w=null;w&&m.push(w)}for(f=Bl(f.getElementsByTagName("body")[0]),n=0;n<f.length;n++)(w=Fl(f[n],c.periodStart,h,g,l,m,d,k))&&e.push(w)}return e};var Dl=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,Gl=/^(\d+px|\d+em|[\d\.]+%)$/,El=/^(\d+)px (\d+)px$/,Hl=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Il=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Jl=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,Kl=/^(\d*(?:\.\d*)?)f$/,Ll=/^(\d*(?:\.\d*)?)t$/,Ml=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,Nl={left:pl,center:"center",right:"end",start:pl,end:"end"},Ol={left:"line-left",center:"center",right:"line-right"};function Bl(b){var c=[];if(!b)return c;for(var d=b.childNodes,e=0;e<d.length;e++){var f="span"==d[e].nodeName&&"p"==b.nodeName;d[e].nodeType!=Node.ELEMENT_NODE||"br"==d[e].nodeName||f||(f=Bl(d[e]),c=c.concat(f))}return c.length||c.push(b),c}function Fl(b,c,d,e,f,g,h,k){if(!b.hasAttribute("begin")&&!b.hasAttribute("end")&&/^\s*$/.test(b.textContent))return null;!function Pl(b,c){for(var d=b.childNodes,e=0;e<d.length;e++)if("br"==d[e].nodeName&&0<e)d[e-1].textContent+="\n";else if(0<d[e].childNodes.length)Pl(d[e],c);else if(c){var f=d[e].textContent.trim();f=f.replace(/\s+/g," "),d[e].textContent=f}}(b,h),h=Ql(b.getAttribute("begin"),d);var l=Ql(b.getAttribute("end"),d);d=Ql(b.getAttribute("dur"),d);var m=b.textContent;if(null==l&&null!=d&&(l=h+d),null==h||null==l)throw new A(2,2,2001);if(c=new id(h+c,l+c,m),(f=Rl(b,"region",f))&&f.getAttribute("xml:id")){var n=f.getAttribute("xml:id");g=g.filter((function(b){return b.id==n})),c.region=g[0]}return function Sl(b,c,d,e){"rtl"==Tl(c,d,e,"direction")&&(b.direction="rtl");var f=[32,15],g=Tl(c,d,e,"writingMode");"tb"==g||"tblr"==g?b.writingMode="vertical-lr":"tbrl"==g?b.writingMode="vertical-rl":"rltb"==g||"rl"==g?b.direction="rtl":g&&(b.direction=jl),(g=Tl(c,d,e,"textAlign"))&&(b.positionAlign=Ol[g],b.lineAlign=Nl[g],b.textAlign=tl[g.toUpperCase()]);(g=Tl(c,d,e,"displayAlign"))&&(b.displayAlign=ul[g.toUpperCase()]);(g=Tl(c,d,e,"tts:padding"))&&(b.b=g.split(" "));(g=Tl(c,d,e,"color"))&&(b.color=g);(g=Tl(c,d,e,"backgroundColor"))&&(b.backgroundColor=g);(g=Tl(c,d,e,"fontFamily"))&&(b.fontFamily=g);if((g=Tl(c,d,e,"fontWeight"))&&"bold"==g&&(b.fontWeight=700),(g=Tl(c,d,e,"wrapOption"))&&"noWrap"==g&&(b.wrapLine=!1),(g=Tl(c,d,e,"lineHeight"))&&g.match(Gl)&&(b.lineHeight=g),(g=Tl(c,d,e,"fontSize"))&&g.match(Gl))if(g.includes("%")){var h=parseInt(g,10);b.fontSize=50<h?h/f[1]+"%":g}else b.fontSize=g;(f=Tl(c,d,e,"fontStyle"))&&(b.fontStyle=wl[f.toUpperCase()]);(d=Cl(d,e,"textDecoration"))&&Ul(b,d),(c=Vl(c,e,"textDecoration"))&&Ul(b,c)}(c,b,f,e),b.getAttribute("smpte:backgroundImage")&&(k=k[(b=b.getAttribute("smpte:backgroundImage")).substring(1)])&&(c.a=k),c.a&&15===c.region.viewportAnchorX&&85===c.region.viewportAnchorY&&85===c.region.width&&15===c.region.height&&(c.region.viewportAnchorX=7.5),c.a&&7.5===c.region.viewportAnchorX&&85===c.region.viewportAnchorY&&85===c.region.width&&15===c.region.height&&(c.c=!0),c}function Ul(b,c){for(var d=c.split(" "),e=0;e<d.length;e++)switch(d[e]){case"underline":b.textDecoration.includes("underline")||b.textDecoration.push("underline");break;case"noUnderline":b.textDecoration.includes("underline")&&tb(b.textDecoration,"underline");break;case"lineThrough":b.textDecoration.includes("lineThrough")||b.textDecoration.push("lineThrough");break;case"noLineThrough":b.textDecoration.includes("lineThrough")&&tb(b.textDecoration,"lineThrough");break;case"overline":b.textDecoration.includes("overline")||b.textDecoration.push("overline");break;case"noOverline":b.textDecoration.includes("overline")&&tb(b.textDecoration,"overline")}}function Tl(b,c,d,e){return(b=Vl(b,d,e))?b:Cl(c,d,e)}function Cl(b,c,d){for(var e=Bl(b),f=0;f<e.length;f++){var g=M.getAttributeNS(e[f],"http://www.w3.org/ns/ttml#styling",d);if(g)return g}for(b=Rl(b,"style",c);b;){if(e=M.getAttributeNS(b,"http://www.w3.org/ns/ttml#styling",d))return e;b=Rl(b,"style",c)}return null}function Vl(b,c,d){return(b=Rl(b,"style",c))?M.getAttributeNS(b,"http://www.w3.org/ns/ttml#styling",d):null}function Rl(b,c,d){if(!b||1>d.length)return null;var e=null,f=b;for(b=null;f&&!(b=f.getAttribute(c))&&(f=f.parentNode)instanceof Element;);if(c=b)for(b=0;b<d.length;b++)if(d[b].getAttribute("xml:id")==c){e=d[b];break}return e}function Ql(b,c){var d=null;if(Hl.test(b)){d=Hl.exec(b);var e=Number(d[1]),f=Number(d[2]),g=Number(d[3]),h=Number(d[4]);d=(g+=(h+=(Number(d[5])||0)/c.b)/c.frameRate)+60*f+3600*e}else Il.test(b)?d=Wl(Il,b):Jl.test(b)?d=Wl(Jl,b):Kl.test(b)?(d=Kl.exec(b),d=Number(d[1])/c.frameRate):Ll.test(b)?(d=Ll.exec(b),d=Number(d[1])/c.a):Ml.test(b)&&(d=Wl(Ml,b));return d}function Wl(b,c){var d=b.exec(c);return null==d||""==d[0]?null:(Number(d[4])||0)/1e3+(Number(d[3])||0)+60*(Number(d[2])||0)+3600*(Number(d[1])||0)}function Al(b,c,d,e){this.frameRate=Number(b)||30,this.b=Number(c)||1,this.a=Number(e),0==this.a&&(this.a=b?this.frameRate*this.b:1),d&&(b=/^(\d+) (\d+)$/g.exec(d))&&(this.frameRate*=b[1]/b[2])}function Xl(){this.a=new zl}function Yl(){}function $l(b,c,d){var e;(e=/^align:(start|middle|center|end|left|right)$/.exec(c))?(c=e[1],b.textAlign="middle"==c?ml:tl[c.toUpperCase()]):(e=/^vertical:(lr|rl)$/.exec(c))?b.writingMode="lr"==e[1]?"vertical-lr":"vertical-rl":(e=/^size:([\d.]+)%$/.exec(c))?b.size=Number(e[1]):(e=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(c))?(b.position=Number(e[1]),e[2]&&(c=e[2],b.positionAlign="line-left"==c||"start"==c?"line-left":"line-right"==c||"end"==c?"line-right":"center")):(e=/^region:(.*)$/.exec(c))?(c=function am(b,c){var d=b.filter((function(b){return b.id==c}));return d.length?d[0]:null}(d,e[1]))&&(b.region=c):(d=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(c))?(b.lineInterpretation=1,b.line=Number(d[1]),d[2]&&(b.lineAlign=vl[d[2].toUpperCase()])):(d=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(c))&&(b.lineInterpretation=ol,b.line=Number(d[1]),d[2]&&(b.lineAlign=vl[d[2].toUpperCase()]))}function Zl(b){if(null==(b=ef(b,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var c=Number(b[2]),d=Number(b[3]);return 59<c||59<d?null:Number(b[4])/1e3+d+60*c+3600*(Number(b[1])||0)}function bm(){this.a=null}function cm(b,c,d){var e,f,g;return(new P).D("payl",Wd((function(b){e=Sb(b)}))).D("iden",Wd((function(b){f=Sb(b)}))).D("sttg",Wd((function(b){g=Sb(b)}))).parse(b),e?function dm(b,c,d,e,f){if(b=new id(e,f,b),c&&(b.id=c),d)for(c=new cf(d),d=ff(c);d;)$l(b,d,[]),df(c),d=ff(c);return b}(e,f,g,c,d):null}function X(b,c){this.a=null,this.c=b,void 0===c?((c=document.createElement("div")).id="veygoTextDisplayer0",c.classList.add("veygoTextDisplayer"),this.c.parentNode.insertBefore(c,this.c.nextSibling),this.l=!0):this.l=!1,c.style.position="absolute",c.style.display="block",this.b=c,this.g=null,this.o=!1;for(var d=0;d<b.textTracks.length;++d){var e=b.textTracks[d];e.mode="disabled","TextTrack"==e.label&&(this.a=e)}this.a||(this.a=b.addTextTrack("subtitles","TextTrack")),this.a.oncuechange=this.s.bind(this),this.a.mode="hidden",this.m=this.w.bind(this),this.i=null,this.h=this.C.bind(this),b.addEventListener("loadedmetadata",this.h),em(this)}function gm(b){if(b.startTime>=b.endTime)return null;var c=new VTTCue(b.startTime,b.endTime,b.payload+"\n");c.veygoCue=b,c.lineAlign=b.lineAlign,c.positionAlign=b.positionAlign,c.size=b.size,c.c=b.c;try{c.align=b.textAlign}catch(d){}return"center"==b.textAlign&&"center"!=c.align&&(c.align="middle"),"vertical-lr"==b.writingMode?c.vertical="lr":"vertical-rl"==b.writingMode&&(c.vertical="rl"),1==b.lineInterpretation&&(c.snapToLines=!1),null!=b.line&&(c.line=b.line),null!=b.position&&(c.position=b.position),null!=b.a&&(c.image=b.a),c}function fm(b,c){var d=b.mode;b.mode="showing"==d?"showing":"hidden";for(var e=b.cues,f=e.length-1;0<=f;f--){var g=e[f];g&&c(g)&&b.removeCue(g)}b.mode=d}function em(b){var c=b.c.videoWidth,d=b.c.offsetWidth;if(0!==c&&0!==d){var e=b.c.videoHeight,f=b.c.offsetHeight;c/e<d/f?d={width:c=f*c/e,height:f,left:(d-c)/2,top:0}:d={width:d,height:d*e/c,left:0,top:(f-d*e/c)/2},b.b.style.width=d.width+"px",b.b.style.height=d.height+"px",b.b.style.left=d.left+"px",b.b.style.top=d.top+"px",b.f=d,b.a.oncuechange()}}dd("application/ttml+xml",zl),Xl.prototype.parseInit=function(b){var c=!1;if((new P).D("moov",Q).D("trak",Q).D("mdia",Q).D("minf",Q).D("stbl",Q).aa("stsd",Vd).D("stpp",(function(b){c=!0,b.parser.stop()})).parse(b),!c)throw new A(2,2,2007)},Xl.prototype.parseMedia=function(b,c){var d=!1,e=[];if((new P).D("mdat",Wd(function(b){d=!0,e=e.concat(this.a.parseMedia(b,c))}.bind(this))).parse(b),!d)throw new A(2,2,2007);return e},dd('application/mp4; codecs="stpp"',Xl),dd('application/mp4; codecs="stpp.TTML.im1t"',Xl),Yl.prototype.parseInit=function(){},Yl.prototype.parseMedia=function(b,c){var d=Sb(b);if(d=(d=d.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(d[0]))throw new A(2,2,2e3);var e=c.segmentStart;if(null==e&&(e=0,d[0].includes("X-TIMESTAMP-MAP"))){var f=d[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),g=d[0].match(/MPEGTS:(\d+)/m);f&&g&&(e=Zl(new cf(f[1])),e=c.periodStart+(Number(g[1])/9e4-e))}g=[];var h=d[0].split("\n");for(f=1;f<h.length;f++)if(/^Region:/.test(h[f])){var k=new cf(h[f]),l=new kl;ff(k),df(k);for(var m=ff(k);m;){var n=l,q=m;(m=/^id=(.*)$/.exec(q))?n.id=m[1]:(m=/^width=(\d{1,2}|100)%$/.exec(q))?n.width=Number(m[1]):(m=/^lines=(\d+)$/.exec(q))?(n.height=Number(m[1]),n.heightUnits=2):(m=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(q))?(n.regionAnchorX=Number(m[1]),n.regionAnchorY=Number(m[2])):(m=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(q))?(n.viewportAnchorX=Number(m[1]),n.viewportAnchorY=Number(m[2])):/^scroll=up$/.exec(q)&&(n.scroll="up"),df(k),m=ff(k)}g.push(l)}for(f=[],k=1;k<d.length;k++){if(m=h=d[k].split("\n"),q=e,h=g,1==m.length&&!m[0]||/^NOTE($|[ \t])/.test(m[0])||"STYLE"==m[0])h=null;else{l=null,m[0].includes("--\x3e")||(l=m[0],m.splice(0,1));var x=Zl(n=new cf(m[0])),w=ef(n,/[ \t]+--\x3e[ \t]+/g),D=Zl(n);if(null==x||null==w||null==D)throw new A(2,2,2001);for((m=new id(x+q,D+q,m.slice(1).join("\n").trim())).b=["0","4%"],df(n),q=ff(n);q;)$l(m,q,h),df(n),q=ff(n);null!=l&&(m.id=l),h=m}h&&f.push(h)}return 0===f.length&&f.push(new id(e,e,"")),f},dd("text/vtt",Yl),dd('text/vtt; codecs="vtt"',Yl),bm.prototype.parseInit=function(b){var c=!1;if((new P).D("moov",Q).D("trak",Q).D("mdia",Q).aa("mdhd",function(b){0==b.version?(b.reader.I(4),b.reader.I(4),this.a=b.reader.B(),b.reader.I(4)):(b.reader.I(8),b.reader.I(8),this.a=b.reader.B(),b.reader.I(8)),b.reader.I(4)}.bind(this)).D("minf",Q).D("stbl",Q).aa("stsd",Vd).D("wvtt",(function(){c=!0})).parse(b),!this.a)throw new A(2,2,2008);if(!c)throw new A(2,2,2008)},bm.prototype.parseMedia=function(b,c){var d=this;if(!this.a)throw new A(2,2,2008);var g,e=0,f=[],h=[],k=!1,l=!1,m=!1,n=null;if((new P).D("moof",Q).D("traf",Q).aa("tfdt",(function(b){k=!0,e=0==b.version?b.reader.B():b.reader.bb()})).aa("tfhd",(function(b){var c=b.flags;(b=b.reader).I(4),1&c&&b.I(8),2&c&&b.I(4),n=8&c?b.B():null})).aa("trun",(function(b){l=!0;var c=b.version,d=b.flags,e=(b=b.reader).B();1&d&&b.I(4),4&d&&b.I(4);for(var g=[],h=0;h<e;h++){var k={duration:null,sampleSize:null,rc:null};256&d&&(k.duration=b.B()),512&d&&(k.sampleSize=b.B()),1024&d&&b.I(4),2048&d&&(k.rc=0==c?b.B():b.fd()),g.push(k)}f=g})).D("mdat",Wd((function(b){m=!0,g=b}))).parse(b),!m&&!k&&!l)throw new A(2,2,2008);var q=e,w=new O(new DataView(g.buffer,g.byteOffset,g.byteLength),0);return f.forEach((function(b){var f=b.duration||n,g=b.rc?e+b.rc:q;q=g+(f||0);var k=0;do{var l=w.B();k+=l;var x=null;"vttc"==Xd(w.B())?8<l&&(x=w.Ka(l-8)):w.I(l-8),f&&x&&h.push(cm(x,c.periodStart+g/d.a,c.periodStart+q/d.a))}while(b.sampleSize&&k<b.sampleSize)})),h.filter(I.wa)},dd('application/mp4; codecs="wvtt"',bm),y("veygo.text.SimpleTextDisplayer",X),X.prototype.s=function(){var b=this;if(this.a){var c=this.a.activeCues;if(this.g&&(this.b.removeChild(this.g),this.g=null),0!==c.length){var d=c[0],e=d.veygoCue,f=/([\d.]+)%/;if(d.image)if(e.c){c=document.createElement("div");var g=document.createElement("img");d="data:image/png;base64,"+d.image,g.style.display="none",g.src=d,g.onload=function(){if(1920===g.width)g.style.width="100%";else{var c=b.f.width*e.region.width/100/1e3;g.style.height=c*g.height+"px",g.style.width=c*g.width+"px"}g.style.display="initial"},c.appendChild(g)}else(c=document.createElement("img")).src="data:image/png;base64,"+d.image;else{c=document.createElement("div");var h=document.createElement("div"),k=document.createElement("span");if(c.style.display="flex",c.style.flexDirection="column",c.style.alignItems="center",e.b&&2===e.b.length){var l=e.b[1],m=l.match(f);h.style.paddingBottom=(m?m[1]*this.f.height/100:l)+"px"}"center"===e.displayAlign?c.style.justifyContent="center":e.displayAlign===ql?c.style.justifyContent="flex-end":"before"===e.displayAlign&&(c.style.justifyContent="flex-start"),"center"==e.textAlign&&(c.style.textAlign="center"),(f=(e.fontSize||"4%").match(f))?(c.style.fontSize=parseFloat(f[1])/100*this.f.height+"px",k.style.backgroundColor="black"):c.style.fontSize=e.fontSize,"proportionalSansSerif"===e.fontFamily?(c.style.fontFamily="Sans Serif",c.style.fontSize=this.f.height*e.region.height/100/2*.8+"px"):c.style.fontFamily="Sans Serif",k.style.color=e.color?e.color:"white",k.style.backgroundColor||(k.style.backgroundColor=e.backgroundColor?e.backgroundColor:"rgba(0,0,0,68)"),k.innerHTML=d.text.replace(/\n/g,"<br/>"),h.appendChild(k),c.appendChild(h)}c.style.position="absolute",c.style.height=e.region.height+"%",c.style.top=e.region.viewportAnchorY+"%",c.style.left=e.region.viewportAnchorX+"%",c.style.width=e.region.width+"%",this.b.appendChild(c),this.g=c}}},X.prototype.remove=function(b,c){return!!this.a&&(fm(this.a,(function(d){return d.startTime<c&&d.endTime>b})),!0)},X.prototype.remove=X.prototype.remove,X.prototype.append=function(b){for(var c=gm,d=[],e=0;e<b.length;e++){var f=c(b[e]);f&&d.push(f)}d.slice().sort((function(b,c){return b.startTime!=c.startTime?b.startTime-c.startTime:b.endTime!=c.endTime?b.endTime-c.startTime:d.indexOf(c)-d.indexOf(b)})).forEach(function(b){this.a.addCue(b)}.bind(this))},X.prototype.append=X.prototype.append,X.prototype.destroy=function(){if(this.a&&fm(this.a,(function(){return!0})),this.l)this.b.parentNode&&this.b.parentNode.removeChild(this.b),this.b=null,this.l=!1;else for(var b=this.b;b.firstChild;)b.removeChild(b.firstChild);return this.i&&(this.i.detach(this.m),this.m=this.i=null),this.h&&(this.c.removeEventListener("loadedmetadata",this.h),this.h=null),this.a=null,Promise.resolve()},X.prototype.destroy=X.prototype.destroy,X.prototype.isTextVisible=function(){return this.o},X.prototype.isTextVisible=X.prototype.isTextVisible,X.prototype.setTextVisibility=function(b){this.b&&(this.b.style.display=b?"block":"none"),this.a.mode="hidden",this.o=b},X.prototype.setTextVisibility=X.prototype.setTextVisibility,X.prototype.w=function(){em(this)},X.prototype.C=function(){em(this)}}.call(exportTo,innerGlobal,innerGlobal),exportTo.veygo)exports[k]=exportTo.veygo[k]}()}).call(this,__webpack_require__(62))},function(module,exports,__webpack_require__){"use strict";var box,dinf,esds,ftyp,mdat,mfhd,minf,moof,moov,mvex,mvhd,trak,tkhd,mdia,mdhd,hdlr,sdtp,stbl,stsd,traf,trex,trun,types,MAJOR_BRAND,MINOR_VERSION,AVC1_BRAND,VIDEO_HDLR,AUDIO_HDLR,HDLR_TYPES,VMHD,SMHD,DREF,STCO,STSC,STSZ,STTS,videoSample,audioSample,audioTrun,videoTrun,trunHeader,UINT32_MAX=Math.pow(2,32)-1;!function(){var i;if(types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(i in types)types.hasOwnProperty(i)&&(types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),MINOR_VERSION=new Uint8Array([0,0,0,1]),VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),HDLR_TYPES={video:VIDEO_HDLR,audio:AUDIO_HDLR},DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),STCO=new Uint8Array([0,0,0,0,0,0,0,0]),STSC=STCO,STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),STTS=STCO,VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),box=function(type){var i,result,payload=[],size=0;for(i=1;i<arguments.length;i++)payload.push(arguments[i]);for(i=payload.length;i--;)size+=payload[i].byteLength;for(result=new Uint8Array(size+8),new DataView(result.buffer,result.byteOffset,result.byteLength).setUint32(0,result.byteLength),result.set(type,4),i=0,size=8;i<payload.length;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result},dinf=function(){return box(types.dinf,box(types.dref,DREF))},esds=function(track){return box(types.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,track.audioobjecttype<<3|track.samplingfrequencyindex>>>1,track.samplingfrequencyindex<<7|track.channelcount<<3,6,1,2]))},ftyp=function(){return box(types.ftyp,MAJOR_BRAND,MINOR_VERSION,MAJOR_BRAND,AVC1_BRAND)},hdlr=function(type){return box(types.hdlr,HDLR_TYPES[type])},mdat=function(data){return box(types.mdat,data)},mdhd=function(track){var result=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,track.duration>>>24&255,track.duration>>>16&255,track.duration>>>8&255,255&track.duration,85,196,0,0]);return track.samplerate&&(result[12]=track.samplerate>>>24&255,result[13]=track.samplerate>>>16&255,result[14]=track.samplerate>>>8&255,result[15]=255&track.samplerate),box(types.mdhd,result)},mdia=function(track){return box(types.mdia,mdhd(track),hdlr(track.type),minf(track))},mfhd=function(sequenceNumber){return box(types.mfhd,new Uint8Array([0,0,0,0,(4278190080&sequenceNumber)>>24,(16711680&sequenceNumber)>>16,(65280&sequenceNumber)>>8,255&sequenceNumber]))},minf=function(track){return box(types.minf,"video"===track.type?box(types.vmhd,VMHD):box(types.smhd,SMHD),dinf(),stbl(track))},moof=function(sequenceNumber,tracks){for(var trackFragments=[],i=tracks.length;i--;)trackFragments[i]=traf(tracks[i]);return box.apply(null,[types.moof,mfhd(sequenceNumber)].concat(trackFragments))},moov=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=trak(tracks[i]);return box.apply(null,[types.moov,mvhd(4294967295)].concat(boxes).concat(mvex(tracks)))},mvex=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=trex(tracks[i]);return box.apply(null,[types.mvex].concat(boxes))},mvhd=function(duration){var bytes=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&duration)>>24,(16711680&duration)>>16,(65280&duration)>>8,255&duration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return box(types.mvhd,bytes)},sdtp=function(track){var flags,i,samples=track.samples||[],bytes=new Uint8Array(4+samples.length);for(i=0;i<samples.length;i++)flags=samples[i].flags,bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;return box(types.sdtp,bytes)},stbl=function(track){return box(types.stbl,stsd(track),box(types.stts,STTS),box(types.stsc,STSC),box(types.stsz,STSZ),box(types.stco,STCO))},stsd=function(track){return box(types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===track.type?videoSample(track):audioSample(track))},videoSample=function(track){var i,avc1Box,sps=track.sps||[],pps=track.pps||[],sequenceParameterSets=[],pictureParameterSets=[];for(i=0;i<sps.length;i++)sequenceParameterSets.push((65280&sps[i].byteLength)>>>8),sequenceParameterSets.push(255&sps[i].byteLength),sequenceParameterSets=sequenceParameterSets.concat(Array.prototype.slice.call(sps[i]));for(i=0;i<pps.length;i++)pictureParameterSets.push((65280&pps[i].byteLength)>>>8),pictureParameterSets.push(255&pps[i].byteLength),pictureParameterSets=pictureParameterSets.concat(Array.prototype.slice.call(pps[i]));if(avc1Box=[types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&track.width)>>8,255&track.width,(65280&track.height)>>8,255&track.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),box(types.avcC,new Uint8Array([1,track.profileIdc,track.profileCompatibility,track.levelIdc,255].concat([sps.length],sequenceParameterSets,[pps.length],pictureParameterSets))),box(types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],track.sarRatio){var hSpacing=track.sarRatio[0],vSpacing=track.sarRatio[1];avc1Box.push(box(types.pasp,new Uint8Array([(4278190080&hSpacing)>>24,(16711680&hSpacing)>>16,(65280&hSpacing)>>8,255&hSpacing,(4278190080&vSpacing)>>24,(16711680&vSpacing)>>16,(65280&vSpacing)>>8,255&vSpacing])))}return box.apply(null,avc1Box)},audioSample=function(track){return box(types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&track.channelcount)>>8,255&track.channelcount,(65280&track.samplesize)>>8,255&track.samplesize,0,0,0,0,(65280&track.samplerate)>>8,255&track.samplerate,0,0]),esds(track))},tkhd=function(track){var result=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,0,(4278190080&track.duration)>>24,(16711680&track.duration)>>16,(65280&track.duration)>>8,255&track.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&track.width)>>8,255&track.width,0,0,(65280&track.height)>>8,255&track.height,0,0]);return box(types.tkhd,result)},traf=function(track){var trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable,upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime;return trackFragmentHeader=box(types.tfhd,new Uint8Array([0,0,0,58,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),upperWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime/(UINT32_MAX+1)),lowerWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime%(UINT32_MAX+1)),trackFragmentDecodeTime=box(types.tfdt,new Uint8Array([1,0,0,0,upperWordBaseMediaDecodeTime>>>24&255,upperWordBaseMediaDecodeTime>>>16&255,upperWordBaseMediaDecodeTime>>>8&255,255&upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime>>>24&255,lowerWordBaseMediaDecodeTime>>>16&255,lowerWordBaseMediaDecodeTime>>>8&255,255&lowerWordBaseMediaDecodeTime])),92,"audio"===track.type?(trackFragmentRun=trun(track,92),box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun)):(sampleDependencyTable=sdtp(track),trackFragmentRun=trun(track,sampleDependencyTable.length+92),box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable))},trak=function(track){return track.duration=track.duration||4294967295,box(types.trak,tkhd(track),mdia(track))},trex=function(track){var result=new Uint8Array([0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==track.type&&(result[result.length-1]=0),box(types.trex,result)},trunHeader=function(samples,offset){var durationPresent=0,sizePresent=0,flagsPresent=0,compositionTimeOffset=0;return samples.length&&(void 0!==samples[0].duration&&(durationPresent=1),void 0!==samples[0].size&&(sizePresent=2),void 0!==samples[0].flags&&(flagsPresent=4),void 0!==samples[0].compositionTimeOffset&&(compositionTimeOffset=8)),[0,0,durationPresent|sizePresent|flagsPresent|compositionTimeOffset,1,(4278190080&samples.length)>>>24,(16711680&samples.length)>>>16,(65280&samples.length)>>>8,255&samples.length,(4278190080&offset)>>>24,(16711680&offset)>>>16,(65280&offset)>>>8,255&offset]},videoTrun=function(track,offset){var bytesOffest,bytes,header,samples,sample,i;for(offset+=20+16*(samples=track.samples||[]).length,header=trunHeader(samples,offset),(bytes=new Uint8Array(header.length+16*samples.length)).set(header),bytesOffest=header.length,i=0;i<samples.length;i++)sample=samples[i],bytes[bytesOffest++]=(4278190080&sample.duration)>>>24,bytes[bytesOffest++]=(16711680&sample.duration)>>>16,bytes[bytesOffest++]=(65280&sample.duration)>>>8,bytes[bytesOffest++]=255&sample.duration,bytes[bytesOffest++]=(4278190080&sample.size)>>>24,bytes[bytesOffest++]=(16711680&sample.size)>>>16,bytes[bytesOffest++]=(65280&sample.size)>>>8,bytes[bytesOffest++]=255&sample.size,bytes[bytesOffest++]=sample.flags.isLeading<<2|sample.flags.dependsOn,bytes[bytesOffest++]=sample.flags.isDependedOn<<6|sample.flags.hasRedundancy<<4|sample.flags.paddingValue<<1|sample.flags.isNonSyncSample,bytes[bytesOffest++]=61440&sample.flags.degradationPriority,bytes[bytesOffest++]=15&sample.flags.degradationPriority,bytes[bytesOffest++]=(4278190080&sample.compositionTimeOffset)>>>24,bytes[bytesOffest++]=(16711680&sample.compositionTimeOffset)>>>16,bytes[bytesOffest++]=(65280&sample.compositionTimeOffset)>>>8,bytes[bytesOffest++]=255&sample.compositionTimeOffset;return box(types.trun,bytes)},audioTrun=function(track,offset){var bytes,bytesOffest,header,samples,sample,i;for(offset+=20+8*(samples=track.samples||[]).length,header=trunHeader(samples,offset),(bytes=new Uint8Array(header.length+8*samples.length)).set(header),bytesOffest=header.length,i=0;i<samples.length;i++)sample=samples[i],bytes[bytesOffest++]=(4278190080&sample.duration)>>>24,bytes[bytesOffest++]=(16711680&sample.duration)>>>16,bytes[bytesOffest++]=(65280&sample.duration)>>>8,bytes[bytesOffest++]=255&sample.duration,bytes[bytesOffest++]=(4278190080&sample.size)>>>24,bytes[bytesOffest++]=(16711680&sample.size)>>>16,bytes[bytesOffest++]=(65280&sample.size)>>>8,bytes[bytesOffest++]=255&sample.size;return box(types.trun,bytes)},trun=function(track,offset){return"audio"===track.type?audioTrun(track,offset):videoTrun(track,offset)},module.exports={ftyp,mdat,moof,moov,initSegment:function(tracks){var result,fileType=ftyp(),movie=moov(tracks);return(result=new Uint8Array(fileType.byteLength+movie.byteLength)).set(fileType),result.set(movie,fileType.byteLength),result}}},function(module,exports,__webpack_require__){"use strict";var toUnsigned=__webpack_require__(7).toUnsigned,parseType=__webpack_require__(16),findBox=function(data,path){var i,size,type,end,subresults,results=[];if(!path.length)return null;for(i=0;i<data.byteLength;)size=toUnsigned(data[i]<<24|data[i+1]<<16|data[i+2]<<8|data[i+3]),type=parseType(data.subarray(i+4,i+8)),end=size>1?i+size:data.byteLength,type===path[0]&&(1===path.length?results.push(data.subarray(i+8,end)):(subresults=findBox(data.subarray(i+8,end),path.slice(1))).length&&(results=results.concat(subresults))),i=end;return results};module.exports=findBox},function(module,exports,__webpack_require__){"use strict";module.exports=function(buffer){var result="";return result+=String.fromCharCode(buffer[0]),result+=String.fromCharCode(buffer[1]),result+=String.fromCharCode(buffer[2]),result+=String.fromCharCode(buffer[3])}},function(module,exports,__webpack_require__){"use strict";module.exports=function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),trackId:view.getUint32(4)},baseDataOffsetPresent=1&result.flags[2],sampleDescriptionIndexPresent=2&result.flags[2],defaultSampleDurationPresent=8&result.flags[2],defaultSampleSizePresent=16&result.flags[2],defaultSampleFlagsPresent=32&result.flags[2],durationIsEmpty=65536&result.flags[0],defaultBaseIsMoof=131072&result.flags[0];return i=8,baseDataOffsetPresent&&(i+=4,result.baseDataOffset=view.getUint32(12),i+=4),sampleDescriptionIndexPresent&&(result.sampleDescriptionIndex=view.getUint32(i),i+=4),defaultSampleDurationPresent&&(result.defaultSampleDuration=view.getUint32(i),i+=4),defaultSampleSizePresent&&(result.defaultSampleSize=view.getUint32(i),i+=4),defaultSampleFlagsPresent&&(result.defaultSampleFlags=view.getUint32(i)),durationIsEmpty&&(result.durationIsEmpty=!0),!baseDataOffsetPresent&&defaultBaseIsMoof&&(result.baseDataOffsetIsMoof=!0),result}},function(module,exports,__webpack_require__){"use strict";var parseSampleFlags=__webpack_require__(34);module.exports=function(data){var sample,result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),samples:[]},view=new DataView(data.buffer,data.byteOffset,data.byteLength),dataOffsetPresent=1&result.flags[2],firstSampleFlagsPresent=4&result.flags[2],sampleDurationPresent=1&result.flags[1],sampleSizePresent=2&result.flags[1],sampleFlagsPresent=4&result.flags[1],sampleCompositionTimeOffsetPresent=8&result.flags[1],sampleCount=view.getUint32(4),offset=8;for(dataOffsetPresent&&(result.dataOffset=view.getInt32(offset),offset+=4),firstSampleFlagsPresent&&sampleCount&&(sample={flags:parseSampleFlags(data.subarray(offset,offset+4))},offset+=4,sampleDurationPresent&&(sample.duration=view.getUint32(offset),offset+=4),sampleSizePresent&&(sample.size=view.getUint32(offset),offset+=4),sampleCompositionTimeOffsetPresent&&(1===result.version?sample.compositionTimeOffset=view.getInt32(offset):sample.compositionTimeOffset=view.getUint32(offset),offset+=4),result.samples.push(sample),sampleCount--);sampleCount--;)sample={},sampleDurationPresent&&(sample.duration=view.getUint32(offset),offset+=4),sampleSizePresent&&(sample.size=view.getUint32(offset),offset+=4),sampleFlagsPresent&&(sample.flags=parseSampleFlags(data.subarray(offset,offset+4)),offset+=4),sampleCompositionTimeOffsetPresent&&(1===result.version?sample.compositionTimeOffset=view.getInt32(offset):sample.compositionTimeOffset=view.getUint32(offset),offset+=4),result.samples.push(sample);return result}},function(module,exports,__webpack_require__){"use strict";var toUnsigned=__webpack_require__(7).toUnsigned;module.exports=function(data){var result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),baseMediaDecodeTime:toUnsigned(data[4]<<24|data[5]<<16|data[6]<<8|data[7])};return 1===result.version&&(result.baseMediaDecodeTime*=Math.pow(2,32),result.baseMediaDecodeTime+=toUnsigned(data[8]<<24|data[9]<<16|data[10]<<8|data[11])),result}},function(module,exports,__webpack_require__){"use strict";var Stream=__webpack_require__(2),cea708Parser=__webpack_require__(21),CaptionStream=function(options){options=options||{},CaptionStream.prototype.init.call(this),this.cea608parser=options.cea608parser,this.cea608parser&&this.cea608parser.addEventListener("data",this.trigger.bind(this,"data")),this.parse708captions_="boolean"!=typeof options.parse708captions||options.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Cea608Stream(0,0),new Cea608Stream(0,1),new Cea608Stream(1,0),new Cea608Stream(1,1)],this.parse708captions_&&(this.cc708Stream_=new Cea708Stream),this.reset(),this.ccStreams_.forEach((function(cc){cc.on("data",this.trigger.bind(this,"data")),cc.on("partialdone",this.trigger.bind(this,"partialdone")),cc.on("done",this.trigger.bind(this,"done"))}),this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};CaptionStream.prototype=new Stream,CaptionStream.prototype.push=function(event){var sei,userData,newCaptionPackets;if("sei_rbsp"===event.nalUnitType&&(sei=cea708Parser.parseSei(event.escapedRBSP)).payload&&sei.payloadType===cea708Parser.USER_DATA_REGISTERED_ITU_T_T35&&(userData=cea708Parser.parseUserData(sei)))if(event.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(event.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));newCaptionPackets=cea708Parser.parseCaptionPackets(event.pts,userData),this.captionPackets_=this.captionPackets_.concat(newCaptionPackets),this.latestDts_!==event.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=event.dts}},CaptionStream.prototype.flushCCStreams=function(flushType){this.ccStreams_.forEach((function(cc){return"flush"===flushType?cc.flush():cc.partialFlush()}),this)},CaptionStream.prototype.flushStream=function(flushType){if(!this.captionPackets_.length)return void this.flushCCStreams(flushType);this.captionPackets_.forEach((function(elem,idx){elem.presortIndex=idx})),this.captionPackets_.sort((function(a,b){return a.pts===b.pts?a.presortIndex-b.presortIndex:a.pts-b.pts}));const{cea608Packets,cea708Packets}=this.captionPackets_.reduce((acc,packet)=>(packet.type<2?acc.cea608Packets.push(packet):acc.cea708Packets.push(packet),acc),{cea608Packets:[],cea708Packets:[]});this.cea608parser?this.cea608parser.addData(cea608Packets):(cea608Packets.forEach(packet=>this.dispatchCea608Packet(packet)),cea708Packets.forEach(packet=>this.dispatchCea708Packet(packet))),this.captionPackets_.length=0,this.flushCCStreams(flushType)},CaptionStream.prototype.flush=function(){return this.flushStream("flush")},CaptionStream.prototype.partialFlush=function(){return this.flushStream("partialFlush")},CaptionStream.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach((function(ccStream){ccStream.reset()}))},CaptionStream.prototype.dispatchCea608Packet=function(packet){this.setsTextOrXDSActive(packet)?this.activeCea608Channel_[packet.type]=null:this.setsChannel1Active(packet)?this.activeCea608Channel_[packet.type]=0:this.setsChannel2Active(packet)&&(this.activeCea608Channel_[packet.type]=1),null!==this.activeCea608Channel_[packet.type]&&this.ccStreams_[(packet.type<<1)+this.activeCea608Channel_[packet.type]].push(packet)},CaptionStream.prototype.setsChannel1Active=function(packet){return 4096==(30720&packet.ccData)},CaptionStream.prototype.setsChannel2Active=function(packet){return 6144==(30720&packet.ccData)},CaptionStream.prototype.setsTextOrXDSActive=function(packet){return 256==(28928&packet.ccData)||4138==(30974&packet.ccData)||6186==(30974&packet.ccData)},CaptionStream.prototype.dispatchCea708Packet=function(packet){this.parse708captions_&&this.cc708Stream_.push(packet)};var CHARACTER_TRANSLATION_708={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},within708TextBlock=function(b){return 32<=b&&b<=127||160<=b&&b<=255},Cea708Window=function(windowNum){this.windowNum=windowNum,this.reset()};Cea708Window.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Cea708Window.prototype.getText=function(){return this.rows.join("\n")},Cea708Window.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Cea708Window.prototype.newLine=function(pts){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(pts),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Cea708Window.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},Cea708Window.prototype.addText=function(text){this.rows[this.rowIdx]+=text},Cea708Window.prototype.backspace=function(){if(!this.isEmpty()){var row=this.rows[this.rowIdx];this.rows[this.rowIdx]=row.substr(0,row.length-1)}};var Cea708Service=function(serviceNum){this.serviceNum=serviceNum,this.text="",this.currentWindow=new Cea708Window(-1),this.windows=[]};Cea708Service.prototype.init=function(pts,beforeRowOverflow){this.startPts=pts;for(var win=0;win<8;win++)this.windows[win]=new Cea708Window(win),"function"==typeof beforeRowOverflow&&(this.windows[win].beforeRowOverflow=beforeRowOverflow)},Cea708Service.prototype.setCurrentWindow=function(windowNum){this.currentWindow=this.windows[windowNum]};var Cea708Stream=function(){Cea708Stream.prototype.init.call(this);var self=this;this.current708Packet=null,this.services={},this.push=function(packet){3===packet.type?(self.new708Packet(),self.add708Bytes(packet)):(null===self.current708Packet&&self.new708Packet(),self.add708Bytes(packet))}};Cea708Stream.prototype=new Stream,Cea708Stream.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Cea708Stream.prototype.add708Bytes=function(packet){var data=packet.ccData,byte0=data>>>8,byte1=255&data;this.current708Packet.ptsVals.push(packet.pts),this.current708Packet.data.push(byte0),this.current708Packet.data.push(byte1)},Cea708Stream.prototype.push708Packet=function(){var packet708=this.current708Packet,packetData=packet708.data,serviceNum=null,blockSize=null,i=0,b=packetData[i++];for(packet708.seq=b>>6,packet708.sizeCode=63&b;i<packetData.length;i++)blockSize=31&(b=packetData[i++]),7===(serviceNum=b>>5)&&blockSize>0&&(serviceNum=b=packetData[i++]),this.pushServiceBlock(serviceNum,i,blockSize),blockSize>0&&(i+=blockSize-1)},Cea708Stream.prototype.pushServiceBlock=function(serviceNum,start,size){var b,i=start,packetData=this.current708Packet.data,service=this.services[serviceNum];for(service||(service=this.initService(serviceNum,i));i<start+size&&i<packetData.length;i++)b=packetData[i],within708TextBlock(b)?i=this.handleText(i,service):16===b?i=this.extendedCommands(i,service):128<=b&&b<=135?i=this.setCurrentWindow(i,service):152<=b&&b<=159?i=this.defineWindow(i,service):136===b?i=this.clearWindows(i,service):140===b?i=this.deleteWindows(i,service):137===b?i=this.displayWindows(i,service):138===b?i=this.hideWindows(i,service):139===b?i=this.toggleWindows(i,service):151===b?i=this.setWindowAttributes(i,service):144===b?i=this.setPenAttributes(i,service):145===b?i=this.setPenColor(i,service):146===b?i=this.setPenLocation(i,service):143===b?service=this.reset(i,service):8===b?service.currentWindow.backspace():12===b?service.currentWindow.clearText():13===b?service.currentWindow.pendingNewLine=!0:14===b?service.currentWindow.clearText():141===b&&i++},Cea708Stream.prototype.extendedCommands=function(i,service){var b=this.current708Packet.data[++i];return within708TextBlock(b)&&(i=this.handleText(i,service,!0)),i},Cea708Stream.prototype.getPts=function(byteIndex){return this.current708Packet.ptsVals[Math.floor(byteIndex/2)]},Cea708Stream.prototype.initService=function(serviceNum,i){var self=this;return this.services[serviceNum]=new Cea708Service(serviceNum),this.services[serviceNum].init(this.getPts(i),(function(pts){self.flushDisplayed(pts,self.services[serviceNum])})),this.services[serviceNum]},Cea708Stream.prototype.handleText=function(i,service,isExtended){var code,newCode,b=this.current708Packet.data[i],char=(newCode=CHARACTER_TRANSLATION_708[code=(isExtended?4096:0)|b]||code,4096&code&&code===newCode?"":String.fromCharCode(newCode)),win=service.currentWindow;return win.pendingNewLine&&!win.isEmpty()&&win.newLine(this.getPts(i)),win.pendingNewLine=!1,win.addText(char),i},Cea708Stream.prototype.setCurrentWindow=function(i,service){var windowNum=7&this.current708Packet.data[i];return service.setCurrentWindow(windowNum),i},Cea708Stream.prototype.defineWindow=function(i,service){var packetData=this.current708Packet.data,b=packetData[i],windowNum=7&b;service.setCurrentWindow(windowNum);var win=service.currentWindow;return b=packetData[++i],win.visible=(32&b)>>5,win.rowLock=(16&b)>>4,win.columnLock=(8&b)>>3,win.priority=7&b,b=packetData[++i],win.relativePositioning=(128&b)>>7,win.anchorVertical=127&b,b=packetData[++i],win.anchorHorizontal=b,b=packetData[++i],win.anchorPoint=(240&b)>>4,win.rowCount=15&b,b=packetData[++i],win.columnCount=63&b,b=packetData[++i],win.windowStyle=(56&b)>>3,win.penStyle=7&b,win.virtualRowCount=win.rowCount+1,i},Cea708Stream.prototype.setWindowAttributes=function(i,service){var packetData=this.current708Packet.data,b=packetData[i],winAttr=service.currentWindow.winAttr;return b=packetData[++i],winAttr.fillOpacity=(192&b)>>6,winAttr.fillRed=(48&b)>>4,winAttr.fillGreen=(12&b)>>2,winAttr.fillBlue=3&b,b=packetData[++i],winAttr.borderType=(192&b)>>6,winAttr.borderRed=(48&b)>>4,winAttr.borderGreen=(12&b)>>2,winAttr.borderBlue=3&b,b=packetData[++i],winAttr.borderType+=(128&b)>>5,winAttr.wordWrap=(64&b)>>6,winAttr.printDirection=(48&b)>>4,winAttr.scrollDirection=(12&b)>>2,winAttr.justify=3&b,b=packetData[++i],winAttr.effectSpeed=(240&b)>>4,winAttr.effectDirection=(12&b)>>2,winAttr.displayEffect=3&b,i},Cea708Stream.prototype.flushDisplayed=function(pts,service){for(var displayedText=[],winId=0;winId<8;winId++)service.windows[winId].visible&&!service.windows[winId].isEmpty()&&displayedText.push(service.windows[winId].getText());service.endPts=pts,service.text=displayedText.join("\n\n"),this.pushCaption(service),service.startPts=pts},Cea708Stream.prototype.pushCaption=function(service){""!==service.text&&(this.trigger("data",{startPts:service.startPts,endPts:service.endPts,text:service.text,stream:"cc708_"+service.serviceNum}),service.text="",service.startPts=service.endPts)},Cea708Stream.prototype.displayWindows=function(i,service){var b=this.current708Packet.data[++i],pts=this.getPts(i);this.flushDisplayed(pts,service);for(var winId=0;winId<8;winId++)b&1<<winId&&(service.windows[winId].visible=1);return i},Cea708Stream.prototype.hideWindows=function(i,service){var b=this.current708Packet.data[++i],pts=this.getPts(i);this.flushDisplayed(pts,service);for(var winId=0;winId<8;winId++)b&1<<winId&&(service.windows[winId].visible=0);return i},Cea708Stream.prototype.toggleWindows=function(i,service){var b=this.current708Packet.data[++i],pts=this.getPts(i);this.flushDisplayed(pts,service);for(var winId=0;winId<8;winId++)b&1<<winId&&(service.windows[winId].visible^=1);return i},Cea708Stream.prototype.clearWindows=function(i,service){var b=this.current708Packet.data[++i],pts=this.getPts(i);this.flushDisplayed(pts,service);for(var winId=0;winId<8;winId++)b&1<<winId&&service.windows[winId].clearText();return i},Cea708Stream.prototype.deleteWindows=function(i,service){var b=this.current708Packet.data[++i],pts=this.getPts(i);this.flushDisplayed(pts,service);for(var winId=0;winId<8;winId++)b&1<<winId&&service.windows[winId].reset();return i},Cea708Stream.prototype.setPenAttributes=function(i,service){var packetData=this.current708Packet.data,b=packetData[i],penAttr=service.currentWindow.penAttr;return b=packetData[++i],penAttr.textTag=(240&b)>>4,penAttr.offset=(12&b)>>2,penAttr.penSize=3&b,b=packetData[++i],penAttr.italics=(128&b)>>7,penAttr.underline=(64&b)>>6,penAttr.edgeType=(56&b)>>3,penAttr.fontStyle=7&b,i},Cea708Stream.prototype.setPenColor=function(i,service){var packetData=this.current708Packet.data,b=packetData[i],penColor=service.currentWindow.penColor;return b=packetData[++i],penColor.fgOpacity=(192&b)>>6,penColor.fgRed=(48&b)>>4,penColor.fgGreen=(12&b)>>2,penColor.fgBlue=3&b,b=packetData[++i],penColor.bgOpacity=(192&b)>>6,penColor.bgRed=(48&b)>>4,penColor.bgGreen=(12&b)>>2,penColor.bgBlue=3&b,b=packetData[++i],penColor.edgeRed=(48&b)>>4,penColor.edgeGreen=(12&b)>>2,penColor.edgeBlue=3&b,i},Cea708Stream.prototype.setPenLocation=function(i,service){var packetData=this.current708Packet.data,b=packetData[i],penLoc=service.currentWindow.penLoc;return service.currentWindow.pendingNewLine=!0,b=packetData[++i],penLoc.row=15&b,b=packetData[++i],penLoc.column=63&b,i},Cea708Stream.prototype.reset=function(i,service){var pts=this.getPts(i);return this.flushDisplayed(pts,service),this.initService(service.serviceNum,i)};var CHARACTER_TRANSLATION={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},getCharFromCode=function(code){return null===code?"":(code=CHARACTER_TRANSLATION[code]||code,String.fromCharCode(code))},ROWS=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],createDisplayBuffer=function(){for(var result=[],i=15;i--;)result.push("");return result},Cea608Stream=function(field,dataChannel){Cea608Stream.prototype.init.call(this),this.field_=field||0,this.dataChannel_=dataChannel||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(packet){var data,swap,char0,char1,text;if((data=32639&packet.ccData)!==this.lastControlCode_){if(4096==(61440&data)?this.lastControlCode_=data:data!==this.PADDING_&&(this.lastControlCode_=null),char0=data>>>8,char1=255&data,data!==this.PADDING_)if(data===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(data===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(packet.pts),this.flushDisplayed(packet.pts),swap=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=swap,this.startPts_=packet.pts;else if(data===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(packet.pts);else if(data===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(packet.pts);else if(data===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(packet.pts);else if(data===this.CARRIAGE_RETURN_)this.clearFormatting(packet.pts),this.flushDisplayed(packet.pts),this.shiftRowsUp_(),this.startPts_=packet.pts;else if(data===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(data===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(packet.pts),this.displayed_=createDisplayBuffer();else if(data===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=createDisplayBuffer();else if(data===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(packet.pts),this.displayed_=createDisplayBuffer()),this.mode_="paintOn",this.startPts_=packet.pts;else if(this.isSpecialCharacter(char0,char1))text=getCharFromCode((char0=(3&char0)<<8)|char1),this[this.mode_](packet.pts,text),this.column_++;else if(this.isExtCharacter(char0,char1))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),text=getCharFromCode((char0=(3&char0)<<8)|char1),this[this.mode_](packet.pts,text),this.column_++;else if(this.isMidRowCode(char0,char1))this.clearFormatting(packet.pts),this[this.mode_](packet.pts," "),this.column_++,14==(14&char1)&&this.addFormatting(packet.pts,["i"]),1==(1&char1)&&this.addFormatting(packet.pts,["u"]);else if(this.isOffsetControlCode(char0,char1))this.column_+=3&char1;else if(this.isPAC(char0,char1)){var row=ROWS.indexOf(7968&data);"rollUp"===this.mode_&&(row-this.rollUpRows_+1<0&&(row=this.rollUpRows_-1),this.setRollUp(packet.pts,row)),row!==this.row_&&(this.clearFormatting(packet.pts),this.row_=row),1&char1&&-1===this.formatting_.indexOf("u")&&this.addFormatting(packet.pts,["u"]),16==(16&data)&&(this.column_=4*((14&data)>>1)),this.isColorPAC(char1)&&14==(14&char1)&&this.addFormatting(packet.pts,["i"])}else this.isNormalChar(char0)&&(0===char1&&(char1=null),text=getCharFromCode(char0),text+=getCharFromCode(char1),this[this.mode_](packet.pts,text),this.column_+=text.length)}else this.lastControlCode_=null}};Cea608Stream.prototype=new Stream,Cea608Stream.prototype.flushDisplayed=function(pts){var content=this.displayed_.map((function(row){try{return row.trim()}catch(e){return console.error("Skipping malformed caption."),""}})).join("\n").replace(/^\n+|\n+$/g,"");content.length&&this.trigger("data",{startPts:this.startPts_,endPts:pts,text:content,stream:this.name_})},Cea608Stream.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=createDisplayBuffer(),this.nonDisplayed_=createDisplayBuffer(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Cea608Stream.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Cea608Stream.prototype.isSpecialCharacter=function(char0,char1){return char0===this.EXT_&&char1>=48&&char1<=63},Cea608Stream.prototype.isExtCharacter=function(char0,char1){return(char0===this.EXT_+1||char0===this.EXT_+2)&&char1>=32&&char1<=63},Cea608Stream.prototype.isMidRowCode=function(char0,char1){return char0===this.EXT_&&char1>=32&&char1<=47},Cea608Stream.prototype.isOffsetControlCode=function(char0,char1){return char0===this.OFFSET_&&char1>=33&&char1<=35},Cea608Stream.prototype.isPAC=function(char0,char1){return char0>=this.BASE_&&char0<this.BASE_+8&&char1>=64&&char1<=127},Cea608Stream.prototype.isColorPAC=function(char1){return char1>=64&&char1<=79||char1>=96&&char1<=127},Cea608Stream.prototype.isNormalChar=function(char){return char>=32&&char<=127},Cea608Stream.prototype.setRollUp=function(pts,newBaseRow){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(pts),this.nonDisplayed_=createDisplayBuffer(),this.displayed_=createDisplayBuffer()),void 0!==newBaseRow&&newBaseRow!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[newBaseRow-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===newBaseRow&&(newBaseRow=this.row_),this.topRow_=newBaseRow-this.rollUpRows_+1},Cea608Stream.prototype.addFormatting=function(pts,format){this.formatting_=this.formatting_.concat(format);var text=format.reduce((function(text,format){return text+"<"+format+">"}),"");this[this.mode_](pts,text)},Cea608Stream.prototype.clearFormatting=function(pts){if(this.formatting_.length){var text=this.formatting_.reverse().reduce((function(text,format){return text+"</"+format+">"}),"");this.formatting_=[],this[this.mode_](pts,text)}},Cea608Stream.prototype.popOn=function(pts,text){var baseRow=this.nonDisplayed_[this.row_];baseRow+=text,this.nonDisplayed_[this.row_]=baseRow},Cea608Stream.prototype.rollUp=function(pts,text){var baseRow=this.displayed_[this.row_];baseRow+=text,this.displayed_[this.row_]=baseRow},Cea608Stream.prototype.shiftRowsUp_=function(){var i;for(i=0;i<this.topRow_;i++)this.displayed_[i]="";for(i=this.row_+1;i<15;i++)this.displayed_[i]="";for(i=this.topRow_;i<this.row_;i++)this.displayed_[i]=this.displayed_[i+1];this.displayed_[this.row_]=""},Cea608Stream.prototype.paintOn=function(pts,text){var baseRow=this.displayed_[this.row_];baseRow+=text,this.displayed_[this.row_]=baseRow},module.exports={CaptionStream,Cea608Stream,Cea708Stream}},function(module,exports,__webpack_require__){"use strict";module.exports={parseSei:function(bytes){for(var i=0,result={payloadType:-1,payloadSize:0},payloadType=0,payloadSize=0;i<bytes.byteLength&&128!==bytes[i];){for(;255===bytes[i];)payloadType+=255,i++;for(payloadType+=bytes[i++];255===bytes[i];)payloadSize+=255,i++;if(payloadSize+=bytes[i++],!result.payload&&4===payloadType){if("GA94"===String.fromCharCode(bytes[i+3],bytes[i+4],bytes[i+5],bytes[i+6])){result.payloadType=payloadType,result.payloadSize=payloadSize,result.payload=bytes.subarray(i,i+payloadSize);break}result.payload=void 0}i+=payloadSize,payloadType=0,payloadSize=0}return result},parseUserData:function(sei){return 181!==sei.payload[0]||49!=(sei.payload[1]<<8|sei.payload[2])||"GA94"!==String.fromCharCode(sei.payload[3],sei.payload[4],sei.payload[5],sei.payload[6])||3!==sei.payload[7]?null:sei.payload.subarray(8,sei.payload.length-1)},parseCaptionPackets:function(pts,userData){var i,count,offset,data,results=[];if(!(64&userData[0]))return results;for(count=31&userData[0],i=0;i<count;i++)data={type:3&userData[(offset=3*i)+2],pts},4&userData[offset+2]&&(data.ccData=userData[offset+3]<<8|userData[offset+4],results.push(data));return results},discardEmulationPreventionBytes:function(data){for(var newLength,newData,length=data.byteLength,emulationPreventionBytesPositions=[],i=1;i<length-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(emulationPreventionBytesPositions.push(i+2),i+=2):i++;if(0===emulationPreventionBytesPositions.length)return data;newLength=length-emulationPreventionBytesPositions.length,newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===emulationPreventionBytesPositions[0]&&(sourceIndex++,emulationPreventionBytesPositions.shift()),newData[i]=data[sourceIndex];return newData},USER_DATA_REGISTERED_ITU_T_T35:4}},function(module,exports,__webpack_require__){"use strict";module.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},function(module,exports,__webpack_require__){"use strict";var ADTS_SAMPLING_FREQUENCIES=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],parseId3TagSize=function(header,byteIndex){var returnSize=header[byteIndex+6]<<21|header[byteIndex+7]<<14|header[byteIndex+8]<<7|header[byteIndex+9];return returnSize=returnSize>=0?returnSize:0,(16&header[byteIndex+5])>>4?returnSize+20:returnSize+10},getId3Offset=function(data,offset){return data.length-offset<10||data[offset]!=="I".charCodeAt(0)||data[offset+1]!=="D".charCodeAt(0)||data[offset+2]!=="3".charCodeAt(0)?offset:(offset+=parseId3TagSize(data,offset),getId3Offset(data,offset))},parseSyncSafeInteger=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]};module.exports={isLikelyAacData:function(data){var offset=getId3Offset(data,0);return data.length>=offset+2&&255==(255&data[offset])&&240==(240&data[offset+1])&&16==(22&data[offset+1])},parseId3TagSize,parseAdtsSize:function(header,byteIndex){var lowThree=(224&header[byteIndex+5])>>5,middle=header[byteIndex+4]<<3;return 6144&header[byteIndex+3]|middle|lowThree},parseType:function(header,byteIndex){return header[byteIndex]==="I".charCodeAt(0)&&header[byteIndex+1]==="D".charCodeAt(0)&&header[byteIndex+2]==="3".charCodeAt(0)?"timed-metadata":!0&header[byteIndex]&&240==(240&header[byteIndex+1])?"audio":null},parseSampleRate:function(packet){for(var i=0;i+5<packet.length;){if(255===packet[i]&&240==(246&packet[i+1]))return ADTS_SAMPLING_FREQUENCIES[(60&packet[i+2])>>>2];i++}return null},parseAacTimestamp:function(packet){var frameStart,frameSize,frame;frameStart=10,64&packet[5]&&(frameStart+=4,frameStart+=parseSyncSafeInteger(packet.subarray(10,14)));do{if((frameSize=parseSyncSafeInteger(packet.subarray(frameStart+4,frameStart+8)))<1)return null;if("PRIV"===String.fromCharCode(packet[frameStart],packet[frameStart+1],packet[frameStart+2],packet[frameStart+3])){frame=packet.subarray(frameStart+10,frameStart+frameSize+10);for(var i=0;i<frame.byteLength;i++)if(0===frame[i]){if("com.apple.streaming.transportStreamTimestamp"===unescape(function(bytes,start,end){var i,result="";for(i=start;i<end;i++)result+="%"+("00"+bytes[i].toString(16)).slice(-2);return result}(frame,0,i))){var d=frame.subarray(i+1),size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;return size*=4,size+=3&d[7]}break}}frameStart+=10,frameStart+=frameSize}while(frameStart<packet.byteLength);return null}}},function(module,exports,__webpack_require__){"use strict";(function(fetch){var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(__webpack_require__(8)),_logger=_interopRequireDefault(__webpack_require__(1)),_VipUtils=_interopRequireDefault(__webpack_require__(11)),_fingerprintjs=_interopRequireDefault(__webpack_require__(53));const{getHash}=_VipUtils.default;function pad2(num){const norm=Math.floor(Math.abs(num));return(norm<10?"0":"")+norm}function dateToIsoString(date){const tzo=-date.getTimezoneOffset(),dif=tzo>=0?"+":"-";return`${date.getFullYear()}-${pad2(date.getMonth()+1)}-${pad2(date.getDate())}T${pad2(date.getHours())}:${pad2(date.getMinutes())}:${pad2(date.getSeconds())}.${pad2(date.getMilliseconds()/10)}${dif}${pad2(tzo/60)}:${pad2(tzo%60)}`}class ReportDevice{constructor(deviceUid,deviceType,deviceOs){this.deviceUid=deviceUid,this.deviceType=deviceType,this.deviceOs=deviceOs}}class Reporter{constructor(options){(options=(0,_extends2.default)({},options||{})).key&&(_logger.default.deprecated("vip.setup/Reporter.constructor: please use app_key instead of key"),options.app_key=options.key,delete options.key),void 0!==options.no_reporting&&(_logger.default.deprecated("vip.setup/Reporter.constructor: no_reporting option was deprecated. please use activate_veygo_analytics: true if you want to activate it"),void 0===options.activate_veygo_analytics&&(options.activate_veygo_analytics=!options.no_reporting)),void 0===options.activate_veygo_analytics?(options.activate_veygo_analytics=!1,this.activateReportView=void 0===options.activateReportView||!!options.activateReportView):options.activate_veygo_analytics=!!options.activate_veygo_analytics,this._options=options,this.appKey=options.app_key,this.reporting=options.activate_veygo_analytics,this.device=Reporter.createDevice(options?options.device_id:void 0),this.pendingRequests_=0,this.active_=void 0,this.getSessionPromises=void 0,this.sessionToken=null,this.apiDevice=null,this.closeSessionWithSyncBinded=this.closeSessionWithSync.bind(this),this.lastContentName=null,this.batchEvents=[],this.nowMsFn=window.performance&&window.performance.now?()=>Math.floor(1e3*window.performance.now())/1e3:Date.now}analyticsUri(path,queryParams={}){return`${`https://${this.appKey.slice(0,10).toLowerCase()}.analytics.veygo.co`}/api/${path}${function formatParams(params){return"?"+Object.keys(params).map(key=>`${key}=${encodeURIComponent(params[key])}`).join("&")}(queryParams)}`}execute(method,path,queryParameters,data){const headers={};"GET"===method?data=void 0:headers["Content-Type"]="application/x-www-form-urlencoded",this.pendingRequests_+=1;const uri=this.analyticsUri(path,queryParameters||{});headers.Accept="application/json, application/vnd.veygo-analytics.v1";const fetchOptions={method,headers,credentials:"include"};return data&&(fetchOptions.body="json="+encodeURIComponent(JSON.stringify(data))),fetch(uri,fetchOptions).then(response=>{const code=response.status;return response.status>=300?{code,uri,headers,data}:response.json().then(json=>(this.pendingRequests_-=1,{code,uri,headers,data,json})).catch(()=>(this.pendingRequests_-=1,{code,uri,headers,data}))}).catch(error=>(this.pendingRequests_-=1,{uri,headers,reason:"failed_to_fetch",data,error:error.message}))}queue(api,params,flush=!1,sync=!1){if(this.batchEvents.length<6&&this.batchEvents.push([api,params]),this.sessionToken&&(flush||this.batchEvents.length>=6)){const apiEntryPoint=1===this.batchEvents.length?this.batchEvents[0][0]:"/batch",data=1===this.batchEvents.length?this.batchEvents[0][1]:{batch:this.batchEvents};if(sync){const uri=this.analyticsUri(apiEntryPoint,{stok:this.sessionToken}),async=!1,body=JSON.stringify(data);if(void 0!==navigator.sendBeacon){const options={type:"application/x-www-form-urlencoded"},beacon="json="+encodeURIComponent(body),blob=new Blob([beacon],options);navigator.sendBeacon(uri,blob)}else{const headers={"Content-Type":"application/json",Accept:"application/json, application/vnd.veygo-analytics.v1"},xhr=function createXhrObject(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject){const names=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];let i;for(i=0;i<names.length;i+=1){const name=name[i];try{return new ActiveXObject(name)}catch(e){}}}return null}();xhr.open("POST",uri,async),Object.entries(headers).forEach(([k,v])=>{xhr.setRequestHeader(k,v)}),xhr.send(body)}}else this.execute("POST",apiEntryPoint,{stok:this.sessionToken},data);this.batchEvents=[]}}static createDevice(deviceId){const deviceType=navigator.userAgent,deviceOs=navigator.platform||"unknown";return new ReportDevice(deviceId,deviceType,deviceOs)}reportEvent(name,data){const event={name,data};this.queue("events",{event,occured_at_ms:this.nowMsFn()})}reportEventView(playerIdx,name,position,data){this.queue("events",{event:{name,position,data},occured_at_ms:this.nowMsFn(),view:{player_idx:playerIdx}})}async openSession(customerUid,options={}){if("default"!==customerUid&&/\S+@\S+\.\S+/.test(customerUid)&&(customerUid=await getHash(customerUid)),this.getSessionPromises=[],this._customerUid)throw new Error("session_already_opened");return this.openSessionInternal(customerUid,options)}async openSessionInternal(customerUid,options={}){if(void 0===this.device.deviceUid){const components=await _fingerprintjs.default.getPromise(),deviceId=_fingerprintjs.default.x64hash128(components.map(c=>c.value).join(),31);this.device.deviceUid=deviceId}const app=options.app||this._options.app||{};this._customerUid=customerUid,this.apiDevice={os:this.device.deviceOs,type:this.device.deviceType,uid:this.device.deviceUid},this.active_=void 0,window.addEventListener("beforeunload",this.closeSessionWithSyncBinded);const data={app:{id:app.id,major_version:app.major_version||app.version,minor_version:app.minor_version},vip:{flavor:"web",version:window.vip.CONFIG_VIP_BUILD_ID},device:this.apiDevice,time:dateToIsoString(new Date),customer:{uid:customerUid},occured_at_ms:this.nowMsFn()},response=await this.execute("POST","sessions",{token:this.appKey},data);return response.error||401!==response.code?(this.active_=!0,response.json&&(this.sessionToken=response.json.stok)):this.active_=!1,this.active_}needSdkStatus(){if(void 0===this.getSessionPromises){this.getSessionPromises=[];const initAnalytics=[];initAnalytics.push(this.openSessionInternal(this._customerUid||"default")),Promise.all(initAnalytics).then(()=>(this.getSessionPromises.forEach(p=>p.resolve(this.sessionToken)),this.active_))}return Promise.resolve(void 0===this.active_||this.active_)}closeSession(){this.closeSessionWithSync(!1)}closeSessionWithSync(sync=!0){sync&&window.removeEventListener("beforeunload",this.closeSessionWithSyncBinded),this.queue("sessions/action",{action:"close",occured_at_ms:this.nowMsFn()},!0,sync),this.sessionToken=null,delete this.getSessionPromises}reportView(playerIdx,contentName,contentUrl,contentType="unknown",origin){!1!==this.activateReportView&&this.lastContentName!==contentName&&(this.lastContentName=contentName,this.queue("views",{view:{player_idx:playerIdx,content_type:contentType,content_name:contentName,content_url:contentUrl,origin},occured_at_ms:this.nowMsFn()}))}reportStreamStart(){}reportStreamStop(){}reportPlay(playerIdx,position){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"play",position)}reportPause(playerIdx,position){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"pause",position)}reportStop(playerIdx,position){return null===this.lastContentName||!1===this.reporting&&!1===this.activateReportView?(this.lastContentName=null,Promise.resolve()):(this.lastContentName=null,this.reportEventView(playerIdx,"stop",position))}reportSeekStart(playerIdx,position){}reportSeekStop(playerIdx,position){}reportStallStart(playerIdx,position){}reportStallStop(playerIdx,position){}reportBookmark(playerIdx,position){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"bookmark",position)}reportBandwidth(playerIdx,position,bandwidth){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"bandwidth",position,{bandwidth})}reportProfileSwitch(playerIdx,position,width,height,bitrate){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"profile_switch",position,{bitrate,width,height})}reportFrameDropped(playerIdx,position,count){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"frame_dropped",position,count)}reportStartBuffering(playerIdx,position){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"start_buffering",position)}reportStopBuffering(playerIdx,position){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"stop_buffering",position)}reportPlayerError(playerIdx,position,message){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"player_error",position,message)}reportSelectAudioTrack(playerIdx,position,language){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"select_audio_track",position,{language})}reportSelectSubtitles(playerIdx,position,language){return!1===this.reporting?Promise.resolve():this.reportEventView(playerIdx,"select_subtitles",position,{language})}reportSubscribeVodList(list){return!1===this.reporting?Promise.resolve():this.reportEvent("subscribe_vod_list",{vod_list:list})}reportScheduleRecording(content,time,duration){return!1===this.reporting?Promise.resolve():this.reportEvent("schedule_recording",{content,time,duration})}reportCapture(model,mask,alert){}reportProgress(playerIdx,position){}async checkForApplicationUpdate(appIds={}){if(void 0===this.device.deviceUid){const components=await _fingerprintjs.default.getPromise(),deviceId=_fingerprintjs.default.x64hash128(components.map(c=>c.value).join(),31);this.device.deviceUid=deviceId}const data={os:"web",device_type:this.device.deviceType,device_uid:this.device.deviceUid,device_os:this.device.deviceOs,token:this.appKey};appIds.major&&(data.major=appIds.major),appIds.minor&&(data.minor=appIds.minor);const{json}=await this.execute("GET","releases/verify",data);return json}pendingRequests(){return this.pendingRequests_>0}static factory(token){return new Reporter(token)}getVersion(){}setEventDelegate(){}destroy(){}isDead(){return!1}}exports.default=Reporter,Reporter.ViewOrigin={PLAYER:"PLAYER",LIVE:"LIVE",VOD:"VOD",CATCHUP:"CATCHUP",EPG:"EPG"},Reporter.ReportConnection={WIFI:"WIFI",DATA4G:"DATA4G",DATA3G:"DATA3G",DATA:"DATA"}}).call(this,__webpack_require__(52))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class Stream{constructor(name,uri,server,company,scheme,type,contentType){this.name=name,this.uri=uri,this.server=server,this.company=company,this.type=type,this.content_type=contentType,this["widevine.license_server"]=null,this["widevine.license_request_headers"]=null,this["playready.license_server"]=null,this["playready.license_request_headers"]=null,this["fairplay.license_server"]=null,this["fairplay.certificate_uri"]=null,this["fairplay.license_request_headers"]=null,this["hbola.operator_id"]=null,this["hbola.country_id"]=null,this["hbola.token_id"]=null}}exports.default=Stream,Stream.TYPE_HLS="hls",Stream.TYPE_DASH="dash",Stream.TYPE_MSS="smooth",Stream.TYPE_OTHER="other",Stream.CONTENT_VIDEO_LIVE="video_live",Stream.CONTENT_VIDEO_CLIP="video_clip",Stream.CONTENT_VIDEO_ON_DEMAND="vod",Stream.CONTENT_AUDIO_LIVE="audio_live",Stream.CONTENT_AUDIO_ON_DEMAND="audio_podcast"},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(__webpack_require__(8)),_FakeEventTarget=_interopRequireDefault(__webpack_require__(4)),_FakeEvent=_interopRequireDefault(__webpack_require__(3)),_MapUtils=_interopRequireDefault(__webpack_require__(55)),_logger=_interopRequireDefault(__webpack_require__(1)),_PlayerIds=_interopRequireDefault(__webpack_require__(9)),_Error=_interopRequireDefault(__webpack_require__(6));const NavigatorFamily_FIREFOX=0,NavigatorFamily_CHROME=1,NavigatorFamily_SAFARI_MOBILE=2,NavigatorFamily_SAFARI_MAC=3,NavigatorFamily_EDGE=4,NavigatorFamily_IE=5;class Player extends _FakeEventTarget.default{static registerPlayer(klass){Player.playerClasses[klass.id]=klass}static _ensureSetup(){Player.__ensureSetupDone||(Object.keys(Player.playerClasses).forEach(playerId=>{try{Player.playerClasses[playerId].setup()}catch(e){delete Player.playerClasses[playerId]}}),Object.keys(Player.playerClasses).forEach(playerId=>{void 0===Player._defaultPlayerId&&(Player._defaultPlayerId=playerId)}),Player.__ensureSetupDone=!0)}static _navigatorFamily(){let navigatorFamily;if(Player.__navigatorFamily)return Player.__navigatorFamily;const ua=navigator.userAgent.toLowerCase();return ua.indexOf(" edge/")>-1?navigatorFamily=NavigatorFamily_EDGE:-1!==ua.indexOf("safari")?navigatorFamily=ua.indexOf("chrome")>-1?NavigatorFamily_CHROME:/ipad|iphone|ipod/.test(ua)?NavigatorFamily_SAFARI_MOBILE:NavigatorFamily_SAFARI_MAC:-1!==ua.indexOf("applewebkit")?navigatorFamily=/ipad|iphone|ipod/.test(ua)?NavigatorFamily_SAFARI_MOBILE:NavigatorFamily_SAFARI_MAC:ua.indexOf("trident")>-1?navigatorFamily=NavigatorFamily_IE:(ua.indexOf("firefox")>-1||console.error("vip-player: unknown browser "+ua),navigatorFamily=NavigatorFamily_FIREFOX),Player.__navigatorFamily=navigatorFamily,navigatorFamily}constructor(element,reporter){super(),this.currentPlayer=null,this.element=element,this.reporter=reporter,this._toggledTracks=[];const subContainers=this.element.parentNode.getElementsByClassName("veygoSubsDisplayer");subContainers.length&&this.element.parentNode.removeChild(subContainers[0]),this.subsContainer=document.createElement("div"),this.subsContainer.classList.add("veygoSubsDisplayer"),this.element.parentNode.insertBefore(this.subsContainer,this.element.nextSibling),this.reporter=reporter,this.playerIdx=0,Player._ensureSetup(),this.element.addEventListener("ended",this._onMediaElementEnded.bind(this)),this.element.addEventListener("loadedmetadata",this._onMediaElementLoadedMetadata.bind(this)),this.element.addEventListener("canplay",this._onMediaElementCanPlay.bind(this)),this.element.addEventListener("play",this._onMediaElementPlay.bind(this)),this.element.addEventListener("playing",this._onMediaElementPlaying.bind(this)),this.element.addEventListener("pause",this._onMediaElementPause.bind(this)),this.element.addEventListener("seeking",this._onMediaElementSeeking.bind(this)),this.element.addEventListener("seeked",this._onMediaElementSeeked.bind(this)),this.plugins=[],this.defaults={}}destroy(){this.stream&&this.reporter.reportStop(this.playerIdx,this._getAnalyticsPosition()),this.plugins.forEach(p=>p.unlinkPlayer()),null!==this.currentPlayer&&(this.currentPlayer.destroy(),this.currentPlayer=null)}registerPlugin(plugin){plugin.linkPlayer(this),this.plugins.push(plugin)}dispatchError(error){this.dispatchEvent(error instanceof _FakeEvent.default?error:new _FakeEvent.default("error",error))}start(){const newEvent=new _FakeEvent.default("status",{status:"initialized"});this.dispatchEvent(newEvent)}setup(defaults){return(0,_extends2.default)(this.defaults,defaults),this.setupDone=!0,Promise.resolve()}getDrmProperty(){return Promise.resolve(null)}setMaxResolution(width,height){this.maxResolution={width,height},this.currentPlayer&&this.currentPlayer.setMaxResolution(width,height)}setAbrRestrictions(restrictions={}){let filteredRestrictions;filteredRestrictions=restrictions.playbackQuality?{playbackQuality:restrictions.playbackQuality}:void 0!==restrictions.max_height||void 0!==restrictions.min_height?{min_height:restrictions.min_height,max_height:restrictions.max_height}:void 0!==restrictions.min_bandwidth||void 0!==restrictions.max_bandwidth?{min_bandwidth:restrictions.min_bandwidth,max_bandwidth:restrictions.max_bandwidth}:{},this._restrictions=restrictions,this.currentPlayer&&this.currentPlayer.setAbrRestrictions(filteredRestrictions)}getAbrRestrictions(){return this.currentPlayer.getAbrRestrictions?this.currentPlayer.getAbrRestrictions():Promise.resolve(this._restrictions?{min_height:this._restrictions.min_height,max_height:this._restrictions.max_height}:{min_height:0,max_height:1/0})}getTrackSelection(){if(!this.currentPlayer)return{};const tracks=this.currentPlayer.getTracks();return Object.keys(tracks).reduce((acc,type)=>{const activeTrack=tracks[type].find(track=>track["is-active"]);return activeTrack&&(acc[type]=activeTrack),acc},{})}setTrackSelection(trackSelection){this.currentPlayer&&(["audio","text"].forEach(type=>{trackSelection[type]&&this.toggleTrack(trackSelection[type],!0)}),this.applyTracks())}notifyStartStreamConfiguration(stream){this._pluginDispatch("notifyStartStreamConfiguration",stream)}static _guessStreamType(stream){if(stream.type)return stream.type;if(void 0!==stream.uri){if(-1!==stream.uri.indexOf("m3u8"))return"hls";if(-1!==stream.uri.indexOf("mpd"))return"dash"}}async setSource(stream,options={}){this.stream=stream;let playerId=_PlayerIds.default.UNKNOWN;this.element.autoplay=void 0!==options.autoplay?options.autoplay:this.element.autoplay,delete this.restrictions_,options.streaming||(options.streaming={}),options.abr||(options.abr={}),this.firstPlayingDone=!1;const liveDelay=stream.liveDelay||options.liveDelay||options.streaming.liveDelay,streamType=Player._guessStreamType(stream);if("youtube"===streamType?playerId=_PlayerIds.default.YOUTUBE:Player._navigatorFamily()===NavigatorFamily_SAFARI_MOBILE?"hls"!==streamType&&"mp4"!==streamType||(playerId=_PlayerIds.default.HTML5):Player.playerClasses[_PlayerIds.default.VEYGOD]&&liveDelay&&liveDelay<12?(playerId=_PlayerIds.default.VEYGOD,Player._navigatorFamily()!==NavigatorFamily_IE&&Player._navigatorFamily()!==NavigatorFamily_EDGE||(delete(stream=(0,_extends2.default)({},stream)).liveDelay,delete(options=(0,_extends2.default)({},options)).liveDelay)):Player._navigatorFamily()===NavigatorFamily_SAFARI_MAC&&"hls"===streamType?playerId=_PlayerIds.default.HTML5:"hls"===streamType&&Player.playerClasses[_PlayerIds.default.HLSJS]?playerId=_PlayerIds.default.HLSJS:"mp4"!==streamType||stream.clear_keys||(playerId=_PlayerIds.default.HTML5),void 0===Player.playerClasses[playerId]&&(playerId=Player.playerClasses[_PlayerIds.default.VEYGA]?_PlayerIds.default.VEYGA:Player.playerClasses[_PlayerIds.default.HLSJS]&&"hls"===streamType?_PlayerIds.default.HLSJS:Player.playerClasses[_PlayerIds.default.VEYGOD]&&"dash"===streamType?_PlayerIds.default.VEYGOD:Player._defaultPlayerId),void 0===this.currentPlayerId||playerId!==this.currentPlayerId){null!==this.currentPlayer&&await this.currentPlayer.destroy();try{this.currentPlayer=new Player.playerClasses[playerId](this,this.element,this.subsContainer)}catch(e){throw new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.PLAYER,_Error.default.Code.FAILED_TO_CREATE_SESSION,"stream_not_supported")}if(this.currentPlayerId=playerId,this.currentPlayer.addEventListener("error",this._onPlayerError.bind(this)),this.currentPlayer.addEventListener("buffering",this._onPlayerBuffering.bind(this)),this.currentPlayer.addEventListener("trackschanged",this._onPlayerTracksChanged.bind(this)),this.currentPlayer.addEventListener("adaptation",this._onPlayerAdaptation.bind(this)),this.currentPlayer.addEventListener("streaming",this._onPlayerStreaming.bind(this)),this.currentPlayer.addEventListener("emsg",this._onPlayerEmsg.bind(this)),this._restrictions&&this.currentPlayer.setRestrictions(this._restrictions),this.maxResolution){const{width,height}=this.maxResolution;this.currentPlayer.setMaxResolution(width,height)}this.defaults["abr.initial_bandwidth_estimate"]&&this.currentPlayer.setInitialBandwidthEstimate(this.defaults["abr.initial_bandwidth_estimate"])}let setSourcePromise;for(let i=0;i<this.plugins.length;i+=1){const plugin=this.plugins[i];if(plugin.proxy&&(setSourcePromise=plugin.proxy(stream),setSourcePromise))break}const newStream=setSourcePromise?await setSourcePromise:stream;if(!await this.reporter.needSdkStatus())throw new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.PLAYER,_Error.default.Code.VIP_SDK_NOT_ACTIVE);const{content_type:contentType}=newStream,origin=options.origin||"unreported";this.reporter.reportView(this.playerIdx,newStream.name,newStream.uri,contentType,origin);return await this.currentPlayer.setSource(newStream,options||{}).catch(error=>{throw this.dispatchError(error),error})}getSource(){return this.stream}getTimeInfo(){return this.currentPlayer?Promise.resolve(this.currentPlayer.getTimeInfo()):null}isBuffering(){return this.buffering}freeze(resetPosition){return this.offlineDb&&this.offlineDb.bookmark(this.stream,resetPosition),this._pluginDispatch("onPlayerStreamingEnd"),this.reporter.reportStop(this.playerIdx,this._getAnalyticsPosition()),this.currentPlayer?this.currentPlayer.freeze():(this.stream=null,null)}play(){return this.paused=!1,this.currentPlayer.play&&this.currentPlayer.play()||this.element.play()||Promise.resolve()}pause(){return this.paused=!0,this.currentPlayer.pause&&this.currentPlayer.pause()||this.element.pause()||Promise.resolve()}seekTo(position){if(!this.currentPlayer)throw new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.PLAYER,_Error.default.Code.SOURCE_NOT_SET);return this.seeking=!0,this._pluginDispatch("onPlayerSeeking",{to:position,speed:0}),this.currentPlayer.seek(position)}getTracks(){if(!this.currentPlayer)throw new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.PLAYER,_Error.default.Code.SOURCE_NOT_SET);return this.currentPlayer.getTracks()}toggleTrack(track,enable){this._toggledTracks.push({track,enable})}async applyTracks(){if(!this.currentPlayer)return null;const beforeTracks=this.currentPlayer.getTracks(),afterTracks=await this.currentPlayer.applyTracks(this._toggledTracks);return["audio","text"].forEach(type=>{const beforeTrack=beforeTracks[type].find(track=>track["is-active"]),afterTrack=afterTracks[type].find(track=>track["is-active"]);if((beforeTrack||{}).reference!==(afterTrack||{}).reference){const language=afterTrack?afterTrack.language:"",position=this._getAnalyticsPosition();"text"===type?this.reporter.reportSelectSubtitles(this.playerIdx,position,language):this.reporter.reportSelectAudioTrack(this.playerIdx,position,language)}}),this._toggledTracks=[],afterTracks}getVolume(){return{muted:this.element.muted,volume:this.element.volume}}setVolume(setVolumeParam){if("number"==typeof setVolumeParam&&(_logger.default.deprecated("setVolume API with number is deprecated, please use { volumed, muted } object"),setVolumeParam={muted:0===setVolumeParam,volume:setVolumeParam}),this.currentPlayer&&this.currentPlayer.setVolume)setVolumeParam=this.currentPlayer.setVolume(setVolumeParam);else{const{volume,muted}=setVolumeParam;void 0!==volume&&(this.element.volume=volume),void 0!==muted&&(this.element.muted=muted,setVolumeParam.volume=this.element.volume)}this._pluginDispatch("onPlayerVolume",setVolumeParam)}getThumbnail(positionMs){return this.currentPlayer&&this.currentPlayer.getThumbnail?this.currentPlayer.getThumbnail(positionMs):Promise.resolve(null)}getStats(){return this.currentPlayer?this.currentPlayer.getStats():null}static _toShortEventName(eventName){const str=eventName.replace(Player._toShortEventNameRegex,"");return`${str[0].toLowerCase()}${str.slice(1)}`}_pluginDispatch(eventName,data){const shortName=Player._toShortEventName(eventName);"emsg"!==eventName&&this.dispatchEvent(new _FakeEvent.default(shortName,data));for(let i=0;i<this.plugins.length;i+=1){const plugin=this.plugins[i];plugin[eventName]&&plugin[eventName](data)}}_onPlayerError(errorEvent){const sdkError=errorEvent.error;this.reporter.reportPlayerError(this.playerIdx,this._getAnalyticsPosition(),`${sdkError.category}:${sdkError.code}:${sdkError.message}`),this._dispatchStatus("error",sdkError)}_onPlayerStreaming(){this._pluginDispatch("onPlayerPeriod")}_onPlayerEmsg(event){this._pluginDispatch("onPlayerEmsg",event)}_onMediaElementLoadedMetadata(){this.earlyOnLoadedMetadataCanPlay=Player._navigatorFamily()===NavigatorFamily_SAFARI_MOBILE||Player._navigatorFamily()===NavigatorFamily_SAFARI_MAC||Player._navigatorFamily()===NavigatorFamily_EDGE||Player._navigatorFamily()===NavigatorFamily_IE,this.earlyOnLoadedMetadataCanPlay&&(this._dispatchStatus("ready"),this._pluginDispatch("onPlayerCanPlay"))}_onMediaElementCanPlay(){this.firstPlayingDone||this.earlyOnLoadedMetadataCanPlay||(this._dispatchStatus("ready"),this._pluginDispatch("onPlayerCanPlay"))}_onMediaElementEnded(){const stats=this.currentPlayer.getStats();!Number.isNaN(stats.droppedFrames)&&stats.droppedFrames>0&&this.reporter.reportFrameDropped(this.playerIdx,this._getAnalyticsPosition(),stats.droppedFrames),this._pluginDispatch("onPlayerEndReached",{speed:0}),this._dispatchStatus("ended")}_onMediaElementPlay(){this._pluginDispatch("onPlayerPlay"),null===this.currentPlayer||this.playing||this.reporter.reportPlay(this.playerIdx,this._getAnalyticsPosition()),this.playing=!0}_onMediaElementPlaying(){let reason;this.firstPlayingDone?this.seeking?(this.seeking=!1,reason="seeked"):reason="unpaused":(reason="firstPlay",this.firstPlayingDone=!0,this._dispatchStatus("playing")),this._pluginDispatch("onPlayerPlaying",{reason,speed:1}),this.playing||this.reporter.reportPlay(this.playerIdx,this._getAnalyticsPosition()),this.playing=!0}_onMediaElementPause(){this._pluginDispatch("onPlayerPause",{speed:0}),this.playing&&this.reporter.reportPause(this.playerIdx,this._getAnalyticsPosition()),this.playing=!1}_onMediaElementSeeking(){this.firstPlayingDone&&(this.seeking=!0)}_onMediaElementSeeked(){this._pluginDispatch("onPlayerSeeked",{speed:this.paused?0:1}),this.paused&&(this.seeking=!1)}_onPlayerBuffering(event){const{buffering}=event;buffering?(this.buffering||(this.reporter.reportStartBuffering(this.playerIdx,this._getAnalyticsPosition()),this._dispatchStatus("buffering")),this.buffering=!0):(this.buffering&&this.reporter.reportStopBuffering(this.playerIdx,this._getAnalyticsPosition()),this.buffering=!1);const{firstPlayingDone}=this;let reason,eventName;firstPlayingDone?this.seeking||(buffering?(this.stalled=!0,eventName="onPlayerStalled",reason="underflow"):!0===this.stalled&&(this.stalled=!1,eventName="onPlayerPlaying",reason="underflow",this._dispatchStatus("playing"))):buffering&&(eventName="onPlayerBuffering",reason="firstPlay"),eventName&&reason&&this._pluginDispatch(eventName,{reason,speed:this.buffering?0:1})}_onPlayerTracksChanged(){this._pluginDispatch("onPlayerTracksChanged")}_onPlayerAdaptation(){const stats=this.currentPlayer.getStats();if(stats.streamBandwidth){if(this.lastStreamBandwidth===stats.streamBandwidth)return;const position=this._getAnalyticsPosition();this.reporter.reportProfileSwitch(this.playerIdx,position,stats.width,stats.height,stats.streamBandwidth),this.reporter.reportBandwidth(this.playerIdx,position,stats.estimatedBandwidth),this._pluginDispatch("onPlayerAdaptation",{detail:{video:{id:stats.variantVideoId,width:stats.width,height:stats.height},streamBandwidth:stats.streamBandwidth,estimatedBandwidth:stats.estimatedBandwidth}}),this.lastStreamBandwidth=stats.streamBandwidth}else if(stats.playbackQuality){if(this.lastPlaybackQuality===stats.playbackQuality)return;this._pluginDispatch("onPlayerAdaptation",{detail:{video:{id:stats.playbackQuality},playbackQuality:stats.playbackQuality}}),this.lastPlaybackQuality=stats.playbackQuality}}_getAnalyticsPosition(){if(null===this.currentPlayer)return 0;const ti=this.currentPlayer.getTimeInfo();return null===ti?0:Math.round((ti.position?ti.position-ti.seekRange[0]:0)/1e3)}_dispatchStatus(status,what){const newEvent=new _FakeEvent.default("status",{status,what});this.dispatchEvent(newEvent)}static async probeDrmSupport(){if("undefined"!=typeof WebKitMediaKeys)return WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")?{fairplay:{persistentMediaFiles:!1,persistentLicense:!1}}:{};const testKeySystems={"com.widevine.alpha":"widevine","com.apple.fps.2_0":"fairplay","com.apple.fps.1_0":"fairplay","com.apple.fps":"fairplay","com.adobe.primetime":"primetime"};const basicVideoCapabilities=[{robustness:"SW_SECURE_CRYPTO",contentType:'video/mp4; codecs="avc1.42E01E"'},{robustness:"SW_SECURE_CRYPTO",contentType:'video/webm; codecs="vp8"'}],configs=[{videoCapabilities:basicVideoCapabilities,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:basicVideoCapabilities}],support=new Map,tests=Object.keys(testKeySystems).map(async keySystem=>{try{const access=await navigator.requestMediaKeySystemAccess(keySystem,configs),{sessionTypes}=access.getConfiguration(),persistentLicense=!!sessionTypes&&sessionTypes.includes("persistent-license");support.set(keySystem,{persistentLicense,persistentMediaFiles:!0}),await access.createMediaKeys()}catch(e){}});await Promise.all(tests);const drmSupport=_MapUtils.default.asObject(support);return Object.entries(drmSupport).reduce((acc,[k,v])=>(acc[testKeySystems[k]]=v,acc),{})}static probeSupport(stream,options={}){let playerId;Player._ensureSetup();const streamType=Player._guessStreamType(stream);return Player._navigatorFamily()===NavigatorFamily_SAFARI_MOBILE?"hls"!==streamType&&"mp4"!==streamType||(playerId=_PlayerIds.default.HTML5):Player.playerClasses[_PlayerIds.default.VEYGOD]&&(stream.liveDelay||options.liveDelay)?playerId=_PlayerIds.default.VEYGOD:"mp4"===streamType?playerId=_PlayerIds.default.HTML5:Player._navigatorFamily()===NavigatorFamily_SAFARI_MAC?"hls"===streamType?playerId=_PlayerIds.default.HTML5:Player.playerClasses[_PlayerIds.default.VEYGA]&&(playerId=_PlayerIds.default.VEYGA):playerId=Player.playerClasses[_PlayerIds.default.VEYGA]?_PlayerIds.default.VEYGA:Player._defaultPlayerId,{canStream:void 0!==playerId,persistentMediaFiles:playerId===_PlayerIds.default.VEYGA}}}Player.playerClasses={},Player.playerPluginClasses={},Player._toShortEventNameRegex=/^onPlayer/;var _default=Player;exports.default=_default},,,function(module,exports,__webpack_require__){module.exports=__webpack_require__(30)},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0),_mux=_interopRequireDefault(__webpack_require__(31)),_FakeEvent=_interopRequireDefault(__webpack_require__(3)),_FakeEventTarget=_interopRequireDefault(__webpack_require__(4)),_PublicPromise=_interopRequireDefault(__webpack_require__(51)),_VipUtils=_interopRequireDefault(__webpack_require__(11)),_VipReporter=_interopRequireDefault(__webpack_require__(24)),_VipStream=_interopRequireDefault(__webpack_require__(25)),_VipPlayer=_interopRequireDefault(__webpack_require__(26)),_Error=_interopRequireDefault(__webpack_require__(6)),_VipSetup=(_interopRequireDefault(__webpack_require__(12)),_interopRequireDefault(__webpack_require__(56)));window.muxjs=_mux.default;const vip={CONFIG_VIP_VERSION:"5.4.50",CONFIG_VIP_BUILD_ID:"alphanetworks-beemix-5.4.50-default-0c61b93-release",Utils:_VipUtils.default,internal:{FakeEvent:_FakeEvent.default,FakeEventTarget:_FakeEventTarget.default,PlayerError:_Error.default,PublicPromise:_PublicPromise.default},Reporter:_VipReporter.default,Stream:_VipStream.default,Player:_VipPlayer.default,setup:_VipSetup.default};{const PlayerContent=__webpack_require__(12).default;vip.PlayerContent=PlayerContent}{const PlayerHTML5=__webpack_require__(57).default;_VipPlayer.default.registerPlayer(PlayerHTML5)}{const PlayerVeyga=__webpack_require__(58).default;_VipPlayer.default.registerPlayer(PlayerVeyga)}{const PlayerHlsJs=__webpack_require__(71).default;_VipPlayer.default.registerPlayer(PlayerHlsJs)}for(var k in vip)exports[k]=vip[k];window.vip=vip},function(module,exports,__webpack_require__){"use strict";var muxjs={mp4:__webpack_require__(32)};module.exports=muxjs},function(module,exports,__webpack_require__){"use strict";module.exports={generator:__webpack_require__(14),probe:__webpack_require__(33),Transmuxer:__webpack_require__(10).Transmuxer,AudioSegmentStream:__webpack_require__(10).AudioSegmentStream,VideoSegmentStream:__webpack_require__(10).VideoSegmentStream,CaptionParser:__webpack_require__(48)}},function(module,exports,__webpack_require__){"use strict";var timescale,startTime,compositionStartTime,getVideoTrackIds,getTracks,getTimescaleFromMediaHeader,toUnsigned=__webpack_require__(7).toUnsigned,toHexString=__webpack_require__(7).toHexString,findBox=__webpack_require__(15),parseType=__webpack_require__(16),parseTfhd=__webpack_require__(17),parseTrun=__webpack_require__(18),parseTfdt=__webpack_require__(19);timescale=function(init){return findBox(init,["moov","trak"]).reduce((function(result,trak){var tkhd,version,index,id,mdhd;return(tkhd=findBox(trak,["tkhd"])[0])?(version=tkhd[0],id=toUnsigned(tkhd[index=0===version?12:20]<<24|tkhd[index+1]<<16|tkhd[index+2]<<8|tkhd[index+3]),(mdhd=findBox(trak,["mdia","mdhd"])[0])?(index=0===(version=mdhd[0])?12:20,result[id]=toUnsigned(mdhd[index]<<24|mdhd[index+1]<<16|mdhd[index+2]<<8|mdhd[index+3]),result):null):null}),{})},startTime=function(timescale,fragment){var trafs,baseTimes,result;return trafs=findBox(fragment,["moof","traf"]),baseTimes=[].concat.apply([],trafs.map((function(traf){return findBox(traf,["tfhd"]).map((function(tfhd){var id,scale,baseTime;return id=toUnsigned(tfhd[4]<<24|tfhd[5]<<16|tfhd[6]<<8|tfhd[7]),scale=timescale[id]||9e4,(baseTime="number"!=typeof(baseTime=findBox(traf,["tfdt"]).map((function(tfdt){var version,result;return version=tfdt[0],result=toUnsigned(tfdt[4]<<24|tfdt[5]<<16|tfdt[6]<<8|tfdt[7]),1===version&&(result*=Math.pow(2,32),result+=toUnsigned(tfdt[8]<<24|tfdt[9]<<16|tfdt[10]<<8|tfdt[11])),result}))[0])||isNaN(baseTime)?1/0:baseTime)/scale}))}))),result=Math.min.apply(null,baseTimes),isFinite(result)?result:0},compositionStartTime=function(timescales,fragment){var trackId,trafBoxes=findBox(fragment,["moof","traf"]),baseMediaDecodeTime=0,compositionTimeOffset=0;if(trafBoxes&&trafBoxes.length){var tfhd=findBox(trafBoxes[0],["tfhd"])[0],trun=findBox(trafBoxes[0],["trun"])[0],tfdt=findBox(trafBoxes[0],["tfdt"])[0];if(tfhd)trackId=parseTfhd(tfhd).trackId;if(tfdt)baseMediaDecodeTime=parseTfdt(tfdt).baseMediaDecodeTime;if(trun){var parsedTrun=parseTrun(trun);parsedTrun.samples&&parsedTrun.samples.length&&(compositionTimeOffset=parsedTrun.samples[0].compositionTimeOffset||0)}}return(baseMediaDecodeTime+compositionTimeOffset)/(timescales[trackId]||9e4)},getVideoTrackIds=function(init){var traks=findBox(init,["moov","trak"]),videoTrackIds=[];return traks.forEach((function(trak){var hdlrs=findBox(trak,["mdia","hdlr"]),tkhds=findBox(trak,["tkhd"]);hdlrs.forEach((function(hdlr,index){var view,trackId,handlerType=parseType(hdlr.subarray(8,12)),tkhd=tkhds[index];"vide"===handlerType&&(trackId=0===(view=new DataView(tkhd.buffer,tkhd.byteOffset,tkhd.byteLength)).getUint8(0)?view.getUint32(12):view.getUint32(20),videoTrackIds.push(trackId))}))})),videoTrackIds},getTimescaleFromMediaHeader=function(mdhd){var index=0===mdhd[0]?12:20;return toUnsigned(mdhd[index]<<24|mdhd[index+1]<<16|mdhd[index+2]<<8|mdhd[index+3])},getTracks=function(init){var traks=findBox(init,["moov","trak"]),tracks=[];return traks.forEach((function(trak){var view,tkhdVersion,track={},tkhd=findBox(trak,["tkhd"])[0];tkhd&&(tkhdVersion=(view=new DataView(tkhd.buffer,tkhd.byteOffset,tkhd.byteLength)).getUint8(0),track.id=0===tkhdVersion?view.getUint32(12):view.getUint32(20));var hdlr=findBox(trak,["mdia","hdlr"])[0];if(hdlr){var type=parseType(hdlr.subarray(8,12));track.type="vide"===type?"video":"soun"===type?"audio":type}var stsd=findBox(trak,["mdia","minf","stbl","stsd"])[0];if(stsd){var sampleDescriptions=stsd.subarray(8);track.codec=parseType(sampleDescriptions.subarray(4,8));var codecConfig,codecBox=findBox(sampleDescriptions,[track.codec])[0];codecBox&&(/^[a-z]vc[1-9]$/i.test(track.codec)?(codecConfig=codecBox.subarray(78),"avcC"===parseType(codecConfig.subarray(4,8))&&codecConfig.length>11?(track.codec+=".",track.codec+=toHexString(codecConfig[9]),track.codec+=toHexString(codecConfig[10]),track.codec+=toHexString(codecConfig[11])):track.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(track.codec)?(codecConfig=codecBox.subarray(28),"esds"===parseType(codecConfig.subarray(4,8))&&codecConfig.length>20&&0!==codecConfig[19]?(track.codec+="."+toHexString(codecConfig[19]),track.codec+="."+toHexString(codecConfig[20]>>>2&63).replace(/^0/,"")):track.codec="mp4a.40.2"):track.codec=track.codec.toLowerCase())}var mdhd=findBox(trak,["mdia","mdhd"])[0];mdhd&&(track.timescale=getTimescaleFromMediaHeader(mdhd)),tracks.push(track)})),tracks},module.exports={findBox,parseType,timescale,startTime,compositionStartTime,videoTrackIds:getVideoTrackIds,tracks:getTracks,getTimescaleFromMediaHeader}},function(module,exports,__webpack_require__){"use strict";module.exports=function(flags){return{isLeading:(12&flags[0])>>>2,dependsOn:3&flags[0],isDependedOn:(192&flags[1])>>>6,hasRedundancy:(48&flags[1])>>>4,paddingValue:(14&flags[1])>>>1,isNonSyncSample:1&flags[1],degradationPriority:flags[2]<<8|flags[3]}}},function(module,exports,__webpack_require__){"use strict";var sampleForFrame=function(frame,dataOffset){var sample={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return sample.dataOffset=dataOffset,sample.compositionTimeOffset=frame.pts-frame.dts,sample.duration=frame.duration,sample.size=4*frame.length,sample.size+=frame.byteLength,frame.keyFrame&&(sample.flags.dependsOn=2,sample.flags.isNonSyncSample=0),sample};module.exports={groupNalsIntoFrames:function(nalUnits){var i,currentNal,currentFrame=[],frames=[];for(frames.byteLength=0,frames.nalCount=0,frames.duration=0,currentFrame.byteLength=0,i=0;i<nalUnits.length;i++)"access_unit_delimiter_rbsp"===(currentNal=nalUnits[i]).nalUnitType?(currentFrame.length&&(currentFrame.duration=currentNal.dts-currentFrame.dts,frames.byteLength+=currentFrame.byteLength,frames.nalCount+=currentFrame.length,frames.duration+=currentFrame.duration,frames.push(currentFrame)),(currentFrame=[currentNal]).byteLength=currentNal.data.byteLength,currentFrame.pts=currentNal.pts,currentFrame.dts=currentNal.dts):("slice_layer_without_partitioning_rbsp_idr"===currentNal.nalUnitType&&(currentFrame.keyFrame=!0),currentFrame.duration=currentNal.dts-currentFrame.dts,currentFrame.byteLength+=currentNal.data.byteLength,currentFrame.push(currentNal));return frames.length&&(!currentFrame.duration||currentFrame.duration<=0)&&(currentFrame.duration=frames[frames.length-1].duration),frames.byteLength+=currentFrame.byteLength,frames.nalCount+=currentFrame.length,frames.duration+=currentFrame.duration,frames.push(currentFrame),frames},groupFramesIntoGops:function(frames){var i,currentFrame,currentGop=[],gops=[];for(currentGop.byteLength=0,currentGop.nalCount=0,currentGop.duration=0,currentGop.pts=frames[0].pts,currentGop.dts=frames[0].dts,gops.byteLength=0,gops.nalCount=0,gops.duration=0,gops.pts=frames[0].pts,gops.dts=frames[0].dts,i=0;i<frames.length;i++)(currentFrame=frames[i]).keyFrame?(currentGop.length&&(gops.push(currentGop),gops.byteLength+=currentGop.byteLength,gops.nalCount+=currentGop.nalCount,gops.duration+=currentGop.duration),(currentGop=[currentFrame]).nalCount=currentFrame.length,currentGop.byteLength=currentFrame.byteLength,currentGop.pts=currentFrame.pts,currentGop.dts=currentFrame.dts,currentGop.duration=currentFrame.duration):(currentGop.duration+=currentFrame.duration,currentGop.nalCount+=currentFrame.length,currentGop.byteLength+=currentFrame.byteLength,currentGop.push(currentFrame));return gops.length&&currentGop.duration<=0&&(currentGop.duration=gops[gops.length-1].duration),gops.byteLength+=currentGop.byteLength,gops.nalCount+=currentGop.nalCount,gops.duration+=currentGop.duration,gops.push(currentGop),gops},extendFirstKeyFrame:function(gops){var currentGop;return!gops[0][0].keyFrame&&gops.length>1&&(currentGop=gops.shift(),gops.byteLength-=currentGop.byteLength,gops.nalCount-=currentGop.nalCount,gops[0][0].dts=currentGop.dts,gops[0][0].pts=currentGop.pts,gops[0][0].duration+=currentGop.duration),gops},generateSampleTable:function(gops,baseDataOffset){var h,i,sample,currentGop,currentFrame,dataOffset=baseDataOffset||0,samples=[];for(h=0;h<gops.length;h++)for(currentGop=gops[h],i=0;i<currentGop.length;i++)currentFrame=currentGop[i],dataOffset+=(sample=sampleForFrame(currentFrame,dataOffset)).size,samples.push(sample);return samples},concatenateNalData:function(gops){var h,i,j,currentGop,currentFrame,currentNal,dataOffset=0,nalsByteLength=gops.byteLength,numberOfNals=gops.nalCount,data=new Uint8Array(nalsByteLength+4*numberOfNals),view=new DataView(data.buffer);for(h=0;h<gops.length;h++)for(currentGop=gops[h],i=0;i<currentGop.length;i++)for(currentFrame=currentGop[i],j=0;j<currentFrame.length;j++)currentNal=currentFrame[j],view.setUint32(dataOffset,currentNal.data.byteLength),dataOffset+=4,data.set(currentNal.data,dataOffset),dataOffset+=currentNal.data.byteLength;return data},generateSampleTableForFrame:function(frame,baseDataOffset){var sample,samples=[];return sample=sampleForFrame(frame,baseDataOffset||0),samples.push(sample),samples},concatenateNalDataForFrame:function(frame){var i,currentNal,dataOffset=0,nalsByteLength=frame.byteLength,numberOfNals=frame.length,data=new Uint8Array(nalsByteLength+4*numberOfNals),view=new DataView(data.buffer);for(i=0;i<frame.length;i++)currentNal=frame[i],view.setUint32(dataOffset,currentNal.data.byteLength),dataOffset+=4,data.set(currentNal.data,dataOffset),dataOffset+=currentNal.data.byteLength;return data}}},function(module,exports,__webpack_require__){"use strict";var coneOfSilence=__webpack_require__(37),clock=__webpack_require__(5);module.exports={prefixWithSilence:function(track,frames,audioAppendStartTs,videoBaseMediaDecodeTime){var baseMediaDecodeTimeTs,frameDuration,silentFrame,i,firstFrame,audioGapDuration=0,audioFillFrameCount=0,audioFillDuration=0;if(frames.length&&(baseMediaDecodeTimeTs=clock.audioTsToVideoTs(track.baseMediaDecodeTime,track.samplerate),frameDuration=Math.ceil(clock.ONE_SECOND_IN_TS/(track.samplerate/1024)),audioAppendStartTs&&videoBaseMediaDecodeTime&&(audioGapDuration=baseMediaDecodeTimeTs-Math.max(audioAppendStartTs,videoBaseMediaDecodeTime),audioFillDuration=(audioFillFrameCount=Math.floor(audioGapDuration/frameDuration))*frameDuration),!(audioFillFrameCount<1||audioFillDuration>clock.ONE_SECOND_IN_TS/2))){for((silentFrame=coneOfSilence()[track.samplerate])||(silentFrame=frames[0].data),i=0;i<audioFillFrameCount;i++)firstFrame=frames[0],frames.splice(0,0,{data:silentFrame,dts:firstFrame.dts-frameDuration,pts:firstFrame.pts-frameDuration});return track.baseMediaDecodeTime-=Math.floor(clock.videoTsToAudioTs(audioFillDuration,track.samplerate)),audioFillDuration}},trimAdtsFramesByEarliestDts:function(adtsFrames,track,earliestAllowedDts){return track.minSegmentDts>=earliestAllowedDts?adtsFrames:(track.minSegmentDts=1/0,adtsFrames.filter((function(currentFrame){return currentFrame.dts>=earliestAllowedDts&&(track.minSegmentDts=Math.min(track.minSegmentDts,currentFrame.dts),track.minSegmentPts=track.minSegmentDts,!0)})))},generateSampleTable:function(frames){var i,currentFrame,samples=[];for(i=0;i<frames.length;i++)currentFrame=frames[i],samples.push({size:currentFrame.data.byteLength,duration:1024});return samples},concatenateFrameData:function(frames){var i,currentFrame,dataOffset=0,data=new Uint8Array(function(array){var i,sum=0;for(i=0;i<array.length;i++)sum+=array[i].data.byteLength;return sum}(frames));for(i=0;i<frames.length;i++)currentFrame=frames[i],data.set(currentFrame.data,dataOffset),dataOffset+=currentFrame.data.byteLength;return data}}},function(module,exports,__webpack_require__){"use strict";var silence,highPrefix=[33,16,5,32,164,27],lowPrefix=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],zeroFill=function(count){for(var a=[];count--;)a.push(0);return a};module.exports=function(){if(!silence){var coneOfSilence={96e3:[highPrefix,[227,64],zeroFill(154),[56]],88200:[highPrefix,[231],zeroFill(170),[56]],64e3:[highPrefix,[248,192],zeroFill(240),[56]],48e3:[highPrefix,[255,192],zeroFill(268),[55,148,128],zeroFill(54),[112]],44100:[highPrefix,[255,192],zeroFill(268),[55,163,128],zeroFill(84),[112]],32e3:[highPrefix,[255,192],zeroFill(268),[55,234],zeroFill(226),[112]],24e3:[highPrefix,[255,192],zeroFill(268),[55,255,128],zeroFill(268),[111,112],zeroFill(126),[224]],16e3:[highPrefix,[255,192],zeroFill(268),[55,255,128],zeroFill(268),[111,255],zeroFill(269),[223,108],zeroFill(195),[1,192]],12e3:[lowPrefix,zeroFill(268),[3,127,248],zeroFill(268),[6,255,240],zeroFill(268),[13,255,224],zeroFill(268),[27,253,128],zeroFill(259),[56]],11025:[lowPrefix,zeroFill(268),[3,127,248],zeroFill(268),[6,255,240],zeroFill(268),[13,255,224],zeroFill(268),[27,255,192],zeroFill(268),[55,175,128],zeroFill(108),[112]],8e3:[lowPrefix,zeroFill(268),[3,121,16],zeroFill(47),[7]]};metaTable=coneOfSilence,silence=Object.keys(metaTable).reduce((function(obj,key){return obj[key]=new Uint8Array(metaTable[key].reduce((function(arr,part){return arr.concat(part)}),[])),obj}),{})}var metaTable;return silence}},function(module,exports,__webpack_require__){"use strict";var ONE_SECOND_IN_TS=__webpack_require__(5).ONE_SECOND_IN_TS;module.exports={clearDtsInfo:function(track){delete track.minSegmentDts,delete track.maxSegmentDts,delete track.minSegmentPts,delete track.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(track,keepOriginalTimestamps){var baseMediaDecodeTime,minSegmentDts=track.minSegmentDts;return keepOriginalTimestamps||(minSegmentDts-=track.timelineStartInfo.dts),baseMediaDecodeTime=track.timelineStartInfo.baseMediaDecodeTime,baseMediaDecodeTime+=minSegmentDts,baseMediaDecodeTime=Math.max(0,baseMediaDecodeTime),"audio"===track.type&&(baseMediaDecodeTime*=track.samplerate/ONE_SECOND_IN_TS,baseMediaDecodeTime=Math.floor(baseMediaDecodeTime)),baseMediaDecodeTime},collectDtsInfo:function(track,data){"number"==typeof data.pts&&(void 0===track.timelineStartInfo.pts&&(track.timelineStartInfo.pts=data.pts),void 0===track.minSegmentPts?track.minSegmentPts=data.pts:track.minSegmentPts=Math.min(track.minSegmentPts,data.pts),void 0===track.maxSegmentPts?track.maxSegmentPts=data.pts:track.maxSegmentPts=Math.max(track.maxSegmentPts,data.pts)),"number"==typeof data.dts&&(void 0===track.timelineStartInfo.dts&&(track.timelineStartInfo.dts=data.dts),void 0===track.minSegmentDts?track.minSegmentDts=data.dts:track.minSegmentDts=Math.min(track.minSegmentDts,data.dts),void 0===track.maxSegmentDts?track.maxSegmentDts=data.dts:track.maxSegmentDts=Math.max(track.maxSegmentDts,data.dts))}}},function(module,exports,__webpack_require__){"use strict";var TransportPacketStream,TransportParseStream,ElementaryStream,Stream=__webpack_require__(2),CaptionStream=__webpack_require__(20),StreamTypes=__webpack_require__(22),TimestampRolloverStream=__webpack_require__(40).TimestampRolloverStream;(TransportPacketStream=function(){var buffer=new Uint8Array(188),bytesInBuffer=0;TransportPacketStream.prototype.init.call(this),this.push=function(bytes){var everything,startIndex=0,endIndex=188;for(bytesInBuffer?((everything=new Uint8Array(bytes.byteLength+bytesInBuffer)).set(buffer.subarray(0,bytesInBuffer)),everything.set(bytes,bytesInBuffer),bytesInBuffer=0):everything=bytes;endIndex<everything.byteLength;)71!==everything[startIndex]||71!==everything[endIndex]?(startIndex++,endIndex++):(this.trigger("data",everything.subarray(startIndex,endIndex)),startIndex+=188,endIndex+=188);startIndex<everything.byteLength&&(buffer.set(everything.subarray(startIndex),0),bytesInBuffer=everything.byteLength-startIndex)},this.flush=function(){188===bytesInBuffer&&71===buffer[0]&&(this.trigger("data",buffer),bytesInBuffer=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){bytesInBuffer=0,this.trigger("reset")}}).prototype=new Stream,(TransportParseStream=function(){var parsePsi,parsePat,parsePmt,self;TransportParseStream.prototype.init.call(this),self=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,parsePsi=function(payload,psi){var offset=0;psi.payloadUnitStartIndicator&&(offset+=payload[offset]+1),"pat"===psi.type?parsePat(payload.subarray(offset),psi):parsePmt(payload.subarray(offset),psi)},parsePat=function(payload,pat){pat.section_number=payload[7],pat.last_section_number=payload[8],self.pmtPid=(31&payload[10])<<8|payload[11],pat.pmtPid=self.pmtPid},parsePmt=function(payload,pmt){var tableEnd,offset;if(1&payload[5]){for(self.programMapTable={video:null,audio:null,"timed-metadata":{}},tableEnd=3+((15&payload[1])<<8|payload[2])-4,offset=12+((15&payload[10])<<8|payload[11]);offset<tableEnd;){var streamType=payload[offset],pid=(31&payload[offset+1])<<8|payload[offset+2];streamType===StreamTypes.H264_STREAM_TYPE&&null===self.programMapTable.video?self.programMapTable.video=pid:streamType===StreamTypes.ADTS_STREAM_TYPE&&null===self.programMapTable.audio?self.programMapTable.audio=pid:streamType===StreamTypes.METADATA_STREAM_TYPE&&(self.programMapTable["timed-metadata"][pid]=streamType),offset+=5+((15&payload[offset+3])<<8|payload[offset+4])}pmt.programMapTable=self.programMapTable}},this.push=function(packet){var result={},offset=4;if(result.payloadUnitStartIndicator=!!(64&packet[1]),result.pid=31&packet[1],result.pid<<=8,result.pid|=packet[2],(48&packet[3])>>>4>1&&(offset+=packet[offset]+1),0===result.pid)result.type="pat",parsePsi(packet.subarray(offset),result),this.trigger("data",result);else if(result.pid===this.pmtPid)for(result.type="pmt",parsePsi(packet.subarray(offset),result),this.trigger("data",result);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([packet,offset,result]):this.processPes_(packet,offset,result)},this.processPes_=function(packet,offset,result){result.pid===this.programMapTable.video?result.streamType=StreamTypes.H264_STREAM_TYPE:result.pid===this.programMapTable.audio?result.streamType=StreamTypes.ADTS_STREAM_TYPE:result.streamType=this.programMapTable["timed-metadata"][result.pid],result.type="pes",result.data=packet.subarray(offset),this.trigger("data",result)}}).prototype=new Stream,TransportParseStream.STREAM_TYPES={h264:27,adts:15},(ElementaryStream=function(){var programMapTable,self=this,video={data:[],size:0},audio={data:[],size:0},timedMetadata={data:[],size:0},flushStream=function(stream,type,forceFlush){var packetFlushable,fragment,packetData=new Uint8Array(stream.size),event={type},i=0,offset=0;if(stream.data.length&&!(stream.size<9)){for(event.trackId=stream.data[0].pid,i=0;i<stream.data.length;i++)fragment=stream.data[i],packetData.set(fragment.data,offset),offset+=fragment.data.byteLength;!function(payload,pes){var ptsDtsFlags;const startPrefix=payload[0]<<16|payload[1]<<8|payload[2];pes.data=new Uint8Array,1===startPrefix&&(pes.packetLength=6+(payload[4]<<8|payload[5]),pes.dataAlignmentIndicator=0!=(4&payload[6]),192&(ptsDtsFlags=payload[7])&&(pes.pts=(14&payload[9])<<27|(255&payload[10])<<20|(254&payload[11])<<12|(255&payload[12])<<5|(254&payload[13])>>>3,pes.pts*=4,pes.pts+=(6&payload[13])>>>1,pes.dts=pes.pts,64&ptsDtsFlags&&(pes.dts=(14&payload[14])<<27|(255&payload[15])<<20|(254&payload[16])<<12|(255&payload[17])<<5|(254&payload[18])>>>3,pes.dts*=4,pes.dts+=(6&payload[18])>>>1)),pes.data=payload.subarray(9+payload[8]))}(packetData,event),packetFlushable="video"===type||event.packetLength<=stream.size,(forceFlush||packetFlushable)&&(stream.size=0,stream.data.length=0),packetFlushable&&self.trigger("data",event)}};ElementaryStream.prototype.init.call(this),this.push=function(data){({pat:function(){},pes:function(){var stream,streamType;switch(data.streamType){case StreamTypes.H264_STREAM_TYPE:stream=video,streamType="video";break;case StreamTypes.ADTS_STREAM_TYPE:stream=audio,streamType="audio";break;case StreamTypes.METADATA_STREAM_TYPE:stream=timedMetadata,streamType="timed-metadata";break;default:return}data.payloadUnitStartIndicator&&flushStream(stream,streamType,!0),stream.data.push(data),stream.size+=data.data.byteLength},pmt:function(){var event={type:"metadata",tracks:[]};null!==(programMapTable=data.programMapTable).video&&event.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+programMapTable.video,codec:"avc",type:"video"}),null!==programMapTable.audio&&event.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+programMapTable.audio,codec:"adts",type:"audio"}),self.trigger("data",event)}})[data.type]()},this.reset=function(){video.size=0,video.data.length=0,audio.size=0,audio.data.length=0,this.trigger("reset")},this.flushStreams_=function(){flushStream(video,"video"),flushStream(audio,"audio"),flushStream(timedMetadata,"timed-metadata")},this.flush=function(){this.flushStreams_(),this.trigger("done")}}).prototype=new Stream;var m2ts={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream,TransportParseStream,ElementaryStream,TimestampRolloverStream,CaptionStream:CaptionStream.CaptionStream,Cea608Stream:CaptionStream.Cea608Stream,Cea708Stream:CaptionStream.Cea708Stream,MetadataStream:__webpack_require__(41)};for(var type in StreamTypes)StreamTypes.hasOwnProperty(type)&&(m2ts[type]=StreamTypes[type]);module.exports=m2ts},function(module,exports,__webpack_require__){"use strict";var Stream=__webpack_require__(2),handleRollover=function(value,reference){var direction=1;for(value>reference&&(direction=-1);Math.abs(reference-value)>4294967296;)value+=8589934592*direction;return value},TimestampRolloverStream=function(type){var lastDTS,referenceDTS;TimestampRolloverStream.prototype.init.call(this),this.type_=type||"shared",this.push=function(data){"shared"!==this.type_&&data.type!==this.type_||(void 0===referenceDTS&&(referenceDTS=data.dts),data.dts=handleRollover(data.dts,referenceDTS),data.pts=handleRollover(data.pts,referenceDTS),lastDTS=data.dts,this.trigger("data",data))},this.flush=function(){referenceDTS=lastDTS,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){referenceDTS=void 0,lastDTS=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};TimestampRolloverStream.prototype=new Stream,module.exports={TimestampRolloverStream,handleRollover}},function(module,exports,__webpack_require__){"use strict";var MetadataStream,Stream=__webpack_require__(2),StreamTypes=__webpack_require__(22),percentEncode=function(bytes,start,end){var i,result="";for(i=start;i<end;i++)result+="%"+("00"+bytes[i].toString(16)).slice(-2);return result},parseUtf8=function(bytes,start,end){return decodeURIComponent(percentEncode(bytes,start,end))},parseSyncSafeInteger=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},tagParsers={TXXX:function(tag){var i;if(3===tag.data[0]){for(i=1;i<tag.data.length;i++)if(0===tag.data[i]){tag.description=parseUtf8(tag.data,1,i),tag.value=parseUtf8(tag.data,i+1,tag.data.length).replace(/\0*$/,"");break}tag.data=tag.value}},WXXX:function(tag){var i;if(3===tag.data[0])for(i=1;i<tag.data.length;i++)if(0===tag.data[i]){tag.description=parseUtf8(tag.data,1,i),tag.url=parseUtf8(tag.data,i+1,tag.data.length);break}},PRIV:function(tag){var i,bytes;for(i=0;i<tag.data.length;i++)if(0===tag.data[i]){tag.owner=(bytes=tag.data,unescape(percentEncode(bytes,0,i)));break}tag.privateData=tag.data.subarray(i+1),tag.data=tag.privateData}};(MetadataStream=function(options){var i,settings={debug:!(!options||!options.debug),descriptor:options&&options.descriptor},tagSize=0,buffer=[],bufferSize=0;if(MetadataStream.prototype.init.call(this),this.dispatchType=StreamTypes.METADATA_STREAM_TYPE.toString(16),settings.descriptor)for(i=0;i<settings.descriptor.length;i++)this.dispatchType+=("00"+settings.descriptor[i].toString(16)).slice(-2);this.push=function(chunk){var tag,frameStart,frameSize,frame,i;if("timed-metadata"===chunk.type)if(chunk.dataAlignmentIndicator&&(bufferSize=0,buffer.length=0),0===buffer.length&&(chunk.data.length<10||chunk.data[0]!=="I".charCodeAt(0)||chunk.data[1]!=="D".charCodeAt(0)||chunk.data[2]!=="3".charCodeAt(0)))settings.debug&&console.log("Skipping unrecognized metadata packet");else if(buffer.push(chunk),bufferSize+=chunk.data.byteLength,1===buffer.length&&(tagSize=parseSyncSafeInteger(chunk.data.subarray(6,10)),tagSize+=10),!(bufferSize<tagSize)){for(tag={data:new Uint8Array(tagSize),frames:[],pts:buffer[0].pts,dts:buffer[0].dts},i=0;i<tagSize;)tag.data.set(buffer[0].data.subarray(0,tagSize-i),i),i+=buffer[0].data.byteLength,bufferSize-=buffer[0].data.byteLength,buffer.shift();frameStart=10,64&tag.data[5]&&(frameStart+=4,frameStart+=parseSyncSafeInteger(tag.data.subarray(10,14)),tagSize-=parseSyncSafeInteger(tag.data.subarray(16,20)));do{if((frameSize=parseSyncSafeInteger(tag.data.subarray(frameStart+4,frameStart+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((frame={id:String.fromCharCode(tag.data[frameStart],tag.data[frameStart+1],tag.data[frameStart+2],tag.data[frameStart+3]),data:tag.data.subarray(frameStart+10,frameStart+frameSize+10)}).key=frame.id,tagParsers[frame.id]&&(tagParsers[frame.id](frame),"com.apple.streaming.transportStreamTimestamp"===frame.owner)){var d=frame.data,size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;size*=4,size+=3&d[7],frame.timeStamp=size,void 0===tag.pts&&void 0===tag.dts&&(tag.pts=frame.timeStamp,tag.dts=frame.timeStamp),this.trigger("timestamp",frame)}tag.frames.push(frame),frameStart+=10,frameStart+=frameSize}while(frameStart<tagSize);this.trigger("data",tag)}}}).prototype=new Stream,module.exports=MetadataStream},function(module,exports,__webpack_require__){"use strict";var AdtsStream,Stream=__webpack_require__(2),ONE_SECOND_IN_TS=__webpack_require__(5).ONE_SECOND_IN_TS,ADTS_SAMPLING_FREQUENCIES=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(AdtsStream=function(handlePartialSegments){var buffer,frameNum=0;AdtsStream.prototype.init.call(this),this.push=function(packet){var frameLength,protectionSkipBytes,frameEnd,oldBuffer,sampleCount,adtsFrameDuration,i=0;if(handlePartialSegments||(frameNum=0),"audio"===packet.type)for(buffer?(oldBuffer=buffer,(buffer=new Uint8Array(oldBuffer.byteLength+packet.data.byteLength)).set(oldBuffer),buffer.set(packet.data,oldBuffer.byteLength)):buffer=packet.data;i+5<buffer.length;)if(255===buffer[i]&&240==(246&buffer[i+1])){if(protectionSkipBytes=2*(1&~buffer[i+1]),frameLength=(3&buffer[i+3])<<11|buffer[i+4]<<3|(224&buffer[i+5])>>5,adtsFrameDuration=(sampleCount=1024*(1+(3&buffer[i+6])))*ONE_SECOND_IN_TS/ADTS_SAMPLING_FREQUENCIES[(60&buffer[i+2])>>>2],frameEnd=i+frameLength,buffer.byteLength<frameEnd)return;if(this.trigger("data",{pts:packet.pts+frameNum*adtsFrameDuration,dts:packet.dts+frameNum*adtsFrameDuration,sampleCount,audioobjecttype:1+(buffer[i+2]>>>6&3),channelcount:(1&buffer[i+2])<<2|(192&buffer[i+3])>>>6,samplerate:ADTS_SAMPLING_FREQUENCIES[(60&buffer[i+2])>>>2],samplingfrequencyindex:(60&buffer[i+2])>>>2,samplesize:16,data:buffer.subarray(i+7+protectionSkipBytes,frameEnd)}),frameNum++,buffer.byteLength===frameEnd)return void(buffer=void 0);buffer=buffer.subarray(frameEnd)}else i++},this.flush=function(){frameNum=0,this.trigger("done")},this.reset=function(){buffer=void 0,this.trigger("reset")},this.endTimeline=function(){buffer=void 0,this.trigger("endedtimeline")}}).prototype=new Stream,module.exports=AdtsStream},function(module,exports,__webpack_require__){"use strict";var H264Stream,NalByteStream,PROFILES_WITH_OPTIONAL_SPS_DATA,Stream=__webpack_require__(2),ExpGolomb=__webpack_require__(44);(NalByteStream=function(){var i,buffer,syncPoint=0;NalByteStream.prototype.init.call(this),this.push=function(data){var swapBuffer;buffer?((swapBuffer=new Uint8Array(buffer.byteLength+data.data.byteLength)).set(buffer),swapBuffer.set(data.data,buffer.byteLength),buffer=swapBuffer):buffer=data.data;for(var len=buffer.byteLength;syncPoint<len-3;syncPoint++)if(1===buffer[syncPoint+2]){i=syncPoint+5;break}for(;i<len;)switch(buffer[i]){case 0:if(0!==buffer[i-1]){i+=2;break}if(0!==buffer[i-2]){i++;break}syncPoint+3!==i-2&&this.trigger("data",buffer.subarray(syncPoint+3,i-2));do{i++}while(1!==buffer[i]&&i<len);syncPoint=i-2,i+=3;break;case 1:if(0!==buffer[i-1]||0!==buffer[i-2]){i+=3;break}this.trigger("data",buffer.subarray(syncPoint+3,i-2)),syncPoint=i-2,i+=3;break;default:i+=3}buffer=buffer.subarray(syncPoint),i-=syncPoint,syncPoint=0},this.reset=function(){buffer=null,syncPoint=0,this.trigger("reset")},this.flush=function(){buffer&&buffer.byteLength>3&&this.trigger("data",buffer.subarray(syncPoint+3)),buffer=null,syncPoint=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new Stream,PROFILES_WITH_OPTIONAL_SPS_DATA={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(H264Stream=function(){var self,trackId,currentPts,currentDts,discardEmulationPreventionBytes,readSequenceParameterSet,skipScalingList,nalByteStream=new NalByteStream;H264Stream.prototype.init.call(this),self=this,this.push=function(packet){"video"===packet.type&&(trackId=packet.trackId,currentPts=packet.pts,currentDts=packet.dts,nalByteStream.push(packet))},nalByteStream.on("data",(function(data){var event={trackId,pts:currentPts,dts:currentDts,data};switch(31&data[0]){case 5:event.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:event.nalUnitType="sei_rbsp",event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1));break;case 7:event.nalUnitType="seq_parameter_set_rbsp",event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1)),event.config=readSequenceParameterSet(event.escapedRBSP);break;case 8:event.nalUnitType="pic_parameter_set_rbsp";break;case 9:event.nalUnitType="access_unit_delimiter_rbsp"}self.trigger("data",event)})),nalByteStream.on("done",(function(){self.trigger("done")})),nalByteStream.on("partialdone",(function(){self.trigger("partialdone")})),nalByteStream.on("reset",(function(){self.trigger("reset")})),nalByteStream.on("endedtimeline",(function(){self.trigger("endedtimeline")})),this.flush=function(){nalByteStream.flush()},this.partialFlush=function(){nalByteStream.partialFlush()},this.reset=function(){nalByteStream.reset()},this.endTimeline=function(){nalByteStream.endTimeline()},skipScalingList=function(count,expGolombDecoder){var j,lastScale=8,nextScale=8;for(j=0;j<count;j++)0!==nextScale&&(nextScale=(lastScale+expGolombDecoder.readExpGolomb()+256)%256),lastScale=0===nextScale?lastScale:nextScale},discardEmulationPreventionBytes=function(data){for(var newLength,newData,length=data.byteLength,emulationPreventionBytesPositions=[],i=1;i<length-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(emulationPreventionBytesPositions.push(i+2),i+=2):i++;if(0===emulationPreventionBytesPositions.length)return data;newLength=length-emulationPreventionBytesPositions.length,newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===emulationPreventionBytesPositions[0]&&(sourceIndex++,emulationPreventionBytesPositions.shift()),newData[i]=data[sourceIndex];return newData},readSequenceParameterSet=function(data){var expGolombDecoder,profileIdc,levelIdc,profileCompatibility,chromaFormatIdc,picOrderCntType,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,sarRatio,i,frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,sarScale=1;if(profileIdc=(expGolombDecoder=new ExpGolomb(data)).readUnsignedByte(),profileCompatibility=expGolombDecoder.readUnsignedByte(),levelIdc=expGolombDecoder.readUnsignedByte(),expGolombDecoder.skipUnsignedExpGolomb(),PROFILES_WITH_OPTIONAL_SPS_DATA[profileIdc]&&(3===(chromaFormatIdc=expGolombDecoder.readUnsignedExpGolomb())&&expGolombDecoder.skipBits(1),expGolombDecoder.skipUnsignedExpGolomb(),expGolombDecoder.skipUnsignedExpGolomb(),expGolombDecoder.skipBits(1),expGolombDecoder.readBoolean()))for(scalingListCount=3!==chromaFormatIdc?8:12,i=0;i<scalingListCount;i++)expGolombDecoder.readBoolean()&&skipScalingList(i<6?16:64,expGolombDecoder);if(expGolombDecoder.skipUnsignedExpGolomb(),0===(picOrderCntType=expGolombDecoder.readUnsignedExpGolomb()))expGolombDecoder.readUnsignedExpGolomb();else if(1===picOrderCntType)for(expGolombDecoder.skipBits(1),expGolombDecoder.skipExpGolomb(),expGolombDecoder.skipExpGolomb(),numRefFramesInPicOrderCntCycle=expGolombDecoder.readUnsignedExpGolomb(),i=0;i<numRefFramesInPicOrderCntCycle;i++)expGolombDecoder.skipExpGolomb();if(expGolombDecoder.skipUnsignedExpGolomb(),expGolombDecoder.skipBits(1),picWidthInMbsMinus1=expGolombDecoder.readUnsignedExpGolomb(),picHeightInMapUnitsMinus1=expGolombDecoder.readUnsignedExpGolomb(),0===(frameMbsOnlyFlag=expGolombDecoder.readBits(1))&&expGolombDecoder.skipBits(1),expGolombDecoder.skipBits(1),expGolombDecoder.readBoolean()&&(frameCropLeftOffset=expGolombDecoder.readUnsignedExpGolomb(),frameCropRightOffset=expGolombDecoder.readUnsignedExpGolomb(),frameCropTopOffset=expGolombDecoder.readUnsignedExpGolomb(),frameCropBottomOffset=expGolombDecoder.readUnsignedExpGolomb()),expGolombDecoder.readBoolean()&&expGolombDecoder.readBoolean()){switch(expGolombDecoder.readUnsignedByte()){case 1:sarRatio=[1,1];break;case 2:sarRatio=[12,11];break;case 3:sarRatio=[10,11];break;case 4:sarRatio=[16,11];break;case 5:sarRatio=[40,33];break;case 6:sarRatio=[24,11];break;case 7:sarRatio=[20,11];break;case 8:sarRatio=[32,11];break;case 9:sarRatio=[80,33];break;case 10:sarRatio=[18,11];break;case 11:sarRatio=[15,11];break;case 12:sarRatio=[64,33];break;case 13:sarRatio=[160,99];break;case 14:sarRatio=[4,3];break;case 15:sarRatio=[3,2];break;case 16:sarRatio=[2,1];break;case 255:sarRatio=[expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte(),expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte()]}sarRatio&&(sarScale=sarRatio[0]/sarRatio[1])}return{profileIdc,levelIdc,profileCompatibility,width:Math.ceil((16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset)*sarScale),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-2*frameCropTopOffset-2*frameCropBottomOffset,sarRatio}}}).prototype=new Stream,module.exports={H264Stream,NalByteStream}},function(module,exports,__webpack_require__){"use strict";var ExpGolomb;ExpGolomb=function(workingData){var workingBytesAvailable=workingData.byteLength,workingWord=0,workingBitsAvailable=0;this.length=function(){return 8*workingBytesAvailable},this.bitsAvailable=function(){return 8*workingBytesAvailable+workingBitsAvailable},this.loadWord=function(){var position=workingData.byteLength-workingBytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,workingBytesAvailable);if(0===availableBytes)throw new Error("no bytes available");workingBytes.set(workingData.subarray(position,position+availableBytes)),workingWord=new DataView(workingBytes.buffer).getUint32(0),workingBitsAvailable=8*availableBytes,workingBytesAvailable-=availableBytes},this.skipBits=function(count){var skipBytes;workingBitsAvailable>count?(workingWord<<=count,workingBitsAvailable-=count):(count-=workingBitsAvailable,count-=8*(skipBytes=Math.floor(count/8)),workingBytesAvailable-=skipBytes,this.loadWord(),workingWord<<=count,workingBitsAvailable-=count)},this.readBits=function(size){var bits=Math.min(workingBitsAvailable,size),valu=workingWord>>>32-bits;return(workingBitsAvailable-=bits)>0?workingWord<<=bits:workingBytesAvailable>0&&this.loadWord(),(bits=size-bits)>0?valu<<bits|this.readBits(bits):valu},this.skipLeadingZeros=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<workingBitsAvailable;++leadingZeroCount)if(0!=(workingWord&2147483648>>>leadingZeroCount))return workingWord<<=leadingZeroCount,workingBitsAvailable-=leadingZeroCount,leadingZeroCount;return this.loadWord(),leadingZeroCount+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var clz=this.skipLeadingZeros();return this.readBits(clz+1)-1},this.readExpGolomb=function(){var valu=this.readUnsignedExpGolomb();return 1&valu?1+valu>>>1:-1*(valu>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},module.exports=ExpGolomb},function(module,exports,__webpack_require__){"use strict";var AacStream,Stream=__webpack_require__(2),aacUtils=__webpack_require__(23);(AacStream=function(){var everything=new Uint8Array,timeStamp=0;AacStream.prototype.init.call(this),this.setTimestamp=function(timestamp){timeStamp=timestamp},this.push=function(bytes){var bytesLeft,chunk,packet,tempLength,frameSize=0,byteIndex=0;for(everything.length?(tempLength=everything.length,(everything=new Uint8Array(bytes.byteLength+tempLength)).set(everything.subarray(0,tempLength)),everything.set(bytes,tempLength)):everything=bytes;everything.length-byteIndex>=3;)if(everything[byteIndex]!=="I".charCodeAt(0)||everything[byteIndex+1]!=="D".charCodeAt(0)||everything[byteIndex+2]!=="3".charCodeAt(0))if(255!=(255&everything[byteIndex])||240!=(240&everything[byteIndex+1]))byteIndex++;else{if(everything.length-byteIndex<7)break;if(byteIndex+(frameSize=aacUtils.parseAdtsSize(everything,byteIndex))>everything.length)break;packet={type:"audio",data:everything.subarray(byteIndex,byteIndex+frameSize),pts:timeStamp,dts:timeStamp},this.trigger("data",packet),byteIndex+=frameSize}else{if(everything.length-byteIndex<10)break;if(byteIndex+(frameSize=aacUtils.parseId3TagSize(everything,byteIndex))>everything.length)break;chunk={type:"timed-metadata",data:everything.subarray(byteIndex,byteIndex+frameSize)},this.trigger("data",chunk),byteIndex+=frameSize}bytesLeft=everything.length-byteIndex,everything=bytesLeft>0?everything.subarray(byteIndex):new Uint8Array},this.reset=function(){everything=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){everything=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new Stream,module.exports=AacStream},function(module,exports,__webpack_require__){"use strict";module.exports=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"]},function(module,exports,__webpack_require__){"use strict";module.exports=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"]},function(module,exports,__webpack_require__){"use strict";var discardEmulationPreventionBytes=__webpack_require__(21).discardEmulationPreventionBytes,CaptionStream=__webpack_require__(20).CaptionStream,findBox=__webpack_require__(15),parseTfdt=__webpack_require__(19),parseTrun=__webpack_require__(18),parseTfhd=__webpack_require__(17),mapToSample=function(offset,samples){for(var approximateOffset=offset,i=0;i<samples.length;i++){var sample=samples[i];if(approximateOffset<sample.size)return sample;approximateOffset-=sample.size}return null},parseCaptionNals=function(segment,videoTrackId){var trafs=findBox(segment,["moof","traf"]),mdats=findBox(segment,["mdat"]),captionNals={},mdatTrafPairs=[];return mdats.forEach((function(mdat,index){var matchingTraf=trafs[index];mdatTrafPairs.push({mdat,traf:matchingTraf})})),mdatTrafPairs.forEach((function(pair){var seiNals,mdat=pair.mdat,traf=pair.traf,tfhd=findBox(traf,["tfhd"]),headerInfo=parseTfhd(tfhd[0]),trackId=headerInfo.trackId,tfdt=findBox(traf,["tfdt"]),baseMediaDecodeTime=tfdt.length>0?parseTfdt(tfdt[0]).baseMediaDecodeTime:0,truns=findBox(traf,["trun"]);videoTrackId===trackId&&truns.length>0&&(seiNals=function(avcStream,samples,trackId){var seiNal,i,length,lastMatchedSample,avcView=new DataView(avcStream.buffer,avcStream.byteOffset,avcStream.byteLength),result=[];for(i=0;i+4<avcStream.length;i+=length)if(length=avcView.getUint32(i),i+=4,!(length<=0))switch(31&avcStream[i]){case 6:var data=avcStream.subarray(i+1,i+1+length),matchingSample=mapToSample(i,samples);if(seiNal={nalUnitType:"sei_rbsp",size:length,data,escapedRBSP:discardEmulationPreventionBytes(data),trackId},matchingSample)seiNal.pts=matchingSample.pts,seiNal.dts=matchingSample.dts,lastMatchedSample=matchingSample;else{if(!lastMatchedSample){console.log("We've encountered a nal unit without data. See mux.js#233.");break}seiNal.pts=lastMatchedSample.pts,seiNal.dts=lastMatchedSample.dts}result.push(seiNal)}return result}(mdat,function(truns,baseMediaDecodeTime,tfhd){var currentDts=baseMediaDecodeTime,defaultSampleDuration=tfhd.defaultSampleDuration||0,defaultSampleSize=tfhd.defaultSampleSize||0,trackId=tfhd.trackId,allSamples=[];return truns.forEach((function(trun){var samples=parseTrun(trun).samples;samples.forEach((function(sample){void 0===sample.duration&&(sample.duration=defaultSampleDuration),void 0===sample.size&&(sample.size=defaultSampleSize),sample.trackId=trackId,sample.dts=currentDts,void 0===sample.compositionTimeOffset&&(sample.compositionTimeOffset=0),sample.pts=currentDts+sample.compositionTimeOffset,currentDts+=sample.duration})),allSamples=allSamples.concat(samples)})),allSamples}(truns,baseMediaDecodeTime,headerInfo),trackId),captionNals[trackId]||(captionNals[trackId]=[]),captionNals[trackId]=captionNals[trackId].concat(seiNals))})),captionNals};module.exports=function(CEA608ParserFactory){var captionStream,segmentCache,trackId,timescale,parsedCaptions,parsingPartial,isInitialized=!1;this.isInitialized=function(){return isInitialized},this.init=function(options){captionStream||(captionStream=new CaptionStream({cea608parser:CEA608ParserFactory?CEA608ParserFactory():void 0}),isInitialized=!0,parsingPartial=!!options&&options.isPartial,captionStream.on("data",(function(event){event.startTime=event.startPts/timescale,event.endTime=event.endPts/timescale,parsedCaptions.captions.push(event),parsedCaptions.captionStreams[event.stream]=!0})))},this.isNewInit=function(videoTrackIds,timescales){return!(videoTrackIds&&0===videoTrackIds.length||timescales&&"object"==typeof timescales&&0===Object.keys(timescales).length)&&(trackId!==videoTrackIds[0]||timescale!==timescales[trackId])},this.parse=function(segment,videoTrackIds,timescales){var parsedData;if(!this.isInitialized())return null;if(!videoTrackIds||!timescales)return null;if(this.isNewInit(videoTrackIds,timescales))trackId=videoTrackIds[0],timescale=timescales[trackId];else if(null===trackId||!timescale)return segmentCache.push(segment),null;for(;segmentCache.length>0;){var cachedSegment=segmentCache.shift();this.parse(cachedSegment,videoTrackIds,timescales)}return null!==(parsedData=function(segment,trackId,timescale){return null===trackId?null:{seiNals:parseCaptionNals(segment,trackId)[trackId],timescale}}(segment,trackId,timescale))&&parsedData.seiNals?(this.pushNals(parsedData.seiNals),this.flushStream(),parsedCaptions):null},this.pushNals=function(nals){if(!this.isInitialized()||!nals||0===nals.length)return null;nals.forEach((function(nal){captionStream.push(nal)}))},this.flushStream=function(){if(!this.isInitialized())return null;parsingPartial?captionStream.partialFlush():captionStream.flush()},this.clearParsedCaptions=function(){parsedCaptions.captions=[],parsedCaptions.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;captionStream.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){segmentCache=[],trackId=null,timescale=null,parsedCaptions?this.clearParsedCaptions():parsedCaptions={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function assert(cond,what){cond||console.error(what,(new Error).stack)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default=class MultiMap{constructor(){this.map_={}}push(key,value){Object.prototype.hasOwnProperty.call(this.map_,key)?this.map_[key].push(value):this.map_[key]=[value]}get(key){const list=this.map_[key];return list?list.slice():null}getAll(){const list=[];for(const[,v]of Object.entries(this.map_))list.push(...v);return list}remove(key,value){const list=this.map_[key];if(list)for(let i=0;i<list.length;i+=1)list[i]===value&&(list.splice(i,1),i-=1)}clear(){this.map_={}}forEach(callback){for(const[key,value]of Object.enttries(this.map_))callback(key,value)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default=class PublicPromise{static new(){let resolvePromise,rejectPromise;const promise=new Promise((resolve,reject)=>{resolvePromise=resolve,rejectPromise=reject});return promise.resolve=resolvePromise,promise.reject=rejectPromise,promise}}},function(module,exports,__webpack_require__){!function(exports){"use strict";var global="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==global&&global,support={searchParams:"URLSearchParams"in global,iterable:"Symbol"in global&&"iterator"in Symbol,blob:"FileReader"in global&&"Blob"in global&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in global,arrayBuffer:"ArrayBuffer"in global};function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj)}if(support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};function normalizeName(name){if("string"!=typeof name&&(name=String(name)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(name)||""===name)throw new TypeError("Invalid character in header field name");return name.toLowerCase()}function normalizeValue(value){return"string"!=typeof value&&(value=String(value)),value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:void 0===value,value}}};return support.iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach((function(value,name){this.append(name,value)}),this):Array.isArray(headers)?headers.forEach((function(header){this.append(header[0],header[1])}),this):headers&&Object.getOwnPropertyNames(headers).forEach((function(name){this.append(name,headers[name])}),this)}function consumed(body){if(body.bodyUsed)return Promise.reject(new TypeError("Already read"));body.bodyUsed=!0}function fileReaderReady(reader){return new Promise((function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}}))}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function readBlobAsText(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsText(blob),promise}function readArrayBufferAsText(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){this.bodyUsed=this.bodyUsed,this._bodyInit=body,body?"string"==typeof body?this._bodyText=body:support.blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support.formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support.arrayBuffer&&support.blob&&isDataView(body)?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):this._bodyText="",this.headers.get("content-type")||("string"==typeof body?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var isConsumed=consumed(this);return isConsumed||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+", "+value:value},Headers.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach((function(value,name){items.push(name)})),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach((function(value){items.push(value)})),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach((function(value,name){items.push([name,value])})),iteratorFor(items)},support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var body=(options=options||{}).body;if(input instanceof Request){if(input.bodyUsed)throw new TypeError("Already read");this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers(input.headers)),this.method=input.method,this.mode=input.mode,this.signal=input.signal,body||null==input._bodyInit||(body=input._bodyInit,input.bodyUsed=!0)}else this.url=String(input);if(this.credentials=options.credentials||this.credentials||"same-origin",!options.headers&&this.headers||(this.headers=new Headers(options.headers)),this.method=normalizeMethod(options.method||this.method||"GET"),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&body)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(body),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==options.cache&&"no-cache"!==options.cache)){var reParamSearch=/([?&])_=[^&]*/;if(reParamSearch.test(this.url))this.url=this.url.replace(reParamSearch,"$1_="+(new Date).getTime());else{var reQueryString=/\?/;this.url+=(reQueryString.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function decode(body){var form=new FormData;return body.trim().split("&").forEach((function(bytes){if(bytes){var split=bytes.split("="),name=split.shift().replace(/\+/g," "),value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}})),form}function parseHeaders(rawHeaders){var headers=new Headers;return rawHeaders.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(line){var parts=line.split(":"),key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}})),headers}function Response(bodyInit,options){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');options||(options={}),this.type="default",this.status=void 0===options.status?200:options.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in options?options.statusText:"",this.headers=new Headers(options.headers),this.url=options.url||"",this._initBody(bodyInit)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:""});return response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(-1===redirectStatuses.indexOf(status))throw new RangeError("Invalid status code");return new Response(null,{status,headers:{location:url}})},exports.DOMException=global.DOMException;try{new exports.DOMException}catch(err){exports.DOMException=function(message,name){this.message=message,this.name=name;var error=Error(message);this.stack=error.stack},exports.DOMException.prototype=Object.create(Error.prototype),exports.DOMException.prototype.constructor=exports.DOMException}function fetch(input,init){return new Promise((function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted)return reject(new exports.DOMException("Aborted","AbortError"));var xhr=new XMLHttpRequest;function abortXhr(){xhr.abort()}function fixUrl(url){try{return""===url&&global.location.href?global.location.href:url}catch(e){return url}}xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;setTimeout((function(){resolve(new Response(body,options))}),0)},xhr.onerror=function(){setTimeout((function(){reject(new TypeError("Network request failed"))}),0)},xhr.ontimeout=function(){setTimeout((function(){reject(new TypeError("Network request failed"))}),0)},xhr.onabort=function(){setTimeout((function(){reject(new exports.DOMException("Aborted","AbortError"))}),0)},xhr.open(request.method,fixUrl(request.url),!0),"include"===request.credentials?xhr.withCredentials=!0:"omit"===request.credentials&&(xhr.withCredentials=!1),"responseType"in xhr&&(support.blob?xhr.responseType="blob":support.arrayBuffer&&request.headers.get("Content-Type")&&-1!==request.headers.get("Content-Type").indexOf("application/octet-stream")&&(xhr.responseType="arraybuffer")),!init||"object"!=typeof init.headers||init.headers instanceof Headers?request.headers.forEach((function(value,name){xhr.setRequestHeader(name,value)})):Object.getOwnPropertyNames(init.headers).forEach((function(name){xhr.setRequestHeader(name,normalizeValue(init.headers[name]))})),request.signal&&(request.signal.addEventListener("abort",abortXhr),xhr.onreadystatechange=function(){4===xhr.readyState&&request.signal.removeEventListener("abort",abortXhr)}),xhr.send(void 0===request._bodyInit?null:request._bodyInit)}))}fetch.polyfill=!0,global.fetch||(global.fetch=fetch,global.Headers=Headers,global.Request=Request,global.Response=Response),exports.Headers=Headers,exports.Request=Request,exports.Response=Response,exports.fetch=fetch,Object.defineProperty(exports,"__esModule",{value:!0})}(exports),module.exports=self.fetch},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(name,context,definition){"use strict";"undefined"!=typeof window&&__webpack_require__(54)?void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=definition)?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__):module.exports?module.exports=definition():context.exports?context.exports=definition():context.Fingerprint2=definition()}(0,this,(function(){"use strict";void 0===Array.isArray&&(Array.isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)});var x64Add=function(m,n){m=[m[0]>>>16,65535&m[0],m[1]>>>16,65535&m[1]],n=[n[0]>>>16,65535&n[0],n[1]>>>16,65535&n[1]];var o=[0,0,0,0];return o[3]+=m[3]+n[3],o[2]+=o[3]>>>16,o[3]&=65535,o[2]+=m[2]+n[2],o[1]+=o[2]>>>16,o[2]&=65535,o[1]+=m[1]+n[1],o[0]+=o[1]>>>16,o[1]&=65535,o[0]+=m[0]+n[0],o[0]&=65535,[o[0]<<16|o[1],o[2]<<16|o[3]]},x64Multiply=function(m,n){m=[m[0]>>>16,65535&m[0],m[1]>>>16,65535&m[1]],n=[n[0]>>>16,65535&n[0],n[1]>>>16,65535&n[1]];var o=[0,0,0,0];return o[3]+=m[3]*n[3],o[2]+=o[3]>>>16,o[3]&=65535,o[2]+=m[2]*n[3],o[1]+=o[2]>>>16,o[2]&=65535,o[2]+=m[3]*n[2],o[1]+=o[2]>>>16,o[2]&=65535,o[1]+=m[1]*n[3],o[0]+=o[1]>>>16,o[1]&=65535,o[1]+=m[2]*n[2],o[0]+=o[1]>>>16,o[1]&=65535,o[1]+=m[3]*n[1],o[0]+=o[1]>>>16,o[1]&=65535,o[0]+=m[0]*n[3]+m[1]*n[2]+m[2]*n[1]+m[3]*n[0],o[0]&=65535,[o[0]<<16|o[1],o[2]<<16|o[3]]},x64Rotl=function(m,n){return 32===(n%=64)?[m[1],m[0]]:n<32?[m[0]<<n|m[1]>>>32-n,m[1]<<n|m[0]>>>32-n]:(n-=32,[m[1]<<n|m[0]>>>32-n,m[0]<<n|m[1]>>>32-n])},x64LeftShift=function(m,n){return 0===(n%=64)?m:n<32?[m[0]<<n|m[1]>>>32-n,m[1]<<n]:[m[1]<<n-32,0]},x64Xor=function(m,n){return[m[0]^n[0],m[1]^n[1]]},x64Fmix=function(h){return h=x64Xor(h,[0,h[0]>>>1]),h=x64Multiply(h,[4283543511,3981806797]),h=x64Xor(h,[0,h[0]>>>1]),h=x64Multiply(h,[3301882366,444984403]),h=x64Xor(h,[0,h[0]>>>1])},x64hash128=function(key,seed){seed=seed||0;for(var remainder=(key=key||"").length%16,bytes=key.length-remainder,h1=[0,seed],h2=[0,seed],k1=[0,0],k2=[0,0],c1=[2277735313,289559509],c2=[1291169091,658871167],i=0;i<bytes;i+=16)k1=[255&key.charCodeAt(i+4)|(255&key.charCodeAt(i+5))<<8|(255&key.charCodeAt(i+6))<<16|(255&key.charCodeAt(i+7))<<24,255&key.charCodeAt(i)|(255&key.charCodeAt(i+1))<<8|(255&key.charCodeAt(i+2))<<16|(255&key.charCodeAt(i+3))<<24],k2=[255&key.charCodeAt(i+12)|(255&key.charCodeAt(i+13))<<8|(255&key.charCodeAt(i+14))<<16|(255&key.charCodeAt(i+15))<<24,255&key.charCodeAt(i+8)|(255&key.charCodeAt(i+9))<<8|(255&key.charCodeAt(i+10))<<16|(255&key.charCodeAt(i+11))<<24],k1=x64Multiply(k1,c1),k1=x64Rotl(k1,31),k1=x64Multiply(k1,c2),h1=x64Xor(h1,k1),h1=x64Rotl(h1,27),h1=x64Add(h1,h2),h1=x64Add(x64Multiply(h1,[0,5]),[0,1390208809]),k2=x64Multiply(k2,c2),k2=x64Rotl(k2,33),k2=x64Multiply(k2,c1),h2=x64Xor(h2,k2),h2=x64Rotl(h2,31),h2=x64Add(h2,h1),h2=x64Add(x64Multiply(h2,[0,5]),[0,944331445]);switch(k1=[0,0],k2=[0,0],remainder){case 15:k2=x64Xor(k2,x64LeftShift([0,key.charCodeAt(i+14)],48));case 14:k2=x64Xor(k2,x64LeftShift([0,key.charCodeAt(i+13)],40));case 13:k2=x64Xor(k2,x64LeftShift([0,key.charCodeAt(i+12)],32));case 12:k2=x64Xor(k2,x64LeftShift([0,key.charCodeAt(i+11)],24));case 11:k2=x64Xor(k2,x64LeftShift([0,key.charCodeAt(i+10)],16));case 10:k2=x64Xor(k2,x64LeftShift([0,key.charCodeAt(i+9)],8));case 9:k2=x64Xor(k2,[0,key.charCodeAt(i+8)]),k2=x64Multiply(k2,c2),k2=x64Rotl(k2,33),k2=x64Multiply(k2,c1),h2=x64Xor(h2,k2);case 8:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+7)],56));case 7:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+6)],48));case 6:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+5)],40));case 5:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+4)],32));case 4:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+3)],24));case 3:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+2)],16));case 2:k1=x64Xor(k1,x64LeftShift([0,key.charCodeAt(i+1)],8));case 1:k1=x64Xor(k1,[0,key.charCodeAt(i)]),k1=x64Multiply(k1,c1),k1=x64Rotl(k1,31),k1=x64Multiply(k1,c2),h1=x64Xor(h1,k1)}return h1=x64Xor(h1,[0,key.length]),h2=x64Xor(h2,[0,key.length]),h1=x64Add(h1,h2),h2=x64Add(h2,h1),h1=x64Fmix(h1),h2=x64Fmix(h2),h1=x64Add(h1,h2),h2=x64Add(h2,h1),("00000000"+(h1[0]>>>0).toString(16)).slice(-8)+("00000000"+(h1[1]>>>0).toString(16)).slice(-8)+("00000000"+(h2[0]>>>0).toString(16)).slice(-8)+("00000000"+(h2[1]>>>0).toString(16)).slice(-8)},defaultOptions={preprocessor:null,audio:{timeout:1e3,excludeIOS11:!0},fonts:{swfContainerId:"fingerprintjs2",swfPath:"flash/compiled/FontList.swf",userDefinedFonts:[],extendedJsFonts:!1},screen:{detectScreenOrientation:!0},plugins:{sortPluginsFor:[/palemoon/i],excludeIE:!1},extraComponents:[],excludes:{enumerateDevices:!0,pixelRatio:!0,doNotTrack:!0,fontsFlash:!0},NOT_AVAILABLE:"not available",ERROR:"error",EXCLUDED:"excluded"},each=function(obj,iterator){if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator);else if(obj.length===+obj.length)for(var i=0,l=obj.length;i<l;i++)iterator(obj[i],i,obj);else for(var key in obj)obj.hasOwnProperty(key)&&iterator(obj[key],key,obj)},map=function(obj,iterator){var results=[];return null==obj?results:Array.prototype.map&&obj.map===Array.prototype.map?obj.map(iterator):(each(obj,(function(value,index,list){results.push(iterator(value,index,list))})),results)},isEnumerateDevicesSupported=function(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices},getScreenResolution=function(options){var resolution=[window.screen.width,window.screen.height];return options.screen.detectScreenOrientation&&resolution.sort().reverse(),resolution},getAvailableScreenResolution=function(options){if(window.screen.availWidth&&window.screen.availHeight){var available=[window.screen.availHeight,window.screen.availWidth];return options.screen.detectScreenOrientation&&available.sort().reverse(),available}return options.NOT_AVAILABLE},getRegularPlugins=function(options){if(null==navigator.plugins)return options.NOT_AVAILABLE;for(var plugins=[],i=0,l=navigator.plugins.length;i<l;i++)navigator.plugins[i]&&plugins.push(navigator.plugins[i]);return pluginsShouldBeSorted(options)&&(plugins=plugins.sort((function(a,b){return a.name>b.name?1:a.name<b.name?-1:0}))),map(plugins,(function(p){var mimeTypes=map(p,(function(mt){return[mt.type,mt.suffixes]}));return[p.name,p.description,mimeTypes]}))},getIEPlugins=function(options){var result=[];if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){result=map(["AcroPDF.PDF","Adodb.Stream","AgControl.AgControl","DevalVRXCtrl.DevalVRXCtrl.1","MacromediaFlashPaper.MacromediaFlashPaper","Msxml2.DOMDocument","Msxml2.XMLHTTP","PDF.PdfCtrl","QuickTime.QuickTime","QuickTimeCheckObject.QuickTimeCheck.1","RealPlayer","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","Scripting.Dictionary","SWCtl.SWCtl","Shell.UIHelper","ShockwaveFlash.ShockwaveFlash","Skype.Detection","TDCCtl.TDCCtl","WMPlayer.OCX","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1"],(function(name){try{return new window.ActiveXObject(name),name}catch(e){return options.ERROR}}))}else result.push(options.NOT_AVAILABLE);return navigator.plugins&&(result=result.concat(getRegularPlugins(options))),result},pluginsShouldBeSorted=function(options){for(var should=!1,i=0,l=options.plugins.sortPluginsFor.length;i<l;i++){var re=options.plugins.sortPluginsFor[i];if(navigator.userAgent.match(re)){should=!0;break}}return should},hasSessionStorage=function(options){try{return!!window.sessionStorage}catch(e){return options.ERROR}},hasLocalStorage=function(options){try{return!!window.localStorage}catch(e){return options.ERROR}},hasIndexedDB=function(options){try{return!!window.indexedDB}catch(e){return options.ERROR}},getHardwareConcurrency=function(options){return navigator.hardwareConcurrency?navigator.hardwareConcurrency:options.NOT_AVAILABLE},getNavigatorCpuClass=function(options){return navigator.cpuClass||options.NOT_AVAILABLE},getNavigatorPlatform=function(options){return navigator.platform?navigator.platform:options.NOT_AVAILABLE},getDoNotTrack=function(options){return navigator.doNotTrack?navigator.doNotTrack:navigator.msDoNotTrack?navigator.msDoNotTrack:window.doNotTrack?window.doNotTrack:options.NOT_AVAILABLE},getTouchSupport=function(){var touchEvent,maxTouchPoints=0;void 0!==navigator.maxTouchPoints?maxTouchPoints=navigator.maxTouchPoints:void 0!==navigator.msMaxTouchPoints&&(maxTouchPoints=navigator.msMaxTouchPoints);try{document.createEvent("TouchEvent"),touchEvent=!0}catch(_){touchEvent=!1}return[maxTouchPoints,touchEvent,"ontouchstart"in window]},getCanvasFp=function(options){var result=[],canvas=document.createElement("canvas");canvas.width=2e3,canvas.height=200,canvas.style.display="inline";var ctx=canvas.getContext("2d");return ctx.rect(0,0,10,10),ctx.rect(2,2,6,6),result.push("canvas winding:"+(!1===ctx.isPointInPath(5,5,"evenodd")?"yes":"no")),ctx.textBaseline="alphabetic",ctx.fillStyle="#f60",ctx.fillRect(125,1,62,20),ctx.fillStyle="#069",options.dontUseFakeFontInCanvas?ctx.font="11pt Arial":ctx.font="11pt no-real-font-123",ctx.fillText("Cwm fjordbank glyphs vext quiz, ",2,15),ctx.fillStyle="rgba(102, 204, 0, 0.2)",ctx.font="18pt Arial",ctx.fillText("Cwm fjordbank glyphs vext quiz, ",4,45),ctx.globalCompositeOperation="multiply",ctx.fillStyle="rgb(255,0,255)",ctx.beginPath(),ctx.arc(50,50,50,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgb(0,255,255)",ctx.beginPath(),ctx.arc(100,50,50,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgb(255,255,0)",ctx.beginPath(),ctx.arc(75,100,50,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgb(255,0,255)",ctx.arc(75,75,75,0,2*Math.PI,!0),ctx.arc(75,75,25,0,2*Math.PI,!0),ctx.fill("evenodd"),canvas.toDataURL&&result.push("canvas fp:"+canvas.toDataURL()),result},getWebglFp=function(){var gl,fa2s=function(fa){return gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),"["+fa[0]+", "+fa[1]+"]"};if(!(gl=getWebglCanvas()))return null;var result=[],vertexPosBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexPosBuffer);var vertices=new Float32Array([-.2,-.9,0,.4,-.26,0,0,.732134444,0]);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW),vertexPosBuffer.itemSize=3,vertexPosBuffer.numItems=3;var program=gl.createProgram(),vshader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vshader,"attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}"),gl.compileShader(vshader);var fshader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fshader,"precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}"),gl.compileShader(fshader),gl.attachShader(program,vshader),gl.attachShader(program,fshader),gl.linkProgram(program),gl.useProgram(program),program.vertexPosAttrib=gl.getAttribLocation(program,"attrVertex"),program.offsetUniform=gl.getUniformLocation(program,"uniformOffset"),gl.enableVertexAttribArray(program.vertexPosArray),gl.vertexAttribPointer(program.vertexPosAttrib,vertexPosBuffer.itemSize,gl.FLOAT,!1,0,0),gl.uniform2f(program.offsetUniform,1,1),gl.drawArrays(gl.TRIANGLE_STRIP,0,vertexPosBuffer.numItems);try{result.push(gl.canvas.toDataURL())}catch(e){}result.push("extensions:"+(gl.getSupportedExtensions()||[]).join(";")),result.push("webgl aliased line width range:"+fa2s(gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE))),result.push("webgl aliased point size range:"+fa2s(gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE))),result.push("webgl alpha bits:"+gl.getParameter(gl.ALPHA_BITS)),result.push("webgl antialiasing:"+(gl.getContextAttributes().antialias?"yes":"no")),result.push("webgl blue bits:"+gl.getParameter(gl.BLUE_BITS)),result.push("webgl depth bits:"+gl.getParameter(gl.DEPTH_BITS)),result.push("webgl green bits:"+gl.getParameter(gl.GREEN_BITS)),result.push("webgl max anisotropy:"+function(gl){var ext=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic");if(ext){var anisotropy=gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT);return 0===anisotropy&&(anisotropy=2),anisotropy}return null}(gl)),result.push("webgl max combined texture image units:"+gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),result.push("webgl max cube map texture size:"+gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE)),result.push("webgl max fragment uniform vectors:"+gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS)),result.push("webgl max render buffer size:"+gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)),result.push("webgl max texture image units:"+gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)),result.push("webgl max texture size:"+gl.getParameter(gl.MAX_TEXTURE_SIZE)),result.push("webgl max varying vectors:"+gl.getParameter(gl.MAX_VARYING_VECTORS)),result.push("webgl max vertex attribs:"+gl.getParameter(gl.MAX_VERTEX_ATTRIBS)),result.push("webgl max vertex texture image units:"+gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)),result.push("webgl max vertex uniform vectors:"+gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS)),result.push("webgl max viewport dims:"+fa2s(gl.getParameter(gl.MAX_VIEWPORT_DIMS))),result.push("webgl red bits:"+gl.getParameter(gl.RED_BITS)),result.push("webgl renderer:"+gl.getParameter(gl.RENDERER)),result.push("webgl shading language version:"+gl.getParameter(gl.SHADING_LANGUAGE_VERSION)),result.push("webgl stencil bits:"+gl.getParameter(gl.STENCIL_BITS)),result.push("webgl vendor:"+gl.getParameter(gl.VENDOR)),result.push("webgl version:"+gl.getParameter(gl.VERSION));try{var extensionDebugRendererInfo=gl.getExtension("WEBGL_debug_renderer_info");extensionDebugRendererInfo&&(result.push("webgl unmasked vendor:"+gl.getParameter(extensionDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),result.push("webgl unmasked renderer:"+gl.getParameter(extensionDebugRendererInfo.UNMASKED_RENDERER_WEBGL)))}catch(e){}return gl.getShaderPrecisionFormat?(each(["FLOAT","INT"],(function(numType){each(["VERTEX","FRAGMENT"],(function(shader){each(["HIGH","MEDIUM","LOW"],(function(numSize){each(["precision","rangeMin","rangeMax"],(function(key){var format=gl.getShaderPrecisionFormat(gl[shader+"_SHADER"],gl[numSize+"_"+numType])[key];"precision"!==key&&(key="precision "+key);var line=["webgl ",shader.toLowerCase()," shader ",numSize.toLowerCase()," ",numType.toLowerCase()," ",key,":",format].join("");result.push(line)}))}))}))})),loseWebglContext(gl),result):(loseWebglContext(gl),result)},getWebglVendorAndRenderer=function(){try{var glContext=getWebglCanvas(),extensionDebugRendererInfo=glContext.getExtension("WEBGL_debug_renderer_info"),params=glContext.getParameter(extensionDebugRendererInfo.UNMASKED_VENDOR_WEBGL)+"~"+glContext.getParameter(extensionDebugRendererInfo.UNMASKED_RENDERER_WEBGL);return loseWebglContext(glContext),params}catch(e){return null}},getAdBlock=function(){var ads=document.createElement("div");ads.innerHTML="&nbsp;",ads.className="adsbox";var result=!1;try{document.body.appendChild(ads),result=0===document.getElementsByClassName("adsbox")[0].offsetHeight,document.body.removeChild(ads)}catch(e){result=!1}return result},getHasLiedLanguages=function(){if(void 0!==navigator.languages)try{if(navigator.languages[0].substr(0,2)!==navigator.language.substr(0,2))return!0}catch(err){return!0}return!1},getHasLiedResolution=function(){return window.screen.width<window.screen.availWidth||window.screen.height<window.screen.availHeight},getHasLiedOs=function(){var os,userAgent=navigator.userAgent.toLowerCase(),oscpu=navigator.oscpu,platform=navigator.platform.toLowerCase();if(os=userAgent.indexOf("windows phone")>=0?"Windows Phone":userAgent.indexOf("windows")>=0||userAgent.indexOf("win16")>=0||userAgent.indexOf("win32")>=0||userAgent.indexOf("win64")>=0||userAgent.indexOf("win95")>=0||userAgent.indexOf("win98")>=0||userAgent.indexOf("winnt")>=0||userAgent.indexOf("wow64")>=0?"Windows":userAgent.indexOf("android")>=0?"Android":userAgent.indexOf("linux")>=0||userAgent.indexOf("cros")>=0||userAgent.indexOf("x11")>=0?"Linux":userAgent.indexOf("iphone")>=0||userAgent.indexOf("ipad")>=0||userAgent.indexOf("ipod")>=0||userAgent.indexOf("crios")>=0||userAgent.indexOf("fxios")>=0?"iOS":userAgent.indexOf("macintosh")>=0||userAgent.indexOf("mac_powerpc)")>=0?"Mac":"Other",("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&"Windows"!==os&&"Windows Phone"!==os&&"Android"!==os&&"iOS"!==os&&"Other"!==os&&-1===userAgent.indexOf("cros"))return!0;if(void 0!==oscpu){if((oscpu=oscpu.toLowerCase()).indexOf("win")>=0&&"Windows"!==os&&"Windows Phone"!==os)return!0;if(oscpu.indexOf("linux")>=0&&"Linux"!==os&&"Android"!==os)return!0;if(oscpu.indexOf("mac")>=0&&"Mac"!==os&&"iOS"!==os)return!0;if((-1===oscpu.indexOf("win")&&-1===oscpu.indexOf("linux")&&-1===oscpu.indexOf("mac"))!=("Other"===os))return!0}return platform.indexOf("win")>=0&&"Windows"!==os&&"Windows Phone"!==os||((platform.indexOf("linux")>=0||platform.indexOf("android")>=0||platform.indexOf("pike")>=0)&&"Linux"!==os&&"Android"!==os||((platform.indexOf("mac")>=0||platform.indexOf("ipad")>=0||platform.indexOf("ipod")>=0||platform.indexOf("iphone")>=0)&&"Mac"!==os&&"iOS"!==os||!(platform.indexOf("arm")>=0&&"Windows Phone"===os)&&(!(platform.indexOf("pike")>=0&&userAgent.indexOf("opera mini")>=0)&&((platform.indexOf("win")<0&&platform.indexOf("linux")<0&&platform.indexOf("mac")<0&&platform.indexOf("iphone")<0&&platform.indexOf("ipad")<0&&platform.indexOf("ipod")<0)!==("Other"===os)||void 0===navigator.plugins&&"Windows"!==os&&"Windows Phone"!==os))))},getHasLiedBrowser=function(){var browser,userAgent=navigator.userAgent.toLowerCase(),productSub=navigator.productSub;if(userAgent.indexOf("edge/")>=0||userAgent.indexOf("iemobile/")>=0)return!1;if(userAgent.indexOf("opera mini")>=0)return!1;if(("Chrome"===(browser=userAgent.indexOf("firefox/")>=0?"Firefox":userAgent.indexOf("opera/")>=0||userAgent.indexOf(" opr/")>=0?"Opera":userAgent.indexOf("chrome/")>=0?"Chrome":userAgent.indexOf("safari/")>=0?userAgent.indexOf("android 1.")>=0||userAgent.indexOf("android 2.")>=0||userAgent.indexOf("android 3.")>=0||userAgent.indexOf("android 4.")>=0?"AOSP":"Safari":userAgent.indexOf("trident/")>=0?"Internet Explorer":"Other")||"Safari"===browser||"Opera"===browser)&&"20030107"!==productSub)return!0;var errFirefox,tempRes=eval.toString().length;if(37===tempRes&&"Safari"!==browser&&"Firefox"!==browser&&"Other"!==browser)return!0;if(39===tempRes&&"Internet Explorer"!==browser&&"Other"!==browser)return!0;if(33===tempRes&&"Chrome"!==browser&&"AOSP"!==browser&&"Opera"!==browser&&"Other"!==browser)return!0;try{throw"a"}catch(err){try{err.toSource(),errFirefox=!0}catch(errOfErr){errFirefox=!1}}return errFirefox&&"Firefox"!==browser&&"Other"!==browser},isCanvasSupported=function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))},isWebGlSupported=function(){if(!isCanvasSupported())return!1;var glContext=getWebglCanvas(),isSupported=!!window.WebGLRenderingContext&&!!glContext;return loseWebglContext(glContext),isSupported},isIE=function(){return"Microsoft Internet Explorer"===navigator.appName||!("Netscape"!==navigator.appName||!/Trident/.test(navigator.userAgent))},hasSwfObjectLoaded=function(){return void 0!==window.swfobject},hasMinFlashInstalled=function(){return window.swfobject.hasFlashPlayerVersion("9.0.0")},loadSwfAndDetectFonts=function(done,options){window.___fp_swf_loaded=function(fonts){done(fonts)};var id=options.fonts.swfContainerId;!function(options){var node=document.createElement("div");node.setAttribute("id",options.fonts.swfContainerId),document.body.appendChild(node)}();var flashvars={onReady:"___fp_swf_loaded"};window.swfobject.embedSWF(options.fonts.swfPath,id,"1","1","9.0.0",!1,flashvars,{allowScriptAccess:"always",menu:"false"},{})},getWebglCanvas=function(){var canvas=document.createElement("canvas"),gl=null;try{gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl")}catch(e){}return gl||(gl=null),gl},loseWebglContext=function(context){var loseContextExtension=context.getExtension("WEBGL_lose_context");null!=loseContextExtension&&loseContextExtension.loseContext()},components=[{key:"userAgent",getData:function(done){done(navigator.userAgent)}},{key:"webdriver",getData:function(done,options){done(null==navigator.webdriver?options.NOT_AVAILABLE:navigator.webdriver)}},{key:"language",getData:function(done,options){done(navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage||options.NOT_AVAILABLE)}},{key:"colorDepth",getData:function(done,options){done(window.screen.colorDepth||options.NOT_AVAILABLE)}},{key:"deviceMemory",getData:function(done,options){done(navigator.deviceMemory||options.NOT_AVAILABLE)}},{key:"pixelRatio",getData:function(done,options){done(window.devicePixelRatio||options.NOT_AVAILABLE)}},{key:"hardwareConcurrency",getData:function(done,options){done(getHardwareConcurrency(options))}},{key:"screenResolution",getData:function(done,options){done(getScreenResolution(options))}},{key:"availableScreenResolution",getData:function(done,options){done(getAvailableScreenResolution(options))}},{key:"timezoneOffset",getData:function(done){done((new Date).getTimezoneOffset())}},{key:"timezone",getData:function(done,options){window.Intl&&window.Intl.DateTimeFormat?done((new window.Intl.DateTimeFormat).resolvedOptions().timeZone):done(options.NOT_AVAILABLE)}},{key:"sessionStorage",getData:function(done,options){done(hasSessionStorage(options))}},{key:"localStorage",getData:function(done,options){done(hasLocalStorage(options))}},{key:"indexedDb",getData:function(done,options){done(hasIndexedDB(options))}},{key:"addBehavior",getData:function(done){done(!(!document.body||!document.body.addBehavior))}},{key:"openDatabase",getData:function(done){done(!!window.openDatabase)}},{key:"cpuClass",getData:function(done,options){done(getNavigatorCpuClass(options))}},{key:"platform",getData:function(done,options){done(getNavigatorPlatform(options))}},{key:"doNotTrack",getData:function(done,options){done(getDoNotTrack(options))}},{key:"plugins",getData:function(done,options){isIE()?options.plugins.excludeIE?done(options.EXCLUDED):done(getIEPlugins(options)):done(getRegularPlugins(options))}},{key:"canvas",getData:function(done,options){isCanvasSupported()?done(getCanvasFp(options)):done(options.NOT_AVAILABLE)}},{key:"webgl",getData:function(done,options){isWebGlSupported()?done(getWebglFp()):done(options.NOT_AVAILABLE)}},{key:"webglVendorAndRenderer",getData:function(done){isWebGlSupported()?done(getWebglVendorAndRenderer()):done()}},{key:"adBlock",getData:function(done){done(getAdBlock())}},{key:"hasLiedLanguages",getData:function(done){done(getHasLiedLanguages())}},{key:"hasLiedResolution",getData:function(done){done(getHasLiedResolution())}},{key:"hasLiedOs",getData:function(done){done(getHasLiedOs())}},{key:"hasLiedBrowser",getData:function(done){done(getHasLiedBrowser())}},{key:"touchSupport",getData:function(done){done(getTouchSupport())}},{key:"fonts",getData:function(done,options){var baseFonts=["monospace","sans-serif","serif"],fontList=["Andale Mono","Arial","Arial Black","Arial Hebrew","Arial MT","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Bitstream Vera Sans Mono","Book Antiqua","Bookman Old Style","Calibri","Cambria","Cambria Math","Century","Century Gothic","Century Schoolbook","Comic Sans","Comic Sans MS","Consolas","Courier","Courier New","Geneva","Georgia","Helvetica","Helvetica Neue","Impact","Lucida Bright","Lucida Calligraphy","Lucida Console","Lucida Fax","LUCIDA GRANDE","Lucida Handwriting","Lucida Sans","Lucida Sans Typewriter","Lucida Sans Unicode","Microsoft Sans Serif","Monaco","Monotype Corsiva","MS Gothic","MS Outlook","MS PGothic","MS Reference Sans Serif","MS Sans Serif","MS Serif","MYRIAD","MYRIAD PRO","Palatino","Palatino Linotype","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Tahoma","Times","Times New Roman","Times New Roman PS","Trebuchet MS","Verdana","Wingdings","Wingdings 2","Wingdings 3"];if(options.fonts.extendedJsFonts){fontList=fontList.concat(["Abadi MT Condensed Light","Academy Engraved LET","ADOBE CASLON PRO","Adobe Garamond","ADOBE GARAMOND PRO","Agency FB","Aharoni","Albertus Extra Bold","Albertus Medium","Algerian","Amazone BT","American Typewriter","American Typewriter Condensed","AmerType Md BT","Andalus","Angsana New","AngsanaUPC","Antique Olive","Aparajita","Apple Chancery","Apple Color Emoji","Apple SD Gothic Neo","Arabic Typesetting","ARCHER","ARNO PRO","Arrus BT","Aurora Cn BT","AvantGarde Bk BT","AvantGarde Md BT","AVENIR","Ayuthaya","Bandy","Bangla Sangam MN","Bank Gothic","BankGothic Md BT","Baskerville","Baskerville Old Face","Batang","BatangChe","Bauer Bodoni","Bauhaus 93","Bazooka","Bell MT","Bembo","Benguiat Bk BT","Berlin Sans FB","Berlin Sans FB Demi","Bernard MT Condensed","BernhardFashion BT","BernhardMod BT","Big Caslon","BinnerD","Blackadder ITC","BlairMdITC TT","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bodoni MT","Bodoni MT Black","Bodoni MT Condensed","Bodoni MT Poster Compressed","Bookshelf Symbol 7","Boulder","Bradley Hand","Bradley Hand ITC","Bremen Bd BT","Britannic Bold","Broadway","Browallia New","BrowalliaUPC","Brush Script MT","Californian FB","Calisto MT","Calligrapher","Candara","CaslonOpnface BT","Castellar","Centaur","Cezanne","CG Omega","CG Times","Chalkboard","Chalkboard SE","Chalkduster","Charlesworth","Charter Bd BT","Charter BT","Chaucer","ChelthmITC Bk BT","Chiller","Clarendon","Clarendon Condensed","CloisterBlack BT","Cochin","Colonna MT","Constantia","Cooper Black","Copperplate","Copperplate Gothic","Copperplate Gothic Bold","Copperplate Gothic Light","CopperplGoth Bd BT","Corbel","Cordia New","CordiaUPC","Cornerstone","Coronet","Cuckoo","Curlz MT","DaunPenh","Dauphin","David","DB LCD Temp","DELICIOUS","Denmark","DFKai-SB","Didot","DilleniaUPC","DIN","DokChampa","Dotum","DotumChe","Ebrima","Edwardian Script ITC","Elephant","English 111 Vivace BT","Engravers MT","EngraversGothic BT","Eras Bold ITC","Eras Demi ITC","Eras Light ITC","Eras Medium ITC","EucrosiaUPC","Euphemia","Euphemia UCAS","EUROSTILE","Exotc350 Bd BT","FangSong","Felix Titling","Fixedsys","FONTIN","Footlight MT Light","Forte","FrankRuehl","Fransiscan","Freefrm721 Blk BT","FreesiaUPC","Freestyle Script","French Script MT","FrnkGothITC Bk BT","Fruitger","FRUTIGER","Futura","Futura Bk BT","Futura Lt BT","Futura Md BT","Futura ZBlk BT","FuturaBlack BT","Gabriola","Galliard BT","Gautami","Geeza Pro","Geometr231 BT","Geometr231 Hv BT","Geometr231 Lt BT","GeoSlab 703 Lt BT","GeoSlab 703 XBd BT","Gigi","Gill Sans","Gill Sans MT","Gill Sans MT Condensed","Gill Sans MT Ext Condensed Bold","Gill Sans Ultra Bold","Gill Sans Ultra Bold Condensed","Gisha","Gloucester MT Extra Condensed","GOTHAM","GOTHAM BOLD","Goudy Old Style","Goudy Stout","GoudyHandtooled BT","GoudyOLSt BT","Gujarati Sangam MN","Gulim","GulimChe","Gungsuh","GungsuhChe","Gurmukhi MN","Haettenschweiler","Harlow Solid Italic","Harrington","Heather","Heiti SC","Heiti TC","HELV","Herald","High Tower Text","Hiragino Kaku Gothic ProN","Hiragino Mincho ProN","Hoefler Text","Humanst 521 Cn BT","Humanst521 BT","Humanst521 Lt BT","Imprint MT Shadow","Incised901 Bd BT","Incised901 BT","Incised901 Lt BT","INCONSOLATA","Informal Roman","Informal011 BT","INTERSTATE","IrisUPC","Iskoola Pota","JasmineUPC","Jazz LET","Jenson","Jester","Jokerman","Juice ITC","Kabel Bk BT","Kabel Ult BT","Kailasa","KaiTi","Kalinga","Kannada Sangam MN","Kartika","Kaufmann Bd BT","Kaufmann BT","Khmer UI","KodchiangUPC","Kokila","Korinna BT","Kristen ITC","Krungthep","Kunstler Script","Lao UI","Latha","Leelawadee","Letter Gothic","Levenim MT","LilyUPC","Lithograph","Lithograph Light","Long Island","Lydian BT","Magneto","Maiandra GD","Malayalam Sangam MN","Malgun Gothic","Mangal","Marigold","Marion","Marker Felt","Market","Marlett","Matisse ITC","Matura MT Script Capitals","Meiryo","Meiryo UI","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","MingLiU-ExtB","Minion","Minion Pro","Miriam","Miriam Fixed","Mistral","Modern","Modern No. 20","Mona Lisa Solid ITC TT","Mongolian Baiti","MONO","MoolBoran","Mrs Eaves","MS LineDraw","MS Mincho","MS PMincho","MS Reference Specialty","MS UI Gothic","MT Extra","MUSEO","MV Boli","Nadeem","Narkisim","NEVIS","News Gothic","News GothicMT","NewsGoth BT","Niagara Engraved","Niagara Solid","Noteworthy","NSimSun","Nyala","OCR A Extended","Old Century","Old English Text MT","Onyx","Onyx BT","OPTIMA","Oriya Sangam MN","OSAKA","OzHandicraft BT","Palace Script MT","Papyrus","Parchment","Party LET","Pegasus","Perpetua","Perpetua Titling MT","PetitaBold","Pickwick","Plantagenet Cherokee","Playbill","PMingLiU","PMingLiU-ExtB","Poor Richard","Poster","PosterBodoni BT","PRINCETOWN LET","Pristina","PTBarnum BT","Pythagoras","Raavi","Rage Italic","Ravie","Ribbon131 Bd BT","Rockwell","Rockwell Condensed","Rockwell Extra Bold","Rod","Roman","Sakkal Majalla","Santa Fe LET","Savoye LET","Sceptre","Script","Script MT Bold","SCRIPTINA","Serifa","Serifa BT","Serifa Th BT","ShelleyVolante BT","Sherwood","Shonar Bangla","Showcard Gothic","Shruti","Signboard","SILKSCREEN","SimHei","Simplified Arabic","Simplified Arabic Fixed","SimSun","SimSun-ExtB","Sinhala Sangam MN","Sketch Rockwell","Skia","Small Fonts","Snap ITC","Snell Roundhand","Socket","Souvenir Lt BT","Staccato222 BT","Steamer","Stencil","Storybook","Styllo","Subway","Swis721 BlkEx BT","Swiss911 XCm BT","Sylfaen","Synchro LET","System","Tamil Sangam MN","Technical","Teletype","Telugu Sangam MN","Tempus Sans ITC","Terminal","Thonburi","Traditional Arabic","Trajan","TRAJAN PRO","Tristan","Tubular","Tunga","Tw Cen MT","Tw Cen MT Condensed","Tw Cen MT Condensed Extra Bold","TypoUpright BT","Unicorn","Univers","Univers CE 55 Medium","Univers Condensed","Utsaah","Vagabond","Vani","Vijaya","Viner Hand ITC","VisualUI","Vivaldi","Vladimir Script","Vrinda","Westminster","WHITNEY","Wide Latin","ZapfEllipt BT","ZapfHumnst BT","ZapfHumnst Dm BT","Zapfino","Zurich BlkEx BT","Zurich Ex BT","ZWAdobeF"])}fontList=(fontList=fontList.concat(options.fonts.userDefinedFonts)).filter((function(font,position){return fontList.indexOf(font)===position}));var h=document.getElementsByTagName("body")[0],baseFontsDiv=document.createElement("div"),fontsDiv=document.createElement("div"),defaultWidth={},defaultHeight={},createSpan=function(){var s=document.createElement("span");return s.style.position="absolute",s.style.left="-9999px",s.style.fontSize="72px",s.style.fontStyle="normal",s.style.fontWeight="normal",s.style.letterSpacing="normal",s.style.lineBreak="auto",s.style.lineHeight="normal",s.style.textTransform="none",s.style.textAlign="left",s.style.textDecoration="none",s.style.textShadow="none",s.style.whiteSpace="normal",s.style.wordBreak="normal",s.style.wordSpacing="normal",s.innerHTML="mmmmmmmmmmlli",s},createSpanWithFonts=function(fontToDetect,baseFont){var s=createSpan();return s.style.fontFamily="'"+fontToDetect+"',"+baseFont,s},isFontAvailable=function(fontSpans){for(var detected=!1,i=0;i<baseFonts.length;i++)if(detected=fontSpans[i].offsetWidth!==defaultWidth[baseFonts[i]]||fontSpans[i].offsetHeight!==defaultHeight[baseFonts[i]])return detected;return detected},baseFontsSpans=function(){for(var spans=[],index=0,length=baseFonts.length;index<length;index++){var s=createSpan();s.style.fontFamily=baseFonts[index],baseFontsDiv.appendChild(s),spans.push(s)}return spans}();h.appendChild(baseFontsDiv);for(var index=0,length=baseFonts.length;index<length;index++)defaultWidth[baseFonts[index]]=baseFontsSpans[index].offsetWidth,defaultHeight[baseFonts[index]]=baseFontsSpans[index].offsetHeight;var fontsSpans=function(){for(var spans={},i=0,l=fontList.length;i<l;i++){for(var fontSpans=[],j=0,numDefaultFonts=baseFonts.length;j<numDefaultFonts;j++){var s=createSpanWithFonts(fontList[i],baseFonts[j]);fontsDiv.appendChild(s),fontSpans.push(s)}spans[fontList[i]]=fontSpans}return spans}();h.appendChild(fontsDiv);for(var available=[],i=0,l=fontList.length;i<l;i++)isFontAvailable(fontsSpans[fontList[i]])&&available.push(fontList[i]);h.removeChild(fontsDiv),h.removeChild(baseFontsDiv),done(available)},pauseBefore:!0},{key:"fontsFlash",getData:function(done,options){return hasSwfObjectLoaded()?hasMinFlashInstalled()?options.fonts.swfPath?void loadSwfAndDetectFonts((function(fonts){done(fonts)}),options):done("missing options.fonts.swfPath"):done("flash not installed"):done("swf object not loaded")},pauseBefore:!0},{key:"audio",getData:function(done,options){var audioOptions=options.audio;if(audioOptions.excludeIOS11&&navigator.userAgent.match(/OS 11.+Version\/11.+Safari/))return done(options.EXCLUDED);var AudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(null==AudioContext)return done(options.NOT_AVAILABLE);var context=new AudioContext(1,44100,44100),oscillator=context.createOscillator();oscillator.type="triangle",oscillator.frequency.setValueAtTime(1e4,context.currentTime);var compressor=context.createDynamicsCompressor();each([["threshold",-50],["knee",40],["ratio",12],["reduction",-20],["attack",0],["release",.25]],(function(item){void 0!==compressor[item[0]]&&"function"==typeof compressor[item[0]].setValueAtTime&&compressor[item[0]].setValueAtTime(item[1],context.currentTime)})),oscillator.connect(compressor),compressor.connect(context.destination),oscillator.start(0),context.startRendering();var audioTimeoutId=setTimeout((function(){return console.warn('Audio fingerprint timed out. Please report bug at https://github.com/Valve/fingerprintjs2 with your user agent: "'+navigator.userAgent+'".'),context.oncomplete=function(){},context=null,done("audioTimeout")}),audioOptions.timeout);context.oncomplete=function(event){var fingerprint;try{clearTimeout(audioTimeoutId),fingerprint=event.renderedBuffer.getChannelData(0).slice(4500,5e3).reduce((function(acc,val){return acc+Math.abs(val)}),0).toString(),oscillator.disconnect(),compressor.disconnect()}catch(error){return void done(error)}done(fingerprint)}}},{key:"enumerateDevices",getData:function(done,options){if(!isEnumerateDevicesSupported())return done(options.NOT_AVAILABLE);navigator.mediaDevices.enumerateDevices().then((function(devices){done(devices.map((function(device){return"id="+device.deviceId+";gid="+device.groupId+";"+device.kind+";"+device.label})))})).catch((function(error){done(error)}))}}],Fingerprint2=function(options){throw new Error("'new Fingerprint()' is deprecated, see https://github.com/Valve/fingerprintjs2#upgrade-guide-from-182-to-200")};return Fingerprint2.get=function(options,callback){callback?options||(options={}):(callback=options,options={}),function(target,source){if(null==source)return target;var value,key;for(key in source)null==(value=source[key])||Object.prototype.hasOwnProperty.call(target,key)||(target[key]=value)}(options,defaultOptions),options.components=options.extraComponents.concat(components);var keys={data:[],addPreprocessedComponent:function(key,value){"function"==typeof options.preprocessor&&(value=options.preprocessor(key,value)),keys.data.push({key,value})}},i=-1,chainComponents=function(alreadyWaited){if((i+=1)>=options.components.length)callback(keys.data);else{var component=options.components[i];if(options.excludes[component.key])chainComponents(!1);else{if(!alreadyWaited&&component.pauseBefore)return i-=1,void setTimeout((function(){chainComponents(!0)}),1);try{component.getData((function(value){keys.addPreprocessedComponent(component.key,value),chainComponents(!1)}),options)}catch(error){keys.addPreprocessedComponent(component.key,String(error)),chainComponents(!1)}}}};chainComponents(!1)},Fingerprint2.getPromise=function(options){return new Promise((function(resolve,reject){Fingerprint2.get(options,resolve)}))},Fingerprint2.getV18=function(options,callback){return null==callback&&(callback=options,options={}),Fingerprint2.get(options,(function(components){for(var newComponents=[],i=0;i<components.length;i++){var component=components[i];if(component.value===(options.NOT_AVAILABLE||"not available"))newComponents.push({key:component.key,value:"unknown"});else if("plugins"===component.key)newComponents.push({key:"plugins",value:map(component.value,(function(p){var mimeTypes=map(p[2],(function(mt){return mt.join?mt.join("~"):mt})).join(",");return[p[0],p[1],mimeTypes].join("::")}))});else if(-1!==["canvas","webgl"].indexOf(component.key)&&Array.isArray(component.value))newComponents.push({key:component.key,value:component.value.join("~")});else if(-1!==["sessionStorage","localStorage","indexedDb","addBehavior","openDatabase"].indexOf(component.key)){if(!component.value)continue;newComponents.push({key:component.key,value:1})}else component.value?newComponents.push(component.value.join?{key:component.key,value:component.value.join(";")}:component):newComponents.push({key:component.key,value:component.value})}var murmur=x64hash128(map(newComponents,(function(component){return component.value})).join("~~~"),31);callback(murmur,newComponents)}))},Fingerprint2.x64hash128=x64hash128,Fingerprint2.VERSION="2.1.2",Fingerprint2}))},function(module,exports){(function(__webpack_amd_options__){module.exports=__webpack_amd_options__}).call(this,{})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default=class MapUtils{static values(object){return Object.keys(object).map(key=>object[key])}static asMap(object){const map=new Map;return Object.keys(object).forEach(key=>{map.set(key,object[key])}),map}static asObject(map){const obj={};return map.forEach((value,key)=>{obj[key]=value}),obj}static asMap_(object){const map=new Map;return Object.keys(object).forEach(key=>{map.set(key,object[key])}),map}static asObject_(map){const obj={};return map.forEach((value,key)=>{obj[key]=value}),obj}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function setup(options,userid,element){"function"==typeof options&&_logger.default.deprecated("setup: callback API deprecated, now returns a Promise");void 0!==options.userid&&_logger.default.deprecated("setup: options.userid API deprecated, use userid as second argument");void 0!==options.element&&_logger.default.deprecated("setup: options.element API deprecated, use element as third argument");const reporter=new _VipReporter.default(options),player=new Player(options.element||element,reporter,options);return reporter.openSession(userid,{app:options.app}).then(()=>({player,reporter}))};var _logger=_interopRequireDefault(__webpack_require__(1)),_VipReporter=_interopRequireDefault(__webpack_require__(24));const Player=__webpack_require__(12).default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _FakeEventTarget=_interopRequireDefault(__webpack_require__(4)),_logger=_interopRequireDefault(__webpack_require__(1)),_PlayerIds=_interopRequireDefault(__webpack_require__(9)),_Error=_interopRequireDefault(__webpack_require__(6));class PlayerHTML5 extends _FakeEventTarget.default{static setup(){}static stringToArray(string){const buffer=new ArrayBuffer(2*string.length),array=new Uint16Array(buffer);for(let i=0,strLen=string.length;i<strLen;i+=1)array[i]=string.charCodeAt(i);return array}static buffer16ToString(buffer){const uint16array=new Uint16Array(buffer);return String.fromCharCode.apply(null,uint16array)}static buffer8ToString(buffer){const uint8array=new Uint8Array(buffer);return String.fromCharCode.apply(null,uint8array)}static base64DecodeUint8Array(input){const raw=window.atob(input),rawLength=raw.length,array=new Uint8Array(new ArrayBuffer(rawLength));for(let i=0;i<rawLength;i+=1)array[i]=raw.charCodeAt(i);return array}static base64EncodeUint8Array(input){const keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(;i<input.length;)chr1=input[i++],chr2=i<input.length?input[i++]:Number.NaN,chr3=i<input.length?input[i++]:Number.NaN,enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,Number.isNaN(chr2)?enc3=enc4=64:Number.isNaN(chr3)&&(enc4=64),output+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);return output}constructor(playerInterface,element,subsContainer){super();const{autoplay}=element;this.initialAutoplay=autoplay,this._playerInterface=playerInterface,this.element=element,this.subsContainer=subsContainer,this.listeners=[],this.waitForEvent("canplay",()=>{this.setSourcePromise&&(this.setSourcePromise.resolve(),this.setSourcePromise=null)},this.element),this.waitForEvent("pause",()=>{},this.element),this.waitForEvent("error",()=>{const{error}=this.element;_logger.default.error(`error on media element ${error} ${error.code} ${error.message}`),this._playerInterface.dispatchError(new _Error.default(_Error.default.Category.CRITICAL,_Error.default.Category.MEDIA,"html_element",`${error.code}:${error.message}`))},this.element),this.waitForEvent("webkitneedkey",this.onNeedKey,this.element)}async destroy(){await this.freeze(),this.listeners.forEach(({type,target,bindedAction})=>target.removeEventListener(type,bindedAction))}waitForEvent(type,action,target){const bindedAction=action.bind(this);this.listeners.push({type,target,bindedAction}),target.addEventListener(type,bindedAction,!1)}loadCertificate(){const cachedCertificate=PlayerHTML5.fpsCertificates[this.stream["fairplay.certificate_uri"]];return cachedCertificate||new Promise((resolve,reject)=>{const request=new XMLHttpRequest;request.responseType="arraybuffer",request.addEventListener("load",event=>{const request=event.target,res=new Uint8Array(request.response);PlayerHTML5.fpsCertificates[this.stream["fairplay.certificate_uri"]]=res,resolve(res)},!1),request.addEventListener("error",()=>{const err=new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.DRM,_Error.default.Code.LICENSE_REQUEST_FAILED,"com.apple.fps.1_0");this._playerInterface.dispatchError(err),reject(err)},!1),request.open("GET",this.stream["fairplay.certificate_uri"],!0),request.setRequestHeader("Pragma","Cache-Control: no-cache"),request.setRequestHeader("Cache-Control","max-age=0"),request.send()})}static extractContentId(initData){const contentIdUri=PlayerHTML5.buffer16ToString(initData.buffer),n=contentIdUri.indexOf("skd://");return contentIdUri.substr(n+6,contentIdUri.length)}static extractFoxContentId(initData){const contentIdUri=PlayerHTML5.buffer16ToString(initData.buffer),n=contentIdUri.indexOf("skd://");return contentIdUri.substr(contentIdUri.indexOf("?",n)+1).split("&").map(p=>p.substr(p.indexOf("=")+1)).join("").substr(0,100)}static extractNagraContentId(initData){const contentIdUri=PlayerHTML5.buffer16ToString(initData.buffer),n=contentIdUri.indexOf("skd://"),b64=contentIdUri.substr(n+6,contentIdUri.length).split("?")[0];return window.atob(b64)}static concatInitDataIdAndCertificate(initData,id,cert){"string"==typeof id&&(id=PlayerHTML5.stringToArray(id));let offset=0;const buffer=new ArrayBuffer(initData.byteLength+4+id.byteLength+4+cert.byteLength),dataView=new DataView(buffer);new Uint8Array(buffer,offset,initData.byteLength).set(initData),offset+=initData.byteLength,dataView.setUint32(offset,id.byteLength,!0),offset+=4;const idArray=new Uint16Array(buffer,offset,id.length);idArray.set(id),offset+=idArray.byteLength,dataView.setUint32(offset,cert.byteLength,!0),offset+=4;return new Uint8Array(buffer,offset,cert.byteLength).set(cert),new Uint8Array(buffer,0,buffer.byteLength)}async onNeedKey(event){const video=event.target,{initData}=event,{authMethod}=this;let contentId;contentId=this.stream["fairplay.content_id"]?this.stream["fairplay.content_id"]:"foxlatam"===authMethod?PlayerHTML5.extractFoxContentId(initData):"nagra"===authMethod?PlayerHTML5.extractNagraContentId(initData):PlayerHTML5.extractContentId(initData);const certificate=await this.loadCertificate(),sessionData=PlayerHTML5.concatInitDataIdAndCertificate(initData,contentId,certificate);if(this.stream.contentId=contentId,!this.element.webkitKeys){let keySystem;if(WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")&&(keySystem="com.apple.fps.1_0"),void 0===keySystem)return void this._playerInterface.dispatchError(new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.DRM,_Error.default.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE));video.webkitSetMediaKeys(new WebKitMediaKeys(keySystem))}if(!video.webkitKeys)return void this._playerInterface.dispatchError(new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.DRM,_Error.default.Code.FAILED_TO_CREATE_CDM,"com.apple.fps.1_0"));const keySession=video.webkitKeys.createSession("video/mp4",sessionData);keySession?(keySession.contentId=contentId,this.waitForEvent("webkitkeymessage",this.licenseRequestReady.bind(this),keySession),this.waitForEvent("webkitkeyadded",()=>{},keySession),this.waitForEvent("webkitkeyerror",e=>{_logger.default.error("A decryption key error was encountered",e),this._playerInterface.dispatchError(new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.DRM,_Error.default.Code.INTERNAL_ERROR_KEY_STATUS,"com.apple.fps.1_0 webkitkeyerror"))},keySession)):this._playerInterface.dispatchError(new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.DRM,_Error.default.Code.FAILED_TO_CREATE_SESSION,"com.apple.fps.1_0"))}licenseRequestReady(event){const session=event.target,{message}=event,request=new XMLHttpRequest;let licenseUrl;if(request.responseType="arraybuffer",request.session=session,request.addEventListener("load",event=>{const request=event.target;let keyText;if(request.status>=300){const responseText=PlayerHTML5.buffer8ToString(request.response);return void this._playerInterface.dispatchError(new _Error.default(_Error.default.Severity.CRITICAL,_Error.default.Category.DRM,_Error.default.Code.LICENSE_REQUEST_FAILED,responseText))}const responseContentType=request.getResponseHeader("Content-Type");if(null!==responseContentType&&0===responseContentType.indexOf("application/octet-stream")&&"nagra"!==this.authMethod){const key=new Uint8Array(request.response);return void session.update(key)}const responseText=PlayerHTML5.buffer8ToString(request.response);if("hbola"===this.authMethod){keyText=JSON.parse(responseText).License}else if("foxlatam"===this.authMethod)keyText=responseText;else if("nagra"===this.authMethod){keyText=JSON.parse(responseText).CkcMessage}else try{keyText=JSON.parse(responseText).ckc}catch(e){keyText=responseText.trim(),"<ckc>"===keyText.substr(0,5)&&"</ckc>"===keyText.substr(-6)&&(keyText=keyText.slice(5,-6))}const key=PlayerHTML5.base64DecodeUint8Array(keyText);session.update(key)},!1),request.addEventListener("error",error=>{_logger.default.error("The license request failed "+error)},!1),"irdeto"===this.stream["fairplay.auth_method"]){const url=new URL(this.stream["fairplay.license_server"]),searchParams=new URLSearchParams(url.search);null!==searchParams.get("keyId")&&0!==searchParams.get("keyId").length||searchParams.set("keyId",this.stream.contentId),url.search=searchParams.toString(),licenseUrl=url.toString()}else licenseUrl=this.stream["fairplay.license_server"];if(request.open("POST",licenseUrl,!0),this.stream["fairplay.license_request_headers"]&&Object.entries(this.stream["fairplay.license_request_headers"]).forEach(([k,v])=>{request.setRequestHeader(k,v)}),"hbola"===this.authMethod){request.setRequestHeader("Content-type","text/plain;charset=UTF-8");const customHeader=`tokenID=${this.stream["hbola.token_id"]}|skd://${this.stream.contentId}|operatorID=${this.stream["hbola.operator_id"]}|countryID=${this.stream["hbola.country_id"]}`,customHeaderU8=PlayerHTML5.stringToArray(customHeader),customHeaderB64=PlayerHTML5.base64EncodeUint8Array(customHeaderU8);request.setRequestHeader("dt-custom-data",customHeaderB64);const body=`<LicenseRequest xmlns="go:v6:interop"><PlaybackCtx><![CDATA[${PlayerHTML5.base64EncodeUint8Array(message)}]]></PlaybackCtx></LicenseRequest>`;request.send(body)}else if(this.stream["fairplay.raw_request"]||"irdeto"===this.authMethod||"foxlatam"===this.authMethod||"nagra"===this.authMethod||-1!==this.stream["fairplay.license_server"].indexOf("quickplay.com")||-1!==this.stream["fairplay.license_server"].indexOf("irdeto.com"))request.setRequestHeader("Content-type","application/octet-stream"),request.send(message);else{const params="spc="+encodeURIComponent(PlayerHTML5.base64EncodeUint8Array(message));request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),request.send(params)}}setSource(stream,options){return void 0!==options.autoplay&&(this.element.autoplay=options.autoplay),this.stream=stream,this.authMethod=this.stream["fairplay.auth_method"],void 0===this.authMethod&&this.stream["fairplay.license_server"]&&-1!==this.stream["fairplay.license_server"].indexOf("foxsyndicationlatam")&&(this.authMethod="foxlatam"),this.loadCertificate(),this.element.src=stream.uri,new Promise((resolve,reject)=>{this.setSourcePromise={resolve,reject}})}setMaxResolution(width,height){this._maxResolution={width,height}}setAbrRestrictions(){throw new Error("not implemented in this context")}freeze(){return this.stream=null,this.element.pause(),this.element.removeAttribute("src"),this.element.load(),this.element.autoplay=this.initialAutoplay,this.setSourcePromise&&(this.setSourcePromise.reject(new Error("aborted")),this.setSourcePromise=null),Promise.resolve()}getTimeInfo(){if(!this.stream)return null;const{currentTime,duration}=this.element;if(Number.isNaN(duration))return null;const seekRange_start=0,seekRange_end=0+duration;return{isLive:false,position:1e3*(0+currentTime),duration:1e3*(seekRange_end-seekRange_start),seekRange:[1e3*seekRange_start,1e3*seekRange_end]}}play(){this.element.play()}pause(){this.element.pause()}seek(position){this.element.currentTime=position/1e3}getTracks(){const video=[];this.element.videoHeight&&video.push({reference:"video","is-active":!0,name:"video",playable:!0,representations:[{width:this.element.videoWidth,height:this.element.videoHeight}]});const{audioTracks,textTracks}=this.element,audio=[];if(audioTracks)for(let i=0;i<audioTracks.length;i+=1){const t=audioTracks[i];audio.push({reference:t.id||"text-"+t.language,name:t.label||t.language,playable:!0,"is-active":t.enabled,"is-closed-caption":"caption"===t.kind,type:"text",language:t.language})}else audio.push({reference:"audio","is-active":!0,name:"audio",playable:!0});const text=[];if(textTracks)for(let i=0;i<textTracks.length;i+=1){const t=textTracks[i];text.push({reference:t.id||"text-"+t.language,name:t.label||t.language,playable:!0,"is-active":t.enabled,"is-closed-caption":"caption"===t.kind,type:"text",language:t.language})}return{video,audio,text}}applyTracks(toggledTracks){return toggledTracks.forEach(({track,enable})=>{Object.keys(this.element.textTracks).forEach(item=>{this.element.textTracks[item].label===track?this.element.textTracks[item].mode=enable?"showing":"disabled":this.element.textTracks[item].mode="disabled"})}),this.getTracks()}getStats(){return{}}}PlayerHTML5.fpsCertificates={},PlayerHTML5.id=_PlayerIds.default.HTML5;var _default=PlayerHTML5;exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireWildcard=__webpack_require__(59),_interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(__webpack_require__(61)),_extends2=_interopRequireDefault(__webpack_require__(8)),_FakeEvent=_interopRequireDefault(__webpack_require__(3)),_FakeEventTarget=_interopRequireDefault(__webpack_require__(4)),_VipUtils=_interopRequireDefault(__webpack_require__(11)),_veygaPlayer=_interopRequireDefault(__webpack_require__(13)),_PlayerIds=_interopRequireDefault(__webpack_require__(9)),_Error=_interopRequireWildcard(__webpack_require__(6)),_PlayerVeygaAbrFactory=_interopRequireDefault(__webpack_require__(63)),_PlayerVeygaClosedCaptionParser=_interopRequireDefault(__webpack_require__(66)),_PlayerVeygaTextDisplayer=_interopRequireDefault(__webpack_require__(68));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}const{objectApiToCamel}=_VipUtils.default;function veyga(){return window.veyga?window.veyga:_veygaPlayer.default}const resetedRestrictions={maxBandwidth:1/0,maxHeight:1/0,maxPixels:1/0,maxWidth:1/0,minBandwidth:0,minHeight:0,minPixels:0,minWidth:0};class PlayerVeyga extends _FakeEventTarget.default{constructor(playerInterface,element,subsContainer){return super(),this.veyga=veyga(),this.playerInterface=playerInterface,this.element=element,this.subsContainer=subsContainer,this.player=new this.veyga.Player,["error","streaming","adaptation","buffering","trackschanged","emsg"].forEach(type=>{this.player.addEventListener(type,event=>{this.emit(type,event)})}),this.player.getNetworkingEngine().registerRequestFilter(this._requestFilter.bind(this)),this}static setup(){const _veyga=veyga();if(_veyga.polyfill.installAll(),!_veyga.Player.isBrowserSupported())throw new Error("browser_not_supported")}async destroy(){await this.player.destroy(),this.player=null}_requestFilter(type,request){if(type===this.veyga.net.NetworkingEngine.RequestType.LICENSE){let parsedUri;const uri=request.uris[0];if("/"===uri.charAt(0))return;try{parsedUri=new URL(uri)}catch(e){return}if("veygo:"!==parsedUri.protocol)return;const id=parsedUri.searchParams.get("id"),url=`${this.stream["veygo.license_server"]}/keys/${id}?token=${this.stream["veygo.license_token"]}&device=${this.stream["veygo.device"]}&user_name=${this.stream["veygo.user_name"]}&user_token=${this.stream["veygo.user_token"]}`;request.uris.pop(),request.uris.push(url)}}onPlayerError(event){this.dispatchError(event)}dispatchError(veygaError){veygaError.detail&&(veygaError=veygaError.detail);const error=veygaError.category?(0,_Error.veygaToVipError)(veygaError):new _Error.default(_Error.default.Severity.CRITICAL,"generic","js_error",veygaError.message),evt=new _FakeEvent.default("error",{error});return this.dispatchEvent(evt),error}emit(type,data){if("error"===type)return void this.dispatchError(data.detail);const evt=new _FakeEvent.default(type,data);this.dispatchEvent(evt)}start(){this.dispatchStatus("initialized")}getTimeInfo(){if(null===this.player)throw new Error("no_player");const isLive=this.player.isLive();if(null===isLive)return null;const seekRange0=this.player.seekRange(),manifest=this.player.getManifest(),presentationTimeline=manifest?manifest.presentationTimeline:0,presentationStartTime=isLive?presentationTimeline.getPresentationStartTime():0,seekRange=[1e3*(presentationStartTime+seekRange0.start),1e3*(presentationStartTime+seekRange0.end)],bufferedInfo=this.player.getBufferedInfo();return(0,_extends2.default)({isLive,duration:1e3*(seekRange0.end-seekRange0.start),seekRange,buffers:bufferedInfo.total.map(b=>({start:1e3*(presentationStartTime+b.start),end:1e3*(presentationStartTime+b.end)}))},0===this.element.currentTime?void 0:{position:1e3*(presentationStartTime+this.player.getPresentationTime())})}seek(position){const isLive=this.player.isLive(),manifest=this.player.getManifest(),presentationTimeline=manifest?manifest.presentationTimeline:0,presentationStartTime=isLive?presentationTimeline.getPresentationStartTime():0;this.element.currentTime=position/1e3-presentationStartTime}isLive(){if(!this.player)throw new Error("setup_not_done");return this.player.isLive()}isBuffering(){if(!this.player)throw new Error("setup_not_done");return this.player.isBuffering()}freeze(){return this.player.unload(!1)}getTracks(){const videos=this.player.getVideoTracks().map(veygaTrack=>function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({reference:veygaTrack.id,"is-active":veygaTrack.active,name:veygaTrack.id,playable:!0},veygaTrack)),audios=this.player.getVariantTracks(),audio=this.player.getAudioLanguages().map(l=>{const variant=audios.filter(v=>v.language===l),active=audios.filter(v=>v.language===l&&v.active).length>0;return{reference:variant[0].id||"audio-"+l,name:variant[0].label||l,playable:!0,"is-active":active,"is-closed-caption":!1,roles:variant[0].roles,type:"audio",language:l}}),textVisible=this.player.isTextTrackVisible();return{audio,text:this.player.getTextTracks().map(t=>({reference:t.id||"text-"+t.language,name:t.label||t.language,playable:!0,"is-active":textVisible&&t.active,"is-closed-caption":"caption"===t.kind,roles:t.roles,type:"text",language:t.language})),video:videos}}async applyTracks(toggleTracks){const tracks=toggleTracks.sort((a,b)=>a.enable-b.enable);let hasText;for(let i=0;i<tracks.length;i+=1){const t=tracks[i];t.enable?"text"===t.track.type?(await this.player.selectTextLanguage(t.track.language,t.track.roles[0]),hasText=!0):"audio"===t.track.type&&await this.player.selectAudioLanguage(t.track.language):"text"===t.track.type&&(hasText=!1)}return void 0!==hasText&&await this.player.setTextTrackVisibility(hasText||!1),this.getTracks()}setSource(stream,options){if(!this.player)throw new _Error.default(_Error.default.Severity.RECOVERABLE,_Error.default.Category.PLAYER,_Error.default.Code.FAILED_TO_CREATE_SESSION,"player_was_destroyed");this.stream=stream,this.restrictions_=resetedRestrictions,this.player.resetConfiguration();const config={textDisplayFactory:function textDisplayFactory(veygaPlayer,videoElement,subsContainer){return new _PlayerVeygaTextDisplayer.default(videoElement,subsContainer)}.bind(null,this,this.element,this.subsContainer),closedCaptionParserFactory:()=>new _PlayerVeygaClosedCaptionParser.default,manifest:{retryParameters:{timeout:0},dash:{defaultPresentationDelay:options.liveDelay||options.streaming.liveDelay&&options.streaming.liveDelay/1e3,autoCorrectDrift:!0}},streaming:{startAtSegmentBoundary:!0,forceTransmuxTS:!0,jumpLargeGaps:!0,retryParameters:{timeout:0},rebufferingGoal:options.streaming.rebufferingGoal&&options.streaming.rebufferingGoal/1e3,bufferingGoal:options.streaming.bufferingGoal&&options.streaming.bufferingGoal/1e3,bufferBehind:options.streaming.bufferBehind&&options.streaming.bufferBehind/1e3},drm:{retryParameters:{timeout:0}},abr:{switchInterval:options.abr.switchInterval&&options.abr.switchInterval/1e3,keepAudioQualityConstant:options.abr.keepAudioQualityConstant,keepAudioQualityConstantBitrate:options.abr.keepAudioQualityConstantBitrate},abrFactory:_PlayerVeygaAbrFactory.default,preferredAudioLanguage:options.preferredAudioLanguages?options.preferredAudioLanguages[0]:"",preferredTextLanguage:options.preferredTextLanguages?options.preferredTextLanguages[0]:"",preferredTextRole:options.preferredTextRoles?options.preferredTextRoles[0]:""};config.restrictions=objectApiToCamel(this.restrictions_),this.initialBandwidthEstimate_&&(config.abr.defaultBandwidthEstimate=this.initialBandwidthEstimate_);const drm={servers:{},advanced:{}};return(stream["hbola.operator_id"]||stream["hbola.country_id"]||stream["hbola.token_id"])&&(drm.hbola={operatorID:stream["hbola.operator_id"],countryID:stream["hbola.country_id"],tokenID:stream["hbola.token_id"]}),(stream["widevine.license_server"]||"widevine"===stream.scheme)&&(drm.servers["com.widevine.alpha"]=stream["widevine.license_server"]||stream.server,drm.advanced["com.widevine.alpha"]={videoRobustness:"SW_SECURE_CRYPTO",audioRobustness:"SW_SECURE_CRYPTO",authMethod:stream["widevine.auth_method"],serverCertificate:stream["widevine.certificate"]},drm.licenseRequestExtraHeaders=stream["widevine.license_request_headers"]||{}),stream.clear_keys&&(drm.clearKeys=stream.clear_keys),config.drm=drm,this.player.configure(config),this.player.attach(this.element,!1),this.player.load(stream.uri,options.startPosition?options.startPosition/1e3:void 0).catch(veygaError=>{veygaError.detail&&(veygaError=veygaError.detail);throw(0,_Error.veygaToVipError)(veygaError)})}setMaxResolution(w,h){this.player.setMaxHardwareResolution(w,h)}setAbrRestrictions(restrictions){const playerRestrictions_=(0,_extends2.default)({},resetedRestrictions,objectApiToCamel(restrictions));this.restrictions_=playerRestrictions_;const config={restrictions:playerRestrictions_};this.player.configure(config)}setInitialBandwidthEstimate(initialBandwidthEstimate){this.initialBandwidthEstimate_=initialBandwidthEstimate;const config={abr:{defaultBandwidthEstimate:initialBandwidthEstimate}};this.player.configure(config)}getStats(){return this.player.getStats()}}exports.default=PlayerVeyga,PlayerVeyga.id=_PlayerIds.default.VEYGA},function(module,exports,__webpack_require__){var _typeof=__webpack_require__(60);function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}module.exports=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}},function(module,exports){function _typeof(obj){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?module.exports=_typeof=function _typeof(obj){return typeof obj}:module.exports=_typeof=function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}module.exports=_typeof},function(module,exports){module.exports=function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _logger=_interopRequireDefault(__webpack_require__(1)),_veygaPlayer=_interopRequireDefault(__webpack_require__(13)),_EwmaBandwidthEstimator=_interopRequireDefault(__webpack_require__(64));const veyga=function whichVeyga(){return window.veyga?window.veyga:_veygaPlayer.default}(),{SimpleAbrManager}=veyga.abr;class PlayerVeygaAbrFactory extends SimpleAbrManager{constructor(){super(),this.switch_=null,this.enabled_=!1,this.bandwidthEstimator_=new _EwmaBandwidthEstimator.default,this.variants_=[],this.startupComplete_=!1,this.lastTimeChosenMs_=null,this.config_=null}static varTag(v){return v.video.bandwidth?`v:${v.video.bandwidth}:a:${v.audio.bandwidth}`:""+v.bandwidth}stop(){this.switch_=null,this.enabled_=!1,this.variants_=[],this.lastTimeChosenMs_=null}init(switchCallback){this.switch_=switchCallback}chooseVariant(){let sortedVariants=PlayerVeygaAbrFactory.filterAndSortVariants_(this.config_.restrictions,this.variants_);const currentBandwidth=this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate);this.variants_.length&&!sortedVariants.length&&(_logger.default.warn("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),sortedVariants=PlayerVeygaAbrFactory.filterAndSortVariants_(null,this.variants_),sortedVariants=[sortedVariants[0]]);let chosen=sortedVariants[0]||null;PlayerVeygaAbrFactory.LOG_ABR&&_logger.default.debug("bw",currentBandwidth,"variants",sortedVariants.map(veyga.abr.SimpleAbrManager.varTag));for(let i=0;i<sortedVariants.length;i+=1){const variant=sortedVariants[i],nextVariant=sortedVariants[i+1]||{bandwidth:1/0},minBandwidth=variant.bandwidth/this.config_.bandwidthDowngradeTarget,maxBandwidth=nextVariant.bandwidth/this.config_.bandwidthUpgradeTarget;currentBandwidth>=minBandwidth&&currentBandwidth<=maxBandwidth&&(PlayerVeygaAbrFactory.LOG_ABR&&_logger.default.debug(`variant #${i} ${veyga.abr.SimpleAbrManager.varTag(variant)} ok, min ${minBandwidth}, max ${maxBandwidth}`),chosen=variant)}return PlayerVeygaAbrFactory.LOG_ABR&&_logger.default.debug("chosenVariant",veyga.abr.SimpleAbrManager.varTag(chosen)),this.lastTimeChosenMs_=Date.now(),chosen}enable(){this.enabled_=!0}disable(){this.enabled_=!1}segmentDownloaded(deltaTimeMs,numBytes){this.bandwidthEstimator_.sample(deltaTimeMs,numBytes),null!=this.lastTimeChosenMs_&&this.enabled_&&this.suggestStreams_()}getBandwidthEstimate(){return this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate)}setVariants(variants){const sortedVariants=variants.sort((v1,v2)=>v1.bandwidth-v2.bandwidth);let ascendingVideoBandwidth=0;const audioByQualities={},videoByQualities={},sortedFilteredVariants=sortedVariants.filter(v=>(v.audio&&v.audio.bandwidth&&(audioByQualities[v.audio.bandwidth]=!0),v.video&&v.video.bandwidth?(videoByQualities[v.video.bandwidth]=!0,v.video.bandwidth>=ascendingVideoBandwidth&&(ascendingVideoBandwidth=v.video.bandwidth,!0)):(videoByQualities[0]=!0,!0))),audioQualities=Object.keys(audioByQualities).map(x=>parseInt(x,10)).sort((a,b)=>a-b);if(this.config_.keepAudioQualityConstant||this.config_.keepAudioQualityConstantBitrate){let chosenAudioQuality;if(this.config_.keepAudioQualityConstantBitrate){const audioQualitiesDist=audioQualities.map((bitrate,idx)=>[idx,Math.abs(bitrate-this.config_.keepAudioQualityConstantBitrate)]).sort((a,b)=>a[1]-b[1]);chosenAudioQuality=audioQualities[audioQualitiesDist[0][0]]}else{const audioIndex=Math.ceil((audioQualities.length-1)/2);chosenAudioQuality=audioQualities[audioIndex]}this.variants_=sortedFilteredVariants.filter(v=>!(!v.audio||!v.audio.bandwidth)&&v.audio.bandwidth===chosenAudioQuality)}else{const videoQualities=Object.keys(videoByQualities).map(x=>parseInt(x,10)).sort((a,b)=>a-b),actualVideoRepresentationStartIndex=0===videoByQualities[0]?1:0,actualVideoRepresentationLength=videoQualities.length-actualVideoRepresentationStartIndex;for(let i=0;i<videoQualities.length;i+=1){const videoQuality=videoQualities[i],audioSetIndex=Math.ceil((audioQualities.length-1)*(i-actualVideoRepresentationStartIndex)/actualVideoRepresentationLength);videoByQualities[videoQuality]=audioQualities[audioSetIndex]}this.variants_=sortedFilteredVariants.filter(v=>!v.audio||!v.audio.bandwidth||(!v.video||!v.video.bandwidth||v.audio.bandwidth===videoByQualities[v.video.bandwidth]))}}configure(config){this.config_=config}suggestStreams_(){if(this.startupComplete_){if(Date.now()-this.lastTimeChosenMs_<1e3*this.config_.switchInterval)return}else{if(!this.bandwidthEstimator_.hasGoodEstimate())return;this.startupComplete_=!0}const chosenVariant=this.chooseVariant();this.switch_(chosenVariant)}static filterAndSortVariants_(restrictions,variants){return restrictions&&(variants=variants.filter(variant=>veyga.util.StreamUtils.meetsRestrictions(variant,restrictions,{width:1/0,height:1/0}))),variants}}PlayerVeygaAbrFactory.LOG_ABR=!1;var _default=PlayerVeygaAbrFactory;exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Ewma=_interopRequireDefault(__webpack_require__(65));exports.default=class EwmaBandwidthEstimator{constructor(){this.fast_=new _Ewma.default(2),this.slow_=new _Ewma.default(5),this.bytesSampled_=0,this.minTotalBytes_=128e3,this.minBytes_=16e3}sample(durationMs,numBytes){if(numBytes<this.minBytes_)return;const bandwidth=8e3*numBytes/durationMs,weight=durationMs/1e3;this.bytesSampled_+=numBytes,this.fast_.sample(weight,bandwidth),this.slow_.sample(weight,bandwidth)}getBandwidthEstimate(defaultEstimate){return this.bytesSampled_<this.minTotalBytes_?defaultEstimate:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}hasGoodEstimate(){return this.bytesSampled_>=this.minTotalBytes_}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default=class Ewma{constructor(halfLife){this.alpha_=Math.exp(Math.log(.5)/halfLife),this.estimate_=0,this.totalWeight_=0}sample(weight,value){const adjAlpha=this.alpha_**weight,newEstimate=value*(1-adjAlpha)+adjAlpha*this.estimate_;Number.isNaN(newEstimate)||(this.estimate_=newEstimate,this.totalWeight_+=weight)}getEstimate(){const zeroFactor=1-this.alpha_**this.totalWeight_;return this.estimate_/zeroFactor}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _FakeEvent=_interopRequireDefault(__webpack_require__(3)),_FakeEventTarget=_interopRequireDefault(__webpack_require__(4)),_cea608Parser=__webpack_require__(67);class PlayerVeygaClosedCaptionParser extends _FakeEventTarget.default{constructor(){super(),this.parsers=[new _cea608Parser.Cea608Parser(1,{newCue:this.newCue.bind(this,"CC1")},{newCue:this.newCue.bind(this,"CC2")}),new _cea608Parser.Cea608Parser(2,{newCue:this.newCue.bind(this,"CC3")},{newCue:this.newCue.bind(this,"CC4")})]}newCue(stream,startPts,endPts,captionScreen){const copyScreen=new _cea608Parser.CaptionScreen;copyScreen.copy(captionScreen),this.dispatchEvent(new _FakeEvent.default("data",{startPts,endPts,stream,text:copyScreen}))}addData(newCaptionPackets){newCaptionPackets.forEach(packet=>{const short=packet.ccData;this.parsers[packet.type]&&this.parsers[packet.type].addData(packet.pts,[short>>8,255&short])})}}var _default=PlayerVeygaClosedCaptionParser;exports.default=_default},function(module,exports,__webpack_require__){"use strict";!function(exports){var specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(byte){var charCode=byte;return specialCea608CharsCodes.hasOwnProperty(byte)&&(charCode=specialCea608CharsCodes[byte]),String.fromCharCode(charCode)},rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],logger={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(newTime){this.time=newTime},log:function(severity,msg){var minLevel=this.verboseFilter[severity];this.verboseLevel>=minLevel&&console.log(this.time+" ["+severity+"] "+msg)}},numArrayToHexArray=function(numArray){for(var hexArray=[],j=0;j<numArray.length;j++)hexArray.push(numArray[j].toString(16));return hexArray},PenState=function(foreground,underline,italics,background,flash){this.foreground=foreground||"white",this.underline=underline||!1,this.italics=italics||!1,this.background=background||"black",this.flash=flash||!1};PenState.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(styles){for(var attribs=["foreground","underline","italics","background","flash"],i=0;i<attribs.length;i++){var style=attribs[i];styles.hasOwnProperty(style)&&(this[style]=styles[style])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash},copy:function(newPenState){this.foreground=newPenState.foreground,this.underline=newPenState.underline,this.italics=newPenState.italics,this.background=newPenState.background,this.flash=newPenState.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var StyledUnicodeChar=function(uchar,foreground,underline,italics,background,flash){this.uchar=uchar||" ",this.penState=new PenState(foreground,underline,italics,background,flash)};StyledUnicodeChar.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(uchar,newPenState){this.uchar=uchar,this.penState.copy(newPenState)},setPenState:function(newPenState){this.penState.copy(newPenState)},equals:function(other){return this.uchar===other.uchar&&this.penState.equals(other.penState)},copy:function(newChar){this.uchar=newChar.uchar,this.penState.copy(newChar.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var Row=function(){this.chars=[];for(var i=0;i<32;i++)this.chars.push(new StyledUnicodeChar);this.pos=0,this.currPenState=new PenState};Row.prototype={equals:function(other){for(var equal=!0,i=0;i<32;i++)if(!this.chars[i].equals(other.chars[i])){equal=!1;break}return equal},copy:function(other){for(var i=0;i<32;i++)this.chars[i].copy(other.chars[i])},isEmpty:function(){for(var empty=!0,i=0;i<32;i++)if(!this.chars[i].isEmpty()){empty=!1;break}return empty},setCursor:function(absPos){this.pos!==absPos&&(this.pos=absPos),this.pos<0?(logger.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>32&&(logger.log("ERROR","Too large cursor position "+this.pos),this.pos=32)},moveCursor:function(relPos){var newPos=this.pos+relPos;if(relPos>1)for(var i=this.pos+1;i<newPos+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(newPos)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(byte){byte>=144&&this.backSpace();var char=getCharForByte(byte);this.pos>=32?logger.log("ERROR","Cannot insert "+byte.toString(16)+" ("+char+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(char,this.currPenState),this.moveCursor(1))},clearFromPos:function(startPos){var i;for(i=startPos;i<32;i++)this.chars[i].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var chars=[],empty=!0,i=0;i<32;i++){var char=this.chars[i].uchar;" "!==char&&(empty=!1),chars.push(char)}return empty?"":chars.join("")},setPenStyles:function(styles){this.currPenState.setStyles(styles),this.chars[this.pos].setPenState(this.currPenState)}};var CaptionScreen=function(){this.rows=[];for(var i=0;i<15;i++)this.rows.push(new Row);this.currRow=14,this.nrRollUpRows=null,this.reset()};CaptionScreen.prototype={reset:function(){for(var i=0;i<15;i++)this.rows[i].clear();this.currRow=14},equals:function(other){for(var equal=!0,i=0;i<15;i++)if(!this.rows[i].equals(other.rows[i])){equal=!1;break}return equal},copy:function(other){for(var i=0;i<15;i++)this.rows[i].copy(other.rows[i])},isEmpty:function(){for(var empty=!0,i=0;i<15;i++)if(!this.rows[i].isEmpty()){empty=!1;break}return empty},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(char){this.rows[this.currRow].insertChar(char)},setPen:function(styles){this.rows[this.currRow].setPenStyles(styles)},moveCursor:function(relPos){this.rows[this.currRow].moveCursor(relPos)},setCursor:function(absPos){logger.log("INFO","setCursor: "+absPos),this.rows[this.currRow].setCursor(absPos)},setPAC:function(pacData){logger.log("INFO","pacData = "+JSON.stringify(pacData));var newRow=pacData.row-1;this.nrRollUpRows&&newRow<this.nrRollUpRows-1&&(newRow=this.nrRollUpRows-1),this.currRow=newRow;var row=this.rows[this.currRow];if(null!==pacData.indent){var indent=pacData.indent,prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent),pacData.color=row.chars[prevPos].penState.foreground}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:"black",flash:!1};this.setPen(styles)},setBkgData:function(bkgData){logger.log("INFO","bkgData = "+JSON.stringify(bkgData)),this.backSpace(),this.setPen(bkgData),this.insertChar(32)},setRollUpRows:function(nrRows){this.nrRollUpRows=nrRows},rollUp:function(){if(null!==this.nrRollUpRows){logger.log("TEXT",this.getDisplayText());var topRowIndex=this.currRow+1-this.nrRollUpRows,topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear(),this.rows.splice(this.currRow,0,topRow),logger.log("INFO","Rolling up")}else logger.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(asOneRow){asOneRow=asOneRow||!1;for(var displayText=[],text="",rowNr=-1,i=0;i<15;i++){var rowText=this.rows[i].getTextString();rowText&&(rowNr=i+1,asOneRow?displayText.push("Row "+rowNr+': "'+rowText+'"'):displayText.push(rowText.trim()))}return displayText.length>0&&(text=asOneRow?"["+displayText.join(" | ")+"]":displayText.join("\n")),text},getTextAndFormat:function(){return this.rows}};var Cea608Channel=function(channelNumber,outputFilter){this.chNr=channelNumber,this.outputFilter=outputFilter,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen,this.nonDisplayedMemory=new CaptionScreen,this.lastOutputScreen=new CaptionScreen,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};Cea608Channel.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(newHandler){this.outputFilter=newHandler},setPAC:function(pacData){this.writeScreen.setPAC(pacData)},setBkgData:function(bkgData){this.writeScreen.setBkgData(bkgData)},setMode:function(newMode){newMode!==this.mode&&(this.mode=newMode,logger.log("INFO","MODE="+newMode),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=newMode)},insertChars:function(chars){for(var i=0;i<chars.length;i++)this.writeScreen.insertChar(chars[i]);var screen=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";logger.log("INFO",screen+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(logger.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){logger.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){logger.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){logger.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(nrRows){logger.log("INFO","RU("+nrRows+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nrRows)},cc_FON:function(){logger.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){logger.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){logger.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){logger.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){logger.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){logger.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){logger.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(logger.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=tmp,this.writeScreen=this.nonDisplayedMemory,logger.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(nrCols){logger.log("INFO","TO("+nrCols+") - Tab Offset"),this.writeScreen.moveCursor(nrCols)},cc_MIDROW:function(secondByte){var styles={flash:!1};if(styles.underline=secondByte%2==1,styles.italics=secondByte>=46,styles.italics)styles.foreground="white";else{var colorIndex=Math.floor(secondByte/2)-16;styles.foreground=["white","green","blue","cyan","red","yellow","magenta"][colorIndex]}logger.log("INFO","MIDROW: "+JSON.stringify(styles)),this.writeScreen.setPen(styles)},outputDataUpdate:function(){var t=logger.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}};var Cea608Parser=function(field,out1,out2){this.field=field||1,this.outputs=[out1,out2],this.channels=[new Cea608Channel(1,out1),new Cea608Channel(2,out2)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};Cea608Parser.prototype={getHandler:function(index){return this.channels[index].getHandler()},setHandler:function(index,newHandler){this.channels[index].setHandler(newHandler)},addData:function(t,byteList){var cmdFound,a,b,charsFound=!1;this.lastTime=t,logger.setTime(t);for(var i=0;i<byteList.length;i+=2)if(a=127&byteList[i],b=127&byteList[i+1],a>=16&&a<=31&&a===this.lastCmdA&&b===this.lastCmdB)this.lastCmdA=null,this.lastCmdB=null,logger.log("DEBUG","Repeated command ("+numArrayToHexArray([a,b])+") is dropped");else if(0!==a||0!==b){if(logger.log("DATA","["+numArrayToHexArray([byteList[i],byteList[i+1]])+"] -> ("+numArrayToHexArray([a,b])+")"),(cmdFound=this.parseCmd(a,b))||(cmdFound=this.parseMidrow(a,b)),cmdFound||(cmdFound=this.parsePAC(a,b)),cmdFound||(cmdFound=this.parseBackgroundAttributes(a,b)),!cmdFound)if(charsFound=this.parseChars(a,b))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(charsFound);else logger.log("WARNING","No channel found yet. TEXT-MODE?");cmdFound?this.dataCounters.cmd+=2:charsFound?this.dataCounters.char+=2:(this.dataCounters.other+=2,logger.log("WARNING","Couldn't parse cleaned data "+numArrayToHexArray([a,b])+" orig: "+numArrayToHexArray([byteList[i],byteList[i+1]])))}else this.dataCounters.padding+=2},parseCmd:function(a,b){var chNr=null;if(!((20===a||21===a||28===a||29===a)&&32<=b&&b<=47)&&!((23===a||31===a)&&33<=b&&b<=35))return!1;chNr=20===a||21===a||23===a?1:2;var channel=this.channels[chNr-1];return 20===a||21===a||28===a||29===a?32===b?channel.cc_RCL():33===b?channel.cc_BS():34===b?channel.cc_AOF():35===b?channel.cc_AON():36===b?channel.cc_DER():37===b?channel.cc_RU(2):38===b?channel.cc_RU(3):39===b?channel.cc_RU(4):40===b?channel.cc_FON():41===b?channel.cc_RDC():42===b?channel.cc_TR():43===b?channel.cc_RTD():44===b?channel.cc_EDM():45===b?channel.cc_CR():46===b?channel.cc_ENM():47===b&&channel.cc_EOC():channel.cc_TO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0},parseMidrow:function(a,b){var chNr=null;if((17===a||25===a)&&32<=b&&b<=47){if((chNr=17===a?1:2)!==this.currChNr)return logger.log("ERROR","Mismatch channel in midrow parsing"),!1;var channel=this.channels[chNr-1];return channel.insertChars([32]),channel.cc_MIDROW(b),logger.log("DEBUG","MIDROW ("+numArrayToHexArray([a,b])+")"),this.lastCmdA=a,this.lastCmdB=b,!0}return!1},parsePAC:function(a,b){var chNr,row=null;if(!((17<=a&&a<=23||25<=a&&a<=31)&&64<=b&&b<=127)&&!((16===a||24===a)&&64<=b&&b<=95))return!1;chNr=a<=23?1:2,row=64<=b&&b<=95?1===chNr?rowsLowCh1[a]:rowsLowCh2[a]:1===chNr?rowsHighCh1[a]:rowsHighCh2[a];var pacData=this.interpretPAC(row,b);return this.channels[chNr-1].setPAC(pacData),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0},interpretPAC:function(row,byte){var pacIndex=byte,pacData={color:null,italics:!1,indent:null,underline:!1,row};return pacIndex=byte>95?byte-96:byte-64,pacData.underline=1==(1&pacIndex),pacIndex<=13?pacData.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pacIndex/2)]:pacIndex<=15?(pacData.italics=!0,pacData.color="white"):pacData.indent=4*Math.floor((pacIndex-16)/2),pacData},parseChars:function(a,b){var channelNr=null,charCodes=null,charCode1=null;if(a>=25?(channelNr=2,charCode1=a-8):(channelNr=1,charCode1=a),17<=charCode1&&charCode1<=19){var oneCode=b;oneCode=17===charCode1?b+80:18===charCode1?b+112:b+144,logger.log("INFO","Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr),charCodes=[oneCode],this.lastCmdA=a,this.lastCmdB=b}else 32<=a&&a<=127&&(charCodes=0===b?[a]:[a,b],this.lastCmdA=null,this.lastCmdB=null);if(charCodes){var hexCodes=numArrayToHexArray(charCodes);logger.log("DEBUG","Char codes =  "+hexCodes.join(","))}return charCodes},parseBackgroundAttributes:function(a,b){var bkgData,index,chNr;return((16===a||24===a)&&32<=b&&b<=47||(23===a||31===a)&&45<=b&&b<=47)&&(bkgData={},16===a||24===a?(index=Math.floor((b-32)/2),bkgData.background=backgroundColors[index],b%2==1&&(bkgData.background=bkgData.background+"_semi")):45===b?bkgData.background="transparent":(bkgData.foreground="black",47===b&&(bkgData.underline=!0)),chNr=a<24?1:2,this.channels[chNr-1].setBkgData(bkgData),this.lastCmdA=a,this.lastCmdB=b,!0)},reset:function(){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(t){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].cueSplitAtTime(t)}};exports.logger=logger,exports.PenState=PenState,exports.CaptionScreen=CaptionScreen,exports.Cea608Parser=Cea608Parser,exports.findCea608Nalus=function(raw,startPos,size){for(var nalSize=0,cursor=startPos,cea608NaluRanges=[],isCEA608SEI=function(payloadType,payloadSize,raw,pos){if(4!==payloadType||payloadSize<8)return null;var countryCode=raw.getUint8(pos),providerCode=raw.getUint16(pos+1),userIdentifier=raw.getUint32(pos+3),userDataTypeCode=raw.getUint8(pos+7);return 181==countryCode&&49==providerCode&&1195456820==userIdentifier&&3==userDataTypeCode};cursor<startPos+size;){if(nalSize=raw.getUint32(cursor),6===(31&raw.getUint8(cursor+4)))for(var pos=cursor+5,payloadType=-1;pos<cursor+4+nalSize-1;){payloadType=0;for(var b=255;255===b;)payloadType+=b=raw.getUint8(pos),pos++;var payloadSize=0;for(b=255;255===b;)payloadSize+=b=raw.getUint8(pos),pos++;isCEA608SEI(payloadType,payloadSize,raw,pos)&&cea608NaluRanges.push([pos,payloadSize]),pos+=payloadSize}cursor+=nalSize+4}return cea608NaluRanges},exports.extractCea608DataFromRange=function(raw,cea608Range){var pos=cea608Range[0],fieldData=[[],[]];pos+=8;var ccCount=31&raw.getUint8(pos);pos+=2;for(var i=0;i<ccCount;i++){var byte=raw.getUint8(pos),ccValid=4&byte,ccType=3&byte;pos++;var ccData1=raw.getUint8(pos);pos++;var ccData2=raw.getUint8(pos);pos++,ccValid&&(127&ccData1)+(127&ccData2)!=0&&(0===ccType?(fieldData[0].push(ccData1),fieldData[0].push(ccData2)):1===ccType&&(fieldData[1].push(ccData1),fieldData[1].push(ccData2)))}return fieldData}}(exports)},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;_interopRequireDefault(__webpack_require__(1));var _veygaPlayer=_interopRequireDefault(__webpack_require__(13)),_ResizeSensor=_interopRequireDefault(__webpack_require__(69)),_EmbeddedTextHtmlRender=_interopRequireDefault(__webpack_require__(70));const veyga=function whichVeyga(){return window.veyga?window.veyga:_veygaPlayer.default}(),{Cue}=veyga.text;function PlayerVeygaTextDisplayer(video,subContainer){this.textTrack_=null,this.video_=video,void 0===subContainer?((subContainer=document.createElement("div")).id="veygoTextDisplayer0",subContainer.classList.add("veygoTextDisplayer"),this.video_.parentNode.insertBefore(subContainer,this.video_.nextSibling),this.subContainerAdded_=!0):this.subContainerAdded_=!1,subContainer.style.position="absolute",subContainer.style.display="block",this.subContainer_=subContainer,this.subContainerRect_=null,this.subContent_=null,this.visibility_=!1;for(let i=0;i<video.textTracks.length;++i){let track=video.textTracks[i];track.mode="disabled",track.label==PlayerVeygaTextDisplayer.TextTrackLabel_&&(this.textTrack_=track)}this.textTrack_||(this.textTrack_=video.addTextTrack("subtitles",PlayerVeygaTextDisplayer.TextTrackLabel_)),this.textTrack_.oncuechange=this.onCueChange.bind(this),this.textTrack_.mode="hidden",this.sensorCb_=this.onVideoElementResize_.bind(this),this.sensor_=new _ResizeSensor.default(video.parentNode,this.sensorCb_),this.videoCb_=this.onVideoResize_.bind(this),video.addEventListener("loadedmetadata",this.videoCb_),this.repositionText_()}const percentMatcher=/([\d.]+)%/;PlayerVeygaTextDisplayer.prototype.onCueChange=function(){if(!this.textTrack_)return;const{activeCues}=this.textTrack_;if(null==activeCues||0===activeCues.length){const{subContainer_}=this;for(;subContainer_.firstChild;)subContainer_.removeChild(subContainer_.firstChild);return void(this.subContent_=null)}const captionContainer=this.subContainer_,firstCue=activeCues[0],firstVeygaCue=firstCue.veygaCue;let subContent;if("object"==typeof firstVeygaCue.payload){const videoOffsetLeft=0,videoOffsetTop=0,aspectRatio=4/3,use80Percent=!0,{videoWidth,offsetWidth}=this.video_;if(0===videoWidth||0===offsetWidth)return;const{videoHeight,offsetHeight}=this.video_,realVideoSize=function getVideoVisibleVideoSize(viewWidth,viewHeight,videoWidth,videoHeight,aspectRatio,use80Percent){let videoPictureWidth=0,videoPictureHeight=0;viewWidth/viewHeight>videoWidth/videoHeight?(videoPictureHeight=viewHeight,videoPictureWidth=videoPictureHeight/videoHeight*videoWidth):(videoPictureWidth=viewWidth,videoPictureHeight=videoPictureWidth/videoWidth*videoHeight);let videoPictureXAspect=0,videoPictureYAspect=0,videoPictureWidthAspect=0,videoPictureHeightAspect=0;return videoPictureWidth/videoPictureHeight>aspectRatio?(videoPictureHeightAspect=videoPictureHeight,videoPictureWidthAspect=videoPictureHeight*aspectRatio):(videoPictureWidthAspect=videoPictureWidth,videoPictureHeightAspect=videoPictureWidth/aspectRatio),videoPictureXAspect=(viewWidth-videoPictureWidthAspect)/2,videoPictureYAspect=(viewHeight-videoPictureHeightAspect)/2,use80Percent?{x:videoPictureXAspect+.1*videoPictureWidthAspect,y:videoPictureYAspect+.1*videoPictureHeightAspect,w:.8*videoPictureWidthAspect,h:.8*videoPictureHeightAspect}:{x:videoPictureXAspect,y:videoPictureYAspect,w:videoPictureWidthAspect,h:videoPictureHeightAspect}}(offsetWidth,offsetHeight,videoWidth,videoHeight,aspectRatio,use80Percent),newVideoWidth=realVideoSize.w,newVideoHeight=realVideoSize.h,actualVideoLeft=realVideoSize.x+videoOffsetLeft,actualVideoTop=realVideoSize.y+videoOffsetTop,actualVideoWidth=newVideoWidth,actualVideoHeight=newVideoHeight;if(captionContainer){const containerStyle=captionContainer.style;containerStyle.left=actualVideoLeft+"px",containerStyle.top=actualVideoTop+"px",containerStyle.width=actualVideoWidth+"px",containerStyle.height=actualVideoHeight+"px"}const{subContainer_}=this;for(;subContainer_.firstChild;)subContainer_.removeChild(subContainer_.firstChild);this.subContent_=null;const activeCuesLength=activeCues.length;for(let i=0;i<activeCuesLength;i+=1){const veygaCue=activeCues[i].veygaCue;veygaCue.payload;_EmbeddedTextHtmlRender.default.createHTMLCaptionsFromScreen(newVideoWidth,newVideoHeight,0,0,veygaCue.payload).forEach(caption=>{const subContent=caption.cueHTMLElement;this.subContainer_.appendChild(subContent)})}return}const{subContainer_}=this;for(;subContainer_.firstChild;)subContainer_.removeChild(subContainer_.firstChild);this.subContent_=null;const containerStyle=captionContainer.style;if(delete containerStyle.left,delete containerStyle.top,delete containerStyle.width,delete containerStyle.height,firstVeygaCue.image)if(firstVeygaCue.telecentroPatch){subContent=document.createElement("div"),subContent.className="genericSub";const img=document.createElement("img"),dataUrl="data:image/png;base64,"+firstVeygaCue.image;img.style.display="none",img.src=dataUrl,img.onload=()=>{if(1920===img.width)img.style.width="100%";else{const scale=this.subContainerRect_.width*firstVeygaCue.region.width/100/1e3;img.style.height=scale*img.height+"px",img.style.width=scale*img.width+"px"}img.style.display="initial"},subContent.appendChild(img)}else{subContent=document.createElement("img");const dataUrl="data:image/png;base64,"+firstVeygaCue.image;subContent.src=dataUrl}else{subContent=document.createElement("div"),subContent.className="genericSub";const paddedContent=document.createElement("div");paddedContent.className="genericSubPadded";const subSpan=document.createElement("span");if(subSpan.className="genericSubSpan",subContent.style.display="flex",subContent.style.flexDirection="column",subContent.style.alignItems="center",firstVeygaCue.padding&&2===firstVeygaCue.padding.length){const p1=firstVeygaCue.padding[1],p1m=p1.match(percentMatcher),p1px=p1m?p1m[1]*this.subContainerRect_.height/100:p1;paddedContent.style.paddingBottom=p1px+"px"}firstVeygaCue.displayAlign===Cue.displayAlign.CENTER?subContent.style.justifyContent="center":firstVeygaCue.displayAlign===Cue.displayAlign.AFTER?subContent.style.justifyContent="flex-end":firstVeygaCue.displayAlign===Cue.displayAlign.BEFORE&&(subContent.style.justifyContent="flex-start"),"center"==firstVeygaCue.textAlign&&(subContent.style.textAlign="center");const fontSizePercentM=(firstVeygaCue.fontSize||"4%").match(percentMatcher);if(fontSizePercentM){const ratio=parseFloat(fontSizePercentM[1])/100;subContent.style.fontSize=this.subContainerRect_.height*ratio+"px",subSpan.style.backgroundColor="black"}else subContent.style.fontSize=firstVeygaCue.fontSize;if("proportionalSansSerif"===firstVeygaCue.fontFamily){subContent.style.fontFamily="Sans Serif";const h=this.subContainerRect_.height*firstVeygaCue.region.height/100;subContent.style.fontSize=h/2*.8+"px"}else subContent.style.fontFamily="Sans Serif";firstVeygaCue.color?subSpan.style.color=firstVeygaCue.color:subSpan.style.color="white",subSpan.style.backgroundColor||(firstVeygaCue.backgroundColor?subSpan.style.backgroundColor=firstVeygaCue.backgroundColor:subSpan.style.backgroundColor="rgba(0,0,0,68)"),subSpan.innerHTML=firstCue.text.replace(/\n/g,"<br/>"),paddedContent.appendChild(subSpan),subContent.appendChild(paddedContent)}subContent.style.position="absolute",subContent.style.height=firstVeygaCue.region.height+"%",subContent.style.top=firstVeygaCue.region.viewportAnchorY+"%",subContent.style.left=firstVeygaCue.region.viewportAnchorX+"%",subContent.style.width=firstVeygaCue.region.width+"%",this.subContainer_.appendChild(subContent),this.subContent_=subContent},PlayerVeygaTextDisplayer.prototype.remove=function(start,end){if(!this.textTrack_)return!1;return PlayerVeygaTextDisplayer.removeWhere_(this.textTrack_,cue=>cue.startTime<end&&cue.endTime>start),!0},PlayerVeygaTextDisplayer.prototype.append=function(cues){const convertToTextTrackCue=PlayerVeygaTextDisplayer.convertToTextTrackCue_;let textTrackCues=[],hasImage=!1;for(let i=0;i<cues.length;i++){let cue=convertToTextTrackCue(cues[i]);cue&&(cue.image&&(hasImage=!0),textTrackCues.push(cue))}textTrackCues.slice().sort((function(a,b){return a.startTime!=b.startTime?a.startTime-b.startTime:a.endTime!=b.endTime?a.endTime-b.startTime:textTrackCues.indexOf(b)-textTrackCues.indexOf(a)})).forEach(function(cue){this.textTrack_.addCue(cue)}.bind(this))},PlayerVeygaTextDisplayer.prototype.destroy=function(){if(this.textTrack_){let removeIt=cue=>!0;PlayerVeygaTextDisplayer.removeWhere_(this.textTrack_,removeIt)}if(this.subContainerAdded_)this.subContainer_.parentNode&&this.subContainer_.parentNode.removeChild(this.subContainer_),this.subContainer_=null,this.subContainerAdded_=!1;else{const{subContainer_}=this;for(;subContainer_.firstChild;)subContainer_.removeChild(subContainer_.firstChild)}return this.sensor_&&(this.sensor_.detach(this.sensorCb_),this.sensor_=null,this.sensorCb_=null),this.videoCb_&&(this.video_.removeEventListener("loadedmetadata",this.videoCb_),this.videoCb_=null),this.textTrack_=null,Promise.resolve()},PlayerVeygaTextDisplayer.prototype.isTextVisible=function(){return this.visibility_},PlayerVeygaTextDisplayer.prototype.setTextVisibility=function(on){this.subContainer_&&(this.subContainer_.style.display=on?"block":"none"),this.textTrack_.mode="hidden",this.visibility_=on},PlayerVeygaTextDisplayer.convertToTextTrackCue_=function(veygaCue){if(veygaCue.startTime>=veygaCue.endTime)return veygaCue.startTime!==veygaCue.endTime&&veyga.log.warning("Invalid cue times: "+veygaCue.startTime+" - "+veygaCue.endTime),null;const Cue=veyga.text.Cue;let vttCue=new VTTCue(veygaCue.startTime,veygaCue.endTime,veygaCue.payload+"\n");vttCue.veygaCue=veygaCue,vttCue.lineAlign=veygaCue.lineAlign,vttCue.positionAlign=veygaCue.positionAlign,vttCue.size=veygaCue.size,vttCue.telecentroPatch=veygaCue.telecentroPatch;try{vttCue.align=veygaCue.textAlign}catch(exception){}return"center"==veygaCue.textAlign&&"center"!=vttCue.align&&(vttCue.align="middle"),veygaCue.writingMode==Cue.writingMode.VERTICAL_LEFT_TO_RIGHT?vttCue.vertical="lr":veygaCue.writingMode==Cue.writingMode.VERTICAL_RIGHT_TO_LEFT&&(vttCue.vertical="rl"),veygaCue.lineInterpretation==Cue.lineInterpretation.PERCENTAGE&&(vttCue.snapToLines=!1),null!=veygaCue.line&&(vttCue.line=veygaCue.line),null!=veygaCue.position&&(vttCue.position=veygaCue.position),null!=veygaCue.image&&(vttCue.image=veygaCue.image),vttCue},PlayerVeygaTextDisplayer.removeWhere_=function(track,predicate){let oldState=track.mode,tempState="showing"==oldState?"showing":"hidden";track.mode=tempState;let cues=track.cues;for(let i=cues.length-1;i>=0;i--){let cue=cues[i];cue&&predicate(cue)&&track.removeCue(cue)}track.mode=oldState},PlayerVeygaTextDisplayer.prototype.onVideoElementResize_=function(e){this.repositionText_()},PlayerVeygaTextDisplayer.prototype.onVideoResize_=function(e){this.repositionText_()},PlayerVeygaTextDisplayer.prototype.repositionText_=function(){const{videoWidth,offsetWidth}=this.video_;if(0===videoWidth||0===offsetWidth)return;const{videoHeight,offsetHeight}=this.video_;let rect;if(videoWidth/videoHeight<offsetWidth/offsetHeight){const width=offsetHeight*videoWidth/videoHeight;rect={width,height:offsetHeight,left:(offsetWidth-width)/2,top:0}}else{rect={width:offsetWidth,height:offsetWidth*videoHeight/videoWidth,left:0,top:(offsetHeight-offsetWidth*videoHeight/videoWidth)/2}}this.subContainer_.style.width=rect.width+"px",this.subContainer_.style.height=rect.height+"px",this.subContainer_.style.left=rect.left+"px",this.subContainer_.style.top=rect.top+"px",this.subContainerRect_=rect,this.textTrack_.oncuechange()},PlayerVeygaTextDisplayer.TextTrackLabel_="TextTrack";var _default=PlayerVeygaTextDisplayer;exports.default=_default},function(module,exports,__webpack_require__){"use strict";function forEachElement(elements,callback){var elementsType=Object.prototype.toString.call(elements),isCollectionTyped="[object Array]"===elementsType||"[object NodeList]"===elementsType||"[object HTMLCollection]"===elementsType||"[object Object]"===elementsType,i=0,j=elements.length;if(isCollectionTyped)for(;i<j;i++)callback(elements[i]);else callback(elements)}function getElementSize(element){if(!element.getBoundingClientRect)return{width:element.offsetWidth,height:element.offsetHeight};var rect=element.getBoundingClientRect();return{width:Math.round(rect.width),height:Math.round(rect.height)}}function ResizeSensor(element,callback){function EventQueue(){var i,j,q=[];this.add=function(ev){q.push(ev)},this.call=function(sizeInfo){for(i=0,j=q.length;i<j;i++)q[i].call(this,sizeInfo)},this.remove=function(ev){var newQueue=[];for(i=0,j=q.length;i<j;i++)q[i]!==ev&&newQueue.push(q[i]);q=newQueue},this.length=function(){return q.length}}function attachResizeEvent(element,resized){if(element)if(element.resizedAttached)element.resizedAttached.add(resized);else{element.resizedAttached=new EventQueue,element.resizedAttached.add(resized),element.resizeSensor=document.createElement("div"),element.resizeSensor.dir="ltr",element.resizeSensor.className="resize-sensor";var style="pointer-events: none; position: absolute; left: 0px; top: 0px; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden; max-width: 100%;",styleChild="position: absolute; left: 0; top: 0; transition: 0s;";element.resizeSensor.style.cssText=style,element.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+style+'"><div style="'+styleChild+'"></div></div><div class="resize-sensor-shrink" style="'+style+'"><div style="'+styleChild+' width: 200%; height: 200%"></div></div>',element.appendChild(element.resizeSensor);var dirty,rafId,computedStyle=window.getComputedStyle(element),expand=(computedStyle&&computedStyle.getPropertyValue("position"),element.resizeSensor.childNodes[0]),expandChild=expand.childNodes[0],shrink=element.resizeSensor.childNodes[1],size=getElementSize(element),lastWidth=size.width,lastHeight=size.height,initialHiddenCheck=!0,lastAnimationFrame=0,reset=function(){if(initialHiddenCheck){if(0===element.offsetWidth&&0===element.offsetHeight)return void(lastAnimationFrame||(lastAnimationFrame=requestAnimationFrame((function(){lastAnimationFrame=0,reset()}))));initialHiddenCheck=!1}var width,height;width=element.offsetWidth,height=element.offsetHeight,expandChild.style.width=width+10+"px",expandChild.style.height=height+10+"px",expand.scrollLeft=width+10,expand.scrollTop=height+10,shrink.scrollLeft=width+10,shrink.scrollTop=height+10};element.resizeSensor.resetSensor=reset;var onResized=function(){rafId=0,dirty&&(lastWidth=size.width,lastHeight=size.height,element.resizedAttached&&element.resizedAttached.call(size))},onScroll=function(){size=getElementSize(element),(dirty=size.width!==lastWidth||size.height!==lastHeight)&&!rafId&&(rafId=requestAnimationFrame(onResized)),reset()},addEvent=function(el,name,cb){el.attachEvent?el.attachEvent("on"+name,cb):el.addEventListener(name,cb)};addEvent(expand,"scroll",onScroll),addEvent(shrink,"scroll",onScroll),requestAnimationFrame(reset)}}forEachElement(element,(function(elem){attachResizeEvent(elem,callback)})),this.element=element}if(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,ResizeSensor.prototype.detach=function(ev){ResizeSensor.detach(this.element,ev)},ResizeSensor.prototype.reset=function(){this.element.resizeSensor.resetSensor()},ResizeSensor.reset=function(element){forEachElement(element,(function(elem){elem.resizeSensor.resetSensor()}))},ResizeSensor.detach=function(element,ev){forEachElement(element,(function(elem){elem&&(elem.resizedAttached&&"function"==typeof ev&&(elem.resizedAttached.remove(ev),elem.resizedAttached.length())||elem.resizeSensor&&(elem.contains(elem.resizeSensor)&&elem.removeChild(elem.resizeSensor),delete elem.resizeSensor,delete elem.resizedAttached))}))},"undefined"!=typeof MutationObserver){var observer=new MutationObserver((function(mutations){for(var i in mutations)if(mutations.hasOwnProperty(i))for(var items=mutations[i].addedNodes,j=0;j<items.length;j++)items[j].resizeSensor&&ResizeSensor.reset(items[j])}));"interactive"===document.readyState||"complete"===document.readyState?observer.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("loaded",(function(event){observer.observe(document.body,{childList:!0,subtree:!0})}))}var _default=ResizeSensor;exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(__webpack_require__(8));function createRGB(color){return"red"===color?"rgb(255, 0, 0)":"green"===color?"rgb(0, 255, 0)":"blue"===color?"rgb(0, 0, 255)":"cyan"===color?"rgb(0, 255, 255)":"magenta"===color?"rgb(255, 0, 255)":"yellow"===color?"rgb(255, 255, 0)":"white"===color?"rgb(255, 255, 255)":"black"===color?"rgb(0, 0, 0)":color}const fontSize={bodyStyle:["%",90]};class EmbeddedTextHtmlRender{static getRowsWithSpans(captionScreen){let currentStyle,prevPenState=null;const styleStates={};return{styleStates,rows:captionScreen.rows.map((row,index)=>{let line="";const[leftIndent,rightIndent]=function checkIndent(chars){let line="";for(let c=0;c<chars.length;c+=1)line+=chars[c].uchar;const l=line.length,lineStartRight=function ltrim(s){return s.replace(/^\s+/g,"")}(line),ll=lineStartRight.length;return[l-ll,ll-function rtrim(s){return s.replace(/\s+$/g,"")}(lineStartRight).length]}(row.chars),spans=[];for(let c=leftIndent;c<row.chars.length-rightIndent;c+=1){const uc=row.chars[c],currPenState=uc.penState;if(null===prevPenState||!currPenState.equals(prevPenState)){line.trim().length>0&&(spans.push({name:currentStyle,line,row:index}),line="");let currPenStateString=`style_cea608_${currPenState.foreground}_${currPenState.background}`;currPenState.underline&&(currPenStateString+="_underline"),currPenState.italics&&(currPenStateString+="_italics"),void 0===styleStates[currPenStateString]&&(styleStates[currPenStateString]=(0,_extends2.default)({},currPenState)),prevPenState=currPenState,currentStyle=currPenStateString}line+=uc.uchar}return line.trim().length>0&&spans.push({name:currentStyle,line,row:index}),{leftIndent,rightIndent,spans}})}}static createHTMLCaptionsFromScreen(displayWidth,displayHeight,startTime,endTime,captionScreen){const cueID="cea608cueID"+EmbeddedTextHtmlRender.captionId;EmbeddedTextHtmlRender.captionId+=1;const state=EmbeddedTextHtmlRender.getRowsWithSpans(captionScreen),{styleStates,rows}=state,captionsArray=[],finalDiv=document.createElement("div");finalDiv.className="cea608Screen";finalDiv.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none; top: 0px; height: 100%; left: 0px; width: 100%;  align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;; "+function getLineStyle(displayWidth,displayHeight){return`font-size: ${.9*displayHeight/15}px; letter-spacing: calc(${displayWidth/32}px - 1ch); font-family: "Deja Vu Sans Mono", "Lucida Console", Monaco, Consolas, "PT Mono", monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex; flex-direction: column; unicode-bidi: normal; direction: ltr;`}(displayWidth,displayHeight);for(let r=0;r<15;r+=1){const row=rows[r],rowWrapper=document.createElement("div");if(rowWrapper.className="cea608Row",rowWrapper.style.cssText=`height: ${100/15}%;`,0===row.spans.length){const spanElement=document.createElement("span");spanElement.textContent=String.fromCharCode(160),spanElement.className="cea608Span cea608SpanEmpty",rowWrapper.appendChild(spanElement)}else{if(row.leftIndent){const spanElement=document.createElement("span");spanElement.textContent="",spanElement.className="cea608Span cea608SpanPadding";for(let tmp=0;tmp<row.leftIndent;tmp+=1)spanElement.textContent=spanElement.textContent+" ";rowWrapper.appendChild(spanElement)}for(let s=0;s<row.spans.length;s+=1){const span=row.spans[s],spanStyle=styleStates[span.name],spanElement=document.createElement("span");spanElement.className="cea608Span "+span.name,spanElement.style.cssText="; "+`color: ${(style=spanStyle).foreground?createRGB(style.foreground):"rgb(255, 255, 255)"}; font-style: ${style.italics?"italic":"normal"}; text-decoration: ${style.underline?"underline":"none"}; background-color: ${style.background?createRGB(style.background):"transparent"};`,spanElement.textContent=span.line.trim(),rowWrapper.appendChild(spanElement)}}finalDiv.appendChild(rowWrapper)}var style;return captionsArray.push({type:"html",start:startTime,end:endTime,cueHTMLElement:finalDiv,cueID,cellResolution:[32,15],isFromCEA608:!0,fontSize,lineHeight:{},linePadding:{},captionScreen}),captionsArray}}EmbeddedTextHtmlRender.captionId=0;var _default=EmbeddedTextHtmlRender;exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _FakeEvent=_interopRequireDefault(__webpack_require__(3)),_FakeEventTarget=_interopRequireDefault(__webpack_require__(4)),_logger=_interopRequireDefault(__webpack_require__(1)),_hlsjs=_interopRequireDefault(__webpack_require__(72)),_PlayerIds=_interopRequireDefault(__webpack_require__(9)),_Error=_interopRequireDefault(__webpack_require__(6));class PlayerHlsJs extends _FakeEventTarget.default{static setup(){}constructor(playerInterface,element,subsContainer){if(super(),!_hlsjs.default.isSupported())throw new Error("browser_not_supported");const{autoplay}=element;this.initialAutoplay=autoplay,this._playerInterface=playerInterface,this.element=element,this.subsContainer=subsContainer,this.listeners=[],this.waitForEvent("canplay",()=>{this.setSourcePromise&&(this.setSourcePromise.resolve(),this.setSourcePromise=null)},this.element),this.waitForEvent("pause",()=>{},this.element),this.waitForEvent("error",()=>{const{error}=this.element;_logger.default.error(`error on media element ${error} ${error.code} ${error.message}`),this._playerInterface.dispatchError(new _Error.default(_Error.default.Category.CRITICAL,_Error.default.Category.MEDIA,"html_element",`${error.code}:${error.message}`))},this.element)}async destroy(){this.listeners.forEach(({type,target,bindedAction})=>target.removeEventListener(type,bindedAction)),this.hls.destroy(),this.hls=null}waitForEvent(type,action,target){const bindedAction=action.bind(this);this.listeners.push({type,target,bindedAction}),target.addEventListener(type,bindedAction,!1)}emit(type,data){if("error"===type)return void this.dispatchError(data.detail);const evt=new _FakeEvent.default(type,data);this.dispatchEvent(evt)}setSource(stream,options){return void 0!==options.autoplay&&(this.element.autoplay=options.autoplay),this.stream=stream,this.hls&&this.hls.destroy(),this.hls=new _hlsjs.default,this.hls.attachMedia(this.element),this.hls.on(_hlsjs.default.Events.MANIFEST_PARSED,(event,data)=>{"hlsManifestParsed"===event&&(this.manifest=data)}),this.hls.loadSource(stream.uri),new Promise((resolve,reject)=>{this.setSourcePromise={resolve,reject}})}setMaxResolution(width,height){this._maxResolution={width,height}}freeze(){return this.stream=null,this.element.pause(),this.element.removeAttribute("src"),this.element.load(),this.element.autoplay=this.initialAutoplay,this.setSourcePromise&&(this.setSourcePromise.reject(new Error("aborted")),this.setSourcePromise=null),Promise.resolve()}getTimeInfo(){if(!this.stream)return null;const{currentTime,duration}=this.element;if(Number.isNaN(duration))return null;const seekRange_start=0,seekRange_end=0+duration;return{isLive:false,position:1e3*(0+currentTime),duration:1e3*(seekRange_end-seekRange_start),seekRange:[1e3*seekRange_start,1e3*seekRange_end]}}play(){this.element.play()}pause(){this.element.pause()}seek(position){this.element.currentTime=position/1e3}getTracks(){if(!this.manifest)return null;const video=[],audio=[],text=[];if(this.manifest.audio||this.manifest.video){this.element.videoHeight&&video.push({reference:"video","is-active":!0,name:"video",playable:!0});const audioTracksByLang=this.hls.audioTracks.reduce((acc,audioHlsTrack)=>(void 0===acc[audioHlsTrack.lang]?acc[audioHlsTrack.lang]={reference:audioHlsTrack.lang,subtracks:[{group:audioHlsTrack.groupId,id:audioHlsTrack.id}],name:audioHlsTrack.name||audioHlsTrack.lang,playable:!0,"is-active":this.hls.audioTrack===audioHlsTrack.id,"is-closed-caption":"caption"===audioHlsTrack.kind,type:"audio",language:audioHlsTrack.lang}:acc[audioHlsTrack.lang].subtracks.push({group:audioHlsTrack.groupId,id:audioHlsTrack.id}),acc),{});Object.values(audioTracksByLang).forEach(item=>audio.push(item)),this.hls.subtitleTracks.forEach(subtitleHlsTrack=>{text.push({reference:subtitleHlsTrack.id,name:subtitleHlsTrack.name||subtitleHlsTrack.lang,playable:!0,"is-active":this.hls.subtitleDisplay&&this.hls.subtitleTrack===subtitleHlsTrack.id,"is-closed-caption":"caption"===subtitleHlsTrack.kind,type:"text",language:subtitleHlsTrack.lang})})}else this.element.videoHeight&&video.push({reference:"video","is-active":!0,name:"video",playable:!0}),audio.push({reference:"audio","is-active":!0,name:"audio",playable:!0});return{video,audio,text}}applyTracks(toggledTracks){return toggledTracks.forEach(({track,enable})=>{"text"===track.type&&(this.hls.subtitleTrack=enable?track.reference:-1),"audio"===track.type&&(this.hls.audioTrack=enable?track.reference:-1)}),this.getTracks()}getStats(){return{}}}PlayerHlsJs.id=_PlayerIds.default.HLSJS;var _default=PlayerHlsJs;exports.default=_default},function(module,exports,__webpack_require__){"use strict";"undefined"!=typeof window&&function webpackUniversalModuleDefinition(root,factory){module.exports=factory()}(0,(function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/dist/",__webpack_require__(__webpack_require__.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(module,exports,__webpack_require__){var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/url-toolkit/src/url-toolkit.js":function(module,exports,__webpack_require__){var URL_REGEX,FIRST_SEGMENT_REGEX,SLASH_DOT_REGEX,SLASH_DOT_DOT_REGEX,URLToolkit;URL_REGEX=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,FIRST_SEGMENT_REGEX=/^([^\/?#]*)(.*)$/,SLASH_DOT_REGEX=/(?:\/|^)\.(?=\/)/g,SLASH_DOT_DOT_REGEX=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL,opts){if(opts=opts||{},baseURL=baseURL.trim(),!(relativeURL=relativeURL.trim())){if(!opts.alwaysNormalize)return baseURL;var basePartsForNormalise=URLToolkit.parseURL(baseURL);if(!basePartsForNormalise)throw new Error("Error trying to parse base URL.");return basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path),URLToolkit.buildURLFromParts(basePartsForNormalise)}var relativeParts=URLToolkit.parseURL(relativeURL);if(!relativeParts)throw new Error("Error trying to parse relative URL.");if(relativeParts.scheme)return opts.alwaysNormalize?(relativeParts.path=URLToolkit.normalizePath(relativeParts.path),URLToolkit.buildURLFromParts(relativeParts)):relativeURL;var baseParts=URLToolkit.parseURL(baseURL);if(!baseParts)throw new Error("Error trying to parse base URL.");if(!baseParts.netLoc&&baseParts.path&&"/"!==baseParts.path[0]){var pathParts=FIRST_SEGMENT_REGEX.exec(baseParts.path);baseParts.netLoc=pathParts[1],baseParts.path=pathParts[2]}baseParts.netLoc&&!baseParts.path&&(baseParts.path="/");var builtParts={scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc&&(builtParts.netLoc=baseParts.netLoc,"/"!==relativeParts.path[0]))if(relativeParts.path){var baseURLPath=baseParts.path,newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf("/")+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath)}else builtParts.path=baseParts.path,relativeParts.params||(builtParts.params=baseParts.params,relativeParts.query||(builtParts.query=baseParts.query));return null===builtParts.path&&(builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path),URLToolkit.buildURLFromParts(builtParts)},parseURL:function(url){var parts=URL_REGEX.exec(url);return parts?{scheme:parts[1]||"",netLoc:parts[2]||"",path:parts[3]||"",params:parts[4]||"",query:parts[5]||"",fragment:parts[6]||""}:null},normalizePath:function(path){for(path=path.split("").reverse().join("").replace(SLASH_DOT_REGEX,"");path.length!==(path=path.replace(SLASH_DOT_DOT_REGEX,"")).length;);return path.split("").reverse().join("")},buildURLFromParts:function(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment}},module.exports=URLToolkit},"./node_modules/webworkify-webpack/index.js":function(module,exports,__webpack_require__){function webpackBootstrapFunc(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__.oe=function(err){throw console.error(err),err};var f=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return f.default||f}function quoteRegExp(str){return(str+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function getModuleDependencies(sources,module,queueName){var retval={};retval[queueName]=[];var fnString=module.toString(),wrapperSignature=fnString.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!wrapperSignature)return retval;for(var match,webpackRequireName=wrapperSignature[1],re=new RegExp("(\\\\n|\\W)"+quoteRegExp(webpackRequireName)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");match=re.exec(fnString);)"dll-reference"!==match[3]&&retval[queueName].push(match[3]);for(re=new RegExp("\\("+quoteRegExp(webpackRequireName)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");match=re.exec(fnString);)sources[match[2]]||(retval[queueName].push(match[1]),sources[match[2]]=__webpack_require__(match[1]).m),retval[match[2]]=retval[match[2]]||[],retval[match[2]].push(match[4]);for(var n,keys=Object.keys(retval),i=0;i<keys.length;i++)for(var j=0;j<retval[keys[i]].length;j++)n=retval[keys[i]][j],isNaN(1*n)||(retval[keys[i]][j]=1*retval[keys[i]][j]);return retval}function hasValuesInQueues(queues){return Object.keys(queues).reduce((function(hasValues,key){return hasValues||queues[key].length>0}),!1)}module.exports=function(moduleId,options){options=options||{};var sources={main:__webpack_require__.m},requiredModules=options.all?{main:Object.keys(sources.main)}:function getRequiredModules(sources,moduleId){for(var modulesQueue={main:[moduleId]},requiredModules={main:[]},seenModules={main:{}};hasValuesInQueues(modulesQueue);)for(var queues=Object.keys(modulesQueue),i=0;i<queues.length;i++){var queueName=queues[i],moduleToCheck=modulesQueue[queueName].pop();if(seenModules[queueName]=seenModules[queueName]||{},!seenModules[queueName][moduleToCheck]&&sources[queueName][moduleToCheck]){seenModules[queueName][moduleToCheck]=!0,requiredModules[queueName]=requiredModules[queueName]||[],requiredModules[queueName].push(moduleToCheck);for(var newModules=getModuleDependencies(sources,sources[queueName][moduleToCheck],queueName),newModulesKeys=Object.keys(newModules),j=0;j<newModulesKeys.length;j++)modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]]||[],modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]])}}return requiredModules}(sources,moduleId),src="";Object.keys(requiredModules).filter((function(m){return"main"!==m})).forEach((function(module){for(var entryModule=0;requiredModules[module][entryModule];)entryModule++;requiredModules[module].push(entryModule),sources[module][entryModule]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",src=src+"var "+module+" = ("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(entryModule))+")({"+requiredModules[module].map((function(id){return JSON.stringify(id)+": "+sources[module][id].toString()})).join(",")+"});\n"})),src=src+"new (("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(moduleId))+")({"+requiredModules.main.map((function(id){return JSON.stringify(id)+": "+sources.main[id].toString()})).join(",")+"}))(self);";var blob=new window.Blob([src],{type:"text/javascript"});if(options.bare)return blob;var workerUrl=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(blob),worker=new window.Worker(workerUrl);return worker.objectURL=workerUrl,worker}},"./src/crypt/decrypter.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var AESCrypto=function(){function AESCrypto(subtle,iv){this.subtle=subtle,this.aesIV=iv}return AESCrypto.prototype.decrypt=function decrypt(data,key){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},key,data)},AESCrypto}(),fast_aes_key=function(){function FastAESKey(subtle,key){this.subtle=subtle,this.key=key}return FastAESKey.prototype.expandKey=function expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},FastAESKey}();var aes_decryptor=function(){function AESDecryptor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var _proto=AESDecryptor.prototype;return _proto.uint8ArrayToUint32Array_=function uint8ArrayToUint32Array_(arrayBuffer){for(var view=new DataView(arrayBuffer),newArray=new Uint32Array(4),i=0;i<4;i++)newArray[i]=view.getUint32(4*i);return newArray},_proto.initTable=function initTable(){var sBox=this.sBox,invSBox=this.invSBox,subMix=this.subMix,subMix0=subMix[0],subMix1=subMix[1],subMix2=subMix[2],subMix3=subMix[3],invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],d=new Uint32Array(256),x=0,xi=0,i=0;for(i=0;i<256;i++)d[i]=i<128?i<<1:i<<1^283;for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,sBox[x]=sx,invSBox[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;subMix0[x]=t<<24|t>>>8,subMix1[x]=t<<16|t>>>16,subMix2[x]=t<<8|t>>>24,subMix3[x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,invSubMix0[sx]=t<<24|t>>>8,invSubMix1[sx]=t<<16|t>>>16,invSubMix2[sx]=t<<8|t>>>24,invSubMix3[sx]=t,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):x=xi=1}},_proto.expandKey=function expandKey(keyBuffer){for(var key=this.uint8ArrayToUint32Array_(keyBuffer),sameKey=!0,offset=0;offset<key.length&&sameKey;)sameKey=key[offset]===this.key[offset],offset++;if(!sameKey){this.key=key;var keySize=this.keySize=key.length;if(4!==keySize&&6!==keySize&&8!==keySize)throw new Error("Invalid aes key size="+keySize);var ksRow,invKsRow,prev,t,ksRows=this.ksRows=4*(keySize+6+1),keySchedule=this.keySchedule=new Uint32Array(ksRows),invKeySchedule=this.invKeySchedule=new Uint32Array(ksRows),sbox=this.sBox,rcon=this.rcon,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3];for(ksRow=0;ksRow<ksRows;ksRow++)ksRow<keySize?prev=keySchedule[ksRow]=key[ksRow]:(t=prev,ksRow%keySize==0?(t=sbox[(t=t<<8|t>>>24)>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t],t^=rcon[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize==4&&(t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t]),keySchedule[ksRow]=prev=(keySchedule[ksRow-keySize]^t)>>>0);for(invKsRow=0;invKsRow<ksRows;invKsRow++)ksRow=ksRows-invKsRow,t=3&invKsRow?keySchedule[ksRow]:keySchedule[ksRow-4],invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:invSubMix0[sbox[t>>>24]]^invSubMix1[sbox[t>>>16&255]]^invSubMix2[sbox[t>>>8&255]]^invSubMix3[sbox[255&t]],invKeySchedule[invKsRow]=invKeySchedule[invKsRow]>>>0}},_proto.networkToHostOrderSwap=function networkToHostOrderSwap(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24},_proto.decrypt=function decrypt(inputArrayBuffer,offset,aesIV,removePKCS7Padding){for(var t0,t1,t2,t3,s0,s1,s2,s3,inputWords0,inputWords1,inputWords2,inputWords3,ksRow,i,nRounds=this.keySize+6,invKeySchedule=this.invKeySchedule,invSBOX=this.invSBox,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],initVector=this.uint8ArrayToUint32Array_(aesIV),initVector0=initVector[0],initVector1=initVector[1],initVector2=initVector[2],initVector3=initVector[3],inputInt32=new Int32Array(inputArrayBuffer),outputInt32=new Int32Array(inputInt32.length),swapWord=this.networkToHostOrderSwap;offset<inputInt32.length;){for(inputWords0=swapWord(inputInt32[offset]),inputWords1=swapWord(inputInt32[offset+1]),inputWords2=swapWord(inputInt32[offset+2]),inputWords3=swapWord(inputInt32[offset+3]),s0=inputWords0^invKeySchedule[0],s1=inputWords3^invKeySchedule[1],s2=inputWords2^invKeySchedule[2],s3=inputWords1^invKeySchedule[3],ksRow=4,i=1;i<nRounds;i++)t0=invSubMix0[s0>>>24]^invSubMix1[s1>>16&255]^invSubMix2[s2>>8&255]^invSubMix3[255&s3]^invKeySchedule[ksRow],t1=invSubMix0[s1>>>24]^invSubMix1[s2>>16&255]^invSubMix2[s3>>8&255]^invSubMix3[255&s0]^invKeySchedule[ksRow+1],t2=invSubMix0[s2>>>24]^invSubMix1[s3>>16&255]^invSubMix2[s0>>8&255]^invSubMix3[255&s1]^invKeySchedule[ksRow+2],t3=invSubMix0[s3>>>24]^invSubMix1[s0>>16&255]^invSubMix2[s1>>8&255]^invSubMix3[255&s2]^invKeySchedule[ksRow+3],s0=t0,s1=t1,s2=t2,s3=t3,ksRow+=4;t0=invSBOX[s0>>>24]<<24^invSBOX[s1>>16&255]<<16^invSBOX[s2>>8&255]<<8^invSBOX[255&s3]^invKeySchedule[ksRow],t1=invSBOX[s1>>>24]<<24^invSBOX[s2>>16&255]<<16^invSBOX[s3>>8&255]<<8^invSBOX[255&s0]^invKeySchedule[ksRow+1],t2=invSBOX[s2>>>24]<<24^invSBOX[s3>>16&255]<<16^invSBOX[s0>>8&255]<<8^invSBOX[255&s1]^invKeySchedule[ksRow+2],t3=invSBOX[s3>>>24]<<24^invSBOX[s0>>16&255]<<16^invSBOX[s1>>8&255]<<8^invSBOX[255&s2]^invKeySchedule[ksRow+3],ksRow+=3,outputInt32[offset]=swapWord(t0^initVector0),outputInt32[offset+1]=swapWord(t3^initVector1),outputInt32[offset+2]=swapWord(t2^initVector2),outputInt32[offset+3]=swapWord(t1^initVector3),initVector0=inputWords0,initVector1=inputWords1,initVector2=inputWords2,initVector3=inputWords3,offset+=4}return removePKCS7Padding?function removePadding(buffer){var outputBytes=buffer.byteLength,paddingBytes=outputBytes&&new DataView(buffer).getUint8(outputBytes-1);return paddingBytes?buffer.slice(0,outputBytes-paddingBytes):buffer}(outputInt32.buffer):outputInt32.buffer},_proto.destroy=function destroy(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},AESDecryptor}(),errors=__webpack_require__("./src/errors.ts"),logger=__webpack_require__("./src/utils/logger.js"),events=__webpack_require__("./src/events.js"),get_self_scope=__webpack_require__("./src/utils/get-self-scope.js"),global=Object(get_self_scope.getSelfScope)(),decrypter_Decrypter=function(){function Decrypter(observer,config,_temp){var _ref$removePKCS7Paddi=(void 0===_temp?{}:_temp).removePKCS7Padding,removePKCS7Padding=void 0===_ref$removePKCS7Paddi||_ref$removePKCS7Paddi;if(this.logEnabled=!0,this.observer=observer,this.config=config,this.removePKCS7Padding=removePKCS7Padding,removePKCS7Padding)try{var browserCrypto=global.crypto;browserCrypto&&(this.subtle=browserCrypto.subtle||browserCrypto.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var _proto=Decrypter.prototype;return _proto.isSync=function isSync(){return this.disableWebCrypto&&this.config.enableSoftwareAES},_proto.decrypt=function decrypt(data,key,iv,callback){var _this=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(logger.logger.log("JS AES decrypt"),this.logEnabled=!1);var decryptor=this.decryptor;decryptor||(this.decryptor=decryptor=new aes_decryptor),decryptor.expandKey(key),callback(decryptor.decrypt(data,0,iv,this.removePKCS7Padding))}else{this.logEnabled&&(logger.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var subtle=this.subtle;this.key!==key&&(this.key=key,this.fastAesKey=new fast_aes_key(subtle,key)),this.fastAesKey.expandKey().then((function(aesKey){new AESCrypto(subtle,iv).decrypt(data,aesKey).catch((function(err){_this.onWebCryptoError(err,data,key,iv,callback)})).then((function(result){callback(result)}))})).catch((function(err){_this.onWebCryptoError(err,data,key,iv,callback)}))}},_proto.onWebCryptoError=function onWebCryptoError(err,data,key,iv,callback){this.config.enableSoftwareAES?(logger.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(data,key,iv,callback)):(logger.logger.error("decrypting error : "+err.message),this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:err.message}))},_proto.destroy=function destroy(){var decryptor=this.decryptor;decryptor&&(decryptor.destroy(),this.decryptor=void 0)},Decrypter}();__webpack_exports__.default=decrypter_Decrypter},"./src/demux/demuxer-inline.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var events=__webpack_require__("./src/events.js"),errors=__webpack_require__("./src/errors.ts"),crypt_decrypter=__webpack_require__("./src/crypt/decrypter.js"),number_isFinite=__webpack_require__("./src/polyfills/number-isFinite.js"),logger=__webpack_require__("./src/utils/logger.js"),get_self_scope=__webpack_require__("./src/utils/get-self-scope.js");function isHeaderPattern(data,offset){return 255===data[offset]&&240==(246&data[offset+1])}function getHeaderLength(data,offset){return 1&data[offset+1]?7:9}function getFullFrameLength(data,offset){return(3&data[offset+3])<<11|data[offset+4]<<3|(224&data[offset+5])>>>5}function isHeader(data,offset){return!!(offset+1<data.length&&isHeaderPattern(data,offset))}function adts_probe(data,offset){if(isHeader(data,offset)){var frameLength=getHeaderLength(data,offset);offset+5<data.length&&(frameLength=getFullFrameLength(data,offset));var newOffset=offset+frameLength;if(newOffset===data.length||newOffset+1<data.length&&isHeaderPattern(data,newOffset))return!0}return!1}function initTrackConfig(track,observer,data,offset,audioCodec){if(!track.samplerate){var config=function getAudioConfig(observer,data,offset,audioCodec){var adtsObjectType,adtsSampleingIndex,adtsExtensionSampleingIndex,adtsChanelConfig,config,userAgent=navigator.userAgent.toLowerCase(),manifestCodec=audioCodec,adtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(adtsObjectType=1+((192&data[offset+2])>>>6),!((adtsSampleingIndex=(60&data[offset+2])>>>2)>adtsSampleingRates.length-1))return adtsChanelConfig=(1&data[offset+2])<<2,adtsChanelConfig|=(192&data[offset+3])>>>6,logger.logger.log("manifest codec:"+audioCodec+",ADTS data:type:"+adtsObjectType+",sampleingIndex:"+adtsSampleingIndex+"["+adtsSampleingRates[adtsSampleingIndex]+"Hz],channelConfig:"+adtsChanelConfig),/firefox/i.test(userAgent)?adtsSampleingIndex>=6?(adtsObjectType=5,config=new Array(4),adtsExtensionSampleingIndex=adtsSampleingIndex-3):(adtsObjectType=2,config=new Array(2),adtsExtensionSampleingIndex=adtsSampleingIndex):-1!==userAgent.indexOf("android")?(adtsObjectType=2,config=new Array(2),adtsExtensionSampleingIndex=adtsSampleingIndex):(adtsObjectType=5,config=new Array(4),audioCodec&&(-1!==audioCodec.indexOf("mp4a.40.29")||-1!==audioCodec.indexOf("mp4a.40.5"))||!audioCodec&&adtsSampleingIndex>=6?adtsExtensionSampleingIndex=adtsSampleingIndex-3:((audioCodec&&-1!==audioCodec.indexOf("mp4a.40.2")&&(adtsSampleingIndex>=6&&1===adtsChanelConfig||/vivaldi/i.test(userAgent))||!audioCodec&&1===adtsChanelConfig)&&(adtsObjectType=2,config=new Array(2)),adtsExtensionSampleingIndex=adtsSampleingIndex)),config[0]=adtsObjectType<<3,config[0]|=(14&adtsSampleingIndex)>>1,config[1]|=(1&adtsSampleingIndex)<<7,config[1]|=adtsChanelConfig<<3,5===adtsObjectType&&(config[1]|=(14&adtsExtensionSampleingIndex)>>1,config[2]=(1&adtsExtensionSampleingIndex)<<7,config[2]|=8,config[3]=0),{config,samplerate:adtsSampleingRates[adtsSampleingIndex],channelCount:adtsChanelConfig,codec:"mp4a.40."+adtsObjectType,manifestCodec};observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+adtsSampleingIndex})}(observer,data,offset,audioCodec);track.config=config.config,track.samplerate=config.samplerate,track.channelCount=config.channelCount,track.codec=config.codec,track.manifestCodec=config.manifestCodec,logger.logger.log("parsed codec:"+track.codec+",rate:"+config.samplerate+",nb channel:"+config.channelCount)}}function getFrameDuration(samplerate){return 9216e4/samplerate}function appendFrame(track,data,offset,pts,frameIndex){var header=function parseFrameHeader(data,offset,pts,frameIndex,frameDuration){var headerLength,frameLength,length=data.length;if(headerLength=getHeaderLength(data,offset),frameLength=getFullFrameLength(data,offset),(frameLength-=headerLength)>0&&offset+headerLength+frameLength<=length)return{headerLength,frameLength,stamp:pts+frameIndex*frameDuration}}(data,offset,pts,frameIndex,getFrameDuration(track.samplerate));if(header){var stamp=header.stamp,headerLength=header.headerLength,frameLength=header.frameLength,aacSample={unit:data.subarray(offset+headerLength,offset+headerLength+frameLength),pts:stamp,dts:stamp};return track.samples.push(aacSample),{sample:aacSample,length:frameLength+headerLength}}}var id3=__webpack_require__("./src/demux/id3.js"),aacdemuxer=function(){function AACDemuxer(observer,remuxer,config){this.observer=observer,this.config=config,this.remuxer=remuxer}var _proto=AACDemuxer.prototype;return _proto.resetInitSegment=function resetInitSegment(initSegment,audioCodec,videoCodec,duration){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:audioCodec,duration,inputTimeScale:9e4}},_proto.resetTimeStamp=function resetTimeStamp(){},AACDemuxer.probe=function probe(data){if(!data)return!1;for(var offset=(id3.default.getID3Data(data,0)||[]).length,length=data.length;offset<length;offset++)if(adts_probe(data,offset))return logger.logger.log("ADTS sync word found !"),!0;return!1},_proto.append=function append(data,timeOffset,contiguous,accurateTimeOffset){for(var track=this._audioTrack,id3Data=id3.default.getID3Data(data,0)||[],timestamp=id3.default.getTimeStamp(id3Data),pts=Object(number_isFinite.isFiniteNumber)(timestamp)?90*timestamp:9e4*timeOffset,frameIndex=0,stamp=pts,length=data.length,offset=id3Data.length,id3Samples=[{pts:stamp,dts:stamp,data:id3Data}];offset<length-1;)if(isHeader(data,offset)&&offset+5<length){initTrackConfig(track,this.observer,data,offset,track.manifestCodec);var frame=appendFrame(track,data,offset,pts,frameIndex);if(!frame){logger.logger.log("Unable to parse AAC frame");break}offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else id3.default.isHeader(data,offset)?(id3Data=id3.default.getID3Data(data,offset),id3Samples.push({pts:stamp,dts:stamp,data:id3Data}),offset+=id3Data.length):offset++;this.remuxer.remux(track,{samples:[]},{samples:id3Samples,inputTimeScale:9e4},{samples:[]},timeOffset,contiguous,accurateTimeOffset)},_proto.destroy=function destroy(){},AACDemuxer}(),mp4demuxer=__webpack_require__("./src/demux/mp4demuxer.js"),MpegAudio={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function appendFrame(track,data,offset,pts,frameIndex){if(!(offset+24>data.length)){var header=this.parseHeader(data,offset);if(header&&offset+header.frameLength<=data.length){var stamp=pts+frameIndex*(9e4*header.samplesPerFrame/header.sampleRate),sample={unit:data.subarray(offset,offset+header.frameLength),pts:stamp,dts:stamp};return track.config=[],track.channelCount=header.channelCount,track.samplerate=header.sampleRate,track.samples.push(sample),{sample,length:header.frameLength}}}},parseHeader:function parseHeader(data,offset){var headerB=data[offset+1]>>3&3,headerC=data[offset+1]>>1&3,headerE=data[offset+2]>>4&15,headerF=data[offset+2]>>2&3,headerG=data[offset+2]>>1&1;if(1!==headerB&&0!==headerE&&15!==headerE&&3!==headerF){var columnInBitrates=3===headerB?3-headerC:3===headerC?3:4,bitRate=1e3*MpegAudio.BitratesMap[14*columnInBitrates+headerE-1],columnInSampleRates=3===headerB?0:2===headerB?1:2,sampleRate=MpegAudio.SamplingRateMap[3*columnInSampleRates+headerF],channelCount=data[offset+3]>>6==3?1:2,sampleCoefficient=MpegAudio.SamplesCoefficients[headerB][headerC],bytesInSlot=MpegAudio.BytesInSlot[headerC],samplesPerFrame=8*sampleCoefficient*bytesInSlot;return{sampleRate,channelCount,frameLength:parseInt(sampleCoefficient*bitRate/sampleRate+headerG,10)*bytesInSlot,samplesPerFrame}}},isHeaderPattern:function isHeaderPattern(data,offset){return 255===data[offset]&&224==(224&data[offset+1])&&0!=(6&data[offset+1])},isHeader:function isHeader(data,offset){return!!(offset+1<data.length&&this.isHeaderPattern(data,offset))},probe:function probe(data,offset){if(offset+1<data.length&&this.isHeaderPattern(data,offset)){var header=this.parseHeader(data,offset),frameLength=4;header&&header.frameLength&&(frameLength=header.frameLength);var newOffset=offset+frameLength;if(newOffset===data.length||newOffset+1<data.length&&this.isHeaderPattern(data,newOffset))return!0}return!1}},mpegaudio=MpegAudio,exp_golomb=function(){function ExpGolomb(data){this.data=data,this.bytesAvailable=data.byteLength,this.word=0,this.bitsAvailable=0}var _proto=ExpGolomb.prototype;return _proto.loadWord=function loadWord(){var data=this.data,bytesAvailable=this.bytesAvailable,position=data.byteLength-bytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,bytesAvailable);if(0===availableBytes)throw new Error("no bytes available");workingBytes.set(data.subarray(position,position+availableBytes)),this.word=new DataView(workingBytes.buffer).getUint32(0),this.bitsAvailable=8*availableBytes,this.bytesAvailable-=availableBytes},_proto.skipBits=function skipBits(count){var skipBytes;this.bitsAvailable>count?(this.word<<=count,this.bitsAvailable-=count):(count-=this.bitsAvailable,count-=(skipBytes=count>>3)>>3,this.bytesAvailable-=skipBytes,this.loadWord(),this.word<<=count,this.bitsAvailable-=count)},_proto.readBits=function readBits(size){var bits=Math.min(this.bitsAvailable,size),valu=this.word>>>32-bits;return size>32&&logger.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=bits,this.bitsAvailable>0?this.word<<=bits:this.bytesAvailable>0&&this.loadWord(),(bits=size-bits)>0&&this.bitsAvailable?valu<<bits|this.readBits(bits):valu},_proto.skipLZ=function skipLZ(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<this.bitsAvailable;++leadingZeroCount)if(0!=(this.word&2147483648>>>leadingZeroCount))return this.word<<=leadingZeroCount,this.bitsAvailable-=leadingZeroCount,leadingZeroCount;return this.loadWord(),leadingZeroCount+this.skipLZ()},_proto.skipUEG=function skipUEG(){this.skipBits(1+this.skipLZ())},_proto.skipEG=function skipEG(){this.skipBits(1+this.skipLZ())},_proto.readUEG=function readUEG(){var clz=this.skipLZ();return this.readBits(clz+1)-1},_proto.readEG=function readEG(){var valu=this.readUEG();return 1&valu?1+valu>>>1:-1*(valu>>>1)},_proto.readBoolean=function readBoolean(){return 1===this.readBits(1)},_proto.readUByte=function readUByte(){return this.readBits(8)},_proto.readUShort=function readUShort(){return this.readBits(16)},_proto.readUInt=function readUInt(){return this.readBits(32)},_proto.skipScalingList=function skipScalingList(count){var j,lastScale=8,nextScale=8;for(j=0;j<count;j++)0!==nextScale&&(nextScale=(lastScale+this.readEG()+256)%256),lastScale=0===nextScale?lastScale:nextScale},_proto.readSPS=function readSPS(){var profileIdc,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,i,frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,readUByte=this.readUByte.bind(this),readBits=this.readBits.bind(this),readUEG=this.readUEG.bind(this),readBoolean=this.readBoolean.bind(this),skipBits=this.skipBits.bind(this),skipEG=this.skipEG.bind(this),skipUEG=this.skipUEG.bind(this),skipScalingList=this.skipScalingList.bind(this);if(readUByte(),profileIdc=readUByte(),readBits(5),skipBits(3),readUByte(),skipUEG(),100===profileIdc||110===profileIdc||122===profileIdc||244===profileIdc||44===profileIdc||83===profileIdc||86===profileIdc||118===profileIdc||128===profileIdc){var chromaFormatIdc=readUEG();if(3===chromaFormatIdc&&skipBits(1),skipUEG(),skipUEG(),skipBits(1),readBoolean())for(scalingListCount=3!==chromaFormatIdc?8:12,i=0;i<scalingListCount;i++)readBoolean()&&skipScalingList(i<6?16:64)}skipUEG();var picOrderCntType=readUEG();if(0===picOrderCntType)readUEG();else if(1===picOrderCntType)for(skipBits(1),skipEG(),skipEG(),numRefFramesInPicOrderCntCycle=readUEG(),i=0;i<numRefFramesInPicOrderCntCycle;i++)skipEG();skipUEG(),skipBits(1),picWidthInMbsMinus1=readUEG(),picHeightInMapUnitsMinus1=readUEG(),0===(frameMbsOnlyFlag=readBits(1))&&skipBits(1),skipBits(1),readBoolean()&&(frameCropLeftOffset=readUEG(),frameCropRightOffset=readUEG(),frameCropTopOffset=readUEG(),frameCropBottomOffset=readUEG());var pixelRatio=[1,1];if(readBoolean()&&readBoolean())switch(readUByte()){case 1:pixelRatio=[1,1];break;case 2:pixelRatio=[12,11];break;case 3:pixelRatio=[10,11];break;case 4:pixelRatio=[16,11];break;case 5:pixelRatio=[40,33];break;case 6:pixelRatio=[24,11];break;case 7:pixelRatio=[20,11];break;case 8:pixelRatio=[32,11];break;case 9:pixelRatio=[80,33];break;case 10:pixelRatio=[18,11];break;case 11:pixelRatio=[15,11];break;case 12:pixelRatio=[64,33];break;case 13:pixelRatio=[160,99];break;case 14:pixelRatio=[4,3];break;case 15:pixelRatio=[3,2];break;case 16:pixelRatio=[2,1];break;case 255:pixelRatio=[readUByte()<<8|readUByte(),readUByte()<<8|readUByte()]}return{width:Math.ceil(16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-(frameMbsOnlyFlag?2:4)*(frameCropTopOffset+frameCropBottomOffset),pixelRatio}},_proto.readSliceType=function readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()},ExpGolomb}(),sample_aes=function(){function SampleAesDecrypter(observer,config,decryptdata,discardEPB){this.decryptdata=decryptdata,this.discardEPB=discardEPB,this.decrypter=new crypt_decrypter.default(observer,config,{removePKCS7Padding:!1})}var _proto=SampleAesDecrypter.prototype;return _proto.decryptBuffer=function decryptBuffer(encryptedData,callback){this.decrypter.decrypt(encryptedData,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,callback)},_proto.decryptAacSample=function decryptAacSample(samples,sampleIndex,callback,sync){var curUnit=samples[sampleIndex].unit,encryptedData=curUnit.subarray(16,curUnit.length-curUnit.length%16),encryptedBuffer=encryptedData.buffer.slice(encryptedData.byteOffset,encryptedData.byteOffset+encryptedData.length),localthis=this;this.decryptBuffer(encryptedBuffer,(function(decryptedData){decryptedData=new Uint8Array(decryptedData),curUnit.set(decryptedData,16),sync||localthis.decryptAacSamples(samples,sampleIndex+1,callback)}))},_proto.decryptAacSamples=function decryptAacSamples(samples,sampleIndex,callback){for(;;sampleIndex++){if(sampleIndex>=samples.length)return void callback();if(!(samples[sampleIndex].unit.length<32)){var sync=this.decrypter.isSync();if(this.decryptAacSample(samples,sampleIndex,callback,sync),!sync)return}}},_proto.getAvcEncryptedData=function getAvcEncryptedData(decodedData){for(var encryptedDataLen=16*Math.floor((decodedData.length-48)/160)+16,encryptedData=new Int8Array(encryptedDataLen),outputPos=0,inputPos=32;inputPos<=decodedData.length-16;inputPos+=160,outputPos+=16)encryptedData.set(decodedData.subarray(inputPos,inputPos+16),outputPos);return encryptedData},_proto.getAvcDecryptedUnit=function getAvcDecryptedUnit(decodedData,decryptedData){decryptedData=new Uint8Array(decryptedData);for(var inputPos=0,outputPos=32;outputPos<=decodedData.length-16;outputPos+=160,inputPos+=16)decodedData.set(decryptedData.subarray(inputPos,inputPos+16),outputPos);return decodedData},_proto.decryptAvcSample=function decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit,sync){var decodedData=this.discardEPB(curUnit.data),encryptedData=this.getAvcEncryptedData(decodedData),localthis=this;this.decryptBuffer(encryptedData.buffer,(function(decryptedData){curUnit.data=localthis.getAvcDecryptedUnit(decodedData,decryptedData),sync||localthis.decryptAvcSamples(samples,sampleIndex,unitIndex+1,callback)}))},_proto.decryptAvcSamples=function decryptAvcSamples(samples,sampleIndex,unitIndex,callback){for(;;sampleIndex++,unitIndex=0){if(sampleIndex>=samples.length)return void callback();for(var curUnits=samples[sampleIndex].units;!(unitIndex>=curUnits.length);unitIndex++){var curUnit=curUnits[unitIndex];if(!(curUnit.length<=48||1!==curUnit.type&&5!==curUnit.type)){var sync=this.decrypter.isSync();if(this.decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit,sync),!sync)return}}}},SampleAesDecrypter}(),RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4},tsdemuxer=function(){function TSDemuxer(observer,remuxer,config,typeSupported){this.observer=observer,this.config=config,this.typeSupported=typeSupported,this.remuxer=remuxer,this.sampleAes=null}var _proto=TSDemuxer.prototype;return _proto.setDecryptData=function setDecryptData(decryptdata){null!=decryptdata&&null!=decryptdata.key&&"SAMPLE-AES"===decryptdata.method?this.sampleAes=new sample_aes(this.observer,this.config,decryptdata,this.discardEPB):this.sampleAes=null},TSDemuxer.probe=function probe(data){var syncOffset=TSDemuxer._syncOffset(data);return!(syncOffset<0)&&(syncOffset&&logger.logger.warn("MPEG2-TS detected but first sync word found @ offset "+syncOffset+", junk ahead ?"),!0)},TSDemuxer._syncOffset=function _syncOffset(data){for(var scanwindow=Math.min(1e3,data.length-564),i=0;i<scanwindow;){if(71===data[i]&&71===data[i+188]&&71===data[i+376])return i;i++}return-1},TSDemuxer.createTrack=function createTrack(type,duration){return{container:"video"===type||"audio"===type?"video/mp2t":void 0,type,id:RemuxerTrackIdConfig[type],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===type?0:void 0,isAAC:"audio"===type||void 0,duration:"audio"===type?duration:void 0}},_proto.resetInitSegment=function resetInitSegment(initSegment,audioCodec,videoCodec,duration){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=TSDemuxer.createTrack("video",duration),this._audioTrack=TSDemuxer.createTrack("audio",duration),this._id3Track=TSDemuxer.createTrack("id3",duration),this._txtTrack=TSDemuxer.createTrack("text",duration),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=audioCodec,this.videoCodec=videoCodec,this._duration=duration},_proto.resetTimeStamp=function resetTimeStamp(){},_proto.append=function append(data,timeOffset,contiguous,accurateTimeOffset){var start,stt,pid,offset,pes,len=data.length,unknownPIDs=!1;this.contiguous=contiguous;var pmtParsed=this.pmtParsed,avcTrack=this._avcTrack,audioTrack=this._audioTrack,id3Track=this._id3Track,avcId=avcTrack.pid,audioId=audioTrack.pid,id3Id=id3Track.pid,pmtId=this._pmtId,avcData=avcTrack.pesData,audioData=audioTrack.pesData,id3Data=id3Track.pesData,parsePAT=this._parsePAT,parsePMT=this._parsePMT,parsePES=this._parsePES,parseAVCPES=this._parseAVCPES.bind(this),parseAACPES=this._parseAACPES.bind(this),parseMPEGPES=this._parseMPEGPES.bind(this),parseID3PES=this._parseID3PES.bind(this),syncOffset=TSDemuxer._syncOffset(data);for(len-=(len+syncOffset)%188,start=syncOffset;start<len;start+=188)if(71===data[start]){if(stt=!!(64&data[start+1]),pid=((31&data[start+1])<<8)+data[start+2],(48&data[start+3])>>4>1){if((offset=start+5+data[start+4])===start+188)continue}else offset=start+4;switch(pid){case avcId:stt&&(avcData&&(pes=parsePES(avcData))&&parseAVCPES(pes,!1),avcData={data:[],size:0}),avcData&&(avcData.data.push(data.subarray(offset,start+188)),avcData.size+=start+188-offset);break;case audioId:stt&&(audioData&&(pes=parsePES(audioData))&&(audioTrack.isAAC?parseAACPES(pes):parseMPEGPES(pes)),audioData={data:[],size:0}),audioData&&(audioData.data.push(data.subarray(offset,start+188)),audioData.size+=start+188-offset);break;case id3Id:stt&&(id3Data&&(pes=parsePES(id3Data))&&parseID3PES(pes),id3Data={data:[],size:0}),id3Data&&(id3Data.data.push(data.subarray(offset,start+188)),id3Data.size+=start+188-offset);break;case 0:stt&&(offset+=data[offset]+1),pmtId=this._pmtId=parsePAT(data,offset);break;case pmtId:stt&&(offset+=data[offset]+1);var parsedPIDs=parsePMT(data,offset,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(avcId=parsedPIDs.avc)>0&&(avcTrack.pid=avcId),(audioId=parsedPIDs.audio)>0&&(audioTrack.pid=audioId,audioTrack.isAAC=parsedPIDs.isAAC),(id3Id=parsedPIDs.id3)>0&&(id3Track.pid=id3Id),unknownPIDs&&!pmtParsed&&(logger.logger.log("reparse from beginning"),unknownPIDs=!1,start=syncOffset-188),pmtParsed=this.pmtParsed=!0;break;case 17:case 8191:break;default:unknownPIDs=!0}}else this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});avcData&&(pes=parsePES(avcData))?(parseAVCPES(pes,!0),avcTrack.pesData=null):avcTrack.pesData=avcData,audioData&&(pes=parsePES(audioData))?(audioTrack.isAAC?parseAACPES(pes):parseMPEGPES(pes),audioTrack.pesData=null):(audioData&&audioData.size&&logger.logger.log("last AAC PES packet truncated,might overlap between fragments"),audioTrack.pesData=audioData),id3Data&&(pes=parsePES(id3Data))?(parseID3PES(pes),id3Track.pesData=null):id3Track.pesData=id3Data,null==this.sampleAes?this.remuxer.remux(audioTrack,avcTrack,id3Track,this._txtTrack,timeOffset,contiguous,accurateTimeOffset):this.decryptAndRemux(audioTrack,avcTrack,id3Track,this._txtTrack,timeOffset,contiguous,accurateTimeOffset)},_proto.decryptAndRemux=function decryptAndRemux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(audioTrack.samples&&audioTrack.isAAC){var localthis=this;this.sampleAes.decryptAacSamples(audioTrack.samples,0,(function(){localthis.decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)}))}else this.decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)},_proto.decryptAndRemuxAvc=function decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(videoTrack.samples){var localthis=this;this.sampleAes.decryptAvcSamples(videoTrack.samples,0,0,(function(){localthis.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)}))}else this.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)},_proto.destroy=function destroy(){this._initPTS=this._initDTS=void 0,this._duration=0},_proto._parsePAT=function _parsePAT(data,offset){return(31&data[offset+10])<<8|data[offset+11]},_proto._parsePMT=function _parsePMT(data,offset,mpegSupported,isSampleAes){var tableEnd,pid,result={audio:-1,avc:-1,id3:-1,isAAC:!0};for(tableEnd=offset+3+((15&data[offset+1])<<8|data[offset+2])-4,offset+=12+((15&data[offset+10])<<8|data[offset+11]);offset<tableEnd;){switch(pid=(31&data[offset+1])<<8|data[offset+2],data[offset]){case 207:if(!isSampleAes){logger.logger.log("unknown stream type:"+data[offset]);break}case 15:-1===result.audio&&(result.audio=pid);break;case 21:-1===result.id3&&(result.id3=pid);break;case 219:if(!isSampleAes){logger.logger.log("unknown stream type:"+data[offset]);break}case 27:-1===result.avc&&(result.avc=pid);break;case 3:case 4:mpegSupported?-1===result.audio&&(result.audio=pid,result.isAAC=!1):logger.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:logger.logger.warn("HEVC stream type found, not supported for now");break;default:logger.logger.log("unknown stream type:"+data[offset])}offset+=5+((15&data[offset+3])<<8|data[offset+4])}return result},_proto._parsePES=function _parsePES(stream){var frag,pesFlags,pesLen,pesHdrLen,pesData,pesPts,pesDts,payloadStartOffset,i=0,data=stream.data;if(!stream||0===stream.size)return null;for(;data[0].length<19&&data.length>1;){var newData=new Uint8Array(data[0].length+data[1].length);newData.set(data[0]),newData.set(data[1],data[0].length),data[0]=newData,data.splice(1,1)}if(1===((frag=data[0])[0]<<16)+(frag[1]<<8)+frag[2]){if((pesLen=(frag[4]<<8)+frag[5])&&pesLen>stream.size-6)return null;if(192&(pesFlags=frag[7])&&((pesPts=536870912*(14&frag[9])+4194304*(255&frag[10])+16384*(254&frag[11])+128*(255&frag[12])+(254&frag[13])/2)>4294967295&&(pesPts-=8589934592),64&pesFlags?((pesDts=536870912*(14&frag[14])+4194304*(255&frag[15])+16384*(254&frag[16])+128*(255&frag[17])+(254&frag[18])/2)>4294967295&&(pesDts-=8589934592),pesPts-pesDts>54e5&&(logger.logger.warn(Math.round((pesPts-pesDts)/9e4)+"s delta between PTS and DTS, align them"),pesPts=pesDts)):pesDts=pesPts),payloadStartOffset=(pesHdrLen=frag[8])+9,stream.size<=payloadStartOffset)return null;stream.size-=payloadStartOffset,pesData=new Uint8Array(stream.size);for(var j=0,dataLen=data.length;j<dataLen;j++){var len=(frag=data[j]).byteLength;if(payloadStartOffset){if(payloadStartOffset>len){payloadStartOffset-=len;continue}frag=frag.subarray(payloadStartOffset),len-=payloadStartOffset,payloadStartOffset=0}pesData.set(frag,i),i+=len}return pesLen&&(pesLen-=pesHdrLen+3),{data:pesData,pts:pesPts,dts:pesDts,len:pesLen}}return null},_proto.pushAccesUnit=function pushAccesUnit(avcSample,avcTrack){if(avcSample.units.length&&avcSample.frame){var samples=avcTrack.samples,nbSamples=samples.length;if(isNaN(avcSample.pts)){if(!nbSamples)return void avcTrack.dropped++;var lastSample=samples[nbSamples-1];avcSample.pts=lastSample.pts,avcSample.dts=lastSample.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===avcSample.key||avcTrack.sps&&(nbSamples||this.contiguous)?(avcSample.id=nbSamples,samples.push(avcSample)):avcTrack.dropped++}avcSample.debug.length&&logger.logger.log(avcSample.pts+"/"+avcSample.dts+":"+avcSample.debug)},_proto._parseAVCPES=function _parseAVCPES(pes,last){var expGolombDecoder,push,i,_this=this,track=this._avcTrack,units=this._parseAVCNALu(pes.data),avcSample=this.avcSample,spsfound=!1,pushAccesUnit=this.pushAccesUnit.bind(this),createAVCSample=function createAVCSample(key,pts,dts,debug){return{key,pts,dts,units:[],debug}};pes.data=null,avcSample&&units.length&&!track.audFound&&(pushAccesUnit(avcSample,track),avcSample=this.avcSample=createAVCSample(!1,pes.pts,pes.dts,"")),units.forEach((function(unit){switch(unit.type){case 1:push=!0,avcSample||(avcSample=_this.avcSample=createAVCSample(!0,pes.pts,pes.dts,"")),avcSample.frame=!0;var data=unit.data;if(spsfound&&data.length>4){var sliceType=new exp_golomb(data).readSliceType();2!==sliceType&&4!==sliceType&&7!==sliceType&&9!==sliceType||(avcSample.key=!0)}break;case 5:push=!0,avcSample||(avcSample=_this.avcSample=createAVCSample(!0,pes.pts,pes.dts,"")),avcSample.key=!0,avcSample.frame=!0;break;case 6:push=!0,(expGolombDecoder=new exp_golomb(_this.discardEPB(unit.data))).readUByte();for(var payloadType=0,payloadSize=0,endOfCaptions=!1,b=0;!endOfCaptions&&expGolombDecoder.bytesAvailable>1;){payloadType=0;do{payloadType+=b=expGolombDecoder.readUByte()}while(255===b);payloadSize=0;do{payloadSize+=b=expGolombDecoder.readUByte()}while(255===b);if(4===payloadType&&0!==expGolombDecoder.bytesAvailable){if(endOfCaptions=!0,181===expGolombDecoder.readUByte())if(49===expGolombDecoder.readUShort())if(1195456820===expGolombDecoder.readUInt())if(3===expGolombDecoder.readUByte()){var firstByte=expGolombDecoder.readUByte(),totalCCs=31&firstByte,byteArray=[firstByte,expGolombDecoder.readUByte()];for(i=0;i<totalCCs;i++)byteArray.push(expGolombDecoder.readUByte()),byteArray.push(expGolombDecoder.readUByte()),byteArray.push(expGolombDecoder.readUByte());_this._insertSampleInOrder(_this._txtTrack.samples,{type:3,pts:pes.pts,bytes:byteArray})}}else if(5===payloadType&&0!==expGolombDecoder.bytesAvailable){if(endOfCaptions=!0,payloadSize>16){var uuidStrArray=[];for(i=0;i<16;i++)uuidStrArray.push(expGolombDecoder.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||uuidStrArray.push("-");var length=payloadSize-16,userDataPayloadBytes=new Uint8Array(length);for(i=0;i<length;i++)userDataPayloadBytes[i]=expGolombDecoder.readUByte();_this._insertSampleInOrder(_this._txtTrack.samples,{pts:pes.pts,payloadType,uuid:uuidStrArray.join(""),userDataBytes:userDataPayloadBytes,userData:Object(id3.utf8ArrayToStr)(userDataPayloadBytes.buffer)})}}else if(payloadSize<expGolombDecoder.bytesAvailable)for(i=0;i<payloadSize;i++)expGolombDecoder.readUByte()}break;case 7:if(push=!0,spsfound=!0,!track.sps){var config=(expGolombDecoder=new exp_golomb(unit.data)).readSPS();track.width=config.width,track.height=config.height,track.pixelRatio=config.pixelRatio,track.sps=[unit.data],track.duration=_this._duration;var codecarray=unit.data.subarray(1,4),codecstring="avc1.";for(i=0;i<3;i++){var h=codecarray[i].toString(16);h.length<2&&(h="0"+h),codecstring+=h}track.codec=codecstring}break;case 8:push=!0,track.pps||(track.pps=[unit.data]);break;case 9:push=!1,track.audFound=!0,avcSample&&pushAccesUnit(avcSample,track),avcSample=_this.avcSample=createAVCSample(!1,pes.pts,pes.dts,"");break;case 12:push=!1;break;default:push=!1,avcSample&&(avcSample.debug+="unknown NAL "+unit.type+" ")}avcSample&&push&&avcSample.units.push(unit)})),last&&avcSample&&(pushAccesUnit(avcSample,track),this.avcSample=null)},_proto._insertSampleInOrder=function _insertSampleInOrder(arr,data){var len=arr.length;if(len>0){if(data.pts>=arr[len-1].pts)arr.push(data);else for(var pos=len-1;pos>=0;pos--)if(data.pts<arr[pos].pts){arr.splice(pos,0,data);break}}else arr.push(data)},_proto._getLastNalUnit=function _getLastNalUnit(){var lastUnit,avcSample=this.avcSample;if(!avcSample||0===avcSample.units.length){var samples=this._avcTrack.samples;avcSample=samples[samples.length-1]}if(avcSample){var units=avcSample.units;lastUnit=units[units.length-1]}return lastUnit},_proto._parseAVCNALu=function _parseAVCNALu(array){var value,overflow,unit,lastUnitType,i=0,len=array.byteLength,track=this._avcTrack,state=track.naluState||0,lastState=state,units=[],lastUnitStart=-1;for(-1===state&&(lastUnitStart=0,lastUnitType=31&array[0],state=0,i=1);i<len;)if(value=array[i++],state)if(1!==state)if(value)if(1===value){if(lastUnitStart>=0)unit={data:array.subarray(lastUnitStart,i-state-1),type:lastUnitType},units.push(unit);else{var lastUnit=this._getLastNalUnit();if(lastUnit&&(lastState&&i<=4-lastState&&lastUnit.state&&(lastUnit.data=lastUnit.data.subarray(0,lastUnit.data.byteLength-lastState)),(overflow=i-state-1)>0)){var tmp=new Uint8Array(lastUnit.data.byteLength+overflow);tmp.set(lastUnit.data,0),tmp.set(array.subarray(0,overflow),lastUnit.data.byteLength),lastUnit.data=tmp}}i<len?(lastUnitStart=i,lastUnitType=31&array[i],state=0):state=-1}else state=0;else state=3;else state=value?0:2;else state=value?0:1;if(lastUnitStart>=0&&state>=0&&(unit={data:array.subarray(lastUnitStart,len),type:lastUnitType,state},units.push(unit)),0===units.length){var _lastUnit=this._getLastNalUnit();if(_lastUnit){var _tmp=new Uint8Array(_lastUnit.data.byteLength+array.byteLength);_tmp.set(_lastUnit.data,0),_tmp.set(array,_lastUnit.data.byteLength),_lastUnit.data=_tmp}}return track.naluState=state,units},_proto.discardEPB=function discardEPB(data){for(var newLength,newData,length=data.byteLength,EPBPositions=[],i=1;i<length-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(EPBPositions.push(i+2),i+=2):i++;if(0===EPBPositions.length)return data;newLength=length-EPBPositions.length,newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===EPBPositions[0]&&(sourceIndex++,EPBPositions.shift()),newData[i]=data[sourceIndex];return newData},_proto._parseAACPES=function _parseAACPES(pes){var frameDuration,frameIndex,offset,stamp,len,reason,fatal,track=this._audioTrack,data=pes.data,pts=pes.pts,aacOverFlow=this.aacOverFlow,aacLastPTS=this.aacLastPTS;if(aacOverFlow){var tmp=new Uint8Array(aacOverFlow.byteLength+data.byteLength);tmp.set(aacOverFlow,0),tmp.set(data,aacOverFlow.byteLength),data=tmp}for(offset=0,len=data.length;offset<len-1&&!isHeader(data,offset);offset++);if(offset&&(offset<len-1?(reason="AAC PES did not start with ADTS header,offset:"+offset,fatal=!1):(reason="no ADTS header found in AAC PES",fatal=!0),logger.logger.warn("parsing error:"+reason),this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal,reason}),fatal))return;if(initTrackConfig(track,this.observer,data,offset,this.audioCodec),frameIndex=0,frameDuration=getFrameDuration(track.samplerate),aacOverFlow&&aacLastPTS){var newPTS=aacLastPTS+frameDuration;Math.abs(newPTS-pts)>1&&(logger.logger.log("AAC: align PTS for overlapping frames by "+Math.round((newPTS-pts)/90)),pts=newPTS)}for(;offset<len;){if(isHeader(data,offset)){if(offset+5<len){var frame=appendFrame(track,data,offset,pts,frameIndex);if(frame){offset+=frame.length,stamp=frame.sample.pts,frameIndex++;continue}}break}offset++}aacOverFlow=offset<len?data.subarray(offset,len):null,this.aacOverFlow=aacOverFlow,this.aacLastPTS=stamp},_proto._parseMPEGPES=function _parseMPEGPES(pes){for(var data=pes.data,length=data.length,frameIndex=0,offset=0,pts=pes.pts;offset<length;)if(mpegaudio.isHeader(data,offset)){var frame=mpegaudio.appendFrame(this._audioTrack,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,frameIndex++}else offset++},_proto._parseID3PES=function _parseID3PES(pes){this._id3Track.samples.push(pes)},TSDemuxer}(),mp3demuxer=function(){function MP3Demuxer(observer,remuxer,config){this.observer=observer,this.config=config,this.remuxer=remuxer}var _proto=MP3Demuxer.prototype;return _proto.resetInitSegment=function resetInitSegment(initSegment,audioCodec,videoCodec,duration){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:audioCodec,duration,inputTimeScale:9e4}},_proto.resetTimeStamp=function resetTimeStamp(){},MP3Demuxer.probe=function probe(data){var offset,length,id3Data=id3.default.getID3Data(data,0);if(id3Data&&void 0!==id3.default.getTimeStamp(id3Data))for(offset=id3Data.length,length=Math.min(data.length-1,offset+100);offset<length;offset++)if(mpegaudio.probe(data,offset))return logger.logger.log("MPEG Audio sync word found !"),!0;return!1},_proto.append=function append(data,timeOffset,contiguous,accurateTimeOffset){for(var id3Data=id3.default.getID3Data(data,0),timestamp=id3.default.getTimeStamp(id3Data),pts=timestamp?90*timestamp:9e4*timeOffset,offset=id3Data.length,length=data.length,frameIndex=0,stamp=0,track=this._audioTrack,id3Samples=[{pts,dts:pts,data:id3Data}];offset<length;)if(mpegaudio.isHeader(data,offset)){var frame=mpegaudio.appendFrame(track,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else id3.default.isHeader(data,offset)?(id3Data=id3.default.getID3Data(data,offset),id3Samples.push({pts:stamp,dts:stamp,data:id3Data}),offset+=id3Data.length):offset++;this.remuxer.remux(track,{samples:[]},{samples:id3Samples,inputTimeScale:9e4},{samples:[]},timeOffset,contiguous,accurateTimeOffset)},_proto.destroy=function destroy(){},MP3Demuxer}(),aac_helper=function(){function AAC(){}return AAC.getSilentFrame=function getSilentFrame(codec,channelCount){switch(codec){case"mp4a.40.2":if(1===channelCount)return new Uint8Array([0,200,0,128,35,128]);if(2===channelCount)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===channelCount)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},AAC}(),UINT32_MAX=Math.pow(2,32)-1,mp4_generator=function(){function MP4(){}return MP4.init=function init(){var i;for(i in MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},MP4.types)MP4.types.hasOwnProperty(i)&&(MP4.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var videoHdlr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audioHdlr=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:videoHdlr,audio:audioHdlr};var dref=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),stco=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=stco,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var majorBrand=new Uint8Array([105,115,111,109]),avc1Brand=new Uint8Array([97,118,99,49]),minorVersion=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,majorBrand,minorVersion,majorBrand,avc1Brand),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,dref))},MP4.box=function box(type){for(var result,payload=Array.prototype.slice.call(arguments,1),size=8,i=payload.length,len=i;i--;)size+=payload[i].byteLength;for((result=new Uint8Array(size))[0]=size>>24&255,result[1]=size>>16&255,result[2]=size>>8&255,result[3]=255&size,result.set(type,4),i=0,size=8;i<len;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result},MP4.hdlr=function hdlr(type){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[type])},MP4.mdat=function mdat(data){return MP4.box(MP4.types.mdat,data)},MP4.mdhd=function mdhd(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,85,196,0,0]))},MP4.mdia=function mdia(track){return MP4.box(MP4.types.mdia,MP4.mdhd(track.timescale,track.duration),MP4.hdlr(track.type),MP4.minf(track))},MP4.mfhd=function mfhd(sequenceNumber){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,sequenceNumber>>24,sequenceNumber>>16&255,sequenceNumber>>8&255,255&sequenceNumber]))},MP4.minf=function minf(track){return"audio"===track.type?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(track)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(track))},MP4.moof=function moof(sn,baseMediaDecodeTime,track){return MP4.box(MP4.types.moof,MP4.mfhd(sn),MP4.traf(track,baseMediaDecodeTime))},MP4.moov=function moov(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trak(tracks[i]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(tracks[0].timescale,tracks[0].duration)].concat(boxes).concat(MP4.mvex(tracks)))},MP4.mvex=function mvex(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trex(tracks[i]);return MP4.box.apply(null,[MP4.types.mvex].concat(boxes))},MP4.mvhd=function mvhd(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1)),bytes=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,bytes)},MP4.sdtp=function sdtp(track){var flags,i,samples=track.samples||[],bytes=new Uint8Array(4+samples.length);for(i=0;i<samples.length;i++)flags=samples[i].flags,bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;return MP4.box(MP4.types.sdtp,bytes)},MP4.stbl=function stbl(track){return MP4.box(MP4.types.stbl,MP4.stsd(track),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))},MP4.avc1=function avc1(track){var i,data,len,sps=[],pps=[];for(i=0;i<track.sps.length;i++)len=(data=track.sps[i]).byteLength,sps.push(len>>>8&255),sps.push(255&len),sps=sps.concat(Array.prototype.slice.call(data));for(i=0;i<track.pps.length;i++)len=(data=track.pps[i]).byteLength,pps.push(len>>>8&255),pps.push(255&len),pps=pps.concat(Array.prototype.slice.call(data));var avcc=MP4.box(MP4.types.avcC,new Uint8Array([1,sps[3],sps[4],sps[5],255,224|track.sps.length].concat(sps).concat([track.pps.length]).concat(pps))),width=track.width,height=track.height,hSpacing=track.pixelRatio[0],vSpacing=track.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,width>>8&255,255&width,height>>8&255,255&height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),avcc,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([hSpacing>>24,hSpacing>>16&255,hSpacing>>8&255,255&hSpacing,vSpacing>>24,vSpacing>>16&255,vSpacing>>8&255,255&vSpacing])))},MP4.esds=function esds(track){var configlen=track.config.length;return new Uint8Array([0,0,0,0,3,23+configlen,0,1,0,4,15+configlen,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([configlen]).concat(track.config).concat([6,1,2]))},MP4.mp4a=function mp4a(track){var samplerate=track.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0]),MP4.box(MP4.types.esds,MP4.esds(track)))},MP4.mp3=function mp3(track){var samplerate=track.samplerate;return MP4.box(MP4.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0]))},MP4.stsd=function stsd(track){return"audio"===track.type?track.isAAC||"mp3"!==track.codec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(track))},MP4.tkhd=function tkhd(track){var id=track.id,duration=track.duration*track.timescale,width=track.width,height=track.height,upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,id>>24&255,id>>16&255,id>>8&255,255&id,0,0,0,0,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,width>>8&255,255&width,0,0,height>>8&255,255&height,0,0]))},MP4.traf=function traf(track,baseMediaDecodeTime){var sampleDependencyTable=MP4.sdtp(track),id=track.id,upperWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1)),lowerWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,upperWordBaseMediaDecodeTime>>24,upperWordBaseMediaDecodeTime>>16&255,upperWordBaseMediaDecodeTime>>8&255,255&upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime>>24,lowerWordBaseMediaDecodeTime>>16&255,lowerWordBaseMediaDecodeTime>>8&255,255&lowerWordBaseMediaDecodeTime])),MP4.trun(track,sampleDependencyTable.length+16+20+8+16+8+8),sampleDependencyTable)},MP4.trak=function trak(track){return track.duration=track.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(track),MP4.mdia(track))},MP4.trex=function trex(track){var id=track.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},MP4.trun=function trun(track,offset){var i,sample,duration,size,flags,cts,samples=track.samples||[],len=samples.length,arraylen=12+16*len,array=new Uint8Array(arraylen);for(offset+=8+arraylen,array.set([0,0,15,1,len>>>24&255,len>>>16&255,len>>>8&255,255&len,offset>>>24&255,offset>>>16&255,offset>>>8&255,255&offset],0),i=0;i<len;i++)duration=(sample=samples[i]).duration,size=sample.size,flags=sample.flags,cts=sample.cts,array.set([duration>>>24&255,duration>>>16&255,duration>>>8&255,255&duration,size>>>24&255,size>>>16&255,size>>>8&255,255&size,flags.isLeading<<2|flags.dependsOn,flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.paddingValue<<1|flags.isNonSync,61440&flags.degradPrio,15&flags.degradPrio,cts>>>24&255,cts>>>16&255,cts>>>8&255,255&cts],12+16*i);return MP4.box(MP4.types.trun,array)},MP4.initSegment=function initSegment(tracks){MP4.types||MP4.init();var result,movie=MP4.moov(tracks);return(result=new Uint8Array(MP4.FTYP.byteLength+movie.byteLength)).set(MP4.FTYP),result.set(movie,MP4.FTYP.byteLength),result},MP4}();function toTimescaleFromBase(value,destScale,srcBase,round){void 0===srcBase&&(srcBase=1),void 0===round&&(round=!1);var result=value*destScale*srcBase;return round?Math.round(result):result}function toMsFromMpegTsClock(value,round){return void 0===round&&(round=!1),toTimescaleFromBase(value,1e3,1/9e4,round)}function toMpegTsClockFromTimescale(value,srcScale){return void 0===srcScale&&(srcScale=1),toTimescaleFromBase(value,9e4,1/srcScale)}var now,MAX_SILENT_FRAME_DURATION_90KHZ=toMpegTsClockFromTimescale(10),PTS_DTS_SHIFT_TOLERANCE_90KHZ=toMpegTsClockFromTimescale(.2),mp4_remuxer=function(){function MP4Remuxer(observer,config,typeSupported,vendor){this.observer=observer,this.config=config,this.typeSupported=typeSupported;var userAgent=navigator.userAgent;this.isSafari=vendor&&vendor.indexOf("Apple")>-1&&userAgent&&!userAgent.match("CriOS"),this.ISGenerated=!1}var _proto=MP4Remuxer.prototype;return _proto.destroy=function destroy(){},_proto.resetTimeStamp=function resetTimeStamp(defaultTimeStamp){this._initPTS=this._initDTS=defaultTimeStamp},_proto.resetInitSegment=function resetInitSegment(){this.ISGenerated=!1},_proto.remux=function remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(this.ISGenerated||this.generateIS(audioTrack,videoTrack,timeOffset),this.ISGenerated){var nbAudioSamples=audioTrack.samples.length,nbVideoSamples=videoTrack.samples.length,audioTimeOffset=timeOffset,videoTimeOffset=timeOffset;if(nbAudioSamples&&nbVideoSamples){var audiovideoDeltaDts=(audioTrack.samples[0].pts-videoTrack.samples[0].pts)/videoTrack.inputTimeScale;audioTimeOffset+=Math.max(0,audiovideoDeltaDts),videoTimeOffset+=Math.max(0,-audiovideoDeltaDts)}if(nbAudioSamples){audioTrack.timescale||(logger.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(audioTrack,videoTrack,timeOffset));var audioTrackLength,audioData=this.remuxAudio(audioTrack,audioTimeOffset,contiguous,accurateTimeOffset);if(nbVideoSamples)audioData&&(audioTrackLength=audioData.endPTS-audioData.startPTS),videoTrack.timescale||(logger.logger.warn("regenerate InitSegment as video detected"),this.generateIS(audioTrack,videoTrack,timeOffset)),this.remuxVideo(videoTrack,videoTimeOffset,contiguous,audioTrackLength,accurateTimeOffset)}else if(nbVideoSamples){var videoData=this.remuxVideo(videoTrack,videoTimeOffset,contiguous,0,accurateTimeOffset);videoData&&audioTrack.codec&&this.remuxEmptyAudio(audioTrack,audioTimeOffset,contiguous,videoData)}}id3Track.samples.length&&this.remuxID3(id3Track,timeOffset),textTrack.samples.length&&this.remuxText(textTrack,timeOffset),this.observer.trigger(events.default.FRAG_PARSED)},_proto.generateIS=function generateIS(audioTrack,videoTrack,timeOffset){var initPTS,initDTS,observer=this.observer,audioSamples=audioTrack.samples,videoSamples=videoTrack.samples,typeSupported=this.typeSupported,container="audio/mp4",tracks={},data={tracks},computePTSDTS=void 0===this._initPTS;if(computePTSDTS&&(initPTS=initDTS=1/0),audioTrack.config&&audioSamples.length&&(audioTrack.timescale=audioTrack.samplerate,logger.logger.log("audio sampling rate : "+audioTrack.samplerate),audioTrack.isAAC||(typeSupported.mpeg?(container="audio/mpeg",audioTrack.codec=""):typeSupported.mp3&&(audioTrack.codec="mp3")),tracks.audio={container,codec:audioTrack.codec,initSegment:!audioTrack.isAAC&&typeSupported.mpeg?new Uint8Array:mp4_generator.initSegment([audioTrack]),metadata:{channelCount:audioTrack.channelCount}},computePTSDTS&&(initPTS=initDTS=audioSamples[0].pts-audioTrack.inputTimeScale*timeOffset)),videoTrack.sps&&videoTrack.pps&&videoSamples.length){var inputTimeScale=videoTrack.inputTimeScale;videoTrack.timescale=inputTimeScale,tracks.video={container:"video/mp4",codec:videoTrack.codec,initSegment:mp4_generator.initSegment([videoTrack]),metadata:{width:videoTrack.width,height:videoTrack.height}},computePTSDTS&&(initPTS=Math.min(initPTS,videoSamples[0].pts-inputTimeScale*timeOffset),initDTS=Math.min(initDTS,videoSamples[0].dts-inputTimeScale*timeOffset),this.observer.trigger(events.default.INIT_PTS_FOUND,{initPTS}))}Object.keys(tracks).length?(observer.trigger(events.default.FRAG_PARSING_INIT_SEGMENT,data),this.ISGenerated=!0,computePTSDTS&&(this._initPTS=initPTS,this._initDTS=initDTS)):observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},_proto.remuxVideo=function remuxVideo(track,timeOffset,contiguous,audioTrackLength,accurateTimeOffset){var mp4SampleDuration,mdat,moof,firstPTS,firstDTS,lastPTS,lastDTS,offset=8,timeScale=track.timescale,inputSamples=track.samples,outputSamples=[],nbSamples=inputSamples.length,ptsNormalize=this._PTSNormalize,initPTS=this._initPTS,nextAvcDts=this.nextAvcDts,isSafari=this.isSafari;if(0!==nbSamples){isSafari&&(contiguous|=inputSamples.length&&nextAvcDts&&(accurateTimeOffset&&Math.abs(timeOffset-nextAvcDts/timeScale)<.1||Math.abs(inputSamples[0].pts-nextAvcDts-initPTS)<timeScale/5)),contiguous||(nextAvcDts=timeOffset*timeScale),inputSamples.forEach((function(sample){sample.pts=ptsNormalize(sample.pts-initPTS,nextAvcDts),sample.dts=ptsNormalize(sample.dts-initPTS,nextAvcDts)})),inputSamples.sort((function(a,b){var deltadts=a.dts-b.dts,deltapts=a.pts-b.pts;return deltadts||deltapts||a.id-b.id}));var PTSDTSshift=inputSamples.reduce((function(prev,curr){return Math.max(Math.min(prev,curr.pts-curr.dts),-1*PTS_DTS_SHIFT_TOLERANCE_90KHZ)}),0);if(PTSDTSshift<0){logger.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+toMsFromMpegTsClock(PTSDTSshift,!0)+" ms to overcome this issue");for(var i=0;i<inputSamples.length;i++)inputSamples[i].dts+=PTSDTSshift}var sample=inputSamples[0];firstDTS=Math.max(sample.dts,0),firstPTS=Math.max(sample.pts,0);var delta=firstDTS-nextAvcDts;contiguous&&delta&&(delta>1?logger.logger.log("AVC: "+toMsFromMpegTsClock(delta,!0)+" ms hole between fragments detected,filling it"):delta<-1&&logger.logger.log("AVC: "+toMsFromMpegTsClock(-delta,!0)+" ms overlapping between fragments detected"),firstDTS=nextAvcDts,inputSamples[0].dts=firstDTS,firstPTS=Math.max(firstPTS-delta,nextAvcDts),inputSamples[0].pts=firstPTS,logger.logger.log("Video: PTS/DTS adjusted: "+toMsFromMpegTsClock(firstPTS,!0)+"/"+toMsFromMpegTsClock(firstDTS,!0)+", delta: "+toMsFromMpegTsClock(delta,!0)+" ms")),sample=inputSamples[inputSamples.length-1],lastDTS=Math.max(sample.dts,0),lastPTS=Math.max(sample.pts,0,lastDTS),isSafari&&(mp4SampleDuration=Math.round((lastDTS-firstDTS)/(inputSamples.length-1)));for(var nbNalu=0,naluLen=0,_i=0;_i<nbSamples;_i++){for(var _sample=inputSamples[_i],units=_sample.units,nbUnits=units.length,sampleLen=0,j=0;j<nbUnits;j++)sampleLen+=units[j].data.length;naluLen+=sampleLen,nbNalu+=nbUnits,_sample.length=sampleLen,_sample.dts=isSafari?firstDTS+_i*mp4SampleDuration:Math.max(_sample.dts,firstDTS),_sample.pts=Math.max(_sample.pts,_sample.dts)}var mdatSize=naluLen+4*nbNalu+8;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MUX_ERROR,details:errors.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:mdatSize,reason:"fail allocating video mdat "+mdatSize})}var view=new DataView(mdat.buffer);view.setUint32(0,mdatSize),mdat.set(mp4_generator.types.mdat,4);for(var _i2=0;_i2<nbSamples;_i2++){for(var avcSample=inputSamples[_i2],avcSampleUnits=avcSample.units,mp4SampleLength=0,compositionTimeOffset=void 0,_j=0,_nbUnits=avcSampleUnits.length;_j<_nbUnits;_j++){var unit=avcSampleUnits[_j],unitData=unit.data,unitDataLen=unit.data.byteLength;view.setUint32(offset,unitDataLen),offset+=4,mdat.set(unitData,offset),offset+=unitDataLen,mp4SampleLength+=4+unitDataLen}if(isSafari)compositionTimeOffset=Math.max(0,mp4SampleDuration*Math.round((avcSample.pts-avcSample.dts)/mp4SampleDuration));else{if(_i2<nbSamples-1)mp4SampleDuration=inputSamples[_i2+1].dts-avcSample.dts;else{var config=this.config,lastFrameDuration=avcSample.dts-inputSamples[_i2>0?_i2-1:_i2].dts;if(config.stretchShortVideoTrack){var maxBufferHole=config.maxBufferHole,gapTolerance=Math.floor(maxBufferHole*timeScale),deltaToFrameEnd=(audioTrackLength?firstPTS+audioTrackLength*timeScale:this.nextAudioPts)-avcSample.pts;deltaToFrameEnd>gapTolerance?((mp4SampleDuration=deltaToFrameEnd-lastFrameDuration)<0&&(mp4SampleDuration=lastFrameDuration),logger.logger.log("It is approximately "+toMsFromMpegTsClock(deltaToFrameEnd,!1)+" ms to the next segment; using duration "+toMsFromMpegTsClock(mp4SampleDuration,!1)+" ms for the last video frame.")):mp4SampleDuration=lastFrameDuration}else mp4SampleDuration=lastFrameDuration}compositionTimeOffset=Math.round(avcSample.pts-avcSample.dts)}outputSamples.push({size:mp4SampleLength,duration:mp4SampleDuration,cts:compositionTimeOffset,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:avcSample.key?2:1,isNonSync:avcSample.key?0:1}})}this.nextAvcDts=lastDTS+mp4SampleDuration;var dropped=track.dropped;if(track.nbNalu=0,track.dropped=0,outputSamples.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var flags=outputSamples[0].flags;flags.dependsOn=2,flags.isNonSync=0}track.samples=outputSamples,moof=mp4_generator.moof(track.sequenceNumber++,firstDTS,track),track.samples=[];var data={data1:moof,data2:mdat,startPTS:firstPTS/timeScale,endPTS:(lastPTS+mp4SampleDuration)/timeScale,startDTS:firstDTS/timeScale,endDTS:this.nextAvcDts/timeScale,type:"video",hasAudio:!1,hasVideo:!0,nb:outputSamples.length,dropped};return this.observer.trigger(events.default.FRAG_PARSING_DATA,data),data}},_proto.remuxAudio=function remuxAudio(track,timeOffset,contiguous,accurateTimeOffset){var mp4Sample,fillFrame,mdat,moof,firstPTS,lastPTS,inputTimeScale=track.inputTimeScale,mp4timeScale=track.timescale,scaleFactor=inputTimeScale/mp4timeScale,inputSampleDuration=(track.isAAC?1024:1152)*scaleFactor,ptsNormalize=this._PTSNormalize,initPTS=this._initPTS,rawMPEG=!track.isAAC&&this.typeSupported.mpeg,offset=rawMPEG?0:8,inputSamples=track.samples,outputSamples=[],nextAudioPts=this.nextAudioPts;if(contiguous|=inputSamples.length&&nextAudioPts&&(accurateTimeOffset&&Math.abs(timeOffset-nextAudioPts/inputTimeScale)<.1||Math.abs(inputSamples[0].pts-nextAudioPts-initPTS)<20*inputSampleDuration),inputSamples.forEach((function(sample){sample.pts=sample.dts=ptsNormalize(sample.pts-initPTS,timeOffset*inputTimeScale)})),0!==(inputSamples=inputSamples.filter((function(sample){return sample.pts>=0}))).length){if(contiguous||(nextAudioPts=accurateTimeOffset?timeOffset*inputTimeScale:inputSamples[0].pts),track.isAAC)for(var maxAudioFramesDrift=this.config.maxAudioFramesDrift,i=0,nextPts=nextAudioPts;i<inputSamples.length;){var delta,sample=inputSamples[i];if((delta=sample.pts-nextPts)<=-maxAudioFramesDrift*inputSampleDuration)logger.logger.warn("Dropping 1 audio frame @ "+toMsFromMpegTsClock(nextPts,!0)+" ms due to "+toMsFromMpegTsClock(delta,!0)+" ms overlap."),inputSamples.splice(i,1);else if(delta>=maxAudioFramesDrift*inputSampleDuration&&delta<MAX_SILENT_FRAME_DURATION_90KHZ&&nextPts){var missing=Math.round(delta/inputSampleDuration);logger.logger.warn("Injecting "+missing+" audio frames @ "+toMsFromMpegTsClock(nextPts,!0)+" ms due to "+toMsFromMpegTsClock(nextPts,!0)+" ms gap.");for(var j=0;j<missing;j++){var newStamp=Math.max(nextPts,0);(fillFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount))||(logger.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),fillFrame=sample.unit.subarray()),inputSamples.splice(i,0,{unit:fillFrame,pts:newStamp,dts:newStamp}),nextPts+=inputSampleDuration,i++}sample.pts=sample.dts=nextPts,nextPts+=inputSampleDuration,i++}else Math.abs(delta),sample.pts=sample.dts=nextPts,nextPts+=inputSampleDuration,i++}for(var nbSamples=inputSamples.length,mdatSize=0;nbSamples--;)mdatSize+=inputSamples[nbSamples].unit.byteLength;for(var _j2=0,_nbSamples=inputSamples.length;_j2<_nbSamples;_j2++){var audioSample=inputSamples[_j2],unit=audioSample.unit,_pts=audioSample.pts;if(void 0!==lastPTS)mp4Sample.duration=Math.round((_pts-lastPTS)/scaleFactor);else{var _delta=_pts-nextAudioPts,numMissingFrames=0;if(contiguous&&track.isAAC&&_delta){if(_delta>0&&_delta<MAX_SILENT_FRAME_DURATION_90KHZ)numMissingFrames=Math.round((_pts-nextAudioPts)/inputSampleDuration),logger.logger.log(toMsFromMpegTsClock(_delta,!0)+" ms hole between AAC samples detected,filling it"),numMissingFrames>0&&((fillFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount))||(fillFrame=unit.subarray()),mdatSize+=numMissingFrames*fillFrame.length);else if(_delta<-12){logger.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+toMsFromMpegTsClock(nextAudioPts,!0)+" ms / "+toMsFromMpegTsClock(_pts,!0)+" ms / "+toMsFromMpegTsClock(-_delta,!0)+" ms"),mdatSize-=unit.byteLength;continue}_pts=nextAudioPts}if(firstPTS=_pts,!(mdatSize>0))return;mdatSize+=offset;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MUX_ERROR,details:errors.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:mdatSize,reason:"fail allocating audio mdat "+mdatSize})}rawMPEG||(new DataView(mdat.buffer).setUint32(0,mdatSize),mdat.set(mp4_generator.types.mdat,4));for(var _i3=0;_i3<numMissingFrames;_i3++)(fillFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount))||(logger.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),fillFrame=unit.subarray()),mdat.set(fillFrame,offset),offset+=fillFrame.byteLength,mp4Sample={size:fillFrame.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},outputSamples.push(mp4Sample)}mdat.set(unit,offset);var unitLen=unit.byteLength;offset+=unitLen,mp4Sample={size:unitLen,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},outputSamples.push(mp4Sample),lastPTS=_pts}var lastSampleDuration=0;if((nbSamples=outputSamples.length)>=2&&(lastSampleDuration=outputSamples[nbSamples-2].duration,mp4Sample.duration=lastSampleDuration),nbSamples){this.nextAudioPts=nextAudioPts=lastPTS+scaleFactor*lastSampleDuration,track.samples=outputSamples,moof=rawMPEG?new Uint8Array:mp4_generator.moof(track.sequenceNumber++,firstPTS/scaleFactor,track),track.samples=[];var start=firstPTS/inputTimeScale,end=nextAudioPts/inputTimeScale,audioData={data1:moof,data2:mdat,startPTS:start,endPTS:end,startDTS:start,endDTS:end,type:"audio",hasAudio:!0,hasVideo:!1,nb:nbSamples};return this.observer.trigger(events.default.FRAG_PARSING_DATA,audioData),audioData}return null}},_proto.remuxEmptyAudio=function remuxEmptyAudio(track,timeOffset,contiguous,videoData){var inputTimeScale=track.inputTimeScale,scaleFactor=inputTimeScale/(track.samplerate?track.samplerate:inputTimeScale),nextAudioPts=this.nextAudioPts,startDTS=(void 0!==nextAudioPts?nextAudioPts:videoData.startDTS*inputTimeScale)+this._initDTS,endDTS=videoData.endDTS*inputTimeScale+this._initDTS,frameDuration=1024*scaleFactor,nbSamples=Math.ceil((endDTS-startDTS)/frameDuration),silentFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);if(logger.logger.warn("remux empty Audio"),silentFrame){for(var samples=[],i=0;i<nbSamples;i++){var stamp=startDTS+i*frameDuration;samples.push({unit:silentFrame,pts:stamp,dts:stamp})}track.samples=samples,this.remuxAudio(track,timeOffset,contiguous)}else logger.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},_proto.remuxID3=function remuxID3(track){var sample,length=track.samples.length,inputTimeScale=track.inputTimeScale,initPTS=this._initPTS,initDTS=this._initDTS;if(length){for(var index=0;index<length;index++)(sample=track.samples[index]).pts=(sample.pts-initPTS)/inputTimeScale,sample.dts=(sample.dts-initDTS)/inputTimeScale;this.observer.trigger(events.default.FRAG_PARSING_METADATA,{samples:track.samples})}track.samples=[]},_proto.remuxText=function remuxText(track){track.samples.sort((function(a,b){return a.pts-b.pts}));var sample,length=track.samples.length,inputTimeScale=track.inputTimeScale,initPTS=this._initPTS;if(length){for(var index=0;index<length;index++)(sample=track.samples[index]).pts=(sample.pts-initPTS)/inputTimeScale;this.observer.trigger(events.default.FRAG_PARSING_USERDATA,{samples:track.samples})}track.samples=[]},_proto._PTSNormalize=function _PTSNormalize(value,reference){var offset;if(void 0===reference)return value;for(offset=reference<value?-8589934592:8589934592;Math.abs(value-reference)>4294967296;)value+=offset;return value},MP4Remuxer}(),passthrough_remuxer=function(){function PassThroughRemuxer(observer){this.observer=observer}var _proto=PassThroughRemuxer.prototype;return _proto.destroy=function destroy(){},_proto.resetTimeStamp=function resetTimeStamp(){},_proto.resetInitSegment=function resetInitSegment(){},_proto.remux=function remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset,rawData){var observer=this.observer,streamType="";audioTrack&&(streamType+="audio"),videoTrack&&(streamType+="video"),observer.trigger(events.default.FRAG_PARSING_DATA,{data1:rawData,startPTS:timeOffset,startDTS:timeOffset,type:streamType,hasAudio:!!audioTrack,hasVideo:!!videoTrack,nb:1,dropped:0}),observer.trigger(events.default.FRAG_PARSED)},PassThroughRemuxer}(),global=Object(get_self_scope.getSelfScope)();try{now=global.performance.now.bind(global.performance)}catch(err){logger.logger.debug("Unable to use Performance API on this environment"),now=global.Date.now}var demuxer_inline_DemuxerInline=function(){function DemuxerInline(observer,typeSupported,config,vendor){this.observer=observer,this.typeSupported=typeSupported,this.config=config,this.vendor=vendor}var _proto=DemuxerInline.prototype;return _proto.destroy=function destroy(){var demuxer=this.demuxer;demuxer&&demuxer.destroy()},_proto.push=function push(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS){var _this=this;if(data.byteLength>0&&null!=decryptdata&&null!=decryptdata.key&&"AES-128"===decryptdata.method){var decrypter=this.decrypter;null==decrypter&&(decrypter=this.decrypter=new crypt_decrypter.default(this.observer,this.config));var startTime=now();decrypter.decrypt(data,decryptdata.key.buffer,decryptdata.iv.buffer,(function(decryptedData){var endTime=now();_this.observer.trigger(events.default.FRAG_DECRYPTED,{stats:{tstart:startTime,tdecrypt:endTime}}),_this.pushDecrypted(new Uint8Array(decryptedData),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)}))}else this.pushDecrypted(new Uint8Array(data),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)},_proto.pushDecrypted=function pushDecrypted(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS){var demuxer=this.demuxer;if(!demuxer||(discontinuity||trackSwitch)&&!this.probe(data)){for(var observer=this.observer,typeSupported=this.typeSupported,config=this.config,muxConfig=[{demux:tsdemuxer,remux:mp4_remuxer},{demux:mp4demuxer.default,remux:passthrough_remuxer},{demux:aacdemuxer,remux:mp4_remuxer},{demux:mp3demuxer,remux:mp4_remuxer}],i=0,len=muxConfig.length;i<len;i++){var mux=muxConfig[i],probe=mux.demux.probe;if(probe(data)){var _remuxer=this.remuxer=new mux.remux(observer,config,typeSupported,this.vendor);demuxer=new mux.demux(observer,_remuxer,config,typeSupported),this.probe=probe;break}}if(!demuxer)return void observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=demuxer}var remuxer=this.remuxer;(discontinuity||trackSwitch)&&(demuxer.resetInitSegment(initSegment,audioCodec,videoCodec,duration),remuxer.resetInitSegment()),discontinuity&&(demuxer.resetTimeStamp(defaultInitPTS),remuxer.resetTimeStamp(defaultInitPTS)),"function"==typeof demuxer.setDecryptData&&demuxer.setDecryptData(decryptdata),demuxer.append(data,timeOffset,contiguous,accurateTimeOffset)},DemuxerInline}();__webpack_exports__.default=demuxer_inline_DemuxerInline},"./src/demux/demuxer-worker.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _demux_demuxer_inline__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/demux/demuxer-inline.js"),_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/events.js"),_utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/logger.js"),eventemitter3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/eventemitter3/index.js");__webpack_exports__.default=function DemuxerWorker(self){var observer=new eventemitter3__WEBPACK_IMPORTED_MODULE_3__.EventEmitter;observer.trigger=function trigger(event){for(var _len=arguments.length,data=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function off(event){for(var _len2=arguments.length,data=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))};var forwardMessage=function forwardMessage(ev,data){self.postMessage({event:ev,data})};self.addEventListener("message",(function(ev){var data=ev.data;switch(data.cmd){case"init":var config=JSON.parse(data.config);self.demuxer=new _demux_demuxer_inline__WEBPACK_IMPORTED_MODULE_0__.default(observer,data.typeSupported,config,data.vendor),Object(_utils_logger__WEBPACK_IMPORTED_MODULE_2__.enableLogs)(config.debug),forwardMessage("init",null);break;case"demux":self.demuxer.push(data.data,data.decryptdata,data.initSegment,data.audioCodec,data.videoCodec,data.timeOffset,data.discontinuity,data.trackSwitch,data.contiguous,data.duration,data.accurateTimeOffset,data.defaultInitPTS)}})),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_DECRYPTED,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSED,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.ERROR,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_METADATA,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_USERDATA,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.INIT_PTS_FOUND,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_DATA,(function(ev,data){var transferable=[],message={event:ev,data};data.data1&&(message.data1=data.data1.buffer,transferable.push(data.data1.buffer),delete data.data1),data.data2&&(message.data2=data.data2.buffer,transferable.push(data.data2.buffer),delete data.data2),self.postMessage(message,transferable)}))}},"./src/demux/id3.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"utf8ArrayToStr",(function(){return utf8ArrayToStr}));var decoder,_utils_get_self_scope__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/get-self-scope.js"),ID3=function(){function ID3(){}return ID3.isHeader=function isHeader(data,offset){return offset+10<=data.length&&73===data[offset]&&68===data[offset+1]&&51===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},ID3.isFooter=function isFooter(data,offset){return offset+10<=data.length&&51===data[offset]&&68===data[offset+1]&&73===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},ID3.getID3Data=function getID3Data(data,offset){for(var front=offset,length=0;ID3.isHeader(data,offset);){length+=10,length+=ID3._readSize(data,offset+6),ID3.isFooter(data,offset+10)&&(length+=10),offset+=length}if(length>0)return data.subarray(front,front+length)},ID3._readSize=function _readSize(data,offset){var size=0;return size=(127&data[offset])<<21,size|=(127&data[offset+1])<<14,size|=(127&data[offset+2])<<7,size|=127&data[offset+3]},ID3.getTimeStamp=function getTimeStamp(data){for(var frames=ID3.getID3Frames(data),i=0;i<frames.length;i++){var frame=frames[i];if(ID3.isTimeStampFrame(frame))return ID3._readTimeStamp(frame)}},ID3.isTimeStampFrame=function isTimeStampFrame(frame){return frame&&"PRIV"===frame.key&&"com.apple.streaming.transportStreamTimestamp"===frame.info},ID3._getFrameData=function _getFrameData(data){var type=String.fromCharCode(data[0],data[1],data[2],data[3]),size=ID3._readSize(data,4);return{type,size,data:data.subarray(10,10+size)}},ID3.getID3Frames=function getID3Frames(id3Data){for(var offset=0,frames=[];ID3.isHeader(id3Data,offset);){for(var size=ID3._readSize(id3Data,offset+6),end=(offset+=10)+size;offset+8<end;){var frameData=ID3._getFrameData(id3Data.subarray(offset)),frame=ID3._decodeFrame(frameData);frame&&frames.push(frame),offset+=frameData.size+10}ID3.isFooter(id3Data,offset)&&(offset+=10)}return frames},ID3._decodeFrame=function _decodeFrame(frame){return"PRIV"===frame.type?ID3._decodePrivFrame(frame):"T"===frame.type[0]?ID3._decodeTextFrame(frame):"W"===frame.type[0]?ID3._decodeURLFrame(frame):void 0},ID3._readTimeStamp=function _readTimeStamp(timeStampFrame){if(8===timeStampFrame.data.byteLength){var data=new Uint8Array(timeStampFrame.data),pts33Bit=1&data[3],timestamp=(data[4]<<23)+(data[5]<<15)+(data[6]<<7)+data[7];return timestamp/=45,pts33Bit&&(timestamp+=47721858.84),Math.round(timestamp)}},ID3._decodePrivFrame=function _decodePrivFrame(frame){if(!(frame.size<2)){var owner=ID3._utf8ArrayToStr(frame.data,!0),privateData=new Uint8Array(frame.data.subarray(owner.length+1));return{key:frame.type,info:owner,data:privateData.buffer}}},ID3._decodeTextFrame=function _decodeTextFrame(frame){if(!(frame.size<2)){if("TXXX"===frame.type){var index=1,description=ID3._utf8ArrayToStr(frame.data.subarray(index),!0);index+=description.length+1;var value=ID3._utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var text=ID3._utf8ArrayToStr(frame.data.subarray(1));return{key:frame.type,data:text}}},ID3._decodeURLFrame=function _decodeURLFrame(frame){if("WXXX"===frame.type){if(frame.size<2)return;var index=1,description=ID3._utf8ArrayToStr(frame.data.subarray(index));index+=description.length+1;var value=ID3._utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var url=ID3._utf8ArrayToStr(frame.data);return{key:frame.type,data:url}},ID3._utf8ArrayToStr=function _utf8ArrayToStr(array,exitOnNull){void 0===exitOnNull&&(exitOnNull=!1);var decoder=getTextDecoder();if(decoder){var decoded=decoder.decode(array);if(exitOnNull){var idx=decoded.indexOf("\0");return-1!==idx?decoded.substring(0,idx):decoded}return decoded.replace(/\0/g,"")}for(var c,char2,char3,len=array.length,out="",i=0;i<len;){if(0===(c=array[i++])&&exitOnNull)return out;if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:out+=String.fromCharCode(c);break;case 12:case 13:char2=array[i++],out+=String.fromCharCode((31&c)<<6|63&char2);break;case 14:char2=array[i++],char3=array[i++],out+=String.fromCharCode((15&c)<<12|(63&char2)<<6|(63&char3)<<0)}}return out},ID3}();function getTextDecoder(){var global=Object(_utils_get_self_scope__WEBPACK_IMPORTED_MODULE_0__.getSelfScope)();return decoder||void 0===global.TextDecoder||(decoder=new global.TextDecoder("utf-8")),decoder}var utf8ArrayToStr=ID3._utf8ArrayToStr;__webpack_exports__.default=ID3},"./src/demux/mp4demuxer.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/logger.js"),_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/events.js"),UINT32_MAX=Math.pow(2,32)-1,MP4Demuxer=function(){function MP4Demuxer(observer,remuxer){this.observer=observer,this.remuxer=remuxer}var _proto=MP4Demuxer.prototype;return _proto.resetTimeStamp=function resetTimeStamp(initPTS){this.initPTS=initPTS},_proto.resetInitSegment=function resetInitSegment(initSegment,audioCodec,videoCodec,duration){if(initSegment&&initSegment.byteLength){var initData=this.initData=MP4Demuxer.parseInitSegment(initSegment);null==audioCodec&&(audioCodec="mp4a.40.5"),null==videoCodec&&(videoCodec="avc1.42e01e");var tracks={};initData.audio&&initData.video?tracks.audiovideo={container:"video/mp4",codec:audioCodec+","+videoCodec,initSegment:duration?initSegment:null}:(initData.audio&&(tracks.audio={container:"audio/mp4",codec:audioCodec,initSegment:duration?initSegment:null}),initData.video&&(tracks.video={container:"video/mp4",codec:videoCodec,initSegment:duration?initSegment:null})),this.observer.trigger(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_INIT_SEGMENT,{tracks})}else audioCodec&&(this.audioCodec=audioCodec),videoCodec&&(this.videoCodec=videoCodec)},MP4Demuxer.probe=function probe(data){return MP4Demuxer.findBox({data,start:0,end:Math.min(data.length,16384)},["moof"]).length>0},MP4Demuxer.bin2str=function bin2str(buffer){return String.fromCharCode.apply(null,buffer)},MP4Demuxer.readUint16=function readUint16(buffer,offset){buffer.data&&(offset+=buffer.start,buffer=buffer.data);var val=buffer[offset]<<8|buffer[offset+1];return val<0?65536+val:val},MP4Demuxer.readUint32=function readUint32(buffer,offset){buffer.data&&(offset+=buffer.start,buffer=buffer.data);var val=buffer[offset]<<24|buffer[offset+1]<<16|buffer[offset+2]<<8|buffer[offset+3];return val<0?4294967296+val:val},MP4Demuxer.writeUint32=function writeUint32(buffer,offset,value){buffer.data&&(offset+=buffer.start,buffer=buffer.data),buffer[offset]=value>>24,buffer[offset+1]=value>>16&255,buffer[offset+2]=value>>8&255,buffer[offset+3]=255&value},MP4Demuxer.findBox=function findBox(data,path){var i,size,end,subresults,start,endbox,results=[];if(data.data?(start=data.start,end=data.end,data=data.data):(start=0,end=data.byteLength),!path.length)return null;for(i=start;i<end;)endbox=(size=MP4Demuxer.readUint32(data,i))>1?i+size:end,MP4Demuxer.bin2str(data.subarray(i+4,i+8))===path[0]&&(1===path.length?results.push({data,start:i+8,end:endbox}):(subresults=MP4Demuxer.findBox({data,start:i+8,end:endbox},path.slice(1))).length&&(results=results.concat(subresults))),i=endbox;return results},MP4Demuxer.parseSegmentIndex=function parseSegmentIndex(initSegment){var references,moov=MP4Demuxer.findBox(initSegment,["moov"])[0],moovEndOffset=moov?moov.end:null,index=0,sidx=MP4Demuxer.findBox(initSegment,["sidx"]);if(!sidx||!sidx[0])return null;references=[];var version=(sidx=sidx[0]).data[0];index=0===version?8:16;var timescale=MP4Demuxer.readUint32(sidx,index);index+=4;index+=0===version?8:16,index+=2;var startByte=sidx.end+0,referencesCount=MP4Demuxer.readUint16(sidx,index);index+=2;for(var i=0;i<referencesCount;i++){var referenceIndex=index,referenceInfo=MP4Demuxer.readUint32(sidx,referenceIndex);referenceIndex+=4;var referenceSize=2147483647&referenceInfo;if(1===(2147483648&referenceInfo)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var subsegmentDuration=MP4Demuxer.readUint32(sidx,referenceIndex);referenceIndex+=4,references.push({referenceSize,subsegmentDuration,info:{duration:subsegmentDuration/timescale,start:startByte,end:startByte+referenceSize-1}}),startByte+=referenceSize,index=referenceIndex+=4}return{earliestPresentationTime:0,timescale,version,referencesCount,references,moovEndOffset}},MP4Demuxer.parseInitSegment=function parseInitSegment(initSegment){var result=[];return MP4Demuxer.findBox(initSegment,["moov","trak"]).forEach((function(trak){var tkhd=MP4Demuxer.findBox(trak,["tkhd"])[0];if(tkhd){var version=tkhd.data[tkhd.start],index=0===version?12:20,trackId=MP4Demuxer.readUint32(tkhd,index),mdhd=MP4Demuxer.findBox(trak,["mdia","mdhd"])[0];if(mdhd){index=0===(version=mdhd.data[mdhd.start])?12:20;var timescale=MP4Demuxer.readUint32(mdhd,index),hdlr=MP4Demuxer.findBox(trak,["mdia","hdlr"])[0];if(hdlr){var type={soun:"audio",vide:"video"}[MP4Demuxer.bin2str(hdlr.data.subarray(hdlr.start+8,hdlr.start+12))];if(type){var codecBox=MP4Demuxer.findBox(trak,["mdia","minf","stbl","stsd"]);if(codecBox.length){codecBox=codecBox[0];var codecType=MP4Demuxer.bin2str(codecBox.data.subarray(codecBox.start+12,codecBox.start+16));_utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.log("MP4Demuxer:"+type+":"+codecType+" found")}result[trackId]={timescale,type},result[type]={timescale,id:trackId}}}}}})),result},MP4Demuxer.getStartDTS=function getStartDTS(initData,fragment){var trafs,baseTimes,result;return trafs=MP4Demuxer.findBox(fragment,["moof","traf"]),baseTimes=[].concat.apply([],trafs.map((function(traf){return MP4Demuxer.findBox(traf,["tfhd"]).map((function(tfhd){var id,scale;return id=MP4Demuxer.readUint32(tfhd,4),scale=initData[id].timescale||9e4,MP4Demuxer.findBox(traf,["tfdt"]).map((function(tfdt){var version,result;return version=tfdt.data[tfdt.start],result=MP4Demuxer.readUint32(tfdt,4),1===version&&(result*=Math.pow(2,32),result+=MP4Demuxer.readUint32(tfdt,8)),result}))[0]/scale}))}))),result=Math.min.apply(null,baseTimes),isFinite(result)?result:0},MP4Demuxer.offsetStartDTS=function offsetStartDTS(initData,fragment,timeOffset){MP4Demuxer.findBox(fragment,["moof","traf"]).map((function(traf){return MP4Demuxer.findBox(traf,["tfhd"]).map((function(tfhd){var id=MP4Demuxer.readUint32(tfhd,4),timescale=initData[id].timescale||9e4;MP4Demuxer.findBox(traf,["tfdt"]).map((function(tfdt){var version=tfdt.data[tfdt.start],baseMediaDecodeTime=MP4Demuxer.readUint32(tfdt,4);if(0===version)MP4Demuxer.writeUint32(tfdt,4,baseMediaDecodeTime-timeOffset*timescale);else{baseMediaDecodeTime*=Math.pow(2,32),baseMediaDecodeTime+=MP4Demuxer.readUint32(tfdt,8),baseMediaDecodeTime-=timeOffset*timescale,baseMediaDecodeTime=Math.max(baseMediaDecodeTime,0);var upper=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1)),lower=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));MP4Demuxer.writeUint32(tfdt,4,upper),MP4Demuxer.writeUint32(tfdt,8,lower)}}))}))}))},_proto.append=function append(data,timeOffset,contiguous,accurateTimeOffset){var initData=this.initData;initData||(this.resetInitSegment(data,this.audioCodec,this.videoCodec,!1),initData=this.initData);var startDTS,initPTS=this.initPTS;if(void 0===initPTS){var _startDTS=MP4Demuxer.getStartDTS(initData,data);this.initPTS=initPTS=_startDTS-timeOffset,this.observer.trigger(_events__WEBPACK_IMPORTED_MODULE_1__.default.INIT_PTS_FOUND,{initPTS})}MP4Demuxer.offsetStartDTS(initData,data,initPTS),startDTS=MP4Demuxer.getStartDTS(initData,data),this.remuxer.remux(initData.audio,initData.video,null,null,startDTS,contiguous,accurateTimeOffset,data)},_proto.destroy=function destroy(){},MP4Demuxer}();__webpack_exports__.default=MP4Demuxer},"./src/errors.ts":function(module,__webpack_exports__,__webpack_require__){var ErrorTypes,ErrorDetails;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ErrorTypes",(function(){return ErrorTypes})),__webpack_require__.d(__webpack_exports__,"ErrorDetails",(function(){return ErrorDetails})),function(ErrorTypes){ErrorTypes.NETWORK_ERROR="networkError",ErrorTypes.MEDIA_ERROR="mediaError",ErrorTypes.KEY_SYSTEM_ERROR="keySystemError",ErrorTypes.MUX_ERROR="muxError",ErrorTypes.OTHER_ERROR="otherError"}(ErrorTypes||(ErrorTypes={})),function(ErrorDetails){ErrorDetails.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",ErrorDetails.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",ErrorDetails.KEY_SYSTEM_NO_SESSION="keySystemNoSession",ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",ErrorDetails.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",ErrorDetails.MANIFEST_LOAD_ERROR="manifestLoadError",ErrorDetails.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",ErrorDetails.MANIFEST_PARSING_ERROR="manifestParsingError",ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",ErrorDetails.LEVEL_LOAD_ERROR="levelLoadError",ErrorDetails.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",ErrorDetails.LEVEL_SWITCH_ERROR="levelSwitchError",ErrorDetails.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",ErrorDetails.FRAG_LOAD_ERROR="fragLoadError",ErrorDetails.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",ErrorDetails.FRAG_DECRYPT_ERROR="fragDecryptError",ErrorDetails.FRAG_PARSING_ERROR="fragParsingError",ErrorDetails.REMUX_ALLOC_ERROR="remuxAllocError",ErrorDetails.KEY_LOAD_ERROR="keyLoadError",ErrorDetails.KEY_LOAD_TIMEOUT="keyLoadTimeOut",ErrorDetails.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",ErrorDetails.BUFFER_APPEND_ERROR="bufferAppendError",ErrorDetails.BUFFER_APPENDING_ERROR="bufferAppendingError",ErrorDetails.BUFFER_STALLED_ERROR="bufferStalledError",ErrorDetails.BUFFER_FULL_ERROR="bufferFullError",ErrorDetails.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",ErrorDetails.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",ErrorDetails.INTERNAL_EXCEPTION="internalException"}(ErrorDetails||(ErrorDetails={}))},"./src/events.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_exports__.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return hls_Hls}));var cues_namespaceObject={};__webpack_require__.r(cues_namespaceObject),__webpack_require__.d(cues_namespaceObject,"newCue",(function(){return newCue}));var PlaylistContextType,PlaylistLevelType,url_toolkit=__webpack_require__("./node_modules/url-toolkit/src/url-toolkit.js"),errors=__webpack_require__("./src/errors.ts"),number_isFinite=__webpack_require__("./src/polyfills/number-isFinite.js"),events=__webpack_require__("./src/events.js"),logger=__webpack_require__("./src/utils/logger.js"),FORBIDDEN_EVENT_NAMES={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},event_handler=function(){function EventHandler(hls){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=hls,this.onEvent=this.onEvent.bind(this);for(var _len=arguments.length,events=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)events[_key-1]=arguments[_key];this.handledEvents=events,this.useGenericHandler=!0,this.registerListeners()}var _proto=EventHandler.prototype;return _proto.destroy=function destroy(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},_proto.onHandlerDestroying=function onHandlerDestroying(){},_proto.onHandlerDestroyed=function onHandlerDestroyed(){},_proto.isEventHandler=function isEventHandler(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},_proto.registerListeners=function registerListeners(){this.isEventHandler()&&this.handledEvents.forEach((function(event){if(FORBIDDEN_EVENT_NAMES[event])throw new Error("Forbidden event-name: "+event);this.hls.on(event,this.onEvent)}),this)},_proto.unregisterListeners=function unregisterListeners(){this.isEventHandler()&&this.handledEvents.forEach((function(event){this.hls.off(event,this.onEvent)}),this)},_proto.onEvent=function onEvent(event,data){this.onEventGeneric(event,data)},_proto.onEventGeneric=function onEventGeneric(event,data){try{(function eventToFunction(event,data){var funcName="on"+event.replace("hls","");if("function"!=typeof this[funcName])throw new Error("Event "+event+" has no generic handler in this "+this.constructor.name+" class (tried "+funcName+")");return this[funcName].bind(this,data)}).call(this,event,data).call()}catch(err){logger.logger.error("An internal error happened while handling event "+event+'. Error message: "'+err.message+'". Here is a stacktrace:',err),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.OTHER_ERROR,details:errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event,err})}},EventHandler}();!function(PlaylistContextType){PlaylistContextType.MANIFEST="manifest",PlaylistContextType.LEVEL="level",PlaylistContextType.AUDIO_TRACK="audioTrack",PlaylistContextType.SUBTITLE_TRACK="subtitleTrack"}(PlaylistContextType||(PlaylistContextType={})),function(PlaylistLevelType){PlaylistLevelType.MAIN="main",PlaylistLevelType.AUDIO="audio",PlaylistLevelType.SUBTITLE="subtitle"}(PlaylistLevelType||(PlaylistLevelType={}));var mp4demuxer=__webpack_require__("./src/demux/mp4demuxer.js");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ElementaryStreamTypes,level_key_LevelKey=function(){function LevelKey(baseURI,relativeURI){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=baseURI,this.reluri=relativeURI}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(LevelKey,[{key:"uri",get:function get(){return!this._uri&&this.reluri&&(this._uri=Object(url_toolkit.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),LevelKey}();function fragment_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}!function(ElementaryStreamTypes){ElementaryStreamTypes.AUDIO="audio",ElementaryStreamTypes.VIDEO="video"}(ElementaryStreamTypes||(ElementaryStreamTypes={}));var fragment_Fragment=function(){function Fragment(){var _this$_elementaryStre;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((_this$_elementaryStre={})[ElementaryStreamTypes.AUDIO]=!1,_this$_elementaryStre[ElementaryStreamTypes.VIDEO]=!1,_this$_elementaryStre),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var _proto=Fragment.prototype;return _proto.setByteRange=function setByteRange(value,previousFrag){var params=value.split("@",2),byteRange=[];1===params.length?byteRange[0]=previousFrag?previousFrag.byteRangeEndOffset:0:byteRange[0]=parseInt(params[1]),byteRange[1]=parseInt(params[0])+byteRange[0],this._byteRange=byteRange},_proto.addElementaryStream=function addElementaryStream(type){this._elementaryStreams[type]=!0},_proto.hasElementaryStream=function hasElementaryStream(type){return!0===this._elementaryStreams[type]},_proto.createInitializationVector=function createInitializationVector(segmentNumber){for(var uint8View=new Uint8Array(16),i=12;i<16;i++)uint8View[i]=segmentNumber>>8*(15-i)&255;return uint8View},_proto.setDecryptDataFromLevelKey=function setDecryptDataFromLevelKey(levelkey,segmentNumber){var decryptdata=levelkey;return levelkey&&levelkey.method&&levelkey.uri&&!levelkey.iv&&((decryptdata=new level_key_LevelKey(levelkey.baseuri,levelkey.reluri)).method=levelkey.method,decryptdata.iv=this.createInitializationVector(segmentNumber)),decryptdata},function fragment_createClass(Constructor,protoProps,staticProps){return protoProps&&fragment_defineProperties(Constructor.prototype,protoProps),staticProps&&fragment_defineProperties(Constructor,staticProps),Constructor}(Fragment,[{key:"url",get:function get(){return!this._url&&this.relurl&&(this._url=Object(url_toolkit.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function set(value){this._url=value}},{key:"byteRange",get:function get(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function get(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function get(){return this.byteRange[1]}},{key:"decryptdata",get:function get(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var sn=this.sn;"number"!=typeof sn&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&logger.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),sn=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,sn)}return this._decryptdata}},{key:"endProgramDateTime",get:function get(){if(null===this.programDateTime)return null;if(!Object(number_isFinite.isFiniteNumber)(this.programDateTime))return null;var duration=Object(number_isFinite.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*duration}},{key:"encrypted",get:function get(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]),Fragment}();function level_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var level_Level=function(){function Level(baseUrl){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=baseUrl,this.version=null}return function level_createClass(Constructor,protoProps,staticProps){return protoProps&&level_defineProperties(Constructor.prototype,protoProps),staticProps&&level_defineProperties(Constructor,staticProps),Constructor}(Level,[{key:"hasProgramDateTime",get:function get(){return!(!this.fragments[0]||!Object(number_isFinite.isFiniteNumber)(this.fragments[0].programDateTime))}}]),Level}(),DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,attr_list=function(){function AttrList(attrs){for(var attr in"string"==typeof attrs&&(attrs=AttrList.parseAttrList(attrs)),attrs)attrs.hasOwnProperty(attr)&&(this[attr]=attrs[attr])}var _proto=AttrList.prototype;return _proto.decimalInteger=function decimalInteger(attrName){var intValue=parseInt(this[attrName],10);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},_proto.hexadecimalInteger=function hexadecimalInteger(attrName){if(this[attrName]){var stringValue=(this[attrName]||"0x").slice(2);stringValue=(1&stringValue.length?"0":"")+stringValue;for(var value=new Uint8Array(stringValue.length/2),i=0;i<stringValue.length/2;i++)value[i]=parseInt(stringValue.slice(2*i,2*i+2),16);return value}return null},_proto.hexadecimalIntegerAsNumber=function hexadecimalIntegerAsNumber(attrName){var intValue=parseInt(this[attrName],16);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},_proto.decimalFloatingPoint=function decimalFloatingPoint(attrName){return parseFloat(this[attrName])},_proto.enumeratedString=function enumeratedString(attrName){return this[attrName]},_proto.decimalResolution=function decimalResolution(attrName){var res=DECIMAL_RESOLUTION_REGEX.exec(this[attrName]);if(null!==res)return{width:parseInt(res[1],10),height:parseInt(res[2],10)}},AttrList.parseAttrList=function parseAttrList(input){var match,attrs={};for(ATTR_LIST_REGEX.lastIndex=0;null!==(match=ATTR_LIST_REGEX.exec(input));){var value=match[2];0===value.indexOf('"')&&value.lastIndexOf('"')===value.length-1&&(value=value.slice(1,-1)),attrs[match[1]]=value}return attrs},AttrList}(),sampleEntryCodesISO={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function isCodecSupportedInMp4(codec,type){return MediaSource.isTypeSupported((type||"video")+'/mp4;codecs="'+codec+'"')}var MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),LEVEL_PLAYLIST_REGEX_SLOW=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,MP4_REGEX_SUFFIX=/\.(mp4|m4s|m4v|m4a)$/i,m3u8_parser_M3U8Parser=function(){function M3U8Parser(){}return M3U8Parser.findGroup=function findGroup(groups,mediaGroupId){for(var i=0;i<groups.length;i++){var group=groups[i];if(group.id===mediaGroupId)return group}},M3U8Parser.convertAVC1ToAVCOTI=function convertAVC1ToAVCOTI(codec){var result,avcdata=codec.split(".");return avcdata.length>2?(result=avcdata.shift()+".",result+=parseInt(avcdata.shift()).toString(16),result+=("000"+parseInt(avcdata.shift()).toString(16)).substr(-4)):result=codec,result},M3U8Parser.resolve=function resolve(url,baseUrl){return url_toolkit.buildAbsoluteURL(baseUrl,url,{alwaysNormalize:!0})},M3U8Parser.parseMasterPlaylist=function parseMasterPlaylist(string,baseurl){var result,levels=[];function setCodecs(codecs,level){["video","audio"].forEach((function(type){var filtered=codecs.filter((function(codec){return function isCodecType(codec,type){var typeCodes=sampleEntryCodesISO[type];return!!typeCodes&&!0===typeCodes[codec.slice(0,4)]}(codec,type)}));if(filtered.length){var preferred=filtered.filter((function(codec){return 0===codec.lastIndexOf("avc1",0)||0===codec.lastIndexOf("mp4a",0)}));level[type+"Codec"]=preferred.length>0?preferred[0]:filtered[0],codecs=codecs.filter((function(codec){return-1===filtered.indexOf(codec)}))}})),level.unknownCodecs=codecs}for(MASTER_PLAYLIST_REGEX.lastIndex=0;null!=(result=MASTER_PLAYLIST_REGEX.exec(string));){var level={},attrs=level.attrs=new attr_list(result[1]);level.url=M3U8Parser.resolve(result[2],baseurl);var resolution=attrs.decimalResolution("RESOLUTION");resolution&&(level.width=resolution.width,level.height=resolution.height),level.bitrate=attrs.decimalInteger("AVERAGE-BANDWIDTH")||attrs.decimalInteger("BANDWIDTH"),level.name=attrs.NAME,setCodecs([].concat((attrs.CODECS||"").split(/[ ,]+/)),level),level.videoCodec&&-1!==level.videoCodec.indexOf("avc1")&&(level.videoCodec=M3U8Parser.convertAVC1ToAVCOTI(level.videoCodec)),levels.push(level)}return levels},M3U8Parser.parseMasterPlaylistMedia=function parseMasterPlaylistMedia(string,baseurl,type,audioGroups){var result;void 0===audioGroups&&(audioGroups=[]);var medias=[],id=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;null!==(result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string));){var attrs=new attr_list(result[1]);if(attrs.TYPE===type){var media={id:id++,groupId:attrs["GROUP-ID"],name:attrs.NAME||attrs.LANGUAGE,type,default:"YES"===attrs.DEFAULT,autoselect:"YES"===attrs.AUTOSELECT,forced:"YES"===attrs.FORCED,lang:attrs.LANGUAGE};if(attrs.URI&&(media.url=M3U8Parser.resolve(attrs.URI,baseurl)),audioGroups.length){var groupCodec=M3U8Parser.findGroup(audioGroups,media.groupId);media.audioCodec=groupCodec?groupCodec.codec:audioGroups[0].codec}medias.push(media)}}return medias},M3U8Parser.parseLevelPlaylist=function parseLevelPlaylist(string,baseurl,id,type,levelUrlId){var result,i,levelkey,currentSN=0,totalduration=0,level=new level_Level(baseurl),discontinuityCounter=0,prevFrag=null,frag=new fragment_Fragment,firstPdtIndex=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0;null!==(result=LEVEL_PLAYLIST_REGEX_FAST.exec(string));){var duration=result[1];if(duration){frag.duration=parseFloat(duration);var title=(" "+result[2]).slice(1);frag.title=title||null,frag.tagList.push(title?["INF",duration,title]:["INF",duration])}else if(result[3]){if(Object(number_isFinite.isFiniteNumber)(frag.duration)){var sn=currentSN++;frag.type=type,frag.start=totalduration,levelkey&&(frag.levelkey=levelkey),frag.sn=sn,frag.level=id,frag.cc=discontinuityCounter,frag.urlId=levelUrlId,frag.baseurl=baseurl,frag.relurl=(" "+result[3]).slice(1),assignProgramDateTime(frag,prevFrag),level.fragments.push(frag),prevFrag=frag,totalduration+=frag.duration,frag=new fragment_Fragment}}else if(result[4]){var data=(" "+result[4]).slice(1);prevFrag?frag.setByteRange(data,prevFrag):frag.setByteRange(data)}else if(result[5])frag.rawProgramDateTime=(" "+result[5]).slice(1),frag.tagList.push(["PROGRAM-DATE-TIME",frag.rawProgramDateTime]),null===firstPdtIndex&&(firstPdtIndex=level.fragments.length);else{if(!(result=result[0].match(LEVEL_PLAYLIST_REGEX_SLOW))){logger.logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<result.length&&void 0===result[i];i++);var value1=(" "+result[i+1]).slice(1),value2=(" "+result[i+2]).slice(1);switch(result[i]){case"#":frag.tagList.push(value2?[value1,value2]:[value1]);break;case"PLAYLIST-TYPE":level.type=value1.toUpperCase();break;case"MEDIA-SEQUENCE":currentSN=level.startSN=parseInt(value1);break;case"TARGETDURATION":level.targetduration=parseFloat(value1);break;case"VERSION":level.version=parseInt(value1);break;case"EXTM3U":break;case"ENDLIST":level.live=!1;break;case"DIS":discontinuityCounter++,frag.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":discontinuityCounter=parseInt(value1);break;case"KEY":var keyAttrs=new attr_list(value1),decryptmethod=keyAttrs.enumeratedString("METHOD"),decrypturi=keyAttrs.URI,decryptiv=keyAttrs.hexadecimalInteger("IV");decryptmethod&&(levelkey=new level_key_LevelKey(baseurl,decrypturi),decrypturi&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(decryptmethod)>=0&&(levelkey.method=decryptmethod,levelkey.key=null,levelkey.iv=decryptiv));break;case"START":var startTimeOffset=new attr_list(value1).decimalFloatingPoint("TIME-OFFSET");Object(number_isFinite.isFiniteNumber)(startTimeOffset)&&(level.startTimeOffset=startTimeOffset);break;case"MAP":var mapAttrs=new attr_list(value1);frag.relurl=mapAttrs.URI,mapAttrs.BYTERANGE&&frag.setByteRange(mapAttrs.BYTERANGE),frag.baseurl=baseurl,frag.level=id,frag.type=type,frag.sn="initSegment",level.initSegment=frag,(frag=new fragment_Fragment).rawProgramDateTime=level.initSegment.rawProgramDateTime;break;default:logger.logger.warn("line parsed but not handled: "+result)}}}return(frag=prevFrag)&&!frag.relurl&&(level.fragments.pop(),totalduration-=frag.duration),level.totalduration=totalduration,level.averagetargetduration=totalduration/level.fragments.length,level.endSN=currentSN-1,level.startCC=level.fragments[0]?level.fragments[0].cc:0,level.endCC=discontinuityCounter,!level.initSegment&&level.fragments.length&&level.fragments.every((function(frag){return MP4_REGEX_SUFFIX.test(frag.relurl)}))&&(logger.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(frag=new fragment_Fragment).relurl=level.fragments[0].relurl,frag.baseurl=baseurl,frag.level=id,frag.type=type,frag.sn="initSegment",level.initSegment=frag,level.needSidxRanges=!0),firstPdtIndex&&function backfillProgramDateTimes(fragments,startIndex){for(var fragPrev=fragments[startIndex],i=startIndex-1;i>=0;i--){var frag=fragments[i];frag.programDateTime=fragPrev.programDateTime-1e3*frag.duration,fragPrev=frag}}(level.fragments,firstPdtIndex),level},M3U8Parser}();function assignProgramDateTime(frag,prevFrag){frag.rawProgramDateTime?frag.programDateTime=Date.parse(frag.rawProgramDateTime):prevFrag&&prevFrag.programDateTime&&(frag.programDateTime=prevFrag.endProgramDateTime),Object(number_isFinite.isFiniteNumber)(frag.programDateTime)||(frag.programDateTime=null,frag.rawProgramDateTime=null)}var performance=window.performance,playlist_loader=function(_EventHandler){function PlaylistLoader(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MANIFEST_LOADING,events.default.LEVEL_LOADING,events.default.AUDIO_TRACK_LOADING,events.default.SUBTITLE_TRACK_LOADING)||this).loaders={},_this}!function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(PlaylistLoader,_EventHandler),PlaylistLoader.canHaveQualityLevels=function canHaveQualityLevels(type){return type!==PlaylistContextType.AUDIO_TRACK&&type!==PlaylistContextType.SUBTITLE_TRACK},PlaylistLoader.mapContextToLevelType=function mapContextToLevelType(context){switch(context.type){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}},PlaylistLoader.getResponseUrl=function getResponseUrl(response,context){var url=response.url;return void 0!==url&&0!==url.indexOf("data:")||(url=context.url),url};var _proto=PlaylistLoader.prototype;return _proto.createInternalLoader=function createInternalLoader(context){var config=this.hls.config,PLoader=config.pLoader,Loader=config.loader,loader=new(PLoader||Loader)(config);return context.loader=loader,this.loaders[context.type]=loader,loader},_proto.getInternalLoader=function getInternalLoader(context){return this.loaders[context.type]},_proto.resetInternalLoader=function resetInternalLoader(contextType){this.loaders[contextType]&&delete this.loaders[contextType]},_proto.destroyInternalLoaders=function destroyInternalLoaders(){for(var contextType in this.loaders){var loader=this.loaders[contextType];loader&&loader.destroy(),this.resetInternalLoader(contextType)}},_proto.destroy=function destroy(){this.destroyInternalLoaders(),_EventHandler.prototype.destroy.call(this)},_proto.onManifestLoading=function onManifestLoading(data){this.load({url:data.url,type:PlaylistContextType.MANIFEST,level:0,id:null,responseType:"text"})},_proto.onLevelLoading=function onLevelLoading(data){this.load({url:data.url,type:PlaylistContextType.LEVEL,level:data.level,id:data.id,responseType:"text"})},_proto.onAudioTrackLoading=function onAudioTrackLoading(data){this.load({url:data.url,type:PlaylistContextType.AUDIO_TRACK,level:null,id:data.id,responseType:"text"})},_proto.onSubtitleTrackLoading=function onSubtitleTrackLoading(data){this.load({url:data.url,type:PlaylistContextType.SUBTITLE_TRACK,level:null,id:data.id,responseType:"text"})},_proto.load=function load(context){var config=this.hls.config;logger.logger.debug("Loading playlist of type "+context.type+", level: "+context.level+", id: "+context.id);var maxRetry,timeout,retryDelay,maxRetryDelay,loader=this.getInternalLoader(context);if(loader){var loaderContext=loader.context;if(loaderContext&&loaderContext.url===context.url)return logger.logger.trace("playlist request ongoing"),!1;logger.logger.warn("aborting previous loader for type: "+context.type),loader.abort()}switch(context.type){case PlaylistContextType.MANIFEST:maxRetry=config.manifestLoadingMaxRetry,timeout=config.manifestLoadingTimeOut,retryDelay=config.manifestLoadingRetryDelay,maxRetryDelay=config.manifestLoadingMaxRetryTimeout;break;case PlaylistContextType.LEVEL:maxRetry=0,maxRetryDelay=0,retryDelay=0,timeout=config.levelLoadingTimeOut;break;default:maxRetry=config.levelLoadingMaxRetry,timeout=config.levelLoadingTimeOut,retryDelay=config.levelLoadingRetryDelay,maxRetryDelay=config.levelLoadingMaxRetryTimeout}loader=this.createInternalLoader(context);var loaderConfig={timeout,maxRetry,retryDelay,maxRetryDelay},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return logger.logger.debug("Calling internal loader delegate for URL: "+context.url),loader.load(context,loaderConfig,loaderCallbacks),!0},_proto.loadsuccess=function loadsuccess(response,stats,context,networkDetails){if(void 0===networkDetails&&(networkDetails=null),context.isSidxRequest)return this._handleSidxRequest(response,context),void this._handlePlaylistLoaded(response,stats,context,networkDetails);if(this.resetInternalLoader(context.type),"string"!=typeof response.data)throw new Error('expected responseType of "text" for PlaylistLoader');var string=response.data;stats.tload=performance.now(),0===string.indexOf("#EXTM3U")?string.indexOf("#EXTINF:")>0||string.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(response,stats,context,networkDetails):this._handleMasterPlaylist(response,stats,context,networkDetails):this._handleManifestParsingError(response,context,"no EXTM3U delimiter",networkDetails)},_proto.loaderror=function loaderror(response,context,networkDetails){void 0===networkDetails&&(networkDetails=null),this._handleNetworkError(context,networkDetails,!1,response)},_proto.loadtimeout=function loadtimeout(stats,context,networkDetails){void 0===networkDetails&&(networkDetails=null),this._handleNetworkError(context,networkDetails,!0)},_proto._handleMasterPlaylist=function _handleMasterPlaylist(response,stats,context,networkDetails){var hls=this.hls,string=response.data,url=PlaylistLoader.getResponseUrl(response,context),levels=m3u8_parser_M3U8Parser.parseMasterPlaylist(string,url);if(levels.length){var audioGroups=levels.map((function(level){return{id:level.attrs.AUDIO,codec:level.audioCodec}})),audioTracks=m3u8_parser_M3U8Parser.parseMasterPlaylistMedia(string,url,"AUDIO",audioGroups),subtitles=m3u8_parser_M3U8Parser.parseMasterPlaylistMedia(string,url,"SUBTITLES");if(audioTracks.length){var embeddedAudioFound=!1;audioTracks.forEach((function(audioTrack){audioTrack.url||(embeddedAudioFound=!0)})),!1===embeddedAudioFound&&levels[0].audioCodec&&!levels[0].attrs.AUDIO&&(logger.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),audioTracks.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1}))}hls.trigger(events.default.MANIFEST_LOADED,{levels,audioTracks,subtitles,url,stats,networkDetails})}else this._handleManifestParsingError(response,context,"no level found in manifest",networkDetails)},_proto._handleTrackOrLevelPlaylist=function _handleTrackOrLevelPlaylist(response,stats,context,networkDetails){var hls=this.hls,id=context.id,level=context.level,type=context.type,url=PlaylistLoader.getResponseUrl(response,context),levelUrlId=Object(number_isFinite.isFiniteNumber)(id)?id:0,levelId=Object(number_isFinite.isFiniteNumber)(level)?level:levelUrlId,levelType=PlaylistLoader.mapContextToLevelType(context),levelDetails=m3u8_parser_M3U8Parser.parseLevelPlaylist(response.data,url,levelId,levelType,levelUrlId);if(levelDetails.tload=stats.tload,type===PlaylistContextType.MANIFEST){var singleLevel={url,details:levelDetails};hls.trigger(events.default.MANIFEST_LOADED,{levels:[singleLevel],audioTracks:[],url,stats,networkDetails})}if(stats.tparsed=performance.now(),levelDetails.needSidxRanges){var sidxUrl=levelDetails.initSegment.url;this.load({url:sidxUrl,isSidxRequest:!0,type,level,levelDetails,id,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else context.levelDetails=levelDetails,this._handlePlaylistLoaded(response,stats,context,networkDetails)},_proto._handleSidxRequest=function _handleSidxRequest(response,context){if("string"==typeof response.data)throw new Error("sidx request must be made with responseType of array buffer");var sidxInfo=mp4demuxer.default.parseSegmentIndex(new Uint8Array(response.data));if(sidxInfo){var sidxReferences=sidxInfo.references,levelDetails=context.levelDetails;sidxReferences.forEach((function(segmentRef,index){var segRefInfo=segmentRef.info;if(levelDetails){var frag=levelDetails.fragments[index];0===frag.byteRange.length&&frag.setByteRange(String(1+segRefInfo.end-segRefInfo.start)+"@"+String(segRefInfo.start))}})),levelDetails&&levelDetails.initSegment.setByteRange(String(sidxInfo.moovEndOffset)+"@0")}},_proto._handleManifestParsingError=function _handleManifestParsingError(response,context,reason,networkDetails){this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:response.url,reason,networkDetails})},_proto._handleNetworkError=function _handleNetworkError(context,networkDetails,timeout,response){var details,fatal;void 0===timeout&&(timeout=!1),void 0===response&&(response=null),logger.logger.info("A network error occured while loading a "+context.type+"-type playlist");var loader=this.getInternalLoader(context);switch(context.type){case PlaylistContextType.MANIFEST:details=timeout?errors.ErrorDetails.MANIFEST_LOAD_TIMEOUT:errors.ErrorDetails.MANIFEST_LOAD_ERROR,fatal=!0;break;case PlaylistContextType.LEVEL:details=timeout?errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:errors.ErrorDetails.LEVEL_LOAD_ERROR,fatal=!1;break;case PlaylistContextType.AUDIO_TRACK:details=timeout?errors.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal=!1;break;default:fatal=!1}loader&&(loader.abort(),this.resetInternalLoader(context.type));var errorData={type:errors.ErrorTypes.NETWORK_ERROR,details,fatal,url:context.url,loader,context,networkDetails};response&&(errorData.response=response),this.hls.trigger(events.default.ERROR,errorData)},_proto._handlePlaylistLoaded=function _handlePlaylistLoaded(response,stats,context,networkDetails){var type=context.type,level=context.level,id=context.id,levelDetails=context.levelDetails;if(levelDetails&&levelDetails.targetduration)if(PlaylistLoader.canHaveQualityLevels(context.type))this.hls.trigger(events.default.LEVEL_LOADED,{details:levelDetails,level:level||0,id:id||0,stats,networkDetails});else switch(type){case PlaylistContextType.AUDIO_TRACK:this.hls.trigger(events.default.AUDIO_TRACK_LOADED,{details:levelDetails,id,stats,networkDetails});break;case PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(events.default.SUBTITLE_TRACK_LOADED,{details:levelDetails,id,stats,networkDetails})}else this._handleManifestParsingError(response,context,"invalid target duration",networkDetails)},PlaylistLoader}(event_handler);var fragment_loader=function(_EventHandler){function FragmentLoader(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.FRAG_LOADING)||this).loaders={},_this}!function fragment_loader_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(FragmentLoader,_EventHandler);var _proto=FragmentLoader.prototype;return _proto.destroy=function destroy(){var loaders=this.loaders;for(var loaderName in loaders){var loader=loaders[loaderName];loader&&loader.destroy()}this.loaders={},_EventHandler.prototype.destroy.call(this)},_proto.onFragLoading=function onFragLoading(data){var frag=data.frag,type=frag.type,loaders=this.loaders,config=this.hls.config,FragmentILoader=config.fLoader,DefaultILoader=config.loader;frag.loaded=0;var loaderContext,loaderConfig,loaderCallbacks,loader=loaders[type];loader&&(logger.logger.warn("abort previous fragment loader for type: "+type),loader.abort()),loader=loaders[type]=frag.loader=config.fLoader?new FragmentILoader(config):new DefaultILoader(config),loaderContext={url:frag.url,frag,responseType:"arraybuffer",progressData:!1};var start=frag.byteRangeStartOffset,end=frag.byteRangeEndOffset;Object(number_isFinite.isFiniteNumber)(start)&&Object(number_isFinite.isFiniteNumber)(end)&&(loaderContext.rangeStart=start,loaderContext.rangeEnd=end),loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},loader.load(loaderContext,loaderConfig,loaderCallbacks)},_proto.loadsuccess=function loadsuccess(response,stats,context,networkDetails){void 0===networkDetails&&(networkDetails=null);var payload=response.data,frag=context.frag;frag.loader=void 0,this.loaders[frag.type]=void 0,this.hls.trigger(events.default.FRAG_LOADED,{payload,frag,stats,networkDetails})},_proto.loaderror=function loaderror(response,context,networkDetails){void 0===networkDetails&&(networkDetails=null);var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.loaders[frag.type]=void 0,this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:context.frag,response,networkDetails})},_proto.loadtimeout=function loadtimeout(stats,context,networkDetails){void 0===networkDetails&&(networkDetails=null);var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.loaders[frag.type]=void 0,this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:context.frag,networkDetails})},_proto.loadprogress=function loadprogress(stats,context,data,networkDetails){void 0===networkDetails&&(networkDetails=null);var frag=context.frag;frag.loaded=stats.loaded,this.hls.trigger(events.default.FRAG_LOAD_PROGRESS,{frag,stats,networkDetails})},FragmentLoader}(event_handler);var key_loader=function(_EventHandler){function KeyLoader(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.KEY_LOADING)||this).loaders={},_this.decryptkey=null,_this.decrypturl=null,_this}!function key_loader_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(KeyLoader,_EventHandler);var _proto=KeyLoader.prototype;return _proto.destroy=function destroy(){for(var loaderName in this.loaders){var loader=this.loaders[loaderName];loader&&loader.destroy()}this.loaders={},_EventHandler.prototype.destroy.call(this)},_proto.onKeyLoading=function onKeyLoading(data){var frag=data.frag,type=frag.type,loader=this.loaders[type];if(frag.decryptdata){var uri=frag.decryptdata.uri;if(uri!==this.decrypturl||null===this.decryptkey){var config=this.hls.config;if(loader&&(logger.logger.warn("abort previous key loader for type:"+type),loader.abort()),!uri)return void logger.logger.warn("key uri is falsy");frag.loader=this.loaders[type]=new config.loader(config),this.decrypturl=uri,this.decryptkey=null;var loaderContext={url:uri,frag,responseType:"arraybuffer"},loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:config.fragLoadingRetryDelay,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};frag.loader.load(loaderContext,loaderConfig,loaderCallbacks)}else this.decryptkey&&(frag.decryptdata.key=this.decryptkey,this.hls.trigger(events.default.KEY_LOADED,{frag}))}else logger.logger.warn("Missing decryption data on fragment in onKeyLoading")},_proto.loadsuccess=function loadsuccess(response,stats,context){var frag=context.frag;frag.decryptdata?(this.decryptkey=frag.decryptdata.key=new Uint8Array(response.data),frag.loader=void 0,delete this.loaders[frag.type],this.hls.trigger(events.default.KEY_LOADED,{frag})):logger.logger.error("after key load, decryptdata unset")},_proto.loaderror=function loaderror(response,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),delete this.loaders[frag.type],this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag,response})},_proto.loadtimeout=function loadtimeout(stats,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),delete this.loaders[frag.type],this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag})},KeyLoader}(event_handler);var FragmentState_NOT_LOADED="NOT_LOADED",FragmentState_APPENDING="APPENDING",FragmentState_PARTIAL="PARTIAL",FragmentState_OK="OK",fragment_tracker_FragmentTracker=function(_EventHandler){function FragmentTracker(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.BUFFER_APPENDED,events.default.FRAG_BUFFERED,events.default.FRAG_LOADED)||this).bufferPadding=.2,_this.fragments=Object.create(null),_this.timeRanges=Object.create(null),_this.config=hls.config,_this}!function fragment_tracker_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(FragmentTracker,_EventHandler);var _proto=FragmentTracker.prototype;return _proto.destroy=function destroy(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,event_handler.prototype.destroy.call(this),_EventHandler.prototype.destroy.call(this)},_proto.getBufferedFrag=function getBufferedFrag(position,levelType){var fragments=this.fragments,bufferedFrags=Object.keys(fragments).filter((function(key){var fragmentEntity=fragments[key];if(fragmentEntity.body.type!==levelType)return!1;if(!fragmentEntity.buffered)return!1;var frag=fragmentEntity.body;return frag.startPTS<=position&&position<=frag.endPTS}));if(0===bufferedFrags.length)return null;var bufferedFragKey=bufferedFrags.pop();return fragments[bufferedFragKey].body},_proto.detectEvictedFragments=function detectEvictedFragments(elementaryStream,timeRange){var fragmentTimes,time,_this2=this;Object.keys(this.fragments).forEach((function(key){var fragmentEntity=_this2.fragments[key];if(!0===fragmentEntity.buffered){var esData=fragmentEntity.range[elementaryStream];if(esData){fragmentTimes=esData.time;for(var i=0;i<fragmentTimes.length;i++)if(time=fragmentTimes[i],!1===_this2.isTimeBuffered(time.startPTS,time.endPTS,timeRange)){_this2.removeFragment(fragmentEntity.body);break}}}}))},_proto.detectPartialFragments=function detectPartialFragments(fragment){var _this3=this,fragKey=this.getFragmentKey(fragment),fragmentEntity=this.fragments[fragKey];fragmentEntity&&(fragmentEntity.buffered=!0,Object.keys(this.timeRanges).forEach((function(elementaryStream){if(fragment.hasElementaryStream(elementaryStream)){var timeRange=_this3.timeRanges[elementaryStream];fragmentEntity.range[elementaryStream]=_this3.getBufferedTimes(fragment.startPTS,fragment.endPTS,timeRange)}})))},_proto.getBufferedTimes=function getBufferedTimes(startPTS,endPTS,timeRange){for(var startTime,endTime,fragmentTimes=[],fragmentPartial=!1,i=0;i<timeRange.length;i++){if(startTime=timeRange.start(i)-this.bufferPadding,endTime=timeRange.end(i)+this.bufferPadding,startPTS>=startTime&&endPTS<=endTime){fragmentTimes.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))});break}if(startPTS<endTime&&endPTS>startTime)fragmentTimes.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))}),fragmentPartial=!0;else if(endPTS<=startTime)break}return{time:fragmentTimes,partial:fragmentPartial}},_proto.getFragmentKey=function getFragmentKey(fragment){return fragment.type+"_"+fragment.level+"_"+fragment.urlId+"_"+fragment.sn},_proto.getPartialFragment=function getPartialFragment(time){var timePadding,startTime,endTime,_this4=this,bestFragment=null,bestOverlap=0;return Object.keys(this.fragments).forEach((function(key){var fragmentEntity=_this4.fragments[key];_this4.isPartial(fragmentEntity)&&(startTime=fragmentEntity.body.startPTS-_this4.bufferPadding,endTime=fragmentEntity.body.endPTS+_this4.bufferPadding,time>=startTime&&time<=endTime&&(timePadding=Math.min(time-startTime,endTime-time),bestOverlap<=timePadding&&(bestFragment=fragmentEntity.body,bestOverlap=timePadding)))})),bestFragment},_proto.getState=function getState(fragment){var fragKey=this.getFragmentKey(fragment),fragmentEntity=this.fragments[fragKey],state=FragmentState_NOT_LOADED;return void 0!==fragmentEntity&&(state=fragmentEntity.buffered?!0===this.isPartial(fragmentEntity)?FragmentState_PARTIAL:FragmentState_OK:FragmentState_APPENDING),state},_proto.isPartial=function isPartial(fragmentEntity){return!0===fragmentEntity.buffered&&(void 0!==fragmentEntity.range.video&&!0===fragmentEntity.range.video.partial||void 0!==fragmentEntity.range.audio&&!0===fragmentEntity.range.audio.partial)},_proto.isTimeBuffered=function isTimeBuffered(startPTS,endPTS,timeRange){for(var startTime,endTime,i=0;i<timeRange.length;i++){if(startTime=timeRange.start(i)-this.bufferPadding,endTime=timeRange.end(i)+this.bufferPadding,startPTS>=startTime&&endPTS<=endTime)return!0;if(endPTS<=startTime)return!1}return!1},_proto.onFragLoaded=function onFragLoaded(e){var fragment=e.frag;Object(number_isFinite.isFiniteNumber)(fragment.sn)&&!fragment.bitrateTest&&(this.fragments[this.getFragmentKey(fragment)]={body:fragment,range:Object.create(null),buffered:!1})},_proto.onBufferAppended=function onBufferAppended(e){var _this5=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(elementaryStream){var timeRange=_this5.timeRanges[elementaryStream];_this5.detectEvictedFragments(elementaryStream,timeRange)}))},_proto.onFragBuffered=function onFragBuffered(e){this.detectPartialFragments(e.frag)},_proto.hasFragment=function hasFragment(fragment){var fragKey=this.getFragmentKey(fragment);return void 0!==this.fragments[fragKey]},_proto.removeFragment=function removeFragment(fragment){var fragKey=this.getFragmentKey(fragment);delete this.fragments[fragKey]},_proto.removeAllFragments=function removeAllFragments(){this.fragments=Object.create(null)},FragmentTracker}(event_handler),binary_search={search:function search(list,comparisonFn){for(var minIndex=0,maxIndex=list.length-1,currentIndex=null,currentElement=null;minIndex<=maxIndex;){var comparisonResult=comparisonFn(currentElement=list[currentIndex=(minIndex+maxIndex)/2|0]);if(comparisonResult>0)minIndex=currentIndex+1;else{if(!(comparisonResult<0))return currentElement;maxIndex=currentIndex-1}}return null}},BufferHelper=function(){function BufferHelper(){}return BufferHelper.isBuffered=function isBuffered(media,position){try{if(media)for(var buffered=media.buffered,i=0;i<buffered.length;i++)if(position>=buffered.start(i)&&position<=buffered.end(i))return!0}catch(error){}return!1},BufferHelper.bufferInfo=function bufferInfo(media,pos,maxHoleDuration){try{if(media){var i,vbuffered=media.buffered,buffered=[];for(i=0;i<vbuffered.length;i++)buffered.push({start:vbuffered.start(i),end:vbuffered.end(i)});return this.bufferedInfo(buffered,pos,maxHoleDuration)}}catch(error){}return{len:0,start:pos,end:pos,nextStart:void 0}},BufferHelper.bufferedInfo=function bufferedInfo(buffered,pos,maxHoleDuration){buffered.sort((function(a,b){var diff=a.start-b.start;return diff||b.end-a.end}));var buffered2=[];if(maxHoleDuration)for(var i=0;i<buffered.length;i++){var buf2len=buffered2.length;if(buf2len){var buf2end=buffered2[buf2len-1].end;buffered[i].start-buf2end<maxHoleDuration?buffered[i].end>buf2end&&(buffered2[buf2len-1].end=buffered[i].end):buffered2.push(buffered[i])}else buffered2.push(buffered[i])}else buffered2=buffered;for(var bufferStartNext,bufferLen=0,bufferStart=pos,bufferEnd=pos,_i=0;_i<buffered2.length;_i++){var start=buffered2[_i].start,end=buffered2[_i].end;if(pos+maxHoleDuration>=start&&pos<end)bufferStart=start,bufferLen=(bufferEnd=end)-pos;else if(pos+maxHoleDuration<start){bufferStartNext=start;break}}return{len:bufferLen,start:bufferStart,end:bufferEnd,nextStart:bufferStartNext}},BufferHelper}(),eventemitter3=__webpack_require__("./node_modules/eventemitter3/index.js"),webworkify_webpack=__webpack_require__("./node_modules/webworkify-webpack/index.js"),demuxer_inline=__webpack_require__("./src/demux/demuxer-inline.js");function getMediaSource(){return window.MediaSource||window.WebKitMediaSource}var get_self_scope=__webpack_require__("./src/utils/get-self-scope.js");var Observer=function(_EventEmitter){function Observer(){return _EventEmitter.apply(this,arguments)||this}return function observer_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(Observer,_EventEmitter),Observer.prototype.trigger=function trigger(event){for(var _len=arguments.length,data=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];this.emit.apply(this,[event,event].concat(data))},Observer}(eventemitter3.EventEmitter),global=Object(get_self_scope.getSelfScope)(),demuxer_MediaSource=getMediaSource()||{isTypeSupported:function isTypeSupported(){return!1}},demux_demuxer=function(){function Demuxer(hls,id){var _this=this;this.hls=hls,this.id=id;var observer=this.observer=new Observer,config=hls.config,forwardMessage=function forwardMessage(ev,data){(data=data||{}).frag=_this.frag,data.id=_this.id,hls.trigger(ev,data)};observer.on(events.default.FRAG_DECRYPTED,forwardMessage),observer.on(events.default.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(events.default.FRAG_PARSING_DATA,forwardMessage),observer.on(events.default.FRAG_PARSED,forwardMessage),observer.on(events.default.ERROR,forwardMessage),observer.on(events.default.FRAG_PARSING_METADATA,forwardMessage),observer.on(events.default.FRAG_PARSING_USERDATA,forwardMessage),observer.on(events.default.INIT_PTS_FOUND,forwardMessage);var typeSupported={mp4:demuxer_MediaSource.isTypeSupported("video/mp4"),mpeg:demuxer_MediaSource.isTypeSupported("audio/mpeg"),mp3:demuxer_MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},vendor=navigator.vendor;if(config.enableWorker&&"undefined"!=typeof Worker){var w;logger.logger.log("demuxing in webworker");try{w=this.w=webworkify_webpack("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),w.addEventListener("message",this.onwmsg),w.onerror=function(event){hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.OTHER_ERROR,details:errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:event.message+" ("+event.filename+":"+event.lineno+")"}})},w.postMessage({cmd:"init",typeSupported,vendor,id,config:JSON.stringify(config)})}catch(err){logger.logger.warn("Error in worker:",err),logger.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),w&&global.URL.revokeObjectURL(w.objectURL),this.demuxer=new demuxer_inline.default(observer,typeSupported,config,vendor),this.w=void 0}}else this.demuxer=new demuxer_inline.default(observer,typeSupported,config,vendor)}var _proto=Demuxer.prototype;return _proto.destroy=function destroy(){var w=this.w;if(w)w.removeEventListener("message",this.onwmsg),w.terminate(),this.w=null;else{var demuxer=this.demuxer;demuxer&&(demuxer.destroy(),this.demuxer=null)}var observer=this.observer;observer&&(observer.removeAllListeners(),this.observer=null)},_proto.push=function push(data,initSegment,audioCodec,videoCodec,frag,duration,accurateTimeOffset,defaultInitPTS){var w=this.w,timeOffset=Object(number_isFinite.isFiniteNumber)(frag.startPTS)?frag.startPTS:frag.start,decryptdata=frag.decryptdata,lastFrag=this.frag,discontinuity=!(lastFrag&&frag.cc===lastFrag.cc),trackSwitch=!(lastFrag&&frag.level===lastFrag.level),nextSN=lastFrag&&frag.sn===lastFrag.sn+1,contiguous=!trackSwitch&&nextSN;if(discontinuity&&logger.logger.log(this.id+":discontinuity detected"),trackSwitch&&logger.logger.log(this.id+":switch detected"),this.frag=frag,w)w.postMessage({cmd:"demux",data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS},data instanceof ArrayBuffer?[data]:[]);else{var demuxer=this.demuxer;demuxer&&demuxer.push(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)}},_proto.onWorkerMessage=function onWorkerMessage(ev){var data=ev.data,hls=this.hls;switch(data.event){case"init":global.URL.revokeObjectURL(this.w.objectURL);break;case events.default.FRAG_PARSING_DATA:data.data.data1=new Uint8Array(data.data1),data.data2&&(data.data.data2=new Uint8Array(data.data2));default:data.data=data.data||{},data.data.frag=this.frag,data.data.id=this.id,hls.trigger(data.event,data.data)}},Demuxer}();function addGroupId(level,type,id){switch(type){case"audio":level.audioGroupIds||(level.audioGroupIds=[]),level.audioGroupIds.push(id);break;case"text":level.textGroupIds||(level.textGroupIds=[]),level.textGroupIds.push(id)}}function updatePTS(fragments,fromIdx,toIdx){var fragFrom=fragments[fromIdx],fragTo=fragments[toIdx],fragToPTS=fragTo.startPTS;Object(number_isFinite.isFiniteNumber)(fragToPTS)?toIdx>fromIdx?(fragFrom.duration=fragToPTS-fragFrom.start,fragFrom.duration<0&&logger.logger.warn("negative duration computed for frag "+fragFrom.sn+",level "+fragFrom.level+", there should be some duration drift between playlist and fragment!")):(fragTo.duration=fragFrom.start-fragToPTS,fragTo.duration<0&&logger.logger.warn("negative duration computed for frag "+fragTo.sn+",level "+fragTo.level+", there should be some duration drift between playlist and fragment!")):fragTo.start=toIdx>fromIdx?fragFrom.start+fragFrom.duration:Math.max(fragFrom.start-fragTo.duration,0)}function updateFragPTSDTS(details,frag,startPTS,endPTS,startDTS,endDTS){var maxStartPTS=startPTS;if(Object(number_isFinite.isFiniteNumber)(frag.startPTS)){var deltaPTS=Math.abs(frag.startPTS-startPTS);Object(number_isFinite.isFiniteNumber)(frag.deltaPTS)?frag.deltaPTS=Math.max(deltaPTS,frag.deltaPTS):frag.deltaPTS=deltaPTS,maxStartPTS=Math.max(startPTS,frag.startPTS),startPTS=Math.min(startPTS,frag.startPTS),endPTS=Math.max(endPTS,frag.endPTS),startDTS=Math.min(startDTS,frag.startDTS),endDTS=Math.max(endDTS,frag.endDTS)}var drift=startPTS-frag.start;frag.start=frag.startPTS=startPTS,frag.maxStartPTS=maxStartPTS,frag.endPTS=endPTS,frag.startDTS=startDTS,frag.endDTS=endDTS,frag.duration=endPTS-startPTS;var fragIdx,fragments,i,sn=frag.sn;if(!details||sn<details.startSN||sn>details.endSN)return 0;for(fragIdx=sn-details.startSN,(fragments=details.fragments)[fragIdx]=frag,i=fragIdx;i>0;i--)updatePTS(fragments,i,i-1);for(i=fragIdx;i<fragments.length-1;i++)updatePTS(fragments,i,i+1);return details.PTSKnown=!0,drift}function mergeDetails(oldDetails,newDetails){newDetails.initSegment&&oldDetails.initSegment&&(newDetails.initSegment=oldDetails.initSegment);var PTSFrag,ccOffset=0;if(mapFragmentIntersection(oldDetails,newDetails,(function(oldFrag,newFrag){ccOffset=oldFrag.cc-newFrag.cc,Object(number_isFinite.isFiniteNumber)(oldFrag.startPTS)&&(newFrag.start=newFrag.startPTS=oldFrag.startPTS,newFrag.endPTS=oldFrag.endPTS,newFrag.duration=oldFrag.duration,newFrag.backtracked=oldFrag.backtracked,newFrag.dropped=oldFrag.dropped,PTSFrag=newFrag),newDetails.PTSKnown=!0})),newDetails.PTSKnown){if(ccOffset){logger.logger.log("discontinuity sliding from playlist, take drift into account");for(var newFragments=newDetails.fragments,i=0;i<newFragments.length;i++)newFragments[i].cc+=ccOffset}PTSFrag?updateFragPTSDTS(newDetails,PTSFrag,PTSFrag.startPTS,PTSFrag.endPTS,PTSFrag.startDTS,PTSFrag.endDTS):function adjustSliding(oldPlaylist,newPlaylist){var delta=newPlaylist.startSN-oldPlaylist.startSN,oldFragments=oldPlaylist.fragments,newFragments=newPlaylist.fragments;if(delta<0||delta>oldFragments.length)return;for(var i=0;i<newFragments.length;i++)newFragments[i].start+=oldFragments[delta].start}(oldDetails,newDetails),newDetails.PTSKnown=oldDetails.PTSKnown}}function mapFragmentIntersection(oldPlaylist,newPlaylist,intersectionFn){if(oldPlaylist&&newPlaylist)for(var start=Math.max(oldPlaylist.startSN,newPlaylist.startSN)-newPlaylist.startSN,end=Math.min(oldPlaylist.endSN,newPlaylist.endSN)-newPlaylist.startSN,delta=newPlaylist.startSN-oldPlaylist.startSN,i=start;i<=end;i++){var oldFrag=oldPlaylist.fragments[delta+i],newFrag=newPlaylist.fragments[i];if(!oldFrag||!newFrag)break;intersectionFn(oldFrag,newFrag,i)}}function computeReloadInterval(currentPlaylist,newPlaylist,lastRequestTime){var reloadInterval=1e3*(newPlaylist.averagetargetduration?newPlaylist.averagetargetduration:newPlaylist.targetduration),minReloadInterval=reloadInterval/2;return currentPlaylist&&newPlaylist.endSN===currentPlaylist.endSN&&(reloadInterval=minReloadInterval),lastRequestTime&&(reloadInterval=Math.max(minReloadInterval,reloadInterval-(window.performance.now()-lastRequestTime))),Math.round(reloadInterval)}var time_ranges={toString:function toString(r){for(var log="",len=r.length,i=0;i<len;i++)log+="["+r.start(i).toFixed(3)+","+r.end(i).toFixed(3)+"]";return log}};function adjustPts(sliding,details){details.fragments.forEach((function(frag){if(frag){var start=frag.start+sliding;frag.start=frag.startPTS=start,frag.endPTS=start+frag.duration}})),details.PTSKnown=!0}function alignStream(lastFrag,lastLevel,details){!function alignDiscontinuities(lastFrag,details,lastLevel){if(function shouldAlignOnDiscontinuities(lastFrag,lastLevel,details){var shouldAlign=!1;return lastLevel&&lastLevel.details&&details&&(details.endCC>details.startCC||lastFrag&&lastFrag.cc<details.startCC)&&(shouldAlign=!0),shouldAlign}(lastFrag,lastLevel,details)){var referenceFrag=function findDiscontinuousReferenceFrag(prevDetails,curDetails){var prevFrags=prevDetails.fragments,curFrags=curDetails.fragments;if(curFrags.length&&prevFrags.length){var prevStartFrag=function findFirstFragWithCC(fragments,cc){for(var firstFrag=null,i=0;i<fragments.length;i+=1){var currentFrag=fragments[i];if(currentFrag&&currentFrag.cc===cc){firstFrag=currentFrag;break}}return firstFrag}(prevFrags,curFrags[0].cc);if(prevStartFrag&&(!prevStartFrag||prevStartFrag.startPTS))return prevStartFrag;logger.logger.log("No frag in previous level to align on")}else logger.logger.log("No fragments to align")}(lastLevel.details,details);referenceFrag&&(logger.logger.log("Adjusting PTS using last level due to CC increase within current level"),adjustPts(referenceFrag.start,details))}}(lastFrag,details,lastLevel),!details.PTSKnown&&lastLevel&&function alignPDT(details,lastDetails){if(lastDetails&&lastDetails.fragments.length){if(!details.hasProgramDateTime||!lastDetails.hasProgramDateTime)return;var lastPDT=lastDetails.fragments[0].programDateTime,sliding=(details.fragments[0].programDateTime-lastPDT)/1e3+lastDetails.fragments[0].start;Object(number_isFinite.isFiniteNumber)(sliding)&&(logger.logger.log("adjusting PTS using programDateTime delta, sliding:"+sliding.toFixed(3)),adjustPts(sliding,details))}}(details,lastLevel.details)}function findFragmentByPDT(fragments,PDTValue,maxFragLookUpTolerance){if(null===PDTValue||!Array.isArray(fragments)||!fragments.length||!Object(number_isFinite.isFiniteNumber)(PDTValue))return null;if(PDTValue<(fragments[0].programDateTime||0))return null;if(PDTValue>=(fragments[fragments.length-1].endProgramDateTime||0))return null;maxFragLookUpTolerance=maxFragLookUpTolerance||0;for(var seg=0;seg<fragments.length;++seg){var frag=fragments[seg];if(pdtWithinToleranceTest(PDTValue,maxFragLookUpTolerance,frag))return frag}return null}function findFragmentByPTS(fragPrevious,fragments,bufferEnd,maxFragLookUpTolerance){void 0===bufferEnd&&(bufferEnd=0),void 0===maxFragLookUpTolerance&&(maxFragLookUpTolerance=0);var fragNext=fragPrevious?fragments[fragPrevious.sn-fragments[0].sn+1]:null;return fragNext&&!fragment_finders_fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,fragNext)?fragNext:binary_search.search(fragments,fragment_finders_fragmentWithinToleranceTest.bind(null,bufferEnd,maxFragLookUpTolerance))}function fragment_finders_fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,candidate){void 0===bufferEnd&&(bufferEnd=0),void 0===maxFragLookUpTolerance&&(maxFragLookUpTolerance=0);var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return candidate.start+candidate.duration-candidateLookupTolerance<=bufferEnd?1:candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start?-1:0}function pdtWithinToleranceTest(pdtBufferEnd,maxFragLookUpTolerance,candidate){var candidateLookupTolerance=1e3*Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return(candidate.endProgramDateTime||0)-candidateLookupTolerance>pdtBufferEnd}var gap_controller_GapController=function(){function GapController(config,media,fragmentTracker,hls){this.config=config,this.media=media,this.fragmentTracker=fragmentTracker,this.hls=hls,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var _proto=GapController.prototype;return _proto.poll=function poll(lastCurrentTime){var config=this.config,media=this.media,stalled=this.stalled,currentTime=media.currentTime,seeking=media.seeking,seeked=this.seeking&&!seeking,beginSeek=!this.seeking&&seeking;if(this.seeking=seeking,currentTime===lastCurrentTime){if((beginSeek||seeked)&&(this.stalled=null),!media.paused&&!media.ended&&0!==media.playbackRate&&media.buffered.length){var bufferInfo=BufferHelper.bufferInfo(media,currentTime,0),isBuffered=bufferInfo.len>0,nextStart=bufferInfo.nextStart||0;if(isBuffered||nextStart){if(seeking){if(bufferInfo.len>2||(!nextStart||nextStart-currentTime>2))return;this.moved=!1}if(!this.moved&&this.stalled){var startJump=Math.max(nextStart,bufferInfo.start||0)-currentTime;if(startJump>0&&startJump<=2)return void this._trySkipBufferHole(null)}var tnow=self.performance.now();if(null!==stalled){var stalledDuration=tnow-stalled;!seeking&&stalledDuration>=250&&this._reportStall(bufferInfo.len);var bufferedWithHoles=BufferHelper.bufferInfo(media,currentTime,config.maxBufferHole);this._tryFixBufferStall(bufferedWithHoles,stalledDuration)}else this.stalled=tnow}}}else if(this.moved=!0,null!==stalled){if(this.stallReported){var _stalledDuration=self.performance.now()-stalled;logger.logger.warn("playback not stuck anymore @"+currentTime+", after "+Math.round(_stalledDuration)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},_proto._tryFixBufferStall=function _tryFixBufferStall(bufferInfo,stalledDurationMs){var config=this.config,fragmentTracker=this.fragmentTracker,currentTime=this.media.currentTime,partial=fragmentTracker.getPartialFragment(currentTime);if(partial&&this._trySkipBufferHole(partial))return;bufferInfo.len>config.maxBufferHole&&stalledDurationMs>1e3*config.highBufferWatchdogPeriod&&(logger.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},_proto._reportStall=function _reportStall(bufferLen){var hls=this.hls,media=this.media;this.stallReported||(this.stallReported=!0,logger.logger.warn("Playback stalling at @"+media.currentTime+" due to low buffer"),hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:bufferLen}))},_proto._trySkipBufferHole=function _trySkipBufferHole(partial){for(var config=this.config,hls=this.hls,media=this.media,currentTime=media.currentTime,lastEndTime=0,i=0;i<media.buffered.length;i++){var startTime=media.buffered.start(i);if(currentTime+config.maxBufferHole>=lastEndTime&&currentTime<startTime){var targetTime=Math.max(startTime+.05,media.currentTime+.1);return logger.logger.warn("skipping hole, adjusting currentTime from "+currentTime+" to "+targetTime),this.moved=!0,this.stalled=null,media.currentTime=targetTime,partial&&hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+currentTime+" to "+targetTime,frag:partial}),targetTime}lastEndTime=media.buffered.end(i)}return 0},_proto._tryNudgeBuffer=function _tryNudgeBuffer(){var config=this.config,hls=this.hls,media=this.media,currentTime=media.currentTime,nudgeRetry=(this.nudgeRetry||0)+1;if(this.nudgeRetry=nudgeRetry,nudgeRetry<config.nudgeMaxRetry){var targetTime=currentTime+nudgeRetry*config.nudgeOffset;logger.logger.warn("Nudging 'currentTime' from "+currentTime+" to "+targetTime),media.currentTime=targetTime,hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else logger.logger.error("Playhead still not moving while enough data buffered @"+currentTime+" after "+config.nudgeMaxRetry+" nudges"),hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},GapController}();function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var TaskLoop=function(_EventHandler){function TaskLoop(hls){for(var _this,_len=arguments.length,events=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)events[_key-1]=arguments[_key];return(_this=_EventHandler.call.apply(_EventHandler,[this,hls].concat(events))||this)._boundTick=void 0,_this._tickTimer=null,_this._tickInterval=null,_this._tickCallCount=0,_this._boundTick=_this.tick.bind(_assertThisInitialized(_this)),_this}!function task_loop_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(TaskLoop,_EventHandler);var _proto=TaskLoop.prototype;return _proto.onHandlerDestroying=function onHandlerDestroying(){this.clearNextTick(),this.clearInterval()},_proto.hasInterval=function hasInterval(){return!!this._tickInterval},_proto.hasNextTick=function hasNextTick(){return!!this._tickTimer},_proto.setInterval=function setInterval(millis){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,millis),!0)},_proto.clearInterval=function clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},_proto.clearNextTick=function clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},_proto.tick=function tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},_proto.doTick=function doTick(){},TaskLoop}(event_handler);var State_STOPPED="STOPPED",State_STARTING="STARTING",State_IDLE="IDLE",State_PAUSED="PAUSED",State_KEY_LOADING="KEY_LOADING",State_FRAG_LOADING="FRAG_LOADING",State_FRAG_LOADING_WAITING_RETRY="FRAG_LOADING_WAITING_RETRY",State_WAITING_TRACK="WAITING_TRACK",State_PARSING="PARSING",State_PARSED="PARSED",State_BUFFER_FLUSHING="BUFFER_FLUSHING",State_ENDED="ENDED",State_ERROR="ERROR",State_WAITING_INIT_PTS="WAITING_INIT_PTS",State_WAITING_LEVEL="WAITING_LEVEL",base_stream_controller_BaseStreamController=function(_TaskLoop){function BaseStreamController(){return _TaskLoop.apply(this,arguments)||this}!function base_stream_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(BaseStreamController,_TaskLoop);var _proto=BaseStreamController.prototype;return _proto.doTick=function doTick(){},_proto.startLoad=function startLoad(){},_proto.stopLoad=function stopLoad(){var frag=this.fragCurrent;frag&&(frag.loader&&frag.loader.abort(),this.fragmentTracker.removeFragment(frag)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State_STOPPED},_proto._streamEnded=function _streamEnded(bufferInfo,levelDetails){var fragCurrent=this.fragCurrent,fragmentTracker=this.fragmentTracker;if(!levelDetails.live&&fragCurrent&&!fragCurrent.backtracked&&fragCurrent.sn===levelDetails.endSN&&!bufferInfo.nextStart){var fragState=fragmentTracker.getState(fragCurrent);return fragState===FragmentState_PARTIAL||fragState===FragmentState_OK}return!1},_proto.onMediaSeeking=function onMediaSeeking(){var config=this.config,media=this.media,mediaBuffer=this.mediaBuffer,state=this.state,currentTime=media?media.currentTime:null,bufferInfo=BufferHelper.bufferInfo(mediaBuffer||media,currentTime,this.config.maxBufferHole);if(Object(number_isFinite.isFiniteNumber)(currentTime)&&logger.logger.log("media seeking to "+currentTime.toFixed(3)),state===State_FRAG_LOADING){var fragCurrent=this.fragCurrent;if(0===bufferInfo.len&&fragCurrent){var tolerance=config.maxFragLookUpTolerance,fragStartOffset=fragCurrent.start-tolerance,fragEndOffset=fragCurrent.start+fragCurrent.duration+tolerance;currentTime<fragStartOffset||currentTime>fragEndOffset?(fragCurrent.loader&&(logger.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),fragCurrent.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=State_IDLE):logger.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else state===State_ENDED&&(0===bufferInfo.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=State_IDLE);media&&(this.lastCurrentTime=currentTime),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=currentTime),this.tick()},_proto.onMediaEnded=function onMediaEnded(){this.startPosition=this.lastCurrentTime=0},_proto.onHandlerDestroying=function onHandlerDestroying(){this.stopLoad(),_TaskLoop.prototype.onHandlerDestroying.call(this)},_proto.onHandlerDestroyed=function onHandlerDestroyed(){this.state=State_STOPPED,this.fragmentTracker=null},_proto.computeLivePosition=function computeLivePosition(sliding,levelDetails){var targetLatency=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*levelDetails.targetduration;return sliding+Math.max(0,levelDetails.totalduration-targetLatency)},BaseStreamController}(TaskLoop);function stream_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var stream_controller=function(_BaseStreamController){function StreamController(hls,fragmentTracker){var _this;return(_this=_BaseStreamController.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.MANIFEST_LOADING,events.default.MANIFEST_PARSED,events.default.LEVEL_LOADED,events.default.KEY_LOADED,events.default.FRAG_LOADED,events.default.FRAG_LOAD_EMERGENCY_ABORTED,events.default.FRAG_PARSING_INIT_SEGMENT,events.default.FRAG_PARSING_DATA,events.default.FRAG_PARSED,events.default.ERROR,events.default.AUDIO_TRACK_SWITCHING,events.default.AUDIO_TRACK_SWITCHED,events.default.BUFFER_CREATED,events.default.BUFFER_APPENDED,events.default.BUFFER_FLUSHED)||this).fragmentTracker=fragmentTracker,_this.config=hls.config,_this.audioCodecSwap=!1,_this._state=State_STOPPED,_this.stallReported=!1,_this.gapController=null,_this.altAudio=!1,_this}!function stream_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(StreamController,_BaseStreamController);var _proto=StreamController.prototype;return _proto.startLoad=function startLoad(startPosition){if(this.levels){var lastCurrentTime=this.lastCurrentTime,hls=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var startLevel=hls.startLevel;-1===startLevel&&(startLevel=0,this.bitrateTest=!0),this.level=hls.nextLoadLevel=startLevel,this.loadedmetadata=!1}lastCurrentTime>0&&-1===startPosition&&(logger.logger.log("override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),startPosition=lastCurrentTime),this.state=State_IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition,this.tick()}else this.forceStartLoad=!0,this.state=State_STOPPED},_proto.stopLoad=function stopLoad(){this.forceStartLoad=!1,_BaseStreamController.prototype.stopLoad.call(this)},_proto.doTick=function doTick(){switch(this.state){case State_BUFFER_FLUSHING:this.fragLoadError=0;break;case State_IDLE:this._doTickIdle();break;case State_WAITING_LEVEL:var level=this.levels[this.level];level&&level.details&&(this.state=State_IDLE);break;case State_FRAG_LOADING_WAITING_RETRY:var now=window.performance.now(),retryDate=this.retryDate;(!retryDate||now>=retryDate||this.media&&this.media.seeking)&&(logger.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=State_IDLE)}this._checkBuffer(),this._checkFragmentChanged()},_proto._doTickIdle=function _doTickIdle(){var hls=this.hls,config=hls.config,media=this.media;if(void 0!==this.levelLastLoaded&&(media||!this.startFragRequested&&config.startFragPrefetch)){var pos;pos=this.loadedmetadata?media.currentTime:this.nextLoadPosition;var level=hls.nextLoadLevel,levelInfo=this.levels[level];if(levelInfo){var maxBufLen,levelBitrate=levelInfo.bitrate;maxBufLen=levelBitrate?Math.max(8*config.maxBufferSize/levelBitrate,config.maxBufferLength):config.maxBufferLength,maxBufLen=Math.min(maxBufLen,config.maxMaxBufferLength);var bufferInfo=BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:media,pos,config.maxBufferHole),bufferLen=bufferInfo.len;if(!(bufferLen>=maxBufLen)){logger.logger.trace("buffer length of "+bufferLen.toFixed(3)+" is below max of "+maxBufLen.toFixed(3)+". checking for more payload ..."),this.level=hls.nextLoadLevel=level;var levelDetails=levelInfo.details;if(!levelDetails||levelDetails.live&&this.levelLastLoaded!==level)this.state=State_WAITING_LEVEL;else{if(this._streamEnded(bufferInfo,levelDetails)){var data={};return this.altAudio&&(data.type="video"),this.hls.trigger(events.default.BUFFER_EOS,data),void(this.state=State_ENDED)}this._fetchPayloadOrEos(pos,bufferInfo,levelDetails)}}}}},_proto._fetchPayloadOrEos=function _fetchPayloadOrEos(pos,bufferInfo,levelDetails){var fragPrevious=this.fragPrevious,level=this.level,fragments=levelDetails.fragments,fragLen=fragments.length;if(0!==fragLen){var frag,start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration,bufferEnd=bufferInfo.end;if(levelDetails.initSegment&&!levelDetails.initSegment.data)frag=levelDetails.initSegment;else if(levelDetails.live){var initialLiveManifestSize=this.config.initialLiveManifestSize;if(fragLen<initialLiveManifestSize)return void logger.logger.warn("Can not start playback of a level, reason: not enough fragments "+fragLen+" < "+initialLiveManifestSize);if(null===(frag=this._ensureFragmentAtLivePoint(levelDetails,bufferEnd,start,end,fragPrevious,fragments,fragLen)))return}else bufferEnd<start&&(frag=fragments[0]);frag||(frag=this._findFragment(start,fragPrevious,fragLen,fragments,bufferEnd,end,levelDetails)),frag&&(frag.encrypted?(logger.logger.log("Loading key for "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level),this._loadKey(frag)):(logger.logger.log("Loading "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level+", currentTime:"+pos.toFixed(3)+",bufferEnd:"+bufferEnd.toFixed(3)),this._loadFragment(frag)))}},_proto._ensureFragmentAtLivePoint=function _ensureFragmentAtLivePoint(levelDetails,bufferEnd,start,end,fragPrevious,fragments,fragLen){var frag,config=this.hls.config,media=this.media,maxLatency=void 0!==config.liveMaxLatencyDuration?config.liveMaxLatencyDuration:config.liveMaxLatencyDurationCount*levelDetails.targetduration;if(bufferEnd<Math.max(start-config.maxFragLookUpTolerance,end-maxLatency)){var liveSyncPosition=this.liveSyncPosition=this.computeLivePosition(start,levelDetails);bufferEnd=liveSyncPosition,media&&!media.paused&&media.readyState&&media.duration>liveSyncPosition&&liveSyncPosition>media.currentTime&&(logger.logger.log("buffer end: "+bufferEnd.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+liveSyncPosition.toFixed(3)),media.currentTime=liveSyncPosition),this.nextLoadPosition=liveSyncPosition}if(levelDetails.PTSKnown&&bufferEnd>end&&media&&media.readyState)return null;if(this.startFragRequested&&!levelDetails.PTSKnown){if(fragPrevious)if(levelDetails.hasProgramDateTime)logger.logger.log("live playlist, switching playlist, load frag with same PDT: "+fragPrevious.programDateTime),frag=findFragmentByPDT(fragments,fragPrevious.endProgramDateTime,config.maxFragLookUpTolerance);else{var targetSN=fragPrevious.sn+1;if(targetSN>=levelDetails.startSN&&targetSN<=levelDetails.endSN){var fragNext=fragments[targetSN-levelDetails.startSN];fragPrevious.cc===fragNext.cc&&(frag=fragNext,logger.logger.log("live playlist, switching playlist, load frag with next SN: "+frag.sn))}frag||(frag=binary_search.search(fragments,(function(frag){return fragPrevious.cc-frag.cc})))&&logger.logger.log("live playlist, switching playlist, load frag with same CC: "+frag.sn)}frag||(frag=fragments[Math.min(fragLen-1,Math.round(fragLen/2))],logger.logger.log("live playlist, switching playlist, unknown, load middle frag : "+frag.sn))}return frag},_proto._findFragment=function _findFragment(start,fragPreviousLoad,fragmentIndexRange,fragments,bufferEnd,end,levelDetails){var fragNextLoad,config=this.hls.config;bufferEnd<end?fragNextLoad=findFragmentByPTS(fragPreviousLoad,fragments,bufferEnd,bufferEnd>end-config.maxFragLookUpTolerance?0:config.maxFragLookUpTolerance):fragNextLoad=fragments[fragmentIndexRange-1];if(fragNextLoad){var curSNIdx=fragNextLoad.sn-levelDetails.startSN,sameLevel=fragPreviousLoad&&fragNextLoad.level===fragPreviousLoad.level,prevSnFrag=fragments[curSNIdx-1],nextSnFrag=fragments[curSNIdx+1];if(fragPreviousLoad&&fragNextLoad.sn===fragPreviousLoad.sn)if(sameLevel&&!fragNextLoad.backtracked)if(fragNextLoad.sn<levelDetails.endSN){var deltaPTS=fragPreviousLoad.deltaPTS;deltaPTS&&deltaPTS>config.maxBufferHole&&fragPreviousLoad.dropped&&curSNIdx?(fragNextLoad=prevSnFrag,logger.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(fragNextLoad=nextSnFrag,logger.logger.log("Re-loading fragment with SN: "+fragNextLoad.sn))}else fragNextLoad=null;else fragNextLoad.backtracked&&(nextSnFrag&&nextSnFrag.backtracked?(logger.logger.warn("Already backtracked from fragment "+nextSnFrag.sn+", will not backtrack to fragment "+fragNextLoad.sn+". Loading fragment "+nextSnFrag.sn),fragNextLoad=nextSnFrag):(logger.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),fragNextLoad.dropped=0,prevSnFrag?(fragNextLoad=prevSnFrag).backtracked=!0:curSNIdx&&(fragNextLoad=null)))}return fragNextLoad},_proto._loadKey=function _loadKey(frag){this.state=State_KEY_LOADING,this.hls.trigger(events.default.KEY_LOADING,{frag})},_proto._loadFragment=function _loadFragment(frag){var fragState=this.fragmentTracker.getState(frag);this.fragCurrent=frag,"initSegment"!==frag.sn&&(this.startFragRequested=!0),Object(number_isFinite.isFiniteNumber)(frag.sn)&&!frag.bitrateTest&&(this.nextLoadPosition=frag.start+frag.duration),frag.backtracked||fragState===FragmentState_NOT_LOADED||fragState===FragmentState_PARTIAL?(frag.autoLevel=this.hls.autoLevelEnabled,frag.bitrateTest=this.bitrateTest,this.hls.trigger(events.default.FRAG_LOADING,{frag}),this.demuxer||(this.demuxer=new demux_demuxer(this.hls,"main")),this.state=State_FRAG_LOADING):fragState===FragmentState_APPENDING&&this._reduceMaxBufferLength(frag.duration)&&this.fragmentTracker.removeFragment(frag)},_proto.getBufferedFrag=function getBufferedFrag(position){return this.fragmentTracker.getBufferedFrag(position,PlaylistLevelType.MAIN)},_proto.followingBufferedFrag=function followingBufferedFrag(frag){return frag?this.getBufferedFrag(frag.endPTS+.5):null},_proto._checkFragmentChanged=function _checkFragmentChanged(){var fragPlayingCurrent,currentTime,video=this.media;if(video&&video.readyState&&!1===video.seeking&&((currentTime=video.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=currentTime),BufferHelper.isBuffered(video,currentTime)?fragPlayingCurrent=this.getBufferedFrag(currentTime):BufferHelper.isBuffered(video,currentTime+.1)&&(fragPlayingCurrent=this.getBufferedFrag(currentTime+.1)),fragPlayingCurrent)){var fragPlaying=fragPlayingCurrent;if(fragPlaying!==this.fragPlaying){this.hls.trigger(events.default.FRAG_CHANGED,{frag:fragPlaying});var fragPlayingLevel=fragPlaying.level;this.fragPlaying&&this.fragPlaying.level===fragPlayingLevel||this.hls.trigger(events.default.LEVEL_SWITCHED,{level:fragPlayingLevel}),this.fragPlaying=fragPlaying}}},_proto.immediateLevelSwitch=function immediateLevelSwitch(){if(logger.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var previouslyPaused,media=this.media;media?(previouslyPaused=media.paused,media.pause()):previouslyPaused=!0,this.previouslyPaused=previouslyPaused}var fragCurrent=this.fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_proto.immediateLevelSwitchEnd=function immediateLevelSwitchEnd(){var media=this.media;media&&media.buffered.length&&(this.immediateSwitch=!1,BufferHelper.isBuffered(media,media.currentTime)&&(media.currentTime-=1e-4),this.previouslyPaused||media.play())},_proto.nextLevelSwitch=function nextLevelSwitch(){var media=this.media;if(media&&media.readyState){var fetchdelay,fragPlayingCurrent,nextBufferedFrag;if((fragPlayingCurrent=this.getBufferedFrag(media.currentTime))&&fragPlayingCurrent.startPTS>1&&this.flushMainBuffer(0,fragPlayingCurrent.startPTS-1),media.paused)fetchdelay=0;else{var nextLevelId=this.hls.nextLoadLevel,nextLevel=this.levels[nextLevelId],fragLastKbps=this.fragLastKbps;fetchdelay=fragLastKbps&&this.fragCurrent?this.fragCurrent.duration*nextLevel.bitrate/(1e3*fragLastKbps)+1:0}if((nextBufferedFrag=this.getBufferedFrag(media.currentTime+fetchdelay))&&(nextBufferedFrag=this.followingBufferedFrag(nextBufferedFrag))){var fragCurrent=this.fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(nextBufferedFrag.maxStartPTS,Number.POSITIVE_INFINITY)}}},_proto.flushMainBuffer=function flushMainBuffer(startOffset,endOffset){this.state=State_BUFFER_FLUSHING;var flushScope={startOffset,endOffset};this.altAudio&&(flushScope.type="video"),this.hls.trigger(events.default.BUFFER_FLUSHING,flushScope)},_proto.onMediaAttached=function onMediaAttached(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("seeked",this.onvseeked),media.addEventListener("ended",this.onvended);var config=this.config;this.levels&&config.autoStartLoad&&this.hls.startLoad(config.startPosition),this.gapController=new gap_controller_GapController(config,media,this.fragmentTracker,this.hls)},_proto.onMediaDetaching=function onMediaDetaching(){var media=this.media;media&&media.ended&&(logger.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var levels=this.levels;levels&&levels.forEach((function(level){level.details&&level.details.fragments.forEach((function(fragment){fragment.backtracked=void 0}))})),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("seeked",this.onvseeked),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},_proto.onMediaSeeked=function onMediaSeeked(){var media=this.media,currentTime=media?media.currentTime:void 0;Object(number_isFinite.isFiniteNumber)(currentTime)&&logger.logger.log("media seeked to "+currentTime.toFixed(3)),this.tick()},_proto.onManifestLoading=function onManifestLoading(){logger.logger.log("trigger BUFFER_RESET"),this.hls.trigger(events.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},_proto.onManifestParsed=function onManifestParsed(data){var codec,aac=!1,heaac=!1;data.levels.forEach((function(level){(codec=level.audioCodec)&&(-1!==codec.indexOf("mp4a.40.2")&&(aac=!0),-1!==codec.indexOf("mp4a.40.5")&&(heaac=!0))})),this.audioCodecSwitch=aac&&heaac,this.audioCodecSwitch&&logger.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=data.altAudio,this.levels=data.levels,this.startFragRequested=!1;var config=this.config;(config.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(config.startPosition)},_proto.onLevelLoaded=function onLevelLoaded(data){var newDetails=data.details,newLevelId=data.level,lastLevel=this.levels[this.levelLastLoaded],curLevel=this.levels[newLevelId],duration=newDetails.totalduration,sliding=0;if(logger.logger.log("level "+newLevelId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration),newDetails.live){var curDetails=curLevel.details;curDetails&&newDetails.fragments.length>0?(mergeDetails(curDetails,newDetails),sliding=newDetails.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(sliding,curDetails),newDetails.PTSKnown&&Object(number_isFinite.isFiniteNumber)(sliding)?logger.logger.log("live playlist sliding:"+sliding.toFixed(3)):(logger.logger.log("live playlist - outdated PTS, unknown sliding"),alignStream(this.fragPrevious,lastLevel,newDetails))):(logger.logger.log("live playlist - first load, unknown sliding"),newDetails.PTSKnown=!1,alignStream(this.fragPrevious,lastLevel,newDetails))}else newDetails.PTSKnown=!1;if(curLevel.details=newDetails,this.levelLastLoaded=newLevelId,this.hls.trigger(events.default.LEVEL_UPDATED,{details:newDetails,level:newLevelId}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var startTimeOffset=newDetails.startTimeOffset;Object(number_isFinite.isFiniteNumber)(startTimeOffset)?(startTimeOffset<0&&(logger.logger.log("negative start time offset "+startTimeOffset+", count from end of last fragment"),startTimeOffset=sliding+duration+startTimeOffset),logger.logger.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this.startPosition=startTimeOffset):newDetails.live?(this.startPosition=this.computeLivePosition(sliding,newDetails),logger.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===State_WAITING_LEVEL&&(this.state=State_IDLE),this.tick()},_proto.onKeyLoaded=function onKeyLoaded(){this.state===State_KEY_LOADING&&(this.state=State_IDLE,this.tick())},_proto.onFragLoaded=function onFragLoaded(data){var fragCurrent=this.fragCurrent,hls=this.hls,levels=this.levels,media=this.media,fragLoaded=data.frag;if(this.state===State_FRAG_LOADING&&fragCurrent&&"main"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var stats=data.stats,currentLevel=levels[fragCurrent.level],details=currentLevel.details;if(this.bitrateTest=!1,this.stats=stats,logger.logger.log("Loaded "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level),fragLoaded.bitrateTest&&hls.nextLoadLevel)this.state=State_IDLE,this.startFragRequested=!1,stats.tparsed=stats.tbuffered=window.performance.now(),hls.trigger(events.default.FRAG_BUFFERED,{stats,frag:fragCurrent,id:"main"}),this.tick();else if("initSegment"===fragLoaded.sn)this.state=State_IDLE,stats.tparsed=stats.tbuffered=window.performance.now(),details.initSegment.data=data.payload,hls.trigger(events.default.FRAG_BUFFERED,{stats,frag:fragCurrent,id:"main"}),this.tick();else{logger.logger.log("Parsing "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level+", cc "+fragCurrent.cc),this.state=State_PARSING,this.pendingBuffering=!0,this.appended=!1,fragLoaded.bitrateTest&&(fragLoaded.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:fragLoaded}));var accurateTimeOffset=!(media&&media.seeking)&&(details.PTSKnown||!details.live),initSegmentData=details.initSegment?details.initSegment.data:[],audioCodec=this._getAudioCodec(currentLevel);(this.demuxer=this.demuxer||new demux_demuxer(this.hls,"main")).push(data.payload,initSegmentData,audioCodec,currentLevel.videoCodec,fragCurrent,details.totalduration,accurateTimeOffset)}}this.fragLoadError=0},_proto.onFragParsingInitSegment=function onFragParsingInitSegment(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING){var trackName,track,tracks=data.tracks;if(tracks.audio&&this.altAudio&&delete tracks.audio,track=tracks.audio){var audioCodec=this.levels[this.level].audioCodec,ua=navigator.userAgent.toLowerCase();audioCodec&&this.audioCodecSwap&&(logger.logger.log("swapping playlist audio codec"),audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==track.metadata.channelCount&&-1===ua.indexOf("firefox")&&(audioCodec="mp4a.40.5"),-1!==ua.indexOf("android")&&"audio/mpeg"!==track.container&&(audioCodec="mp4a.40.2",logger.logger.log("Android: force audio codec to "+audioCodec)),track.levelCodec=audioCodec,track.id=data.id}for(trackName in(track=tracks.video)&&(track.levelCodec=this.levels[this.level].videoCodec,track.id=data.id),this.hls.trigger(events.default.BUFFER_CODECS,tracks),tracks){track=tracks[trackName],logger.logger.log("main track:"+trackName+",container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;initSegment&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(events.default.BUFFER_APPENDING,{type:trackName,data:initSegment,parent:"main",content:"initSegment"}))}this.tick()}},_proto.onFragParsingData=function onFragParsingData(data){var _this2=this,fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&("audio"!==data.type||!this.altAudio)&&this.state===State_PARSING){var level=this.levels[this.level],frag=fragCurrent;if(Object(number_isFinite.isFiniteNumber)(data.endPTS)||(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),!0===data.hasAudio&&frag.addElementaryStream(ElementaryStreamTypes.AUDIO),!0===data.hasVideo&&frag.addElementaryStream(ElementaryStreamTypes.VIDEO),logger.logger.log("Parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb+",dropped:"+(data.dropped||0)),"video"===data.type)if(frag.dropped=data.dropped,frag.dropped)if(frag.backtracked)logger.logger.warn("Already backtracked on this fragment, appending with the gap",frag.sn);else{var levelDetails=level.details;if(!levelDetails||frag.sn!==levelDetails.startSN)return logger.logger.warn("missing video frame(s), backtracking fragment",frag.sn),this.fragmentTracker.removeFragment(frag),frag.backtracked=!0,this.nextLoadPosition=data.startPTS,this.state=State_IDLE,this.fragPrevious=frag,void this.tick();logger.logger.warn("missing video frame(s) on first frag, appending with gap",frag.sn)}else frag.backtracked=!1;var drift=updateFragPTSDTS(level.details,frag,data.startPTS,data.endPTS,data.startDTS,data.endDTS),hls=this.hls;hls.trigger(events.default.LEVEL_PTS_UPDATED,{details:level.details,level:this.level,drift,type:data.type,start:data.startPTS,end:data.endPTS}),[data.data1,data.data2].forEach((function(buffer){buffer&&buffer.length&&_this2.state===State_PARSING&&(_this2.appended=!0,_this2.pendingBuffering=!0,hls.trigger(events.default.BUFFER_APPENDING,{type:data.type,data:buffer,parent:"main",content:"data"}))})),this.tick()}},_proto.onFragParsed=function onFragParsed(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING&&(this.stats.tparsed=window.performance.now(),this.state=State_PARSED,this._checkAppendedParsed())},_proto.onAudioTrackSwitching=function onAudioTrackSwitching(data){var altAudio=!!data.url,trackId=data.id;if(!altAudio){if(this.mediaBuffer!==this.media){logger.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fragCurrent=this.fragCurrent;fragCurrent.loader&&(logger.logger.log("switching to main audio track, cancel main fragment load"),fragCurrent.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State_IDLE}var hls=this.hls;hls.trigger(events.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:trackId}),this.altAudio=!1}},_proto.onAudioTrackSwitched=function onAudioTrackSwitched(data){var trackId=data.id,altAudio=!!this.hls.audioTracks[trackId].url;if(altAudio){var videoBuffer=this.videoBuffer;videoBuffer&&this.mediaBuffer!==videoBuffer&&(logger.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=videoBuffer)}this.altAudio=altAudio,this.tick()},_proto.onBufferCreated=function onBufferCreated(data){var mediaTrack,name,tracks=data.tracks,alternate=!1;for(var type in tracks){var track=tracks[type];"main"===track.id?(name=type,mediaTrack=track,"video"===type&&(this.videoBuffer=tracks[type].buffer)):alternate=!0}alternate&&mediaTrack?(logger.logger.log("alternate track found, use "+name+".buffered to schedule main fragment loading"),this.mediaBuffer=mediaTrack.buffer):this.mediaBuffer=this.media},_proto.onBufferAppended=function onBufferAppended(data){if("main"===data.parent){var state=this.state;state!==State_PARSING&&state!==State_PARSED||(this.pendingBuffering=data.pending>0,this._checkAppendedParsed())}},_proto._checkAppendedParsed=function _checkAppendedParsed(){if(!(this.state!==State_PARSED||this.appended&&this.pendingBuffering)){var frag=this.fragCurrent;if(frag){var media=this.mediaBuffer?this.mediaBuffer:this.media;logger.logger.log("main buffered : "+time_ranges.toString(media.buffered)),this.fragPrevious=frag;var stats=this.stats;stats.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*stats.total/(stats.tbuffered-stats.tfirst)),this.hls.trigger(events.default.FRAG_BUFFERED,{stats,frag,id:"main"}),this.state=State_IDLE}this.tick()}},_proto.onError=function onError(data){var frag=data.frag||this.fragCurrent;if(!frag||"main"===frag.type){var mediaBuffered=!!this.media&&BufferHelper.isBuffered(this.media,this.media.currentTime)&&BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case errors.ErrorDetails.KEY_LOAD_ERROR:case errors.ErrorDetails.KEY_LOAD_TIMEOUT:if(!data.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var delay=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);logger.logger.warn("mediaController: frag loading failed, retry in "+delay+" ms"),this.retryDate=window.performance.now()+delay,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=State_FRAG_LOADING_WAITING_RETRY}else logger.logger.error("mediaController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State_ERROR;break;case errors.ErrorDetails.LEVEL_LOAD_ERROR:case errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==State_ERROR&&(data.fatal?(this.state=State_ERROR,logger.logger.warn("streamController: "+data.details+",switch to "+this.state+" state ...")):data.levelRetry||this.state!==State_WAITING_LEVEL||(this.state=State_IDLE));break;case errors.ErrorDetails.BUFFER_FULL_ERROR:"main"!==data.parent||this.state!==State_PARSING&&this.state!==State_PARSED||(mediaBuffered?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=State_IDLE):(logger.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},_proto._reduceMaxBufferLength=function _reduceMaxBufferLength(minLength){var config=this.config;return config.maxMaxBufferLength>=minLength&&(config.maxMaxBufferLength/=2,logger.logger.warn("main:reduce max buffer length to "+config.maxMaxBufferLength+"s"),!0)},_proto._checkBuffer=function _checkBuffer(){var media=this.media;if(media&&0!==media.readyState){var buffered=(this.mediaBuffer?this.mediaBuffer:media).buffered;!this.loadedmetadata&&buffered.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,buffered)}},_proto.onFragLoadEmergencyAborted=function onFragLoadEmergencyAborted(){this.state=State_IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},_proto.onBufferFlushed=function onBufferFlushed(){var media=this.mediaBuffer?this.mediaBuffer:this.media;media&&this.fragmentTracker.detectEvictedFragments(ElementaryStreamTypes.VIDEO,media.buffered),this.state=State_IDLE,this.fragPrevious=null},_proto.swapAudioCodec=function swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap},_proto._seekToStartPos=function _seekToStartPos(){var media=this.media,currentTime=media.currentTime,startPosition=media.seeking?currentTime:this.startPosition;currentTime!==startPosition&&startPosition>=0&&(logger.logger.log("target start position not buffered, seek to buffered.start(0) "+startPosition+" from current time "+currentTime+" "),media.currentTime=startPosition)},_proto._getAudioCodec=function _getAudioCodec(currentLevel){var audioCodec=this.config.defaultAudioCodec||currentLevel.audioCodec;return this.audioCodecSwap&&(logger.logger.log("swapping playlist audio codec"),audioCodec&&(audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),audioCodec},function stream_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&stream_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&stream_controller_defineProperties(Constructor,staticProps),Constructor}(StreamController,[{key:"state",set:function set(nextState){if(this.state!==nextState){var previousState=this.state;this._state=nextState,logger.logger.log("main stream-controller: "+previousState+"->"+nextState),this.hls.trigger(events.default.STREAM_STATE_TRANSITION,{previousState,nextState})}},get:function get(){return this._state}},{key:"currentLevel",get:function get(){var media=this.media;if(media){var frag=this.getBufferedFrag(media.currentTime);if(frag)return frag.level}return-1}},{key:"nextBufferedFrag",get:function get(){var media=this.media;return media?this.followingBufferedFrag(this.getBufferedFrag(media.currentTime)):null}},{key:"nextLevel",get:function get(){var frag=this.nextBufferedFrag;return frag?frag.level:-1}},{key:"liveSyncPosition",get:function get(){return this._liveSyncPosition},set:function set(value){this._liveSyncPosition=value}}]),StreamController}(base_stream_controller_BaseStreamController);function level_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}window.performance;var chromeOrFirefox,level_controller_LevelController=function(_EventHandler){function LevelController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MANIFEST_LOADED,events.default.LEVEL_LOADED,events.default.AUDIO_TRACK_SWITCHED,events.default.FRAG_LOADED,events.default.ERROR)||this).canload=!1,_this.currentLevelIndex=null,_this.manualLevelIndex=-1,_this.timer=null,chromeOrFirefox=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),_this}!function level_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(LevelController,_EventHandler);var _proto=LevelController.prototype;return _proto.onHandlerDestroying=function onHandlerDestroying(){this.clearTimer(),this.manualLevelIndex=-1},_proto.clearTimer=function clearTimer(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},_proto.startLoad=function startLoad(){var levels=this._levels;this.canload=!0,this.levelRetryCount=0,levels&&levels.forEach((function(level){level.loadError=0;var levelDetails=level.details;levelDetails&&levelDetails.live&&(level.details=void 0)})),null!==this.timer&&this.loadLevel()},_proto.stopLoad=function stopLoad(){this.canload=!1},_proto.onManifestLoaded=function onManifestLoaded(data){var bitrateStart,levels=[],audioTracks=[],levelSet={},levelFromSet=null,videoCodecFound=!1,audioCodecFound=!1;if(data.levels.forEach((function(level){var attributes=level.attrs;level.loadError=0,level.fragmentError=!1,videoCodecFound=videoCodecFound||!!level.videoCodec,audioCodecFound=audioCodecFound||!!level.audioCodec,chromeOrFirefox&&level.audioCodec&&-1!==level.audioCodec.indexOf("mp4a.40.34")&&(level.audioCodec=void 0),(levelFromSet=levelSet[level.bitrate])?levelFromSet.url.push(level.url):(level.url=[level.url],level.urlId=0,levelSet[level.bitrate]=level,levels.push(level)),attributes&&(attributes.AUDIO&&(audioCodecFound=!0,addGroupId(levelFromSet||level,"audio",attributes.AUDIO)),attributes.SUBTITLES&&addGroupId(levelFromSet||level,"text",attributes.SUBTITLES))})),videoCodecFound&&audioCodecFound&&(levels=levels.filter((function(_ref){return!!_ref.videoCodec}))),levels=levels.filter((function(_ref2){var audioCodec=_ref2.audioCodec,videoCodec=_ref2.videoCodec;return(!audioCodec||isCodecSupportedInMp4(audioCodec,"audio"))&&(!videoCodec||isCodecSupportedInMp4(videoCodec,"video"))})),data.audioTracks&&(audioTracks=data.audioTracks.filter((function(track){return!track.audioCodec||isCodecSupportedInMp4(track.audioCodec,"audio")}))).forEach((function(track,index){track.id=index})),levels.length>0){bitrateStart=levels[0].bitrate,levels.sort((function(a,b){return a.bitrate-b.bitrate})),this._levels=levels;for(var i=0;i<levels.length;i++)if(levels[i].bitrate===bitrateStart){this._firstLevel=i,logger.logger.log("manifest loaded,"+levels.length+" level(s) found, first bitrate:"+bitrateStart);break}this.hls.trigger(events.default.MANIFEST_PARSED,{levels,audioTracks,firstLevel:this._firstLevel,stats:data.stats,audio:audioCodecFound,video:videoCodecFound,altAudio:audioTracks.some((function(t){return!!t.url}))})}else this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},_proto.setLevelInternal=function setLevelInternal(newLevel){var levels=this._levels,hls=this.hls;if(newLevel>=0&&newLevel<levels.length){if(this.clearTimer(),this.currentLevelIndex!==newLevel){logger.logger.log("switching to level "+newLevel),this.currentLevelIndex=newLevel;var levelProperties=levels[newLevel];levelProperties.level=newLevel,hls.trigger(events.default.LEVEL_SWITCHING,levelProperties)}var level=levels[newLevel],levelDetails=level.details;if(!levelDetails||levelDetails.live){var urlId=level.urlId;hls.trigger(events.default.LEVEL_LOADING,{url:level.url[urlId],level:newLevel,id:urlId})}}else hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.OTHER_ERROR,details:errors.ErrorDetails.LEVEL_SWITCH_ERROR,level:newLevel,fatal:!1,reason:"invalid level idx"})},_proto.onError=function onError(data){if(data.fatal)data.type===errors.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var levelIndex,levelError=!1,fragmentError=!1;switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case errors.ErrorDetails.KEY_LOAD_ERROR:case errors.ErrorDetails.KEY_LOAD_TIMEOUT:levelIndex=data.frag.level,fragmentError=!0;break;case errors.ErrorDetails.LEVEL_LOAD_ERROR:case errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:levelIndex=data.context.level,levelError=!0;break;case errors.ErrorDetails.REMUX_ALLOC_ERROR:levelIndex=data.level,levelError=!0}void 0!==levelIndex&&this.recoverLevel(data,levelIndex,levelError,fragmentError)}},_proto.recoverLevel=function recoverLevel(errorEvent,levelIndex,levelError,fragmentError){var redundantLevels,delay,nextLevel,_this2=this,config=this.hls.config,errorDetails=errorEvent.details,level=this._levels[levelIndex];if(level.loadError++,level.fragmentError=fragmentError,levelError){if(!(this.levelRetryCount+1<=config.levelLoadingMaxRetry))return logger.logger.error("level controller, cannot recover from "+errorDetails+" error"),this.currentLevelIndex=null,this.clearTimer(),void(errorEvent.fatal=!0);delay=Math.min(Math.pow(2,this.levelRetryCount)*config.levelLoadingRetryDelay,config.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return _this2.loadLevel()}),delay),errorEvent.levelRetry=!0,this.levelRetryCount++,logger.logger.warn("level controller, "+errorDetails+", retry in "+delay+" ms, current retry count is "+this.levelRetryCount)}(levelError||fragmentError)&&((redundantLevels=level.url.length)>1&&level.loadError<redundantLevels?(level.urlId=(level.urlId+1)%redundantLevels,level.details=void 0,logger.logger.warn("level controller, "+errorDetails+" for level "+levelIndex+": switching to redundant URL-id "+level.urlId)):-1===this.manualLevelIndex?(nextLevel=0===levelIndex?this._levels.length-1:levelIndex-1,logger.logger.warn("level controller, "+errorDetails+": switch to "+nextLevel),this.hls.nextAutoLevel=this.currentLevelIndex=nextLevel):fragmentError&&(logger.logger.warn("level controller, "+errorDetails+": reload a fragment"),this.currentLevelIndex=null))},_proto.onFragLoaded=function onFragLoaded(_ref3){var frag=_ref3.frag;if(void 0!==frag&&"main"===frag.type){var level=this._levels[frag.level];void 0!==level&&(level.fragmentError=!1,level.loadError=0,this.levelRetryCount=0)}},_proto.onLevelLoaded=function onLevelLoaded(data){var _this3=this,level=data.level,details=data.details;if(level===this.currentLevelIndex){var curLevel=this._levels[level];if(curLevel.fragmentError||(curLevel.loadError=0,this.levelRetryCount=0),details.live){var reloadInterval=computeReloadInterval(curLevel.details,details,data.stats.trequest);logger.logger.log("live playlist, reload in "+Math.round(reloadInterval)+" ms"),this.timer=setTimeout((function(){return _this3.loadLevel()}),reloadInterval)}else this.clearTimer()}},_proto.onAudioTrackSwitched=function onAudioTrackSwitched(data){var audioGroupId=this.hls.audioTracks[data.id].groupId,currentLevel=this.hls.levels[this.currentLevelIndex];if(currentLevel&&currentLevel.audioGroupIds){for(var urlId=-1,i=0;i<currentLevel.audioGroupIds.length;i++)if(currentLevel.audioGroupIds[i]===audioGroupId){urlId=i;break}urlId!==currentLevel.urlId&&(currentLevel.urlId=urlId,this.startLoad())}},_proto.loadLevel=function loadLevel(){if(logger.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var levelObject=this._levels[this.currentLevelIndex];if("object"==typeof levelObject&&levelObject.url.length>0){var level=this.currentLevelIndex,id=levelObject.urlId,url=levelObject.url[id];logger.logger.log("Attempt loading level index "+level+" with URL-id "+id),this.hls.trigger(events.default.LEVEL_LOADING,{url,level,id})}}},function level_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&level_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&level_controller_defineProperties(Constructor,staticProps),Constructor}(LevelController,[{key:"levels",get:function get(){return this._levels}},{key:"level",get:function get(){return this.currentLevelIndex},set:function set(newLevel){var levels=this._levels;levels&&(newLevel=Math.min(newLevel,levels.length-1),this.currentLevelIndex===newLevel&&levels[newLevel].details||this.setLevelInternal(newLevel))}},{key:"manualLevel",get:function get(){return this.manualLevelIndex},set:function set(newLevel){this.manualLevelIndex=newLevel,void 0===this._startLevel&&(this._startLevel=newLevel),-1!==newLevel&&(this.level=newLevel)}},{key:"firstLevel",get:function get(){return this._firstLevel},set:function set(newLevel){this._firstLevel=newLevel}},{key:"startLevel",get:function get(){if(void 0===this._startLevel){var configStartLevel=this.hls.config.startLevel;return void 0!==configStartLevel?configStartLevel:this._firstLevel}return this._startLevel},set:function set(newLevel){this._startLevel=newLevel}},{key:"nextLoadLevel",get:function get(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function set(nextLevel){this.level=nextLevel,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=nextLevel)}}]),LevelController}(event_handler),id3=__webpack_require__("./src/demux/id3.js");function sendAddTrackEvent(track,videoEl){var event;try{event=new Event("addtrack")}catch(err){(event=document.createEvent("Event")).initEvent("addtrack",!1,!1)}event.track=track,videoEl.dispatchEvent(event)}function clearCurrentCues(track){if(track&&track.cues)for(;track.cues.length>0;)track.removeCue(track.cues[0])}var id3_track_controller=function(_EventHandler){function ID3TrackController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.FRAG_PARSING_METADATA,events.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,_this.media=void 0,_this}!function id3_track_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(ID3TrackController,_EventHandler);var _proto=ID3TrackController.prototype;return _proto.destroy=function destroy(){event_handler.prototype.destroy.call(this)},_proto.onMediaAttached=function onMediaAttached(data){this.media=data.media,this.media},_proto.onMediaDetaching=function onMediaDetaching(){clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},_proto.getID3Track=function getID3Track(textTracks){for(var i=0;i<textTracks.length;i++){var textTrack=textTracks[i];if("metadata"===textTrack.kind&&"id3"===textTrack.label)return sendAddTrackEvent(textTrack,this.media),textTrack}return this.media.addTextTrack("metadata","id3")},_proto.onFragParsingMetadata=function onFragParsingMetadata(data){var fragment=data.frag,samples=data.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var Cue=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<samples.length;i++){var frames=id3.default.getID3Frames(samples[i].data);if(frames){var startTime=samples[i].pts,endTime=i<samples.length-1?samples[i+1].pts:fragment.endPTS;startTime===endTime?endTime+=1e-4:startTime>endTime&&(logger.logger.warn("detected an id3 sample with endTime < startTime, adjusting endTime to (startTime + 0.25)"),endTime=startTime+.25);for(var j=0;j<frames.length;j++){var frame=frames[j];if(!id3.default.isTimeStampFrame(frame)){var cue=new Cue(startTime,endTime,"");cue.value=frame,this.id3Track.addCue(cue)}}}}},_proto.onLiveBackBufferReached=function onLiveBackBufferReached(_ref){var bufferEnd=_ref.bufferEnd,id3Track=this.id3Track;if(id3Track&&id3Track.cues&&id3Track.cues.length){var foundCue=function getClosestCue(cues,time){if(time<cues[0].endTime)return cues[0];if(time>cues[cues.length-1].endTime)return cues[cues.length-1];for(var left=0,right=cues.length-1;left<=right;){var mid=Math.floor((right+left)/2);if(time<cues[mid].endTime)right=mid-1;else{if(!(time>cues[mid].endTime))return cues[mid];left=mid+1}}return cues[left].endTime-time<time-cues[right].endTime?cues[left]:cues[right]}(id3Track.cues,bufferEnd);if(foundCue)for(;id3Track.cues[0]!==foundCue;)id3Track.removeCue(id3Track.cues[0])}},ID3TrackController}(event_handler);var ewma=function(){function EWMA(halfLife){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=halfLife?Math.exp(Math.log(.5)/halfLife):0,this.estimate_=0,this.totalWeight_=0}var _proto=EWMA.prototype;return _proto.sample=function sample(weight,value){var adjAlpha=Math.pow(this.alpha_,weight);this.estimate_=value*(1-adjAlpha)+adjAlpha*this.estimate_,this.totalWeight_+=weight},_proto.getTotalWeight=function getTotalWeight(){return this.totalWeight_},_proto.getEstimate=function getEstimate(){if(this.alpha_){var zeroFactor=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/zeroFactor}return this.estimate_},EWMA}(),ewma_bandwidth_estimator=function(){function EwmaBandWidthEstimator(hls,slow,fast,defaultEstimate){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=hls,this.defaultEstimate_=defaultEstimate,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ewma(slow),this.fast_=new ewma(fast)}var _proto=EwmaBandWidthEstimator.prototype;return _proto.sample=function sample(durationMs,numBytes){var durationS=(durationMs=Math.max(durationMs,this.minDelayMs_))/1e3,bandwidthInBps=8*numBytes/durationS;this.fast_.sample(durationS,bandwidthInBps),this.slow_.sample(durationS,bandwidthInBps)},_proto.canEstimate=function canEstimate(){var fast=this.fast_;return fast&&fast.getTotalWeight()>=this.minWeight_},_proto.getEstimate=function getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_proto.destroy=function destroy(){},EwmaBandWidthEstimator}();function abr_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var abr_controller_performance=window.performance,abr_controller=function(_EventHandler){function AbrController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.FRAG_LOADING,events.default.FRAG_LOADED,events.default.FRAG_BUFFERED,events.default.ERROR)||this).lastLoadedFragLevel=0,_this._nextAutoLevel=-1,_this.hls=hls,_this.timer=null,_this._bwEstimator=null,_this.onCheck=_this._abandonRulesCheck.bind(function abr_controller_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(_this)),_this}!function abr_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(AbrController,_EventHandler);var _proto=AbrController.prototype;return _proto.destroy=function destroy(){this.clearTimer(),event_handler.prototype.destroy.call(this)},_proto.onFragLoading=function onFragLoading(data){var frag=data.frag;if("main"===frag.type&&(this.timer||(this.fragCurrent=frag,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var ewmaFast,ewmaSlow,hls=this.hls,config=hls.config,level=frag.level;hls.levels[level].details.live?(ewmaFast=config.abrEwmaFastLive,ewmaSlow=config.abrEwmaSlowLive):(ewmaFast=config.abrEwmaFastVoD,ewmaSlow=config.abrEwmaSlowVoD),this._bwEstimator=new ewma_bandwidth_estimator(hls,ewmaSlow,ewmaFast,config.abrEwmaDefaultEstimate)}},_proto._abandonRulesCheck=function _abandonRulesCheck(){var hls=this.hls,video=hls.media,frag=this.fragCurrent;if(frag){var loader=frag.loader,minAutoLevel=hls.minAutoLevel;if(!loader||loader.stats&&loader.stats.aborted)return logger.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var stats=loader.stats;if(video&&stats&&(!video.paused&&0!==video.playbackRate||!video.readyState)&&frag.autoLevel&&frag.level){var requestDelay=abr_controller_performance.now()-stats.trequest,playbackRate=Math.abs(video.playbackRate);if(requestDelay>500*frag.duration/playbackRate){var levels=hls.levels,loadRate=Math.max(1,stats.bw?stats.bw/8:1e3*stats.loaded/requestDelay),level=levels[frag.level],levelBitrate=level.realBitrate?Math.max(level.realBitrate,level.bitrate):level.bitrate,expectedLen=stats.total?stats.total:Math.max(stats.loaded,Math.round(frag.duration*levelBitrate/8)),pos=video.currentTime,fragLoadedDelay=(expectedLen-stats.loaded)/loadRate,bufferStarvationDelay=(BufferHelper.bufferInfo(video,pos,hls.config.maxBufferHole).end-pos)/playbackRate;if(bufferStarvationDelay<2*frag.duration/playbackRate&&fragLoadedDelay>bufferStarvationDelay){var nextLoadLevel;for(nextLoadLevel=frag.level-1;nextLoadLevel>minAutoLevel;nextLoadLevel--){var levelNextBitrate=levels[nextLoadLevel].realBitrate?Math.max(levels[nextLoadLevel].realBitrate,levels[nextLoadLevel].bitrate):levels[nextLoadLevel].bitrate;if(frag.duration*levelNextBitrate/(6.4*loadRate)<bufferStarvationDelay)break}undefined<fragLoadedDelay&&(logger.logger.warn("loading too slow, abort fragment loading and switch to level "+nextLoadLevel+":fragLoadedDelay["+nextLoadLevel+"]<fragLoadedDelay["+(frag.level-1)+"];bufferStarvationDelay:"+undefined.toFixed(1)+"<"+fragLoadedDelay.toFixed(1)+":"+bufferStarvationDelay.toFixed(1)),hls.nextLoadLevel=nextLoadLevel,this._bwEstimator.sample(requestDelay,stats.loaded),loader.abort(),this.clearTimer(),hls.trigger(events.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag,stats}))}}}}},_proto.onFragLoaded=function onFragLoaded(data){var frag=data.frag;if("main"===frag.type&&Object(number_isFinite.isFiniteNumber)(frag.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=frag.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var level=this.hls.levels[frag.level],loadedBytes=(level.loaded?level.loaded.bytes:0)+data.stats.loaded,loadedDuration=(level.loaded?level.loaded.duration:0)+data.frag.duration;level.loaded={bytes:loadedBytes,duration:loadedDuration},level.realBitrate=Math.round(8*loadedBytes/loadedDuration)}if(data.frag.bitrateTest){var stats=data.stats;stats.tparsed=stats.tbuffered=stats.tload,this.onFragBuffered(data)}}},_proto.onFragBuffered=function onFragBuffered(data){var stats=data.stats,frag=data.frag;if(!0!==stats.aborted&&"main"===frag.type&&Object(number_isFinite.isFiniteNumber)(frag.sn)&&(!frag.bitrateTest||stats.tload===stats.tbuffered)){var fragLoadingProcessingMs=stats.tparsed-stats.trequest;logger.logger.log("latency/loading/parsing/append/kbps:"+Math.round(stats.tfirst-stats.trequest)+"/"+Math.round(stats.tload-stats.tfirst)+"/"+Math.round(stats.tparsed-stats.tload)+"/"+Math.round(stats.tbuffered-stats.tparsed)+"/"+Math.round(8*stats.loaded/(stats.tbuffered-stats.trequest))),this._bwEstimator.sample(fragLoadingProcessingMs,stats.loaded),stats.bwEstimate=this._bwEstimator.getEstimate(),frag.bitrateTest?this.bitrateTestDelay=fragLoadingProcessingMs/1e3:this.bitrateTestDelay=0}},_proto.onError=function onError(data){switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},_proto.clearTimer=function clearTimer(){clearInterval(this.timer),this.timer=null},_proto._findBestLevel=function _findBestLevel(currentLevel,currentFragDuration,currentBw,minAutoLevel,maxAutoLevel,maxFetchDuration,bwFactor,bwUpFactor,levels){for(var i=maxAutoLevel;i>=minAutoLevel;i--){var levelInfo=levels[i];if(levelInfo){var levelDetails=levelInfo.details,avgDuration=levelDetails?levelDetails.totalduration/levelDetails.fragments.length:currentFragDuration,live=!!levelDetails&&levelDetails.live,adjustedbw=void 0;adjustedbw=i<=currentLevel?bwFactor*currentBw:bwUpFactor*currentBw;var bitrate=levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate,fetchDuration=bitrate*avgDuration/adjustedbw;if(logger.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+i+"/"+Math.round(adjustedbw)+"/"+bitrate+"/"+avgDuration+"/"+maxFetchDuration+"/"+fetchDuration),adjustedbw>bitrate&&(!fetchDuration||live&&!this.bitrateTestDelay||fetchDuration<maxFetchDuration))return i}}return-1},function abr_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&abr_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&abr_controller_defineProperties(Constructor,staticProps),Constructor}(AbrController,[{key:"nextAutoLevel",get:function get(){var forcedAutoLevel=this._nextAutoLevel,bwEstimator=this._bwEstimator;if(!(-1===forcedAutoLevel||bwEstimator&&bwEstimator.canEstimate()))return forcedAutoLevel;var nextABRAutoLevel=this._nextABRAutoLevel;return-1!==forcedAutoLevel&&(nextABRAutoLevel=Math.min(forcedAutoLevel,nextABRAutoLevel)),nextABRAutoLevel},set:function set(nextLevel){this._nextAutoLevel=nextLevel}},{key:"_nextABRAutoLevel",get:function get(){var hls=this.hls,maxAutoLevel=hls.maxAutoLevel,levels=hls.levels,config=hls.config,minAutoLevel=hls.minAutoLevel,video=hls.media,currentLevel=this.lastLoadedFragLevel,currentFragDuration=this.fragCurrent?this.fragCurrent.duration:0,pos=video?video.currentTime:0,playbackRate=video&&0!==video.playbackRate?Math.abs(video.playbackRate):1,avgbw=this._bwEstimator?this._bwEstimator.getEstimate():config.abrEwmaDefaultEstimate,bufferStarvationDelay=(BufferHelper.bufferInfo(video,pos,config.maxBufferHole).end-pos)/playbackRate,bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,config.abrBandWidthFactor,config.abrBandWidthUpFactor,levels);if(bestLevel>=0)return bestLevel;logger.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var maxStarvationDelay=currentFragDuration?Math.min(currentFragDuration,config.maxStarvationDelay):config.maxStarvationDelay,bwFactor=config.abrBandWidthFactor,bwUpFactor=config.abrBandWidthUpFactor;if(0===bufferStarvationDelay){var bitrateTestDelay=this.bitrateTestDelay;if(bitrateTestDelay)maxStarvationDelay=(currentFragDuration?Math.min(currentFragDuration,config.maxLoadingDelay):config.maxLoadingDelay)-bitrateTestDelay,logger.logger.trace("bitrate test took "+Math.round(1e3*bitrateTestDelay)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*maxStarvationDelay)+" ms"),bwFactor=bwUpFactor=1}return bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay+maxStarvationDelay,bwFactor,bwUpFactor,levels),Math.max(bestLevel,0)}}]),AbrController}(event_handler);var buffer_controller_MediaSource=getMediaSource(),buffer_controller=function(_EventHandler){function BufferController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHING,events.default.MEDIA_DETACHING,events.default.MANIFEST_PARSED,events.default.BUFFER_RESET,events.default.BUFFER_APPENDING,events.default.BUFFER_CODECS,events.default.BUFFER_EOS,events.default.BUFFER_FLUSHING,events.default.LEVEL_PTS_UPDATED,events.default.LEVEL_UPDATED)||this)._msDuration=null,_this._levelDuration=null,_this._levelTargetDuration=10,_this._live=null,_this._objectUrl=null,_this._needsFlush=!1,_this._needsEos=!1,_this.config=void 0,_this.audioTimestampOffset=void 0,_this.bufferCodecEventsExpected=0,_this._bufferCodecEventsTotal=0,_this.media=null,_this.mediaSource=null,_this.segments=[],_this.parent=void 0,_this.appending=!1,_this.appended=0,_this.appendError=0,_this.flushBufferCounter=0,_this.tracks={},_this.pendingTracks={},_this.sourceBuffer={},_this.flushRange=[],_this._onMediaSourceOpen=function(){logger.logger.log("media source opened"),_this.hls.trigger(events.default.MEDIA_ATTACHED,{media:_this.media});var mediaSource=_this.mediaSource;mediaSource&&mediaSource.removeEventListener("sourceopen",_this._onMediaSourceOpen),_this.checkPendingTracks()},_this._onMediaSourceClose=function(){logger.logger.log("media source closed")},_this._onMediaSourceEnded=function(){logger.logger.log("media source ended")},_this._onSBUpdateEnd=function(){if(_this.audioTimestampOffset&&_this.sourceBuffer.audio){var audioBuffer=_this.sourceBuffer.audio;logger.logger.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+_this.audioTimestampOffset),audioBuffer.timestampOffset=_this.audioTimestampOffset,delete _this.audioTimestampOffset}_this._needsFlush&&_this.doFlush(),_this._needsEos&&_this.checkEos(),_this.appending=!1;var parent=_this.parent,pending=_this.segments.reduce((function(counter,segment){return segment.parent===parent?counter+1:counter}),0),timeRanges={},sbSet=_this.sourceBuffer;for(var streamType in sbSet){var sb=sbSet[streamType];if(!sb)throw Error("handling source buffer update end error: source buffer for "+streamType+" uninitilized and unable to update buffered TimeRanges.");timeRanges[streamType]=sb.buffered}_this.hls.trigger(events.default.BUFFER_APPENDED,{parent,pending,timeRanges}),_this._needsFlush||_this.doAppending(),_this.updateMediaElementDuration(),0===pending&&_this.flushLiveBackBuffer()},_this._onSBUpdateError=function(event){logger.logger.error("sourceBuffer error:",event),_this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},_this.config=hls.config,_this}!function buffer_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(BufferController,_EventHandler);var _proto=BufferController.prototype;return _proto.destroy=function destroy(){event_handler.prototype.destroy.call(this)},_proto.onLevelPtsUpdated=function onLevelPtsUpdated(data){var type=data.type,audioTrack=this.tracks.audio;if("audio"===type&&audioTrack&&"audio/mpeg"===audioTrack.container){var audioBuffer=this.sourceBuffer.audio;if(!audioBuffer)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(audioBuffer.timestampOffset-data.start)>.1){var updating=audioBuffer.updating;try{audioBuffer.abort()}catch(err){logger.logger.warn("can not abort audio buffer: "+err)}updating?this.audioTimestampOffset=data.start:(logger.logger.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+data.start),audioBuffer.timestampOffset=data.start)}}},_proto.onManifestParsed=function onManifestParsed(data){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=data.altAudio?2:1,logger.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},_proto.onMediaAttaching=function onMediaAttaching(data){var media=this.media=data.media;if(media&&buffer_controller_MediaSource){var ms=this.mediaSource=new buffer_controller_MediaSource;ms.addEventListener("sourceopen",this._onMediaSourceOpen),ms.addEventListener("sourceended",this._onMediaSourceEnded),ms.addEventListener("sourceclose",this._onMediaSourceClose),media.src=window.URL.createObjectURL(ms),this._objectUrl=media.src}},_proto.onMediaDetaching=function onMediaDetaching(){logger.logger.log("media source detaching");var ms=this.mediaSource;if(ms){if("open"===ms.readyState)try{ms.endOfStream()}catch(err){logger.logger.warn("onMediaDetaching:"+err.message+" while calling endOfStream")}ms.removeEventListener("sourceopen",this._onMediaSourceOpen),ms.removeEventListener("sourceended",this._onMediaSourceEnded),ms.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):logger.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(events.default.MEDIA_DETACHED)},_proto.checkPendingTracks=function checkPendingTracks(){var bufferCodecEventsExpected=this.bufferCodecEventsExpected,pendingTracks=this.pendingTracks,pendingTracksCount=Object.keys(pendingTracks).length;(pendingTracksCount&&!bufferCodecEventsExpected||2===pendingTracksCount)&&(this.createSourceBuffers(pendingTracks),this.pendingTracks={},this.doAppending())},_proto.onBufferReset=function onBufferReset(){var sourceBuffer=this.sourceBuffer;for(var type in sourceBuffer){var sb=sourceBuffer[type];try{sb&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(sb),sb.removeEventListener("updateend",this._onSBUpdateEnd),sb.removeEventListener("error",this._onSBUpdateError))}catch(err){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},_proto.onBufferCodecs=function onBufferCodecs(tracks){var _this2=this;Object.keys(this.sourceBuffer).length||(Object.keys(tracks).forEach((function(trackName){_this2.pendingTracks[trackName]=tracks[trackName]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},_proto.createSourceBuffers=function createSourceBuffers(tracks){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;if(!mediaSource)throw Error("createSourceBuffers called when mediaSource was null");for(var trackName in tracks)if(!sourceBuffer[trackName]){var track=tracks[trackName];if(!track)throw Error("source buffer exists for track "+trackName+", however track does not");var codec=track.levelCodec||track.codec,mimeType=track.container+";codecs="+codec;logger.logger.log("creating sourceBuffer("+mimeType+")");try{var sb=sourceBuffer[trackName]=mediaSource.addSourceBuffer(mimeType);sb.addEventListener("updateend",this._onSBUpdateEnd),sb.addEventListener("error",this._onSBUpdateError),this.tracks[trackName]={buffer:sb,codec,id:track.id,container:track.container,levelCodec:track.levelCodec}}catch(err){logger.logger.error("error while trying to add sourceBuffer:"+err.message),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err,mimeType})}}this.hls.trigger(events.default.BUFFER_CREATED,{tracks:this.tracks})},_proto.onBufferAppending=function onBufferAppending(data){this._needsFlush||(this.segments?this.segments.push(data):this.segments=[data],this.doAppending())},_proto.onBufferEos=function onBufferEos(data){for(var type in this.sourceBuffer)if(!data.type||data.type===type){var sb=this.sourceBuffer[type];sb&&!sb.ended&&(sb.ended=!0,logger.logger.log(type+" sourceBuffer now EOS"))}this.checkEos()},_proto.checkEos=function checkEos(){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;if(mediaSource&&"open"===mediaSource.readyState){for(var type in sourceBuffer){var sb=sourceBuffer[type];if(sb){if(!sb.ended)return;if(sb.updating)return void(this._needsEos=!0)}}logger.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{mediaSource.endOfStream()}catch(e){logger.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},_proto.onBufferFlushing=function onBufferFlushing(data){data.type?this.flushRange.push({start:data.startOffset,end:data.endOffset,type:data.type}):(this.flushRange.push({start:data.startOffset,end:data.endOffset,type:"video"}),this.flushRange.push({start:data.startOffset,end:data.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},_proto.flushLiveBackBuffer=function flushLiveBackBuffer(){if(this._live){var liveBackBufferLength=this.config.liveBackBufferLength;if(isFinite(liveBackBufferLength)&&!(liveBackBufferLength<0))if(this.media)for(var currentTime=this.media.currentTime,sourceBuffer=this.sourceBuffer,bufferTypes=Object.keys(sourceBuffer),targetBackBufferPosition=currentTime-Math.max(liveBackBufferLength,this._levelTargetDuration),index=bufferTypes.length-1;index>=0;index--){var bufferType=bufferTypes[index],sb=sourceBuffer[bufferType];if(sb){var buffered=sb.buffered;buffered.length>0&&targetBackBufferPosition>buffered.start(0)&&this.removeBufferRange(bufferType,sb,0,targetBackBufferPosition)&&this.hls.trigger(events.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:targetBackBufferPosition})}}else logger.logger.error("flushLiveBackBuffer called without attaching media")}},_proto.onLevelUpdated=function onLevelUpdated(_ref){var details=_ref.details;details.fragments.length>0&&(this._levelDuration=details.totalduration+details.fragments[0].start,this._levelTargetDuration=details.averagetargetduration||details.targetduration||10,this._live=details.live,this.updateMediaElementDuration())},_proto.updateMediaElementDuration=function updateMediaElementDuration(){var duration,config=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var type in this.sourceBuffer){var sb=this.sourceBuffer[type];if(sb&&!0===sb.updating)return}duration=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===config.liveDurationInfinity?(logger.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>duration||!Object(number_isFinite.isFiniteNumber)(duration))&&(logger.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},_proto.doFlush=function doFlush(){for(;this.flushRange.length;){var range=this.flushRange[0];if(!this.flushBuffer(range.start,range.end,range.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var appended=0,sourceBuffer=this.sourceBuffer;try{for(var type in sourceBuffer){var sb=sourceBuffer[type];sb&&(appended+=sb.buffered.length)}}catch(error){logger.logger.error("error while accessing sourceBuffer.buffered")}this.appended=appended,this.hls.trigger(events.default.BUFFER_FLUSHED)}},_proto.doAppending=function doAppending(){var config=this.config,hls=this.hls,segments=this.segments,sourceBuffer=this.sourceBuffer;if(Object.keys(sourceBuffer).length){if(!this.media||this.media.error)return this.segments=[],void logger.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var segment=segments.shift();if(segment)try{var sb=sourceBuffer[segment.type];if(!sb)return void this._onSBUpdateEnd();if(sb.updating)return void segments.unshift(segment);sb.ended=!1,this.parent=segment.parent,sb.appendBuffer(segment.data),this.appendError=0,this.appended++,this.appending=!0}catch(err){logger.logger.error("error while trying to append buffer:"+err.message),segments.unshift(segment);var event={type:errors.ErrorTypes.MEDIA_ERROR,parent:segment.parent,details:"",fatal:!1};22===err.code?(this.segments=[],event.details=errors.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,event.details=errors.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>config.appendErrorMaxRetry&&(logger.logger.log("fail "+config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],event.fatal=!0)),hls.trigger(events.default.ERROR,event)}}}},_proto.flushBuffer=function flushBuffer(startOffset,endOffset,sbType){var sourceBuffer=this.sourceBuffer;if(!Object.keys(sourceBuffer).length)return!0;var currentTime="null";if(this.media&&(currentTime=this.media.currentTime.toFixed(3)),logger.logger.log("flushBuffer,pos/start/end: "+currentTime+"/"+startOffset+"/"+endOffset),this.flushBufferCounter>=this.appended)return logger.logger.warn("abort flushing too many retries"),!0;var sb=sourceBuffer[sbType];if(sb){if(sb.ended=!1,sb.updating)return logger.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(sbType,sb,startOffset,endOffset))return this.flushBufferCounter++,!1}return logger.logger.log("buffer flushed"),!0},_proto.removeBufferRange=function removeBufferRange(type,sb,startOffset,endOffset){try{for(var i=0;i<sb.buffered.length;i++){var bufStart=sb.buffered.start(i),bufEnd=sb.buffered.end(i),removeStart=Math.max(bufStart,startOffset),removeEnd=Math.min(bufEnd,endOffset);if(Math.min(removeEnd,bufEnd)-removeStart>.5){var currentTime="null";return this.media&&(currentTime=this.media.currentTime.toString()),logger.logger.log("sb remove "+type+" ["+removeStart+","+removeEnd+"], of ["+bufStart+","+bufEnd+"], pos:"+currentTime),sb.remove(removeStart,removeEnd),!0}}}catch(error){logger.logger.warn("removeBufferRange failed",error)}return!1},BufferController}(event_handler);function cap_level_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var cap_level_controller=function(_EventHandler){function CapLevelController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.FPS_DROP_LEVEL_CAPPING,events.default.MEDIA_ATTACHING,events.default.MANIFEST_PARSED,events.default.BUFFER_CODECS,events.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,_this.firstLevel=null,_this.levels=[],_this.media=null,_this.restrictedLevels=[],_this.timer=null,_this}!function cap_level_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(CapLevelController,_EventHandler);var _proto=CapLevelController.prototype;return _proto.destroy=function destroy(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.stopCapping())},_proto.onFpsDropLevelCapping=function onFpsDropLevelCapping(data){CapLevelController.isLevelAllowed(data.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(data.droppedLevel)},_proto.onMediaAttaching=function onMediaAttaching(data){this.media=data.media instanceof window.HTMLVideoElement?data.media:null},_proto.onManifestParsed=function onManifestParsed(data){var hls=this.hls;this.restrictedLevels=[],this.levels=data.levels,this.firstLevel=data.firstLevel,hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()},_proto.onBufferCodecs=function onBufferCodecs(data){this.hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()},_proto.onLevelsUpdated=function onLevelsUpdated(data){this.levels=data.levels},_proto.onMediaDetaching=function onMediaDetaching(){this.stopCapping()},_proto.detectPlayerSize=function detectPlayerSize(){if(this.media){var levelsLength=this.levels?this.levels.length:0;if(levelsLength){var hls=this.hls;hls.autoLevelCapping=this.getMaxLevel(levelsLength-1),hls.autoLevelCapping>this.autoLevelCapping&&hls.streamController.nextLevelSwitch(),this.autoLevelCapping=hls.autoLevelCapping}}},_proto.getMaxLevel=function getMaxLevel(capLevelIndex){var _this2=this;if(!this.levels)return-1;var validLevels=this.levels.filter((function(level,index){return CapLevelController.isLevelAllowed(index,_this2.restrictedLevels)&&index<=capLevelIndex}));return CapLevelController.getMaxLevelByMediaSize(validLevels,this.mediaWidth,this.mediaHeight)},_proto.startCapping=function startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},_proto.stopCapping=function stopCapping(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},CapLevelController.isLevelAllowed=function isLevelAllowed(level,restrictedLevels){return void 0===restrictedLevels&&(restrictedLevels=[]),-1===restrictedLevels.indexOf(level)},CapLevelController.getMaxLevelByMediaSize=function getMaxLevelByMediaSize(levels,width,height){if(!levels||levels&&!levels.length)return-1;for(var atGreatestBandiwdth=function atGreatestBandiwdth(curLevel,nextLevel){return!nextLevel||(curLevel.width!==nextLevel.width||curLevel.height!==nextLevel.height)},maxLevelIndex=levels.length-1,i=0;i<levels.length;i+=1){var level=levels[i];if((level.width>=width||level.height>=height)&&atGreatestBandiwdth(level,levels[i+1])){maxLevelIndex=i;break}}return maxLevelIndex},function cap_level_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&cap_level_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&cap_level_controller_defineProperties(Constructor,staticProps),Constructor}(CapLevelController,[{key:"mediaWidth",get:function get(){var width,media=this.media;return media&&(width=media.width||media.clientWidth||media.offsetWidth,width*=CapLevelController.contentScaleFactor),width}},{key:"mediaHeight",get:function get(){var height,media=this.media;return media&&(height=media.height||media.clientHeight||media.offsetHeight,height*=CapLevelController.contentScaleFactor),height}}],[{key:"contentScaleFactor",get:function get(){var pixelRatio=1;try{pixelRatio=window.devicePixelRatio}catch(e){}return pixelRatio}}]),CapLevelController}(event_handler);var fps_controller_performance=window.performance,fps_controller=function(_EventHandler){function FPSController(hls){return _EventHandler.call(this,hls,events.default.MEDIA_ATTACHING)||this}!function fps_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(FPSController,_EventHandler);var _proto=FPSController.prototype;return _proto.destroy=function destroy(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},_proto.onMediaAttaching=function onMediaAttaching(data){var config=this.hls.config;config.capLevelOnFPSDrop&&("function"==typeof(this.video=data.media instanceof window.HTMLVideoElement?data.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),config.fpsDroppedMonitoringPeriod))},_proto.checkFPS=function checkFPS(video,decodedFrames,droppedFrames){var currentTime=fps_controller_performance.now();if(decodedFrames){if(this.lastTime){var currentPeriod=currentTime-this.lastTime,currentDropped=droppedFrames-this.lastDroppedFrames,currentDecoded=decodedFrames-this.lastDecodedFrames,droppedFPS=1e3*currentDropped/currentPeriod,hls=this.hls;if(hls.trigger(events.default.FPS_DROP,{currentDropped,currentDecoded,totalDroppedFrames:droppedFrames}),droppedFPS>0&&currentDropped>hls.config.fpsDroppedMonitoringThreshold*currentDecoded){var currentLevel=hls.currentLevel;logger.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+currentLevel),currentLevel>0&&(-1===hls.autoLevelCapping||hls.autoLevelCapping>=currentLevel)&&(currentLevel-=1,hls.trigger(events.default.FPS_DROP_LEVEL_CAPPING,{level:currentLevel,droppedLevel:hls.currentLevel}),hls.autoLevelCapping=currentLevel,hls.streamController.nextLevelSwitch())}}this.lastTime=currentTime,this.lastDroppedFrames=droppedFrames,this.lastDecodedFrames=decodedFrames}},_proto.checkFPSInterval=function checkFPSInterval(){var video=this.video;if(video)if(this.isVideoPlaybackQualityAvailable){var videoPlaybackQuality=video.getVideoPlaybackQuality();this.checkFPS(video,videoPlaybackQuality.totalVideoFrames,videoPlaybackQuality.droppedVideoFrames)}else this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount)},FPSController}(event_handler),xhr_loader_window=window,xhr_loader_performance=xhr_loader_window.performance,xhr_loader_XMLHttpRequest=xhr_loader_window.XMLHttpRequest,xhr_loader=function(){function XhrLoader(config){config&&config.xhrSetup&&(this.xhrSetup=config.xhrSetup)}var _proto=XhrLoader.prototype;return _proto.destroy=function destroy(){this.abort(),this.loader=null},_proto.abort=function abort(){var loader=this.loader;loader&&4!==loader.readyState&&(this.stats.aborted=!0,loader.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},_proto.load=function load(context,config,callbacks){this.context=context,this.config=config,this.callbacks=callbacks,this.stats={trequest:xhr_loader_performance.now(),retry:0},this.retryDelay=config.retryDelay,this.loadInternal()},_proto.loadInternal=function loadInternal(){var xhr,context=this.context;xhr=this.loader=new xhr_loader_XMLHttpRequest;var stats=this.stats;stats.tfirst=0,stats.loaded=0;var xhrSetup=this.xhrSetup;try{if(xhrSetup)try{xhrSetup(xhr,context.url)}catch(e){xhr.open("GET",context.url,!0),xhrSetup(xhr,context.url)}xhr.readyState||xhr.open("GET",context.url,!0)}catch(e){return void this.callbacks.onError({code:xhr.status,text:e.message},context,xhr)}context.rangeEnd&&xhr.setRequestHeader("Range","bytes="+context.rangeStart+"-"+(context.rangeEnd-1)),xhr.onreadystatechange=this.readystatechange.bind(this),xhr.onprogress=this.loadprogress.bind(this),xhr.responseType=context.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),xhr.send()},_proto.readystatechange=function readystatechange(event){var xhr=event.currentTarget,readyState=xhr.readyState,stats=this.stats,context=this.context,config=this.config;if(!stats.aborted&&readyState>=2)if(window.clearTimeout(this.requestTimeout),0===stats.tfirst&&(stats.tfirst=Math.max(xhr_loader_performance.now(),stats.trequest)),4===readyState){var status=xhr.status;if(status>=200&&status<300){var data,len;stats.tload=Math.max(stats.tfirst,xhr_loader_performance.now()),len="arraybuffer"===context.responseType?(data=xhr.response).byteLength:(data=xhr.responseText).length,stats.loaded=stats.total=len;var response={url:xhr.responseURL,data};this.callbacks.onSuccess(response,stats,context,xhr)}else stats.retry>=config.maxRetry||status>=400&&status<499?(logger.logger.error(status+" while loading "+context.url),this.callbacks.onError({code:status,text:xhr.statusText},context,xhr)):(logger.logger.warn(status+" while loading "+context.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,config.maxRetryDelay),stats.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),config.timeout)},_proto.loadtimeout=function loadtimeout(){logger.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},_proto.loadprogress=function loadprogress(event){var xhr=event.currentTarget,stats=this.stats;stats.loaded=event.loaded,event.lengthComputable&&(stats.total=event.total);var onProgress=this.callbacks.onProgress;onProgress&&onProgress(stats,this.context,null,xhr)},XhrLoader}();function audio_track_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var audio_track_controller=function(_TaskLoop){function AudioTrackController(hls){var _this;return(_this=_TaskLoop.call(this,hls,events.default.MANIFEST_LOADING,events.default.MANIFEST_PARSED,events.default.AUDIO_TRACK_LOADED,events.default.AUDIO_TRACK_SWITCHED,events.default.LEVEL_LOADED,events.default.ERROR)||this)._trackId=-1,_this._selectDefaultTrack=!0,_this.tracks=[],_this.trackIdBlacklist=Object.create(null),_this.audioGroupId=null,_this}!function audio_track_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(AudioTrackController,_TaskLoop);var _proto=AudioTrackController.prototype;return _proto.onManifestLoading=function onManifestLoading(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},_proto.onManifestParsed=function onManifestParsed(data){var tracks=this.tracks=data.audioTracks||[];this.hls.trigger(events.default.AUDIO_TRACKS_UPDATED,{audioTracks:tracks}),this._selectAudioGroup(this.hls.nextLoadLevel)},_proto.onAudioTrackLoaded=function onAudioTrackLoaded(data){if(data.id>=this.tracks.length)logger.logger.warn("Invalid audio track id:",data.id);else{if(logger.logger.log("audioTrack "+data.id+" loaded"),this.tracks[data.id].details=data.details,data.details.live&&!this.hasInterval()){var updatePeriodMs=1e3*data.details.targetduration;this.setInterval(updatePeriodMs)}!data.details.live&&this.hasInterval()&&this.clearInterval()}},_proto.onAudioTrackSwitched=function onAudioTrackSwitched(data){var audioGroupId=this.tracks[data.id].groupId;audioGroupId&&this.audioGroupId!==audioGroupId&&(this.audioGroupId=audioGroupId)},_proto.onLevelLoaded=function onLevelLoaded(data){this._selectAudioGroup(data.level)},_proto.onError=function onError(data){data.type===errors.ErrorTypes.NETWORK_ERROR&&(data.fatal&&this.clearInterval(),data.details===errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(logger.logger.warn("Network failure on audio-track id:",data.context.id),this._handleLoadError()))},_proto._setAudioTrack=function _setAudioTrack(newId){if(this._trackId===newId&&this.tracks[this._trackId].details)logger.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(newId<0||newId>=this.tracks.length)logger.logger.warn("Invalid id passed to audio-track controller");else{var audioTrack=this.tracks[newId];logger.logger.log("Now switching to audio-track index "+newId),this.clearInterval(),this._trackId=newId;var url=audioTrack.url,type=audioTrack.type,id=audioTrack.id;this.hls.trigger(events.default.AUDIO_TRACK_SWITCHING,{id,type,url}),this._loadTrackDetailsIfNeeded(audioTrack)}},_proto.doTick=function doTick(){this._updateTrack(this._trackId)},_proto._selectAudioGroup=function _selectAudioGroup(levelId){var levelInfo=this.hls.levels[levelId];if(levelInfo&&levelInfo.audioGroupIds){var audioGroupId=levelInfo.audioGroupIds[levelInfo.urlId];this.audioGroupId!==audioGroupId&&(this.audioGroupId=audioGroupId,this._selectInitialAudioTrack())}},_proto._selectInitialAudioTrack=function _selectInitialAudioTrack(){var _this2=this,tracks=this.tracks;if(tracks.length){var currentAudioTrack=this.tracks[this._trackId],name=null;if(currentAudioTrack&&(name=currentAudioTrack.name),this._selectDefaultTrack){var defaultTracks=tracks.filter((function(track){return track.default}));defaultTracks.length?tracks=defaultTracks:logger.logger.warn("No default audio tracks defined")}var trackFound=!1,traverseTracks=function traverseTracks(){tracks.forEach((function(track){trackFound||_this2.audioGroupId&&track.groupId!==_this2.audioGroupId||name&&name!==track.name||(_this2._setAudioTrack(track.id),trackFound=!0)}))};traverseTracks(),trackFound||(name=null,traverseTracks()),trackFound||(logger.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},_proto._needsTrackLoading=function _needsTrackLoading(audioTrack){var details=audioTrack.details,url=audioTrack.url;return!(details&&!details.live)&&!!url},_proto._loadTrackDetailsIfNeeded=function _loadTrackDetailsIfNeeded(audioTrack){if(this._needsTrackLoading(audioTrack)){var url=audioTrack.url,id=audioTrack.id;logger.logger.log("loading audio-track playlist for id: "+id),this.hls.trigger(events.default.AUDIO_TRACK_LOADING,{url,id})}},_proto._updateTrack=function _updateTrack(newId){if(!(newId<0||newId>=this.tracks.length)){this.clearInterval(),this._trackId=newId,logger.logger.log("trying to update audio-track "+newId);var audioTrack=this.tracks[newId];this._loadTrackDetailsIfNeeded(audioTrack)}},_proto._handleLoadError=function _handleLoadError(){this.trackIdBlacklist[this._trackId]=!0;var previousId=this._trackId,_this$tracks$previous=this.tracks[previousId],name=_this$tracks$previous.name,language=_this$tracks$previous.language,groupId=_this$tracks$previous.groupId;logger.logger.warn("Loading failed on audio track id: "+previousId+", group-id: "+groupId+', name/language: "'+name+'" / "'+language+'"');for(var newId=previousId,i=0;i<this.tracks.length;i++){if(!this.trackIdBlacklist[i])if(this.tracks[i].name===name){newId=i;break}}newId!==previousId?(logger.logger.log("Attempting audio-track fallback id:",newId,"group-id:",this.tracks[newId].groupId),this._setAudioTrack(newId)):logger.logger.warn('No fallback audio-track found for name/language: "'+name+'" / "'+language+'"')},function audio_track_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&audio_track_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&audio_track_controller_defineProperties(Constructor,staticProps),Constructor}(AudioTrackController,[{key:"audioTracks",get:function get(){return this.tracks}},{key:"audioTrack",get:function get(){return this._trackId},set:function set(newId){this._setAudioTrack(newId),this._selectDefaultTrack=!1}}]),AudioTrackController}(TaskLoop);function audio_stream_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var audio_stream_controller_performance=window.performance,audio_stream_controller=function(_BaseStreamController){function AudioStreamController(hls,fragmentTracker){var _this;return(_this=_BaseStreamController.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.AUDIO_TRACKS_UPDATED,events.default.AUDIO_TRACK_SWITCHING,events.default.AUDIO_TRACK_LOADED,events.default.KEY_LOADED,events.default.FRAG_LOADED,events.default.FRAG_PARSING_INIT_SEGMENT,events.default.FRAG_PARSING_DATA,events.default.FRAG_PARSED,events.default.ERROR,events.default.BUFFER_RESET,events.default.BUFFER_CREATED,events.default.BUFFER_APPENDED,events.default.BUFFER_FLUSHED,events.default.INIT_PTS_FOUND)||this).fragmentTracker=fragmentTracker,_this.config=hls.config,_this.audioCodecSwap=!1,_this._state=State_STOPPED,_this.initPTS=[],_this.waitingFragment=null,_this.videoTrackCC=null,_this}!function audio_stream_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(AudioStreamController,_BaseStreamController);var _proto=AudioStreamController.prototype;return _proto.onInitPtsFound=function onInitPtsFound(data){var demuxerId=data.id,cc=data.frag.cc,initPTS=data.initPTS;"main"===demuxerId&&(this.initPTS[cc]=initPTS,this.videoTrackCC=cc,logger.logger.log("InitPTS for cc: "+cc+" found from video track: "+initPTS),this.state===State_WAITING_INIT_PTS&&this.tick())},_proto.startLoad=function startLoad(startPosition){if(this.tracks){var lastCurrentTime=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,lastCurrentTime>0&&-1===startPosition?(logger.logger.log("audio:override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),this.state=State_IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:startPosition,this.state=State_STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=startPosition,this.state=State_STOPPED},_proto.doTick=function doTick(){var pos,track,trackDetails,hls=this.hls,config=hls.config;switch(this.state){case State_ERROR:case State_PAUSED:case State_BUFFER_FLUSHING:break;case State_STARTING:this.state=State_WAITING_TRACK,this.loadedmetadata=!1;break;case State_IDLE:var tracks=this.tracks;if(!tracks)break;if(!this.media&&(this.startFragRequested||!config.startFragPrefetch))break;if(this.loadedmetadata)pos=this.media.currentTime;else if(void 0===(pos=this.nextLoadPosition))break;var media=this.mediaBuffer?this.mediaBuffer:this.media,videoBuffer=this.videoBuffer?this.videoBuffer:this.media,bufferInfo=BufferHelper.bufferInfo(media,pos,config.maxBufferHole),mainBufferInfo=BufferHelper.bufferInfo(videoBuffer,pos,config.maxBufferHole),bufferLen=bufferInfo.len,bufferEnd=bufferInfo.end,fragPrevious=this.fragPrevious,maxConfigBuffer=Math.min(config.maxBufferLength,config.maxMaxBufferLength),maxBufLen=Math.max(maxConfigBuffer,mainBufferInfo.len),audioSwitch=this.audioSwitch,trackId=this.trackId;if((bufferLen<maxBufLen||audioSwitch)&&trackId<tracks.length){if(void 0===(trackDetails=tracks[trackId].details)){this.state=State_WAITING_TRACK;break}if(!audioSwitch&&this._streamEnded(bufferInfo,trackDetails))return this.hls.trigger(events.default.BUFFER_EOS,{type:"audio"}),void(this.state=State_ENDED);var frag,fragments=trackDetails.fragments,fragLen=fragments.length,start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration;if(audioSwitch)if(trackDetails.live&&!trackDetails.PTSKnown)logger.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),bufferEnd=0;else if(bufferEnd=pos,trackDetails.PTSKnown&&pos<start){if(!(bufferInfo.end>start||bufferInfo.nextStart))return;logger.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=start+.05}if(trackDetails.initSegment&&!trackDetails.initSegment.data)frag=trackDetails.initSegment;else if(bufferEnd<=start){if(frag=fragments[0],null!==this.videoTrackCC&&frag.cc!==this.videoTrackCC&&(frag=function findFragWithCC(fragments,CC){return binary_search.search(fragments,(function(candidate){return candidate.cc<CC?1:candidate.cc>CC?-1:0}))}(fragments,this.videoTrackCC)),trackDetails.live&&frag.loadIdx&&frag.loadIdx===this.fragLoadIdx){var nextBuffered=bufferInfo.nextStart?bufferInfo.nextStart:start;return logger.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(nextBuffered+.05)),void(this.media.currentTime=nextBuffered+.05)}}else{var foundFrag,maxFragLookUpTolerance=config.maxFragLookUpTolerance,fragNext=fragPrevious?fragments[fragPrevious.sn-fragments[0].sn+1]:void 0,fragmentWithinToleranceTest=function fragmentWithinToleranceTest(candidate){var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration);return candidate.start+candidate.duration-candidateLookupTolerance<=bufferEnd?1:candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start?-1:0};bufferEnd<end?(bufferEnd>end-maxFragLookUpTolerance&&(maxFragLookUpTolerance=0),foundFrag=fragNext&&!fragmentWithinToleranceTest(fragNext)?fragNext:binary_search.search(fragments,fragmentWithinToleranceTest)):foundFrag=fragments[fragLen-1],foundFrag&&(frag=foundFrag,start=foundFrag.start,fragPrevious&&frag.level===fragPrevious.level&&frag.sn===fragPrevious.sn&&(frag.sn<trackDetails.endSN?(frag=fragments[frag.sn+1-trackDetails.startSN],logger.logger.log("SN just loaded, load next one: "+frag.sn)):frag=null))}frag&&(frag.encrypted?(logger.logger.log("Loading key for "+frag.sn+" of ["+trackDetails.startSN+" ,"+trackDetails.endSN+"],track "+trackId),this.state=State_KEY_LOADING,hls.trigger(events.default.KEY_LOADING,{frag})):(logger.logger.log("Loading "+frag.sn+", cc: "+frag.cc+" of ["+trackDetails.startSN+" ,"+trackDetails.endSN+"],track "+trackId+", currentTime:"+pos+",bufferEnd:"+bufferEnd.toFixed(3)),this.fragCurrent=frag,(audioSwitch||this.fragmentTracker.getState(frag)===FragmentState_NOT_LOADED)&&("initSegment"!==frag.sn&&(this.startFragRequested=!0),Object(number_isFinite.isFiniteNumber)(frag.sn)&&(this.nextLoadPosition=frag.start+frag.duration),hls.trigger(events.default.FRAG_LOADING,{frag}),this.state=State_FRAG_LOADING)))}break;case State_WAITING_TRACK:(track=this.tracks[this.trackId])&&track.details&&(this.state=State_IDLE);break;case State_FRAG_LOADING_WAITING_RETRY:var now=audio_stream_controller_performance.now(),retryDate=this.retryDate,isSeeking=(media=this.media)&&media.seeking;(!retryDate||now>=retryDate||isSeeking)&&(logger.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=State_IDLE);break;case State_WAITING_INIT_PTS:var videoTrackCC=this.videoTrackCC;if(void 0===this.initPTS[videoTrackCC])break;var waitingFrag=this.waitingFragment;if(waitingFrag){var waitingFragCC=waitingFrag.frag.cc;videoTrackCC!==waitingFragCC?(track=this.tracks[this.trackId]).details&&track.details.live&&(logger.logger.warn("Waiting fragment CC ("+waitingFragCC+") does not match video track CC ("+videoTrackCC+")"),this.waitingFragment=null,this.state=State_IDLE):(this.state=State_FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=State_IDLE}},_proto.onMediaAttached=function onMediaAttached(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("ended",this.onvended);var config=this.config;this.tracks&&config.autoStartLoad&&this.startLoad(config.startPosition)},_proto.onMediaDetaching=function onMediaDetaching(){var media=this.media;media&&media.ended&&(logger.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_proto.onAudioTracksUpdated=function onAudioTracksUpdated(data){logger.logger.log("audio tracks updated"),this.tracks=data.audioTracks},_proto.onAudioTrackSwitching=function onAudioTrackSwitching(data){var altAudio=!!data.url;this.trackId=data.id,this.fragCurrent=null,this.state=State_PAUSED,this.waitingFragment=null,altAudio?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),altAudio&&(this.audioSwitch=!0,this.state=State_IDLE),this.tick()},_proto.onAudioTrackLoaded=function onAudioTrackLoaded(data){var newDetails=data.details,trackId=data.id,track=this.tracks[trackId],duration=newDetails.totalduration,sliding=0;if(logger.logger.log("track "+trackId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration),newDetails.live){var curDetails=track.details;curDetails&&newDetails.fragments.length>0?(mergeDetails(curDetails,newDetails),sliding=newDetails.fragments[0].start,newDetails.PTSKnown?logger.logger.log("live audio playlist sliding:"+sliding.toFixed(3)):logger.logger.log("live audio playlist - outdated PTS, unknown sliding")):(newDetails.PTSKnown=!1,logger.logger.log("live audio playlist - first load, unknown sliding"))}else newDetails.PTSKnown=!1;if(track.details=newDetails,!this.startFragRequested){if(-1===this.startPosition){var startTimeOffset=newDetails.startTimeOffset;Object(number_isFinite.isFiniteNumber)(startTimeOffset)?(logger.logger.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this.startPosition=startTimeOffset):newDetails.live?(this.startPosition=this.computeLivePosition(sliding,newDetails),logger.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===State_WAITING_TRACK&&(this.state=State_IDLE),this.tick()},_proto.onKeyLoaded=function onKeyLoaded(){this.state===State_KEY_LOADING&&(this.state=State_IDLE,this.tick())},_proto.onFragLoaded=function onFragLoaded(data){var fragCurrent=this.fragCurrent,fragLoaded=data.frag;if(this.state===State_FRAG_LOADING&&fragCurrent&&"audio"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var track=this.tracks[this.trackId],details=track.details,duration=details.totalduration,trackId=fragCurrent.level,sn=fragCurrent.sn,cc=fragCurrent.cc,audioCodec=this.config.defaultAudioCodec||track.audioCodec||"mp4a.40.2",stats=this.stats=data.stats;if("initSegment"===sn)this.state=State_IDLE,stats.tparsed=stats.tbuffered=audio_stream_controller_performance.now(),details.initSegment.data=data.payload,this.hls.trigger(events.default.FRAG_BUFFERED,{stats,frag:fragCurrent,id:"audio"}),this.tick();else{this.state=State_PARSING,this.appended=!1,this.demuxer||(this.demuxer=new demux_demuxer(this.hls,"audio"));var initPTS=this.initPTS[cc],initSegmentData=details.initSegment?details.initSegment.data:[];if(details.initSegment||void 0!==initPTS){this.pendingBuffering=!0,logger.logger.log("Demuxing "+sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId);this.demuxer.push(data.payload,initSegmentData,audioCodec,null,fragCurrent,duration,!1,initPTS)}else logger.logger.log("unknown video PTS for continuity counter "+cc+", waiting for video PTS before demuxing audio frag "+sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId),this.waitingFragment=data,this.state=State_WAITING_INIT_PTS}}this.fragLoadError=0},_proto.onFragParsingInitSegment=function onFragParsingInitSegment(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"audio"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING){var track,tracks=data.tracks;if(tracks.video&&delete tracks.video,track=tracks.audio){track.levelCodec=track.codec,track.id=data.id,this.hls.trigger(events.default.BUFFER_CODECS,tracks),logger.logger.log("audio track:audio,container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;if(initSegment){var appendObj={type:"audio",data:initSegment,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[appendObj]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(events.default.BUFFER_APPENDING,appendObj))}this.tick()}}},_proto.onFragParsingData=function onFragParsingData(data){var _this2=this,fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"audio"===data.id&&"audio"===data.type&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING){var trackId=this.trackId,track=this.tracks[trackId],hls=this.hls;Object(number_isFinite.isFiniteNumber)(data.endPTS)||(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),fragCurrent.addElementaryStream(ElementaryStreamTypes.AUDIO),logger.logger.log("parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb),updateFragPTSDTS(track.details,fragCurrent,data.startPTS,data.endPTS);var audioSwitch=this.audioSwitch,media=this.media,appendOnBufferFlush=!1;if(audioSwitch)if(media&&media.readyState){var currentTime=media.currentTime;logger.logger.log("switching audio track : currentTime:"+currentTime),currentTime>=data.startPTS&&(logger.logger.log("switching audio track : flushing all audio"),this.state=State_BUFFER_FLUSHING,hls.trigger(events.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),appendOnBufferFlush=!0,this.audioSwitch=!1,hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:trackId}))}else this.audioSwitch=!1,hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:trackId});var pendingData=this.pendingData;if(!pendingData)return logger.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([data.data1,data.data2].forEach((function(buffer){buffer&&buffer.length&&pendingData.push({type:data.type,data:buffer,parent:"audio",content:"data"})})),!appendOnBufferFlush&&pendingData.length&&(pendingData.forEach((function(appendObj){_this2.state===State_PARSING&&(_this2.pendingBuffering=!0,_this2.hls.trigger(events.default.BUFFER_APPENDING,appendObj))})),this.pendingData=[],this.appended=!0)),this.tick()}},_proto.onFragParsed=function onFragParsed(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;fragCurrent&&"audio"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING&&(this.stats.tparsed=audio_stream_controller_performance.now(),this.state=State_PARSED,this._checkAppendedParsed())},_proto.onBufferReset=function onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_proto.onBufferCreated=function onBufferCreated(data){var audioTrack=data.tracks.audio;audioTrack&&(this.mediaBuffer=audioTrack.buffer,this.loadedmetadata=!0),data.tracks.video&&(this.videoBuffer=data.tracks.video.buffer)},_proto.onBufferAppended=function onBufferAppended(data){if("audio"===data.parent){var state=this.state;state!==State_PARSING&&state!==State_PARSED||(this.pendingBuffering=data.pending>0,this._checkAppendedParsed())}},_proto._checkAppendedParsed=function _checkAppendedParsed(){if(!(this.state!==State_PARSED||this.appended&&this.pendingBuffering)){var frag=this.fragCurrent,stats=this.stats,hls=this.hls;if(frag){this.fragPrevious=frag,stats.tbuffered=audio_stream_controller_performance.now(),hls.trigger(events.default.FRAG_BUFFERED,{stats,frag,id:"audio"});var media=this.mediaBuffer?this.mediaBuffer:this.media;media&&logger.logger.log("audio buffered : "+time_ranges.toString(media.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=State_IDLE}this.tick()}},_proto.onError=function onError(data){var frag=data.frag;if(!frag||"audio"===frag.type)switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:var _frag=data.frag;if(_frag&&"audio"!==_frag.type)break;if(!data.fatal){var loadError=this.fragLoadError;loadError?loadError++:loadError=1;var config=this.config;if(loadError<=config.fragLoadingMaxRetry){this.fragLoadError=loadError;var delay=Math.min(Math.pow(2,loadError-1)*config.fragLoadingRetryDelay,config.fragLoadingMaxRetryTimeout);logger.logger.warn("AudioStreamController: frag loading failed, retry in "+delay+" ms"),this.retryDate=audio_stream_controller_performance.now()+delay,this.state=State_FRAG_LOADING_WAITING_RETRY}else logger.logger.error("AudioStreamController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State_ERROR}break;case errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case errors.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case errors.ErrorDetails.KEY_LOAD_ERROR:case errors.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==State_ERROR&&(this.state=data.fatal?State_ERROR:State_IDLE,logger.logger.warn("AudioStreamController: "+data.details+" while loading frag, now switching to "+this.state+" state ..."));break;case errors.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===data.parent&&(this.state===State_PARSING||this.state===State_PARSED)){var media=this.mediaBuffer,currentTime=this.media.currentTime;if(media&&BufferHelper.isBuffered(media,currentTime)&&BufferHelper.isBuffered(media,currentTime+.5)){var _config=this.config;_config.maxMaxBufferLength>=_config.maxBufferLength&&(_config.maxMaxBufferLength/=2,logger.logger.warn("AudioStreamController: reduce max buffer length to "+_config.maxMaxBufferLength+"s")),this.state=State_IDLE}else logger.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=State_BUFFER_FLUSHING,this.hls.trigger(events.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},_proto.onBufferFlushed=function onBufferFlushed(){var _this3=this,pendingData=this.pendingData;pendingData&&pendingData.length?(logger.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),pendingData.forEach((function(appendObj){_this3.hls.trigger(events.default.BUFFER_APPENDING,appendObj)})),this.appended=!0,this.pendingData=[],this.state=State_PARSED):(this.state=State_IDLE,this.fragPrevious=null,this.tick())},function audio_stream_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&audio_stream_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&audio_stream_controller_defineProperties(Constructor,staticProps),Constructor}(AudioStreamController,[{key:"state",set:function set(nextState){if(this.state!==nextState){var previousState=this.state;this._state=nextState,logger.logger.log("audio stream:"+previousState+"->"+nextState)}},get:function get(){return this._state}}]),AudioStreamController}(base_stream_controller_BaseStreamController),vttcue=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var directionSetting={"":!0,lr:!0,rl:!0},alignSetting={start:!0,middle:!0,end:!0,left:!0,right:!0};function findAlignSetting(value){return"string"==typeof value&&(!!alignSetting[value.toLowerCase()]&&value.toLowerCase())}function extend(obj){for(var i=1;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj)obj[p]=cobj[p]}return obj}function VTTCue(startTime,endTime,text){var cue=this,baseObj={enumerable:!0};cue.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position=50,_positionAlign="middle",_size=50,_align="middle";Object.defineProperty(cue,"id",extend({},baseObj,{get:function get(){return _id},set:function set(value){_id=""+value}})),Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function get(){return _pauseOnExit},set:function set(value){_pauseOnExit=!!value}})),Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function get(){return _startTime},set:function set(value){if("number"!=typeof value)throw new TypeError("Start time must be set to a number.");_startTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function get(){return _endTime},set:function set(value){if("number"!=typeof value)throw new TypeError("End time must be set to a number.");_endTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"text",extend({},baseObj,{get:function get(){return _text},set:function set(value){_text=""+value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"region",extend({},baseObj,{get:function get(){return _region},set:function set(value){_region=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function get(){return _vertical},set:function set(value){var setting=function findDirectionSetting(value){return"string"==typeof value&&!!directionSetting[value.toLowerCase()]&&value.toLowerCase()}(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_vertical=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function get(){return _snapToLines},set:function set(value){_snapToLines=!!value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"line",extend({},baseObj,{get:function get(){return _line},set:function set(value){if("number"!=typeof value&&"auto"!==value)throw new SyntaxError("An invalid number or illegal string was specified.");_line=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function get(){return _lineAlign},set:function set(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_lineAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"position",extend({},baseObj,{get:function get(){return _position},set:function set(value){if(value<0||value>100)throw new Error("Position must be between 0 and 100.");_position=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function get(){return _positionAlign},set:function set(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_positionAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"size",extend({},baseObj,{get:function get(){return _size},set:function set(value){if(value<0||value>100)throw new Error("Size must be between 0 and 100.");_size=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"align",extend({},baseObj,{get:function get(){return _align},set:function set(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_align=setting,this.hasBeenReset=!0}})),cue.displayState=void 0}return VTTCue.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},VTTCue}(),StringDecoder=function StringDecoder(){return{decode:function decode(data){if(!data)return"";if("string"!=typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))}}};function VTTParser(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[]}function Settings(){this.values=Object.create(null)}function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups)if("string"==typeof groups[i]){var kv=groups[i].split(keyValueDelim);if(2===kv.length)callback(kv[0],kv[1])}}Settings.prototype={set:function set(k,v){this.get(k)||""===v||(this.values[k]=v)},get:function get(k,dflt,defaultKey){return defaultKey?this.has(k)?this.values[k]:dflt[defaultKey]:this.has(k)?this.values[k]:dflt},has:function has(k){return k in this.values},alt:function alt(k,v,a){for(var n=0;n<a.length;++n)if(v===a[n]){this.set(k,v);break}},integer:function integer(k,v){/^-?\d+$/.test(v)&&this.set(k,parseInt(v,10))},percent:function percent(k,v){return!!(v.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(v=parseFloat(v))>=0&&v<=100)&&(this.set(k,v),!0)}};var defaults=new vttcue(0,0,0),center="middle"===defaults.align?"middle":"center";function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=function parseTimeStamp(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+(0|f)/1e3}var m=input.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return m?m[3]?computeSeconds(m[1],m[2],m[3].replace(":",""),m[4]):m[1]>59?computeSeconds(m[1],m[2],0,m[4]):computeSeconds(0,m[1],m[2],m[4]):null}(input);if(null===ts)throw new Error("Malformed timestamp: "+oInput);return input=input.replace(/^[^\sa-zA-Z-]+/,""),ts}function skipWhitespace(){input=input.replace(/^\s+/,"")}if(skipWhitespace(),cue.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==input.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+oInput);input=input.substr(3),skipWhitespace(),cue.endTime=consumeTimeStamp(),skipWhitespace(),function consumeCueSettings(input,cue){var settings=new Settings;parseOptions(input,(function(k,v){switch(k){case"region":for(var i=regionList.length-1;i>=0;i--)if(regionList[i].id===v){settings.set(k,regionList[i].region);break}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0),settings.percent(k,vals0)&&settings.set("snapToLines",!1),settings.alt(k,vals0,["auto"]),2===vals.length&&settings.alt("lineAlign",vals[1],["start",center,"end"]);break;case"position":vals=v.split(","),settings.percent(k,vals[0]),2===vals.length&&settings.alt("positionAlign",vals[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start",center,"end","left","right"])}}),/:/,/\s/),cue.region=settings.get("region",null),cue.vertical=settings.get("vertical","");var line=settings.get("line","auto");"auto"===line&&-1===defaults.line&&(line=-1),cue.line=line,cue.lineAlign=settings.get("lineAlign","start"),cue.snapToLines=settings.get("snapToLines",!0),cue.size=settings.get("size",100),cue.align=settings.get("align",center);var position=settings.get("position","auto");"auto"===position&&50===defaults.position&&(position="start"===cue.align||"left"===cue.align?0:"end"===cue.align||"right"===cue.align?100:50),cue.position=position}(input,cue)}function fixLineBreaks(input){return input.replace(/<br(?: \/)?>/gi,"\n")}VTTParser.prototype={parse:function parse(data){var self=this;function collectNextLine(){var buffer=self.buffer,pos=0;for(buffer=fixLineBreaks(buffer);pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos];)++pos;var line=buffer.substr(0,pos);return"\r"===buffer[pos]&&++pos,"\n"===buffer[pos]&&++pos,self.buffer=buffer.substr(pos),line}data&&(self.buffer+=self.decoder.decode(data,{stream:!0}));try{var line;if("INITIAL"===self.state){if(!/\r\n|\n/.test(self.buffer))return this;var m=(line=collectNextLine()).match(/^()?WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new Error("Malformed WebVTT signature.");self.state="HEADER"}for(var alreadyCollectedLine=!1;self.buffer;){if(!/\r\n|\n/.test(self.buffer))return this;switch(alreadyCollectedLine?alreadyCollectedLine=!1:line=collectNextLine(),self.state){case"HEADER":/:/.test(line)?parseOptions(line,(function(k,v){}),/:/):line||(self.state="ID");continue;case"NOTE":line||(self.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE";break}if(!line)continue;if(self.cue=new vttcue(0,0,""),self.state="CUE",-1===line.indexOf("--\x3e")){self.cue.id=line;continue}case"CUE":try{parseCue(line,self.cue,self.regionList)}catch(e){self.cue=null,self.state="BADCUE";continue}self.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=-1!==line.indexOf("--\x3e");if(!line||hasSubstring&&(alreadyCollectedLine=!0)){self.oncue&&self.oncue(self.cue),self.cue=null,self.state="ID";continue}self.cue.text&&(self.cue.text+="\n"),self.cue.text+=line;continue;case"BADCUE":line||(self.state="ID");continue}}}catch(e){"CUETEXT"===self.state&&self.cue&&self.oncue&&self.oncue(self.cue),self.cue=null,self.state="INITIAL"===self.state?"BADWEBVTT":"BADCUE"}return this},flush:function flush(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var vttparser=VTTParser;function newCue(track,startTime,endTime,captionScreen){for(var row,cue,indenting,indent,text,VTTCue=window.VTTCue||TextTrackCue,r=0;r<captionScreen.rows.length;r++)if(indenting=!0,indent=0,text="",!(row=captionScreen.rows[r]).isEmpty()){for(var c=0;c<row.chars.length;c++)row.chars[c].uchar.match(/\s/)&&indenting?indent++:(text+=row.chars[c].uchar,indenting=!1);row.cueStartTime=startTime,startTime===endTime&&(endTime+=1e-4),cue=new VTTCue(startTime,endTime,fixLineBreaks(text.trim())),indent>=16?indent--:indent++,navigator.userAgent.match(/Firefox\//)?cue.line=r+1:cue.line=r>7?r-2:r+1,cue.align="left",cue.position=Math.max(0,Math.min(100,indent/32*100)),track.addCue(cue)}}var VerboseFilter,specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function getCharForByte(byte){var charCode=byte;return specialCea608CharsCodes.hasOwnProperty(byte)&&(charCode=specialCea608CharsCodes[byte]),String.fromCharCode(charCode)},rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(VerboseFilter){VerboseFilter[VerboseFilter.ERROR=0]="ERROR",VerboseFilter[VerboseFilter.TEXT=1]="TEXT",VerboseFilter[VerboseFilter.WARNING=2]="WARNING",VerboseFilter[VerboseFilter.INFO=2]="INFO",VerboseFilter[VerboseFilter.DEBUG=3]="DEBUG",VerboseFilter[VerboseFilter.DATA=3]="DATA"}(VerboseFilter||(VerboseFilter={}));var cea_608_parser_logger={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function setTime(newTime){this.time=newTime},log:function log(severity,msg){this.verboseFilter[severity];this.verboseLevel}},numArrayToHexArray=function numArrayToHexArray(numArray){for(var hexArray=[],j=0;j<numArray.length;j++)hexArray.push(numArray[j].toString(16));return hexArray},PenState=function(){function PenState(foreground,underline,italics,background,flash){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=foreground||"white",this.underline=underline||!1,this.italics=italics||!1,this.background=background||"black",this.flash=flash||!1}var _proto=PenState.prototype;return _proto.reset=function reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},_proto.setStyles=function setStyles(styles){for(var attribs=["foreground","underline","italics","background","flash"],i=0;i<attribs.length;i++){var style=attribs[i];styles.hasOwnProperty(style)&&(this[style]=styles[style])}},_proto.isDefault=function isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},_proto.equals=function equals(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash},_proto.copy=function copy(newPenState){this.foreground=newPenState.foreground,this.underline=newPenState.underline,this.italics=newPenState.italics,this.background=newPenState.background,this.flash=newPenState.flash},_proto.toString=function toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},PenState}(),StyledUnicodeChar=function(){function StyledUnicodeChar(uchar,foreground,underline,italics,background,flash){this.uchar=void 0,this.penState=void 0,this.uchar=uchar||" ",this.penState=new PenState(foreground,underline,italics,background,flash)}var _proto2=StyledUnicodeChar.prototype;return _proto2.reset=function reset(){this.uchar=" ",this.penState.reset()},_proto2.setChar=function setChar(uchar,newPenState){this.uchar=uchar,this.penState.copy(newPenState)},_proto2.setPenState=function setPenState(newPenState){this.penState.copy(newPenState)},_proto2.equals=function equals(other){return this.uchar===other.uchar&&this.penState.equals(other.penState)},_proto2.copy=function copy(newChar){this.uchar=newChar.uchar,this.penState.copy(newChar.penState)},_proto2.isEmpty=function isEmpty(){return" "===this.uchar&&this.penState.isDefault()},StyledUnicodeChar}(),Row=function(){function Row(){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.chars=[];for(var i=0;i<100;i++)this.chars.push(new StyledUnicodeChar);this.pos=0,this.currPenState=new PenState}var _proto3=Row.prototype;return _proto3.equals=function equals(other){for(var equal=!0,i=0;i<100;i++)if(!this.chars[i].equals(other.chars[i])){equal=!1;break}return equal},_proto3.copy=function copy(other){for(var i=0;i<100;i++)this.chars[i].copy(other.chars[i])},_proto3.isEmpty=function isEmpty(){for(var empty=!0,i=0;i<100;i++)if(!this.chars[i].isEmpty()){empty=!1;break}return empty},_proto3.setCursor=function setCursor(absPos){this.pos!==absPos&&(this.pos=absPos),this.pos<0?(cea_608_parser_logger.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(cea_608_parser_logger.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},_proto3.moveCursor=function moveCursor(relPos){var newPos=this.pos+relPos;if(relPos>1)for(var i=this.pos+1;i<newPos+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(newPos)},_proto3.backSpace=function backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},_proto3.insertChar=function insertChar(byte){byte>=144&&this.backSpace();var char=getCharForByte(byte);this.pos>=100?cea_608_parser_logger.log("ERROR","Cannot insert "+byte.toString(16)+" ("+char+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(char,this.currPenState),this.moveCursor(1))},_proto3.clearFromPos=function clearFromPos(startPos){var i;for(i=startPos;i<100;i++)this.chars[i].reset()},_proto3.clear=function clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},_proto3.clearToEndOfRow=function clearToEndOfRow(){this.clearFromPos(this.pos)},_proto3.getTextString=function getTextString(){for(var chars=[],empty=!0,i=0;i<100;i++){var char=this.chars[i].uchar;" "!==char&&(empty=!1),chars.push(char)}return empty?"":chars.join("")},_proto3.setPenStyles=function setPenStyles(styles){this.currPenState.setStyles(styles),this.chars[this.pos].setPenState(this.currPenState)},Row}(),CaptionScreen=function(){function CaptionScreen(){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.rows=[];for(var i=0;i<15;i++)this.rows.push(new Row);this.currRow=14,this.nrRollUpRows=null,this.reset()}var _proto4=CaptionScreen.prototype;return _proto4.reset=function reset(){for(var i=0;i<15;i++)this.rows[i].clear();this.currRow=14},_proto4.equals=function equals(other){for(var equal=!0,i=0;i<15;i++)if(!this.rows[i].equals(other.rows[i])){equal=!1;break}return equal},_proto4.copy=function copy(other){for(var i=0;i<15;i++)this.rows[i].copy(other.rows[i])},_proto4.isEmpty=function isEmpty(){for(var empty=!0,i=0;i<15;i++)if(!this.rows[i].isEmpty()){empty=!1;break}return empty},_proto4.backSpace=function backSpace(){this.rows[this.currRow].backSpace()},_proto4.clearToEndOfRow=function clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()},_proto4.insertChar=function insertChar(char){this.rows[this.currRow].insertChar(char)},_proto4.setPen=function setPen(styles){this.rows[this.currRow].setPenStyles(styles)},_proto4.moveCursor=function moveCursor(relPos){this.rows[this.currRow].moveCursor(relPos)},_proto4.setCursor=function setCursor(absPos){cea_608_parser_logger.log("INFO","setCursor: "+absPos),this.rows[this.currRow].setCursor(absPos)},_proto4.setPAC=function setPAC(pacData){cea_608_parser_logger.log("INFO","pacData = "+JSON.stringify(pacData));var newRow=pacData.row-1;if(this.nrRollUpRows&&newRow<this.nrRollUpRows-1&&(newRow=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==newRow){for(var i=0;i<15;i++)this.rows[i].clear();var topRowIndex=this.currRow+1-this.nrRollUpRows,lastOutputScreen=this.lastOutputScreen;if(lastOutputScreen){var prevLineTime=lastOutputScreen.rows[topRowIndex].cueStartTime;if(prevLineTime&&cea_608_parser_logger.time&&prevLineTime<cea_608_parser_logger.time)for(var _i=0;_i<this.nrRollUpRows;_i++)this.rows[newRow-this.nrRollUpRows+_i+1].copy(lastOutputScreen.rows[topRowIndex+_i])}}this.currRow=newRow;var row=this.rows[this.currRow];if(null!==pacData.indent){var indent=pacData.indent,prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent),pacData.color=row.chars[prevPos].penState.foreground}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:"black",flash:!1};this.setPen(styles)},_proto4.setBkgData=function setBkgData(bkgData){cea_608_parser_logger.log("INFO","bkgData = "+JSON.stringify(bkgData)),this.backSpace(),this.setPen(bkgData),this.insertChar(32)},_proto4.setRollUpRows=function setRollUpRows(nrRows){this.nrRollUpRows=nrRows},_proto4.rollUp=function rollUp(){if(null!==this.nrRollUpRows){cea_608_parser_logger.log("TEXT",this.getDisplayText());var topRowIndex=this.currRow+1-this.nrRollUpRows,topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear(),this.rows.splice(this.currRow,0,topRow),cea_608_parser_logger.log("INFO","Rolling up")}else cea_608_parser_logger.log("DEBUG","roll_up but nrRollUpRows not set yet")},_proto4.getDisplayText=function getDisplayText(asOneRow){asOneRow=asOneRow||!1;for(var displayText=[],text="",rowNr=-1,i=0;i<15;i++){var rowText=this.rows[i].getTextString();rowText&&(rowNr=i+1,asOneRow?displayText.push("Row "+rowNr+": '"+rowText+"'"):displayText.push(rowText.trim()))}return displayText.length>0&&(text=asOneRow?"["+displayText.join(" | ")+"]":displayText.join("\n")),text},_proto4.getTextAndFormat=function getTextAndFormat(){return this.rows},CaptionScreen}(),Cea608Channel=function(){function Cea608Channel(channelNumber,outputFilter){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.lastCueEndTime=void 0,this.chNr=channelNumber,this.outputFilter=outputFilter,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen,this.nonDisplayedMemory=new CaptionScreen,this.lastOutputScreen=new CaptionScreen,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}var _proto5=Cea608Channel.prototype;return _proto5.reset=function reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},_proto5.getHandler=function getHandler(){return this.outputFilter},_proto5.setHandler=function setHandler(newHandler){this.outputFilter=newHandler},_proto5.setPAC=function setPAC(pacData){this.writeScreen.setPAC(pacData)},_proto5.setBkgData=function setBkgData(bkgData){this.writeScreen.setBkgData(bkgData)},_proto5.setMode=function setMode(newMode){newMode!==this.mode&&(this.mode=newMode,cea_608_parser_logger.log("INFO","MODE="+newMode),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=newMode)},_proto5.insertChars=function insertChars(chars){for(var i=0;i<chars.length;i++)this.writeScreen.insertChar(chars[i]);var screen=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";cea_608_parser_logger.log("INFO",screen+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(cea_608_parser_logger.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},_proto5.ccRCL=function ccRCL(){cea_608_parser_logger.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},_proto5.ccBS=function ccBS(){cea_608_parser_logger.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},_proto5.ccAOF=function ccAOF(){},_proto5.ccAON=function ccAON(){},_proto5.ccDER=function ccDER(){cea_608_parser_logger.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},_proto5.ccRU=function ccRU(nrRows){cea_608_parser_logger.log("INFO","RU("+nrRows+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nrRows)},_proto5.ccFON=function ccFON(){cea_608_parser_logger.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},_proto5.ccRDC=function ccRDC(){cea_608_parser_logger.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},_proto5.ccTR=function ccTR(){cea_608_parser_logger.log("INFO","TR"),this.setMode("MODE_TEXT")},_proto5.ccRTD=function ccRTD(){cea_608_parser_logger.log("INFO","RTD"),this.setMode("MODE_TEXT")},_proto5.ccEDM=function ccEDM(){cea_608_parser_logger.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},_proto5.ccCR=function ccCR(){cea_608_parser_logger.log("INFO","CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},_proto5.ccENM=function ccENM(){cea_608_parser_logger.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},_proto5.ccEOC=function ccEOC(){if(cea_608_parser_logger.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=tmp,this.writeScreen=this.nonDisplayedMemory,cea_608_parser_logger.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},_proto5.ccTO=function ccTO(nrCols){cea_608_parser_logger.log("INFO","TO("+nrCols+") - Tab Offset"),this.writeScreen.moveCursor(nrCols)},_proto5.ccMIDROW=function ccMIDROW(secondByte){var styles={flash:!1};if(styles.underline=secondByte%2==1,styles.italics=secondByte>=46,styles.italics)styles.foreground="white";else{var colorIndex=Math.floor(secondByte/2)-16;styles.foreground=["white","green","blue","cyan","red","yellow","magenta"][colorIndex]}cea_608_parser_logger.log("INFO","MIDROW: "+JSON.stringify(styles)),this.writeScreen.setPen(styles)},_proto5.outputDataUpdate=function outputDataUpdate(dispatch){void 0===dispatch&&(dispatch=!1);var t=cea_608_parser_logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),dispatch&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},_proto5.cueSplitAtTime=function cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},Cea608Channel}(),cea_608_parser=function(){function Cea608Parser(field,out1,out2){this.field=void 0,this.outputs=void 0,this.channels=void 0,this.currChNr=void 0,this.lastCmdA=void 0,this.lastCmdB=void 0,this.lastTime=void 0,this.dataCounters=void 0,this.field=field||1,this.outputs=[out1,out2],this.channels=[new Cea608Channel(1,out1),new Cea608Channel(2,out2)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}var _proto6=Cea608Parser.prototype;return _proto6.getHandler=function getHandler(index){return this.channels[index].getHandler()},_proto6.setHandler=function setHandler(index,newHandler){this.channels[index].setHandler(newHandler)},_proto6.addData=function addData(t,byteList){var cmdFound,a,b,charsFound=!1;this.lastTime=t,cea_608_parser_logger.setTime(t);for(var i=0;i<byteList.length;i+=2)if(a=127&byteList[i],b=127&byteList[i+1],0!==a||0!==b){if(cea_608_parser_logger.log("DATA","["+numArrayToHexArray([byteList[i],byteList[i+1]])+"] -> ("+numArrayToHexArray([a,b])+")"),(cmdFound=this.parseCmd(a,b))||(cmdFound=this.parseMidrow(a,b)),cmdFound||(cmdFound=this.parsePAC(a,b)),cmdFound||(cmdFound=this.parseBackgroundAttributes(a,b)),!cmdFound)if(charsFound=this.parseChars(a,b))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(charsFound);else cea_608_parser_logger.log("WARNING","No channel found yet. TEXT-MODE?");cmdFound?this.dataCounters.cmd+=2:charsFound?this.dataCounters.char+=2:(this.dataCounters.other+=2,cea_608_parser_logger.log("WARNING","Couldn't parse cleaned data "+numArrayToHexArray([a,b])+" orig: "+numArrayToHexArray([byteList[i],byteList[i+1]])))}else this.dataCounters.padding+=2},_proto6.parseCmd=function parseCmd(a,b){var chNr=null;if(!((20===a||28===a)&&b>=32&&b<=47)&&!((23===a||31===a)&&b>=33&&b<=35))return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,cea_608_parser_logger.log("DEBUG","Repeated command ("+numArrayToHexArray([a,b])+") is dropped"),!0;chNr=20===a||23===a?1:2;var channel=this.channels[chNr-1];return 20===a||28===a?32===b?channel.ccRCL():33===b?channel.ccBS():34===b?channel.ccAOF():35===b?channel.ccAON():36===b?channel.ccDER():37===b?channel.ccRU(2):38===b?channel.ccRU(3):39===b?channel.ccRU(4):40===b?channel.ccFON():41===b?channel.ccRDC():42===b?channel.ccTR():43===b?channel.ccRTD():44===b?channel.ccEDM():45===b?channel.ccCR():46===b?channel.ccENM():47===b&&channel.ccEOC():channel.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0},_proto6.parseMidrow=function parseMidrow(a,b){var chNr=null;return(17===a||25===a)&&b>=32&&b<=47&&((chNr=17===a?1:2)!==this.currChNr?(cea_608_parser_logger.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[chNr-1].ccMIDROW(b),cea_608_parser_logger.log("DEBUG","MIDROW ("+numArrayToHexArray([a,b])+")"),!0))},_proto6.parsePAC=function parsePAC(a,b){var chNr,row=null;if(!((a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127)&&!((16===a||24===a)&&b>=64&&b<=95))return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;chNr=a<=23?1:2,row=b>=64&&b<=95?1===chNr?rowsLowCh1[a]:rowsLowCh2[a]:1===chNr?rowsHighCh1[a]:rowsHighCh2[a];var pacData=this.interpretPAC(row,b);return this.channels[chNr-1].setPAC(pacData),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0},_proto6.interpretPAC=function interpretPAC(row,byte){var pacIndex=byte,pacData={color:null,italics:!1,indent:null,underline:!1,row};return pacIndex=byte>95?byte-96:byte-64,pacData.underline=1==(1&pacIndex),pacIndex<=13?pacData.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pacIndex/2)]:pacIndex<=15?(pacData.italics=!0,pacData.color="white"):pacData.indent=4*Math.floor((pacIndex-16)/2),pacData},_proto6.parseChars=function parseChars(a,b){var channelNr=null,charCodes=null,charCode1=null;if(a>=25?(channelNr=2,charCode1=a-8):(channelNr=1,charCode1=a),charCode1>=17&&charCode1<=19){var oneCode=b;oneCode=17===charCode1?b+80:18===charCode1?b+112:b+144,cea_608_parser_logger.log("INFO","Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr),charCodes=[oneCode]}else a>=32&&a<=127&&(charCodes=0===b?[a]:[a,b]);if(charCodes){var hexCodes=numArrayToHexArray(charCodes);cea_608_parser_logger.log("DEBUG","Char codes =  "+hexCodes.join(",")),this.lastCmdA=null,this.lastCmdB=null}return charCodes},_proto6.parseBackgroundAttributes=function parseBackgroundAttributes(a,b){var bkgData,index,chNr;return((16===a||24===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=45&&b<=47)&&(bkgData={},16===a||24===a?(index=Math.floor((b-32)/2),bkgData.background=backgroundColors[index],b%2==1&&(bkgData.background=bkgData.background+"_semi")):45===b?bkgData.background="transparent":(bkgData.foreground="black",47===b&&(bkgData.underline=!0)),chNr=a<24?1:2,this.channels[chNr-1].setBkgData(bkgData),this.lastCmdA=null,this.lastCmdB=null,!0)},_proto6.reset=function reset(){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].reset();this.lastCmdA=null,this.lastCmdB=null},_proto6.cueSplitAtTime=function cueSplitAtTime(t){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].cueSplitAtTime(t)},Cea608Parser}(),OutputFilter=function(){function OutputFilter(timelineController,trackName){this.timelineController=void 0,this.trackName=void 0,this.startTime=void 0,this.endTime=void 0,this.screen=void 0,this.timelineController=timelineController,this.trackName=trackName,this.startTime=null,this.endTime=null,this.screen=null}var _proto=OutputFilter.prototype;return _proto.dispatchCue=function dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},_proto.newCue=function newCue(startTime,endTime,screen){(null===this.startTime||this.startTime>startTime)&&(this.startTime=startTime),this.endTime=endTime,this.screen=screen,this.timelineController.createCaptionsTrack(this.trackName)},OutputFilter}(),startsWith=function startsWith(inputString,searchString,position){return inputString.substr(position||0,searchString.length)===searchString},hash=function hash(text){for(var hash=5381,i=text.length;i;)hash=33*hash^text.charCodeAt(--i);return(hash>>>0).toString()},webvtt_parser={parse:function parse(vttByteArray,syncPTS,vttCCs,cc,callBack,errorCallBack){var parsingError,vttLines=Object(id3.utf8ArrayToStr)(new Uint8Array(vttByteArray)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),cueTime="00:00.000",mpegTs=0,localTime=0,presentationTime=0,cues=[],inHeader=!0,timestampMap=!1,parser=new vttparser;parser.oncue=function(cue){var currCC=vttCCs[cc],cueOffset=vttCCs.ccOffset;currCC&&currCC.new&&(void 0!==localTime?cueOffset=vttCCs.ccOffset=currCC.start:function calculateOffset(vttCCs,cc,presentationTime){var currCC=vttCCs[cc],prevCC=vttCCs[currCC.prevCC];if(!prevCC||!prevCC.new&&currCC.new)return vttCCs.ccOffset=vttCCs.presentationOffset=currCC.start,void(currCC.new=!1);for(;prevCC&&prevCC.new;)vttCCs.ccOffset+=currCC.start-prevCC.start,currCC.new=!1,prevCC=vttCCs[(currCC=prevCC).prevCC];vttCCs.presentationOffset=presentationTime}(vttCCs,cc,presentationTime)),presentationTime&&(cueOffset=presentationTime-vttCCs.presentationOffset),timestampMap&&(cue.startTime+=cueOffset-localTime,cue.endTime+=cueOffset-localTime),cue.id=hash(cue.startTime.toString())+hash(cue.endTime.toString())+hash(cue.text),cue.text=decodeURIComponent(encodeURIComponent(cue.text)),cue.endTime>0&&cues.push(cue)},parser.onparsingerror=function(e){parsingError=e},parser.onflush=function(){parsingError&&errorCallBack?errorCallBack(parsingError):callBack(cues)},vttLines.forEach((function(line){if(inHeader){if(startsWith(line,"X-TIMESTAMP-MAP=")){inHeader=!1,timestampMap=!0,line.substr(16).split(",").forEach((function(timestamp){startsWith(timestamp,"LOCAL:")?cueTime=timestamp.substr(6):startsWith(timestamp,"MPEGTS:")&&(mpegTs=parseInt(timestamp.substr(7)))}));try{syncPTS+(9e4*vttCCs[cc].start||0)<0&&(syncPTS+=8589934592),mpegTs-=syncPTS,localTime=function cueString2millis(timeString){var ts=parseInt(timeString.substr(-3)),secs=parseInt(timeString.substr(-6,2)),mins=parseInt(timeString.substr(-9,2)),hours=timeString.length>9?parseInt(timeString.substr(0,timeString.indexOf(":"))):0;if(!(Object(number_isFinite.isFiniteNumber)(ts)&&Object(number_isFinite.isFiniteNumber)(secs)&&Object(number_isFinite.isFiniteNumber)(mins)&&Object(number_isFinite.isFiniteNumber)(hours)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+timeString);return ts+=1e3*secs,ts+=6e4*mins,ts+36e5*hours}(cueTime)/1e3,presentationTime=mpegTs/9e4}catch(e){timestampMap=!1,parsingError=e}return}""===line&&(inHeader=!1)}parser.parse(line+"\n")})),parser.flush()}};function timeline_controller_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function canReuseVttTextTrack(inUseTrack,manifestTrack){return inUseTrack&&inUseTrack.label===manifestTrack.name&&!(inUseTrack.textTrack1||inUseTrack.textTrack2)}var timeline_controller=function(_EventHandler){function TimelineController(hls){var _this;if((_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHING,events.default.MEDIA_DETACHING,events.default.FRAG_PARSING_USERDATA,events.default.FRAG_DECRYPTED,events.default.MANIFEST_LOADING,events.default.MANIFEST_LOADED,events.default.FRAG_LOADED,events.default.INIT_PTS_FOUND)||this).media=null,_this.config=void 0,_this.enabled=!0,_this.Cues=void 0,_this.textTracks=[],_this.tracks=[],_this.initPTS=[],_this.unparsedVttFrags=[],_this.cueRanges=[],_this.captionsTracks={},_this.captionsProperties=void 0,_this.cea608Parser=void 0,_this.lastSn=-1,_this.prevCC=-1,_this.vttCCs=null,_this.hls=hls,_this.config=hls.config,_this.Cues=hls.config.cueHandler,_this.captionsProperties={textTrack1:{label:_this.config.captionsTextTrack1Label,languageCode:_this.config.captionsTextTrack1LanguageCode},textTrack2:{label:_this.config.captionsTextTrack2Label,languageCode:_this.config.captionsTextTrack2LanguageCode}},_this.config.enableCEA708Captions){var channel1=new OutputFilter(timeline_controller_assertThisInitialized(_this),"textTrack1"),channel2=new OutputFilter(timeline_controller_assertThisInitialized(_this),"textTrack2");_this.cea608Parser=new cea_608_parser(0,channel1,channel2)}return _this}!function timeline_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(TimelineController,_EventHandler);var _proto=TimelineController.prototype;return _proto.addCues=function addCues(trackName,startTime,endTime,screen){for(var x1,x2,y1,y2,ranges=this.cueRanges,merged=!1,i=ranges.length;i--;){var cueRange=ranges[i],overlap=(x1=cueRange[0],x2=cueRange[1],y1=startTime,y2=endTime,Math.min(x2,y2)-Math.max(x1,y1));if(overlap>=0&&(cueRange[0]=Math.min(cueRange[0],startTime),cueRange[1]=Math.max(cueRange[1],endTime),merged=!0,overlap/(endTime-startTime)>.5))return}merged||ranges.push([startTime,endTime]),this.Cues.newCue(this.captionsTracks[trackName],startTime,endTime,screen)},_proto.onInitPtsFound=function onInitPtsFound(data){var _this2=this,frag=data.frag,id=data.id,initPTS=data.initPTS,unparsedVttFrags=this.unparsedVttFrags;"main"===id&&(this.initPTS[frag.cc]=initPTS),unparsedVttFrags.length&&(this.unparsedVttFrags=[],unparsedVttFrags.forEach((function(frag){_this2.onFragLoaded(frag)})))},_proto.getExistingTrack=function getExistingTrack(trackName){var media=this.media;if(media)for(var i=0;i<media.textTracks.length;i++){var textTrack=media.textTracks[i];if(textTrack[trackName])return textTrack}return null},_proto.createCaptionsTrack=function createCaptionsTrack(trackName){var captionsProperties=this.captionsProperties,captionsTracks=this.captionsTracks,media=this.media,_captionsProperties$t=captionsProperties[trackName],label=_captionsProperties$t.label,languageCode=_captionsProperties$t.languageCode;if(!captionsTracks[trackName]){var existingTrack=this.getExistingTrack(trackName);if(existingTrack)captionsTracks[trackName]=existingTrack,clearCurrentCues(captionsTracks[trackName]),sendAddTrackEvent(captionsTracks[trackName],media);else{var textTrack=this.createTextTrack("captions",label,languageCode);textTrack&&(textTrack[trackName]=!0,captionsTracks[trackName]=textTrack)}}},_proto.createTextTrack=function createTextTrack(kind,label,lang){var media=this.media;if(media)return media.addTextTrack(kind,label,lang)},_proto.destroy=function destroy(){_EventHandler.prototype.destroy.call(this)},_proto.onMediaAttaching=function onMediaAttaching(data){this.media=data.media,this._cleanTracks()},_proto.onMediaDetaching=function onMediaDetaching(){var captionsTracks=this.captionsTracks;Object.keys(captionsTracks).forEach((function(trackName){clearCurrentCues(captionsTracks[trackName]),delete captionsTracks[trackName]}))},_proto.onManifestLoading=function onManifestLoading(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},_proto._cleanTracks=function _cleanTracks(){var media=this.media;if(media){var textTracks=media.textTracks;if(textTracks)for(var i=0;i<textTracks.length;i++)clearCurrentCues(textTracks[i])}},_proto.onManifestLoaded=function onManifestLoaded(data){var _this3=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=data.subtitles||[];var inUseTracks=this.media?this.media.textTracks:[];this.tracks.forEach((function(track,index){var textTrack;if(index<inUseTracks.length){for(var inUseTrack=null,i=0;i<inUseTracks.length;i++)if(canReuseVttTextTrack(inUseTracks[i],track)){inUseTrack=inUseTracks[i];break}inUseTrack&&(textTrack=inUseTrack)}textTrack||(textTrack=_this3.createTextTrack("subtitles",track.name,track.lang)),track.default?textTrack.mode=_this3.hls.subtitleDisplay?"showing":"hidden":textTrack.mode="disabled",_this3.textTracks.push(textTrack)}))}},_proto.onFragLoaded=function onFragLoaded(data){var frag=data.frag,payload=data.payload,cea608Parser=this.cea608Parser,initPTS=this.initPTS,lastSn=this.lastSn,unparsedVttFrags=this.unparsedVttFrags;if("main"===frag.type){var sn=frag.sn;frag.sn!==lastSn+1&&cea608Parser&&cea608Parser.reset(),this.lastSn=sn}else if("subtitle"===frag.type)if(payload.byteLength){if(!Object(number_isFinite.isFiniteNumber)(initPTS[frag.cc]))return unparsedVttFrags.push(data),void(initPTS.length&&this.hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag}));var decryptData=frag.decryptdata;null!=decryptData&&null!=decryptData.key&&"AES-128"===decryptData.method||this._parseVTTs(frag,payload)}else this.hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag})},_proto._parseVTTs=function _parseVTTs(frag,payload){var hls=this.hls,prevCC=this.prevCC,textTracks=this.textTracks,vttCCs=this.vttCCs;vttCCs[frag.cc]||(vttCCs[frag.cc]={start:frag.start,prevCC,new:!0},this.prevCC=frag.cc),webvtt_parser.parse(payload,this.initPTS[frag.cc],vttCCs,frag.cc,(function(cues){var currentTrack=textTracks[frag.level];"disabled"!==currentTrack.mode?(cues.forEach((function(cue){if(!currentTrack.cues.getCueById(cue.id))try{if(currentTrack.addCue(cue),!currentTrack.cues.getCueById(cue.id))throw new Error("addCue is failed for: "+cue)}catch(err){logger.logger.debug("Failed occurred on adding cues: "+err);var textTrackCue=new window.TextTrackCue(cue.startTime,cue.endTime,cue.text);textTrackCue.id=cue.id,currentTrack.addCue(textTrackCue)}})),hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag})):hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag})}),(function(e){logger.logger.log("Failed to parse VTT cue: "+e),hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag})}))},_proto.onFragDecrypted=function onFragDecrypted(data){var frag=data.frag,payload=data.payload;if("subtitle"===frag.type){if(!Object(number_isFinite.isFiniteNumber)(this.initPTS[frag.cc]))return void this.unparsedVttFrags.push(data);this._parseVTTs(frag,payload)}},_proto.onFragParsingUserdata=function onFragParsingUserdata(data){if(this.enabled&&this.cea608Parser)for(var i=0;i<data.samples.length;i++){var ccBytes=data.samples[i].bytes;if(ccBytes){var ccdatas=this.extractCea608Data(ccBytes);this.cea608Parser.addData(data.samples[i].pts,ccdatas)}}},_proto.extractCea608Data=function extractCea608Data(byteArray){for(var tmpByte,ccbyte1,ccbyte2,count=31&byteArray[0],position=2,actualCCBytes=[],j=0;j<count;j++)tmpByte=byteArray[position++],ccbyte1=127&byteArray[position++],ccbyte2=127&byteArray[position++],0===ccbyte1&&0===ccbyte2||0!=(4&tmpByte)&&0===(3&tmpByte)&&(actualCCBytes.push(ccbyte1),actualCCBytes.push(ccbyte2));return actualCCBytes},TimelineController}(event_handler);function subtitle_track_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function filterSubtitleTracks(textTrackList){for(var tracks=[],i=0;i<textTrackList.length;i++){var track=textTrackList[i];"subtitles"===track.kind&&track.label&&tracks.push(textTrackList[i])}return tracks}var subtitle_track_controller=function(_EventHandler){function SubtitleTrackController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.MANIFEST_LOADED,events.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],_this.trackId=-1,_this.media=null,_this.stopped=!0,_this.subtitleDisplay=!0,_this.queuedDefaultTrack=null,_this}!function subtitle_track_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(SubtitleTrackController,_EventHandler);var _proto=SubtitleTrackController.prototype;return _proto.destroy=function destroy(){event_handler.prototype.destroy.call(this)},_proto.onMediaAttached=function onMediaAttached(data){var _this2=this;this.media=data.media,this.media&&(Object(number_isFinite.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){_this2.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},_proto.onMediaDetaching=function onMediaDetaching(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(number_isFinite.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),filterSubtitleTracks(this.media.textTracks).forEach((function(track){clearCurrentCues(track)})),this.subtitleTrack=-1,this.media=null)},_proto.onManifestLoaded=function onManifestLoaded(data){var _this3=this,tracks=data.subtitles||[];this.tracks=tracks,this.hls.trigger(events.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:tracks}),tracks.forEach((function(track){track.default&&(_this3.media?_this3.subtitleTrack=track.id:_this3.queuedDefaultTrack=track.id)}))},_proto.onSubtitleTrackLoaded=function onSubtitleTrackLoaded(data){var _this4=this,id=data.id,details=data.details,trackId=this.trackId,tracks=this.tracks,currentTrack=tracks[trackId];if(id>=tracks.length||id!==trackId||!currentTrack||this.stopped)this._clearReloadTimer();else if(logger.logger.log("subtitle track "+id+" loaded"),details.live){var reloadInterval=computeReloadInterval(currentTrack.details,details,data.stats.trequest);logger.logger.log("Reloading live subtitle playlist in "+reloadInterval+"ms"),this.timer=setTimeout((function(){_this4._loadCurrentTrack()}),reloadInterval)}else this._clearReloadTimer()},_proto.startLoad=function startLoad(){this.stopped=!1,this._loadCurrentTrack()},_proto.stopLoad=function stopLoad(){this.stopped=!0,this._clearReloadTimer()},_proto._clearReloadTimer=function _clearReloadTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)},_proto._loadCurrentTrack=function _loadCurrentTrack(){var trackId=this.trackId,tracks=this.tracks,hls=this.hls,currentTrack=tracks[trackId];trackId<0||!currentTrack||currentTrack.details&&!currentTrack.details.live||(logger.logger.log("Loading subtitle track "+trackId),hls.trigger(events.default.SUBTITLE_TRACK_LOADING,{url:currentTrack.url,id:trackId}))},_proto._toggleTrackModes=function _toggleTrackModes(newId){var media=this.media,subtitleDisplay=this.subtitleDisplay,trackId=this.trackId;if(media){var textTracks=filterSubtitleTracks(media.textTracks);if(-1===newId)[].slice.call(textTracks).forEach((function(track){track.mode="disabled"}));else{var oldTrack=textTracks[trackId];oldTrack&&(oldTrack.mode="disabled")}var nextTrack=textTracks[newId];nextTrack&&(nextTrack.mode=subtitleDisplay?"showing":"hidden")}},_proto._setSubtitleTrackInternal=function _setSubtitleTrackInternal(newId){var hls=this.hls,tracks=this.tracks;!Object(number_isFinite.isFiniteNumber)(newId)||newId<-1||newId>=tracks.length||(this.trackId=newId,logger.logger.log("Switching to subtitle track "+newId),hls.trigger(events.default.SUBTITLE_TRACK_SWITCH,{id:newId}),this._loadCurrentTrack())},_proto._onTextTracksChanged=function _onTextTracksChanged(){if(this.media){for(var trackId=-1,tracks=filterSubtitleTracks(this.media.textTracks),id=0;id<tracks.length;id++)if("hidden"===tracks[id].mode)trackId=id;else if("showing"===tracks[id].mode){trackId=id;break}this.subtitleTrack=trackId}},function subtitle_track_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&subtitle_track_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&subtitle_track_controller_defineProperties(Constructor,staticProps),Constructor}(SubtitleTrackController,[{key:"subtitleTracks",get:function get(){return this.tracks}},{key:"subtitleTrack",get:function get(){return this.trackId},set:function set(subtitleTrackId){this.trackId!==subtitleTrackId&&(this._toggleTrackModes(subtitleTrackId),this._setSubtitleTrackInternal(subtitleTrackId))}}]),SubtitleTrackController}(event_handler),decrypter=__webpack_require__("./src/crypt/decrypter.js");var KeySystems,subtitle_stream_controller_performance=window.performance,subtitle_stream_controller_SubtitleStreamController=function(_BaseStreamController){function SubtitleStreamController(hls,fragmentTracker){var _this;return(_this=_BaseStreamController.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.ERROR,events.default.KEY_LOADED,events.default.FRAG_LOADED,events.default.SUBTITLE_TRACKS_UPDATED,events.default.SUBTITLE_TRACK_SWITCH,events.default.SUBTITLE_TRACK_LOADED,events.default.SUBTITLE_FRAG_PROCESSED,events.default.LEVEL_UPDATED)||this).fragmentTracker=fragmentTracker,_this.config=hls.config,_this.state=State_STOPPED,_this.tracks=[],_this.tracksBuffered=[],_this.currentTrackId=-1,_this.decrypter=new decrypter.default(hls,hls.config),_this.lastAVStart=0,_this._onMediaSeeking=_this.onMediaSeeking.bind(function subtitle_stream_controller_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(_this)),_this}!function subtitle_stream_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(SubtitleStreamController,_BaseStreamController);var _proto=SubtitleStreamController.prototype;return _proto.onSubtitleFragProcessed=function onSubtitleFragProcessed(data){var frag=data.frag,success=data.success;if(this.fragPrevious=frag,this.state=State_IDLE,success){var buffered=this.tracksBuffered[this.currentTrackId];if(buffered){for(var timeRange,fragStart=frag.start,i=0;i<buffered.length;i++)if(fragStart>=buffered[i].start&&fragStart<=buffered[i].end){timeRange=buffered[i];break}var fragEnd=frag.start+frag.duration;timeRange?timeRange.end=fragEnd:(timeRange={start:fragStart,end:fragEnd},buffered.push(timeRange))}}},_proto.onMediaAttached=function onMediaAttached(_ref){var media=_ref.media;this.media=media,media.addEventListener("seeking",this._onMediaSeeking),this.state=State_IDLE},_proto.onMediaDetaching=function onMediaDetaching(){var _this2=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(track){_this2.tracksBuffered[track.id]=[]})),this.media=null,this.state=State_STOPPED)},_proto.onError=function onError(data){var frag=data.frag;frag&&"subtitle"===frag.type&&(this.state=State_IDLE)},_proto.onSubtitleTracksUpdated=function onSubtitleTracksUpdated(data){var _this3=this;logger.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=data.subtitleTracks,this.tracks.forEach((function(track){_this3.tracksBuffered[track.id]=[]}))},_proto.onSubtitleTrackSwitch=function onSubtitleTrackSwitch(data){if(this.currentTrackId=data.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var currentTrack=this.tracks[this.currentTrackId];currentTrack&&currentTrack.details&&this.setInterval(500)}else this.clearInterval()},_proto.onSubtitleTrackLoaded=function onSubtitleTrackLoaded(data){var id=data.id,details=data.details,currentTrackId=this.currentTrackId,tracks=this.tracks,currentTrack=tracks[currentTrackId];id>=tracks.length||id!==currentTrackId||!currentTrack||(details.live&&function mergeSubtitlePlaylists(oldPlaylist,newPlaylist,referenceStart){void 0===referenceStart&&(referenceStart=0);var lastIndex=-1;mapFragmentIntersection(oldPlaylist,newPlaylist,(function(oldFrag,newFrag,index){newFrag.start=oldFrag.start,lastIndex=index}));var frags=newPlaylist.fragments;if(lastIndex<0)frags.forEach((function(frag){frag.start+=referenceStart}));else for(var i=lastIndex+1;i<frags.length;i++)frags[i].start=frags[i-1].start+frags[i-1].duration}(currentTrack.details,details,this.lastAVStart),currentTrack.details=details,this.setInterval(500))},_proto.onKeyLoaded=function onKeyLoaded(){this.state===State_KEY_LOADING&&(this.state=State_IDLE)},_proto.onFragLoaded=function onFragLoaded(data){var fragCurrent=this.fragCurrent,decryptData=data.frag.decryptdata,fragLoaded=data.frag,hls=this.hls;if(this.state===State_FRAG_LOADING&&fragCurrent&&"subtitle"===data.frag.type&&fragCurrent.sn===data.frag.sn&&data.payload.byteLength>0&&decryptData&&decryptData.key&&"AES-128"===decryptData.method){var startTime=subtitle_stream_controller_performance.now();this.decrypter.decrypt(data.payload,decryptData.key.buffer,decryptData.iv.buffer,(function(decryptedData){var endTime=subtitle_stream_controller_performance.now();hls.trigger(events.default.FRAG_DECRYPTED,{frag:fragLoaded,payload:decryptedData,stats:{tstart:startTime,tdecrypt:endTime}})}))}},_proto.onLevelUpdated=function onLevelUpdated(_ref2){var frags=_ref2.details.fragments;this.lastAVStart=frags.length?frags[0].start:0},_proto.doTick=function doTick(){if(this.media)switch(this.state){case State_IDLE:var config=this.config,currentTrackId=this.currentTrackId,fragmentTracker=this.fragmentTracker,media=this.media,tracks=this.tracks;if(!tracks||!tracks[currentTrackId]||!tracks[currentTrackId].details)break;var foundFrag,maxBufferHole=config.maxBufferHole,maxFragLookUpTolerance=config.maxFragLookUpTolerance,maxConfigBuffer=Math.min(config.maxBufferLength,config.maxMaxBufferLength),bufferedInfo=BufferHelper.bufferedInfo(this._getBuffered(),media.currentTime,maxBufferHole),bufferEnd=bufferedInfo.end,bufferLen=bufferedInfo.len,trackDetails=tracks[currentTrackId].details,fragments=trackDetails.fragments,fragLen=fragments.length,end=fragments[fragLen-1].start+fragments[fragLen-1].duration;if(bufferLen>maxConfigBuffer)return;var fragPrevious=this.fragPrevious;bufferEnd<end?(fragPrevious&&trackDetails.hasProgramDateTime&&(foundFrag=findFragmentByPDT(fragments,fragPrevious.endProgramDateTime,maxFragLookUpTolerance)),foundFrag||(foundFrag=findFragmentByPTS(fragPrevious,fragments,bufferEnd,maxFragLookUpTolerance))):foundFrag=fragments[fragLen-1],foundFrag&&foundFrag.encrypted?(logger.logger.log("Loading key for "+foundFrag.sn),this.state=State_KEY_LOADING,this.hls.trigger(events.default.KEY_LOADING,{frag:foundFrag})):foundFrag&&fragmentTracker.getState(foundFrag)===FragmentState_NOT_LOADED&&(this.fragCurrent=foundFrag,this.state=State_FRAG_LOADING,this.hls.trigger(events.default.FRAG_LOADING,{frag:foundFrag}))}else this.state=State_IDLE},_proto.stopLoad=function stopLoad(){this.lastAVStart=0,_BaseStreamController.prototype.stopLoad.call(this)},_proto._getBuffered=function _getBuffered(){return this.tracksBuffered[this.currentTrackId]||[]},_proto.onMediaSeeking=function onMediaSeeking(){this.fragPrevious=null},SubtitleStreamController}(base_stream_controller_BaseStreamController);!function(KeySystems){KeySystems.WIDEVINE="com.widevine.alpha",KeySystems.PLAYREADY="com.microsoft.playready"}(KeySystems||(KeySystems={}));var requestMediaKeySystemAccess="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function eme_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var eme_controller=function(_EventHandler){function EMEController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHED,events.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,_this._licenseXhrSetup=void 0,_this._emeEnabled=void 0,_this._requestMediaKeySystemAccess=void 0,_this._config=void 0,_this._mediaKeysList=[],_this._media=null,_this._hasSetMediaKeys=!1,_this._requestLicenseFailureCount=0,_this._onMediaEncrypted=function(e){logger.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),_this._attemptSetMediaKeys(),_this._generateRequestWithPreferredKeySession(e.initDataType,e.initData)},_this._config=hls.config,_this._widevineLicenseUrl=_this._config.widevineLicenseUrl,_this._licenseXhrSetup=_this._config.licenseXhrSetup,_this._emeEnabled=_this._config.emeEnabled,_this._requestMediaKeySystemAccess=_this._config.requestMediaKeySystemAccessFunc,_this}!function eme_controller_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(EMEController,_EventHandler);var _proto=EMEController.prototype;return _proto.getLicenseServerUrl=function getLicenseServerUrl(keySystem){switch(keySystem){case KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+keySystem+'"')},_proto._attemptKeySystemAccess=function _attemptKeySystemAccess(keySystem,audioCodecs,videoCodecs){var _this2=this,mediaKeySystemConfigs=function getSupportedMediaKeySystemConfigurations(keySystem,audioCodecs,videoCodecs){switch(keySystem){case KeySystems.WIDEVINE:return function createWidevineMediaKeySystemConfigurations(audioCodecs,videoCodecs){var baseConfig={videoCapabilities:[]};return videoCodecs.forEach((function(codec){baseConfig.videoCapabilities.push({contentType:'video/mp4; codecs="'+codec+'"'})})),[baseConfig]}(0,videoCodecs);default:throw new Error("Unknown key-system: "+keySystem)}}(keySystem,0,videoCodecs);logger.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(keySystem,mediaKeySystemConfigs).then((function(mediaKeySystemAccess){_this2._onMediaKeySystemAccessObtained(keySystem,mediaKeySystemAccess)})).catch((function(err){logger.logger.error('Failed to obtain key-system "'+keySystem+'" access:',err)}))},_proto._onMediaKeySystemAccessObtained=function _onMediaKeySystemAccessObtained(keySystem,mediaKeySystemAccess){var _this3=this;logger.logger.log('Access for key-system "'+keySystem+'" obtained');var mediaKeysListItem={mediaKeysSessionInitialized:!1,mediaKeySystemAccess,mediaKeySystemDomain:keySystem};this._mediaKeysList.push(mediaKeysListItem),mediaKeySystemAccess.createMediaKeys().then((function(mediaKeys){mediaKeysListItem.mediaKeys=mediaKeys,logger.logger.log('Media-keys created for key-system "'+keySystem+'"'),_this3._onMediaKeysCreated()})).catch((function(err){logger.logger.error("Failed to create media-keys:",err)}))},_proto._onMediaKeysCreated=function _onMediaKeysCreated(){var _this4=this;this._mediaKeysList.forEach((function(mediaKeysListItem){mediaKeysListItem.mediaKeysSession||(mediaKeysListItem.mediaKeysSession=mediaKeysListItem.mediaKeys.createSession(),_this4._onNewMediaKeySession(mediaKeysListItem.mediaKeysSession))}))},_proto._onNewMediaKeySession=function _onNewMediaKeySession(keySession){var _this5=this;logger.logger.log("New key-system session "+keySession.sessionId),keySession.addEventListener("message",(function(event){_this5._onKeySessionMessage(keySession,event.message)}),!1)},_proto._onKeySessionMessage=function _onKeySessionMessage(keySession,message){logger.logger.log("Got EME message event, creating license request"),this._requestLicense(message,(function(data){logger.logger.log("Received license data (length: "+(data?data.byteLength:data)+"), updating key-session"),keySession.update(data)}))},_proto._attemptSetMediaKeys=function _attemptSetMediaKeys(){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var keysListItem=this._mediaKeysList[0];if(!keysListItem||!keysListItem.mediaKeys)return logger.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});logger.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(keysListItem.mediaKeys),this._hasSetMediaKeys=!0}},_proto._generateRequestWithPreferredKeySession=function _generateRequestWithPreferredKeySession(initDataType,initData){var _this6=this,keysListItem=this._mediaKeysList[0];if(!keysListItem)return logger.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(keysListItem.mediaKeysSessionInitialized)logger.logger.warn("Key-Session already initialized but requested again");else{var keySession=keysListItem.mediaKeysSession;if(!keySession)return logger.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!initData)return logger.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});logger.logger.log('Generating key-session request for "'+initDataType+'" init data type'),keysListItem.mediaKeysSessionInitialized=!0,keySession.generateRequest(initDataType,initData).then((function(){logger.logger.debug("Key-session generation succeeded")})).catch((function(err){logger.logger.error("Error generating key-session request:",err),_this6.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},_proto._createLicenseXhr=function _createLicenseXhr(url,keyMessage,callback){var xhr=new XMLHttpRequest,licenseXhrSetup=this._licenseXhrSetup;try{if(licenseXhrSetup)try{licenseXhrSetup(xhr,url)}catch(e){xhr.open("POST",url,!0),licenseXhrSetup(xhr,url)}xhr.readyState||xhr.open("POST",url,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return xhr.responseType="arraybuffer",xhr.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,xhr,url,keyMessage,callback),xhr},_proto._onLicenseRequestReadyStageChange=function _onLicenseRequestReadyStageChange(xhr,url,keyMessage,callback){switch(xhr.readyState){case 4:if(200===xhr.status)this._requestLicenseFailureCount=0,logger.logger.log("License request succeeded"),"arraybuffer"!==xhr.responseType&&logger.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),callback(xhr.response);else{if(logger.logger.error("License Request XHR failed ("+url+"). Status: "+xhr.status+" ("+xhr.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var attemptsLeft=3-this._requestLicenseFailureCount+1;logger.logger.warn("Retrying license request, "+attemptsLeft+" attempts left"),this._requestLicense(keyMessage,callback)}}},_proto._generateLicenseRequestChallenge=function _generateLicenseRequestChallenge(keysListItem,keyMessage){switch(keysListItem.mediaKeySystemDomain){case KeySystems.WIDEVINE:return keyMessage}throw new Error("unsupported key-system: "+keysListItem.mediaKeySystemDomain)},_proto._requestLicense=function _requestLicense(keyMessage,callback){logger.logger.log("Requesting content license for key-system");var keysListItem=this._mediaKeysList[0];if(!keysListItem)return logger.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var _url=this.getLicenseServerUrl(keysListItem.mediaKeySystemDomain),_xhr=this._createLicenseXhr(_url,keyMessage,callback);logger.logger.log("Sending license request to URL: "+_url);var challenge=this._generateLicenseRequestChallenge(keysListItem,keyMessage);_xhr.send(challenge)}catch(e){logger.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},_proto.onMediaAttached=function onMediaAttached(data){if(this._emeEnabled){var media=data.media;this._media=media,media.addEventListener("encrypted",this._onMediaEncrypted)}},_proto.onMediaDetached=function onMediaDetached(){this._media&&(this._media.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null)},_proto.onManifestParsed=function onManifestParsed(data){if(this._emeEnabled){var audioCodecs=data.levels.map((function(level){return level.audioCodec})),videoCodecs=data.levels.map((function(level){return level.videoCodec}));this._attemptKeySystemAccess(KeySystems.WIDEVINE,audioCodecs,videoCodecs)}},function eme_controller_createClass(Constructor,protoProps,staticProps){return protoProps&&eme_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&eme_controller_defineProperties(Constructor,staticProps),Constructor}(EMEController,[{key:"requestMediaKeySystemAccess",get:function get(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),EMEController}(event_handler);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var hlsDefaultConfig=function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:xhr_loader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:abr_controller,bufferController:buffer_controller,capLevelController:cap_level_controller,fpsController:fps_controller,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess},function timelineConfig(){0;return{cueHandler:cues_namespaceObject,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es"}}(),{subtitleStreamController:subtitle_stream_controller_SubtitleStreamController,subtitleTrackController:subtitle_track_controller,timelineController:timeline_controller,audioStreamController:audio_stream_controller,audioTrackController:audio_track_controller,emeController:eme_controller});function hls_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function hls_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function hls_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function hls_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function hls_createClass(Constructor,protoProps,staticProps){return protoProps&&hls_defineProperties(Constructor.prototype,protoProps),staticProps&&hls_defineProperties(Constructor,staticProps),Constructor}var hls_Hls=function(_Observer){function Hls(userConfig){var _this;void 0===userConfig&&(userConfig={}),(_this=_Observer.call(this)||this).config=void 0,_this._autoLevelCapping=void 0,_this.abrController=void 0,_this.capLevelController=void 0,_this.levelController=void 0,_this.streamController=void 0,_this.networkControllers=void 0,_this.audioTrackController=void 0,_this.subtitleTrackController=void 0,_this.emeController=void 0,_this.coreComponents=void 0,_this.media=null,_this.url=null;var defaultConfig=Hls.DefaultConfig;if((userConfig.liveSyncDurationCount||userConfig.liveMaxLatencyDurationCount)&&(userConfig.liveSyncDuration||userConfig.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");_this.config=function hls_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?hls_ownKeys(Object(source),!0).forEach((function(key){hls_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):hls_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},defaultConfig,{},userConfig);var config=hls_assertThisInitialized(_this).config;if(void 0!==config.liveMaxLatencyDurationCount&&config.liveMaxLatencyDurationCount<=config.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==config.liveMaxLatencyDuration&&(void 0===config.liveSyncDuration||config.liveMaxLatencyDuration<=config.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(logger.enableLogs)(config.debug),_this._autoLevelCapping=-1;var abrController=_this.abrController=new config.abrController(hls_assertThisInitialized(_this)),bufferController=new config.bufferController(hls_assertThisInitialized(_this)),capLevelController=_this.capLevelController=new config.capLevelController(hls_assertThisInitialized(_this)),fpsController=new config.fpsController(hls_assertThisInitialized(_this)),playListLoader=new playlist_loader(hls_assertThisInitialized(_this)),fragmentLoader=new fragment_loader(hls_assertThisInitialized(_this)),keyLoader=new key_loader(hls_assertThisInitialized(_this)),id3TrackController=new id3_track_controller(hls_assertThisInitialized(_this)),levelController=_this.levelController=new level_controller_LevelController(hls_assertThisInitialized(_this)),fragmentTracker=new fragment_tracker_FragmentTracker(hls_assertThisInitialized(_this)),networkControllers=[levelController,_this.streamController=new stream_controller(hls_assertThisInitialized(_this),fragmentTracker)],Controller=config.audioStreamController;Controller&&networkControllers.push(new Controller(hls_assertThisInitialized(_this),fragmentTracker)),_this.networkControllers=networkControllers;var coreComponents=[playListLoader,fragmentLoader,keyLoader,abrController,bufferController,capLevelController,fpsController,id3TrackController,fragmentTracker];if(Controller=config.audioTrackController){var audioTrackController=new Controller(hls_assertThisInitialized(_this));_this.audioTrackController=audioTrackController,coreComponents.push(audioTrackController)}if(Controller=config.subtitleTrackController){var subtitleTrackController=new Controller(hls_assertThisInitialized(_this));_this.subtitleTrackController=subtitleTrackController,networkControllers.push(subtitleTrackController)}if(Controller=config.emeController){var emeController=new Controller(hls_assertThisInitialized(_this));_this.emeController=emeController,coreComponents.push(emeController)}return(Controller=config.subtitleStreamController)&&networkControllers.push(new Controller(hls_assertThisInitialized(_this),fragmentTracker)),(Controller=config.timelineController)&&coreComponents.push(new Controller(hls_assertThisInitialized(_this))),_this.coreComponents=coreComponents,_this}!function hls_inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(Hls,_Observer),Hls.isSupported=function isSupported(){return function is_supported_isSupported(){var mediaSource=getMediaSource();if(!mediaSource)return!1;var sourceBuffer=self.SourceBuffer||self.WebKitSourceBuffer,isTypeSupported=mediaSource&&"function"==typeof mediaSource.isTypeSupported&&mediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),sourceBufferValidAPI=!sourceBuffer||sourceBuffer.prototype&&"function"==typeof sourceBuffer.prototype.appendBuffer&&"function"==typeof sourceBuffer.prototype.remove;return!!isTypeSupported&&!!sourceBufferValidAPI}()},hls_createClass(Hls,null,[{key:"version",get:function get(){}},{key:"Events",get:function get(){return events.default}},{key:"ErrorTypes",get:function get(){return errors.ErrorTypes}},{key:"ErrorDetails",get:function get(){return errors.ErrorDetails}},{key:"DefaultConfig",get:function get(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig},set:function set(defaultConfig){Hls.defaultConfig=defaultConfig}}]);var _proto=Hls.prototype;return _proto.destroy=function destroy(){logger.logger.log("destroy"),this.trigger(events.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(component){component.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},_proto.attachMedia=function attachMedia(media){logger.logger.log("attachMedia"),this.media=media,this.trigger(events.default.MEDIA_ATTACHING,{media})},_proto.detachMedia=function detachMedia(){logger.logger.log("detachMedia"),this.trigger(events.default.MEDIA_DETACHING),this.media=null},_proto.loadSource=function loadSource(url){url=url_toolkit.buildAbsoluteURL(window.location.href,url,{alwaysNormalize:!0}),logger.logger.log("loadSource:"+url),this.url=url,this.trigger(events.default.MANIFEST_LOADING,{url})},_proto.startLoad=function startLoad(startPosition){void 0===startPosition&&(startPosition=-1),logger.logger.log("startLoad("+startPosition+")"),this.networkControllers.forEach((function(controller){controller.startLoad(startPosition)}))},_proto.stopLoad=function stopLoad(){logger.logger.log("stopLoad"),this.networkControllers.forEach((function(controller){controller.stopLoad()}))},_proto.swapAudioCodec=function swapAudioCodec(){logger.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},_proto.recoverMediaError=function recoverMediaError(){logger.logger.log("recoverMediaError");var media=this.media;this.detachMedia(),media&&this.attachMedia(media)},hls_createClass(Hls,[{key:"levels",get:function get(){return this.levelController.levels}},{key:"currentLevel",get:function get(){return this.streamController.currentLevel},set:function set(newLevel){logger.logger.log("set currentLevel:"+newLevel),this.loadLevel=newLevel,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function get(){return this.streamController.nextLevel},set:function set(newLevel){logger.logger.log("set nextLevel:"+newLevel),this.levelController.manualLevel=newLevel,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function get(){return this.levelController.level},set:function set(newLevel){logger.logger.log("set loadLevel:"+newLevel),this.levelController.manualLevel=newLevel}},{key:"nextLoadLevel",get:function get(){return this.levelController.nextLoadLevel},set:function set(level){this.levelController.nextLoadLevel=level}},{key:"firstLevel",get:function get(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function set(newLevel){logger.logger.log("set firstLevel:"+newLevel),this.levelController.firstLevel=newLevel}},{key:"startLevel",get:function get(){return this.levelController.startLevel},set:function set(newLevel){logger.logger.log("set startLevel:"+newLevel),-1!==newLevel&&(newLevel=Math.max(newLevel,this.minAutoLevel)),this.levelController.startLevel=newLevel}},{key:"capLevelToPlayerSize",set:function set(shouldStartCapping){var newCapLevelToPlayerSize=!!shouldStartCapping;newCapLevelToPlayerSize!==this.config.capLevelToPlayerSize&&(newCapLevelToPlayerSize?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=newCapLevelToPlayerSize)}},{key:"autoLevelCapping",get:function get(){return this._autoLevelCapping},set:function set(newLevel){logger.logger.log("set autoLevelCapping:"+newLevel),this._autoLevelCapping=newLevel}},{key:"bandwidthEstimate",get:function get(){var bwEstimator=this.abrController._bwEstimator;return bwEstimator?bwEstimator.getEstimate():NaN}},{key:"autoLevelEnabled",get:function get(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function get(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function get(){for(var levels=this.levels,minAutoBitrate=this.config.minAutoBitrate,len=levels?levels.length:0,i=0;i<len;i++){if((levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate)>minAutoBitrate)return i}return 0}},{key:"maxAutoLevel",get:function get(){var levels=this.levels,autoLevelCapping=this.autoLevelCapping;return-1===autoLevelCapping&&levels&&levels.length?levels.length-1:autoLevelCapping}},{key:"nextAutoLevel",get:function get(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function set(nextLevel){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,nextLevel)}},{key:"audioTracks",get:function get(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTracks:[]}},{key:"audioTrack",get:function get(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTrack:-1},set:function set(audioTrackId){var audioTrackController=this.audioTrackController;audioTrackController&&(audioTrackController.audioTrack=audioTrackId)}},{key:"liveSyncPosition",get:function get(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function get(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTracks:[]}},{key:"subtitleTrack",get:function get(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTrack:-1},set:function set(subtitleTrackId){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleTrack=subtitleTrackId)}},{key:"subtitleDisplay",get:function get(){var subtitleTrackController=this.subtitleTrackController;return!!subtitleTrackController&&subtitleTrackController.subtitleDisplay},set:function set(value){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleDisplay=value)}}]),Hls}(Observer);hls_Hls.defaultConfig=void 0},"./src/polyfills/number-isFinite.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"isFiniteNumber",(function(){return isFiniteNumber}));var isFiniteNumber=Number.isFinite||function(value){return"number"==typeof value&&isFinite(value)}},"./src/utils/get-self-scope.js":function(module,__webpack_exports__,__webpack_require__){function getSelfScope(){return"undefined"==typeof window?self:window}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"getSelfScope",(function(){return getSelfScope}))},"./src/utils/logger.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"enableLogs",(function(){return enableLogs})),__webpack_require__.d(__webpack_exports__,"logger",(function(){return logger}));var _get_self_scope__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/get-self-scope.js");function noop(){}var fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger;function formatMsg(type,msg){return msg="["+type+"] > "+msg}var global=Object(_get_self_scope__WEBPACK_IMPORTED_MODULE_0__.getSelfScope)();function consolePrintFn(type){var func=global.console[type];return func?function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];args[0]&&(args[0]=formatMsg(type,args[0])),func.apply(global.console,args)}:noop}var enableLogs=function enableLogs(debugConfig){if(global.console&&!0===debugConfig){!function exportLoggerFunctions(debugConfig){for(var _len2=arguments.length,functions=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)functions[_key2-1]=arguments[_key2];functions.forEach((function(type){exportedLogger[type]=debugConfig[type]?debugConfig[type].bind(debugConfig):consolePrintFn(type)}))}(debugConfig,"debug","log","info","warn","error");try{exportedLogger.log()}catch(e){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger},logger=exportedLogger}}).default}))}]);
//# sourceMappingURL=vip-player-ccbb7627700050f60644.js.map